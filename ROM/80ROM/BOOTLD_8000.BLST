 38)   007A 00          		 @SERERR DEFS 1	;
 42)   007B 00          		 @LCDCX DEFS 1        ;DISPLAY X POS (0..F  FOR 1..16)	;DISPLAY X POS (0..F  FOR 1..16)
 43)   007C 00          		 @LCDCY DEFS 1        ;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)	;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)
 44)   007D 00          		 @LCD_DSPCTRL DEFS 1       ;LCD I2C 16X2	;LCD I2C 16X2
 45)   007E 00          		 @LCD_DSPMODE DEFS 1       ;LCD I2C 16X2	;LCD I2C 16X2
 46)   007F 00          		 @LCD_STSMASK DEFS 1       ;LCD I2C 16X2  	;LCD I2C 16X2
 48)   0080 00          		 @KEYCTR DEFS 1        ;IN NB SYSTEM VARS	;IN NB SYSTEM VARS
 49)   0081 00          		 @LASTKEY DEFS 1  ;LAST KEY PRESSED	;LAST KEY PRESSED
 51)   0082 00 00 00 00 		 @BANKS DEFS 8        ;8 PAGES FOR THE 8 BANKS 0..7	;8 PAGES FOR THE 8 BANKS 0..7
 51)   0086 00 00 00 00 		 @BANKS DEFS 8        ;8 PAGES FOR THE 8 BANKS 0..7	;8 PAGES FOR THE 8 BANKS 0..7
 53)   008A 00          		 @STRG_STAT DEFS 1       ;STORAGE_NEW STAUS BIT 0=0 NOT CONNECTED,1=CONNECTED,BIT 7 DEVICE EXISTS	;STORAGE_NEW STAUS BIT 0=0 NOT CONNECTED, 1=CONNECTED, BIT 7 DEVICE EXISTS
 54)   008B 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   008F 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   0093 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   0097 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   009B 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   009F 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   00A3 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 54)   00A7 00 00       		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 59)   00A9 00 00       		 @PRGEX DEFS 2        ;ONLY FOR BOOTL	;ONLY FOR BOOTL
 60)   00AB 00          		 TVSTAT DEFS 1	;
 61)   00AC 00 00       		 @LINESTR DEFS 2       ;ADDRESS OF LINEBUF FOR PRINTING ON STRING	;ADDRESS OF LINEBUF FOR PRINTING ON STRING
 62)   00AE 00          		 @LINEPOS DEFS 1	;
 63)   00AF 00 00 00 00 		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 63)   00B3 00 00 00 00 		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 63)   00B7 00 00 00 00 		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 63)   00BB 00          		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 64)   00BC 00 00 00 00 		 @NUMBUF DEFS 7    	;
 64)   00C0 00 00 00    		 @NUMBUF DEFS 7    	;
 65)   00C3 00 00 00 00 		 @B2DINV DEFS 8        ;BINARY NUMBER TO BE CONVERTED	;BINARY NUMBER TO BE CONVERTED
 65)   00C7 00 00 00 00 		 @B2DINV DEFS 8        ;BINARY NUMBER TO BE CONVERTED	;BINARY NUMBER TO BE CONVERTED
 66)   00CB 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 66)   00CF 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 66)   00D3 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 66)   00D7 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 66)   00DB 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 67)   00DF 00          		 @B2DEND DEFS 1        ;0 FOR TERMINATE THE STRING        	;0 FOR TERMINATE THE STRING
 72)   00E0 00 00       		@CHANDATA:     DEFS 2	;
 73)   00E2 00 00       		               DEFS 2	;
 74)   00E4 00 00       		               DEFS 2	;
 75)   00E6 00 00       		               DEFS 2	;
 77)   00E8 00 00       		@CHANDEL:      DEFS 2	;
 78)   00EA 00 00       		               DEFS 2	;
 79)   00EC 00 00       		               DEFS 2	;
 80)   00EE 00 00       		               DEFS 2	;
 82)   00F0 00          		@CHANCN:       DEFS 1	;
 83)   00F1 00          		               DEFS 1	;
 84)   00F2 00          		               DEFS 1	;
 85)   00F3 00          		               DEFS 1	;
 86)   00F4 00          		@CHANST:       DEFS 1    ;CHANNEL STATUS  BITS 0-3 SET MEANS DISABLED     	;CHANNEL STATUS  BITS 0-3 SET MEANS DISABLED
112)   8000 2F          		 CPL         ;ROM IS HERE	;ROM IS HERE
113)   8001 C3 95 81    		 JP START	;
114)   8004 C3 5F 80    		 JP GETKEY        ;CALL HERE FROM NB ROM TO FIND THE GTNBKEY  $8004	;CALL HERE FROM NB ROM TO FIND THE GTNBKEY  $8004
115)   8007 C3 8B 80    		 JP RSTX        ; CALL HERE FROM NB TO FIND SERIAL TRASMIT  $8007	; CALL HERE FROM NB TO FIND SERIAL TRASMIT  $8007
116)   800A C3 8F 80    		 JP RSRX        ; CALL HERE FROM NB TO FIND SERIAL RECEIVE  $800A	; CALL HERE FROM NB TO FIND SERIAL RECEIVE  $800A
117)   800D C3 A5 80    		 JP NBSTLCD        ;CALL HERE FROM NB TO FIND THE NBSETLCD $800D	;CALL HERE FROM NB TO FIND THE NBSETLCD $800D
118)   8010 C3 E3 81    		 JP MENU        ;$8010	;$8010
119)   8013 C3 4F 80    		 JP CHKKEY       ;CALL HERE FROM NB TO FIND THE CHKKEY $8013 RET NZ FOR KEY AVAIL	;CALL HERE FROM NB TO FIND THE CHKKEY $8013 RET NZ FOR KEY AVAIL
124)   8016 CD 2C 8B    		@OS_PRINTCHAR: CALL RS_TX	;
125)   8019 C9          		 RET	;
129)   801A 7E          		@OS_PRINTTEXT: LD A, (HL)	;
130)   801B FE 00       		 CP 0	;
131)   801D C8          		 RET Z	;
132)   801E E5          		 PUSH HL	;
133)   801F CD 16 80    		 CALL OS_PRINTCHAR	;
134)   8022 E1          		 POP HL	;
135)   8023 23          		 INC HL	;
136)   8024 18 F4       		 JR OS_PRINTTEXT	;
139)   8026 E1          		@OS_PRINTMSG: POP HL	;
140)   8027 CD 1A 80    		 CALL OS_PRINTTEXT	;
141)   802A 23          		 INC HL	;
142)   802B E5          		 PUSH HL        ;CONTINUE AFTER THE MESG	;CONTINUE AFTER THE MESG
143)   802C C9          		 RET	;
149)   802D DF 3C       		@OS_PRCHSCR: DEFW WPTCHAR	;
150)   802F C9          		 RET	;
154)   8030 7E          		@OS_PRMESSCR:  LD A,(HL)	;
155)   8031 B7          		 OR A	;
156)   8032 C8          		 RET Z	;
157)   8033 DF 3C       		 DEFW WPTCHAR	;
158)   8035 23          		 INC HL	;
159)   8036 18 F8       		 JR OS_PRMESSCR	;
161)   8038 7E          		@OS_PRMESSCRSFE: LD A,(HL)	;
162)   8039 B7          		 OR A	;
163)   803A C8          		 RET Z	;
164)   803B FE 0A       		 CP $0A	;
165)   803D 28 04       		 JR Z,PMS_PRN	;
166)   803F FE 1F       		 CP 31 	;
167)   8041 38 04       		 JR C,PMS_SKP	;
168)   8043 DF 3C       		PMS_PRN: DEFW WPTCHAR	;
169)   8045 18 05       		 JR PMS_CNT	;
170)   8047 E5          		PMS_SKP:       PUSH HL	;
171)   8048 CD D9 80    		 CALL SOUTAS	;
172)   804B E1          		 POP HL	;
173)   804C 23          		PMS_CNT: INC HL	;
174)   804D 18 E9       		 JR OS_PRMESSCRSFE	;
178)   804F 47          		CHKKEY: LD B,A	;
179)   8050 CD 93 8B    		 CALL RS_KEYRD 	;
180)   8053 20 04       		 JR NZ, CK_EX       ;ZF SET IF NO KEY ON SERIAL	;ZF SET IF NO KEY ON SERIAL
181)   8055 DB 06       		 IN A,(6)	;
182)   8057 CB 5F       		 BIT 3,A        ;CHECK IF REAL KBD HAS AVAIL KEY, ZF SET IF NO KEY ON REAL KBD	;CHECK IF REAL KBD HAS AVAIL KEY, ZF SET IF NO KEY ON REAL KBD
183)   8059 78          		CK_EX: LD A,B	;
184)   805A 16 A0       		 LD D,$A0        ;DISPCOM 	;DISPCOM
185)   805C CB B6       		 RES 6,(HL)       ;KDATA= BIT 6 	;KDATA= BIT 6
186)   805E C9          		 RET	;
188)   805F E5          		GETKEY: PUSH HL	;
189)   8060 D5          		 PUSH DE	;
190)   8061 C5          		 PUSH BC	;
192)   8062 CD C4 89    		 CALL PS2KEYAVAIL       ;ZF=0 IF WE HAVE A KEY ELSE 1	;ZF=0 IF WE HAVE A KEY ELSE 1
193)   8065 20 05       		 JR NZ, KEYAVAIL       ;CHECK FOR SERIAL INPUT	;CHECK FOR SERIAL INPUT
194)   8067 CD C9 89    		 CALL READKBCHAR       ;READ KEY FROM PS/2	;READ KEY FROM PS/2
195)   806A 18 10       		 JR RGT        ;NB TRANSLATION AND EXIT	;NB TRANSLATION AND EXIT
197)   806C CD 63 8B    		KEYAVAIL: CALL RS_RX       ;GET A CHAR FROM RS232 OR PS2_KEYB	;GET A CHAR FROM RS232 OR PS2_KEYB
198)   806F FE FE       		 CP 254        ;BREAK KEY	;BREAK KEY
199)   8071 20 09       		 JR NZ,RGT	;
205)   8073 21 3C 00    		 LD HL,COPST	;
206)   8076 36 66       		 LD (HL),102  ;SIMULATE BREAK	;SIMULATE BREAK
207)   8078 3E 19       		 LD A,$19 	;
208)   807A 18 03       		 JR KAEXIT	;
209)   807C CD 0E 88    		RGT: CALL GTNBKEY        ;KEY PRESSED TRANSLATE FOR NB	;KEY PRESSED TRANSLATE FOR NB
218)   807F C1          		KAEXIT: POP BC	;
219)   8080 D1          		 POP DE	;
220)   8081 E1          		 POP HL  	;
221)   8082 FE 00       		 CP 0         ;CHECK IF INVALID KEY	;CHECK IF INVALID KEY
222)   8084 C0          		 RET NZ	;
223)   8085 CB B6       		 RES KDATA (HL)        ; KEY INVALID RESET KDATA TEST BIT	; KEY INVALID RESET KDATA TEST BIT
224)   8087 23          		 INC HL         ;GET TO THE LAST VALID KEY	;GET TO THE LAST VALID KEY
225)   8088 7E          		 LD A, (HL)	;
226)   8089 2B          		 DEC HL	;
227)   808A C9          		 RET	;
229)   808B CD 2C 8B    		RSTX: CALL RS_TX	;
230)   808E C9          		 RET	;
232)   808F CD 63 8B    		RSRX: CALL RS_RX	;
233)   8092 C9          		 RET	;
236)   8093 E5          		LCD16SETCURS:  PUSH HL	;
237)   8094 C5          		 PUSH BC	;
238)   8095 CD 5B 94    		 CALL LCD16_SETCURS       ;SET LCD TO LCDCX,LCDCY	;SET LCD TO LCDCX,LCDCY
239)   8098 C1          		 POP BC	;
240)   8099 E1          		 POP HL	;
241)   809A C9          		 RET	;
243)   809B E5          		LCD16PRCHR: PUSH HL     ;OUTPUT CHAR TO LCD	;OUTPUT CHAR TO LCD
244)   809C C5          		 PUSH BC	;
245)   809D D5          		 PUSH DE	;
246)   809E CD 4A 94    		 CALL LCD16_PRCHR	;
247)   80A1 D1          		 POP DE	;
248)   80A2 C1          		 POP BC	;
249)   80A3 E1          		 POP HL	;
250)   80A4 C9          		 RET	;
256)   80A5 D5          		NBSTLCD: PUSH DE	;
257)   80A6 42          		 LD B, D        ;TOTAL CHARS	;TOTAL CHARS
258)   80A7 05          		 DEC B	;
259)   80A8 05          		 DEC B         ;SKIP 2	;SKIP 2
260)   80A9 11 0F 00    		 LD DE, 15        ;START FROM THE END	;START FROM THE END
261)   80AC 19          		 ADD HL, DE	;
262)   80AD AF          		 XOR A	;
263)   80AE 11 7B 00    		 LD DE, LCDCX        ;LCD POSITION	;LCD POSITION
264)   80B1 12          		 LD (DE), A	;
265)   80B2 13          		 INC DE	;
266)   80B3 12          		 LD (DE), A	;
268)   80B4 D5          		 PUSH DE	;
269)   80B5 57          		 LD D, A	;
270)   80B6 5F          		 LD E, A	;
271)   80B7 CD 93 80    		 CALL LCD16SETCURS       ;SET LCD TO LCDCX,LCDCY	;SET LCD TO LCDCX,LCDCY
272)   80BA D1          		 POP DE	;
273)   80BB 1B          		 DEC DE         ;POSITION ON LCDCX	;POSITION ON LCDCX
274)   80BC 0E 00       		 LD C, 0        ;LCD POSITION COUNT	;LCD POSITION COUNT
275)   80BE 7E          		NBSETLP: LD A, (HL)	;
276)   80BF CB 7F       		 BIT 7, A        ;CHECK IF CURSOR HERE	;CHECK IF CURSOR HERE
277)   80C1 28 06       		 JR Z, NBNXT	;
278)   80C3 F5          		 PUSH AF	;
279)   80C4 79          		 LD A, C	;
280)   80C5 12          		 LD (DE), A        ;POSITION CURSOR	;POSITION CURSOR
281)   80C6 F1          		 POP AF	;
282)   80C7 CB BF       		 RES 7, A        ;CLEAR CHAR FROM CURSOR INFO	;CLEAR CHAR FROM CURSOR INFO
283)   80C9 CD 9B 80    		NBNXT: CALL LCD16PRCHR       ;OUTPUT CHAR TO LCD	;OUTPUT CHAR TO LCD
284)   80CC 2B          		 DEC HL	;
285)   80CD 0C          		 INC C	;
286)   80CE 10 EE       		 DJNZ NBSETLP        ;LOOP NEXT CHAR	;LOOP NEXT CHAR
287)   80D0 1A          		 LD A,(DE)	;
288)   80D1 57          		 LD D, A	;
289)   80D2 1E 00       		 LD E, 0	;
290)   80D4 CD 5B 94    		 CALL LCD16_SETCURS       ;POSITION CURSOR	;POSITION CURSOR
291)   80D7 D1          		 POP DE	;
292)   80D8 C9          		 RET	;
296)   80D9 F5          		SOUTAS: PUSH AF        ;SERIAL PRINT ASCII IN DECIMAL	;SERIAL PRINT ASCII IN DECIMAL
297)   80DA 26 00       		 LD H, 0	;
298)   80DC 6F          		 LD L, A	;
299)   80DD 11 AF 00    		 LD DE, MYNUM	;
300)   80E0 CD B1 9A    		 CALL OUTASC	;
302)   80E3 3E 0A       		 LD A, 10	;
303)   80E5 12          		 LD (DE), A	;
304)   80E6 13          		 INC DE	;
305)   80E7 3E 0D       		 LD A, 13	;
306)   80E9 12          		 LD (DE), A	;
307)   80EA 13          		 INC DE	;
308)   80EB AF          		 XOR A	;
309)   80EC 12          		 LD (DE), A	;
311)   80ED 21 AF 00    		 LD HL, MYNUM	;
312)   80F0 CD 3B 8B    		 CALL RS_TXT	;
313)   80F3 F1          		 POP AF	;
314)   80F4 C9          		 RET	;
317)   80F5 E5          		TVON: PUSH HL	;
318)   80F6 21 AB 00    		 LD HL, TVSTAT	;
319)   80F9 CB D6       		 SET 2, (HL)	;
320)   80FB 21 24 00    		 LD HL, 36	;
321)   80FE CB D6       		 SET 2, (HL)	;
322)   8100 E1          		 POP HL	;
323)   8101 18 12       		 JR RESTV	;
326)   8103 E5          		TVOFF: PUSH HL	;
327)   8104 21 AB 00    		 LD HL, TVSTAT	;
328)   8107 CB 96       		 RES 2, (HL)	;
329)   8109 21 24 00    		 LD HL, 36	;
330)   810C CB 96       		 RES 2, (HL)	;
331)   810E E1          		 POP HL	;
332)   810F 18 04       		 JR RESTV	;
335)   8111 AF          		TVOFTM: XOR A         ;TV OFF	;TV OFF
336)   8112 D3 07       		 OUT (7), A	;
337)   8114 C9          		 RET	;
339)   8115 E5          		RESTV: PUSH HL	;
340)   8116 21 AB 00    		 LD HL, TVSTAT	;
341)   8119 7E          		 LD A, (HL)	;
342)   811A D3 07       		 OUT (7), A	;
343)   811C 3E 05       		 LD A, 5	;
344)   811E D3 09       		 OUT (9), A        ; SET DISPLAY ADDRESS	; SET DISPLAY ADDRESS
345)   8120 E1          		 POP HL	;
346)   8121 C9          		 RET	;
349)   8122 5C 43 48 53 		FONTNAME1 DEFM "\CHSET4.CHR"	;
349)   8126 45 54 34 2E 		FONTNAME1 DEFM "\CHSET4.CHR"	;
349)   812A 43 48 52    		FONTNAME1 DEFM "\CHSET4.CHR"	;
350)   812D 00          		 DB 0	;
351)   812E 5C 43 48 53 		FONTNAME2 DEFM "\CHSET2.CHR"	;
351)   8132 45 54 32 2E 		FONTNAME2 DEFM "\CHSET2.CHR"	;
351)   8136 43 48 52    		FONTNAME2 DEFM "\CHSET2.CHR"	;
352)   8139 00          		 DB 0	;
354)   813A 06 02       		LOADFONTS: LD B,2  ;BANK2	;BANK2
355)   813C 3E 08       		 LD A,8   ;VIDEO PAGE FOR FONTS   	;VIDEO PAGE FOR FONTS
356)   813E CD E8 8A    		 CALL PUTPGINBANK  	;
357)   8141 21 22 81    		 LD HL,FONTNAME1	;
358)   8144 01 B8 0B    		 LD BC,3000  ;MAX FILE SIZE	;MAX FILE SIZE
359)   8147 11 00 40    		 LD DE,$4000  ;0000 ON PAGE 8	;0000 ON PAGE 8
360)   814A CD C7 8E    		 CALL STRG_LOADFILE	;
361)   814D 30 01       		 JR NC, LFFILOK	;
362)   814F 76          		 HALT   ;STOP EXEC	;STOP EXEC
363)   8150 21 2E 81    		LFFILOK: LD HL,FONTNAME2	;
364)   8153 01 B8 0B    		 LD BC,3000  ;MAX FILE SIZE	;MAX FILE SIZE
365)   8156 11 00 50    		 LD DE,$5000  ;1000h ON PAGE 8	;1000h ON PAGE 8
366)   8159 CD C7 8E    		 CALL STRG_LOADFILE  	;
367)   815C 30 01       		 JR NC, LFFILOK2	;
368)   815E 76          		 HALT   ;STOP EXEC	;STOP EXEC
369)   815F 3E 0E       		LFFILOK2: LD A,14  ;BANK 2 ON NBRAIN RESTORE PAGE 14	;BANK 2 ON NBRAIN RESTORE PAGE 14
370)   8161 06 02       		 LD B,2	;
371)   8163 CD E8 8A    		 CALL PUTPGINBANK	;
372)   8166 C9          		 RET 	;
375)   8167 15 02 00 18 		SCRDATA DB        $15,$02,$00,$18,$18,$28,$40,$20	;
375)   816B 18 28 40 20 		SCRDATA DB        $15,$02,$00,$18,$18,$28,$40,$20	;
376)   816F 00 02 00 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
376)   8173 00 00 0A 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
376)   8177 00 00 FF 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
376)   817B AB 00 00 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
377)   817F 00 B1       		 DB $00,$B1	;
379)   8181 21 67 81    		SETSCRDATA: LD HL,SCRDATA	;
380)   8184 11 68 02    		 LD DE,$268	;
381)   8187 01 1A 00    		 LD BC,26	;
382)   818A ED B0       		 LDIR	;
383)   818C 21 5C 00    		 LD HL,$5C	;
384)   818F 36 68       		 LD (HL),$68  ;VIDEO START	;VIDEO START
385)   8191 23          		 INC HL	;
386)   8192 36 02       		 LD (HL),$02	;
387)   8194 C9          		 RET	;
391)   8195 F3          		START: DI	;
392)   8196 CD DB 87    		 CALL STNEWD        ;SET NEWDRIVERS AND DEFSTORE DEVICE	;SET NEWDRIVERS AND DEFSTORE DEVICE
394)   8199 CD 03 81    		 CALL TVOFF	;
399)   819C 3E 01       		 LD A, 1        ;1=115200 BPS	;1=115200 BPS
400)   819E CD 13 8B    		 CALL RS_INI        ;RS232 INITIALIZE	;RS232 INITIALIZE
401)   81A1 21 D2 83    		 LD HL, STR00	;
402)   81A4 CD 3B 8B    		 CALL RS_TXT  	;
403)   81A7 21 BF 83    		 LD HL, STRSCR	;
404)   81AA CD 3B 8B    		 CALL RS_TXT	;
406)   81AD CD BE 89    		 CALL PS2KBINIT  	;
408)   81B0 CD 70 92    		 CALL I2C_INIT	;
409)   81B3 CD 66 95    		 CALL DS1307_INIT       ;	;
410)   81B6 CD D5 95    		 CALL DS1307_ADJUST_TEST      ;SET A DEFAULT DATETIME ON DS1307	;SET A DEFAULT DATETIME ON DS1307
411)   81B9 CD B6 93    		 CALL LCD16_INIT       ;LCD 16x2 Initialized	;LCD 16x2 Initialized
412)   81BC 21 30 83    		 LD HL, STR0	;
413)   81BF CD 40 94    		 CALL LCD16_PRINT	;
415)   81C2 CD D6 96    		 CALL SND_INIT  	;
416)   81C5 CD 18 97    		 CALL SND_BEEP	;
417)   81C8 CD 1F 97    		 CALL SND_BEEP2	;
418)   81CB CD 18 97    		 CALL SND_BEEP	;
429)   81CE CD 81 81    		ALLOK: CALL SETSCRDATA	;
430)   81D1 CD 0B 84    		 CALL SCCLS        ;CLEAR SCREEN BUFFER  	;CLEAR SCREEN BUFFER
431)   81D4 21 40 83    		 LD HL, STR02	;
432)   81D7 CD 4B 84    		 CALL SCPRN        ;PRINT WAITING AT SCREEN BUFFER	;PRINT WAITING AT SCREEN BUFFER
434)   81DA CD 3A 81    		 CALL LOADFONTS       ;LOAD NEWBRAIN FONTS TO VIDEO RAM	;LOAD NEWBRAIN FONTS TO VIDEO RAM
435)   81DD CD F5 80    		 CALL TVON	;
437)   81E0 CD F5 89    		 CALL PATCHCMDS       ;PATCH CD ROM TO IMPLEMENT OUR OWN COMMANDS	;PATCH CD ROM TO IMPLEMENT OUR OWN COMMANDS
440)   81E3 21 89 83    		 LD HL, STRMN	;
441)   81E6 CD 3B 8B    		 CALL RS_TXT        ;OUTPUT MENU COMMANDS AT RS232	;OUTPUT MENU COMMANDS AT RS232
442)   81E9 21 E8 83    		 LD HL, STR01	;
443)   81EC CD 3B 8B    		 CALL RS_TXT        ;OUTPUT WAITING AT RS232	;OUTPUT WAITING AT RS232
445)   81EF CD 37 94    		 CALL LCD16_CLR	;
447)   81F2 21 40 83    		 LD HL, STR02	;
448)   81F5 CD 40 94    		 CALL LCD16_PRINT	;
450)   81F8 21 11 83    		 LD HL, SMENU	;
451)   81FB 3E 02       		 LD A, 2	;
452)   81FD CD 4B 84    		 CALL SCPRN	;
454)   8200 CD 1F 82    		 CALL GET_KBCHAR       ;TAKE A CHAR FROM RS232 OR PS2 KEYB	;TAKE A CHAR FROM RS232 OR PS2 KEYB
457)   8203 FE 55       		 CP 'U'         ;UPLOAD PROGRAM	;UPLOAD PROGRAM
458)   8205 CC 84 82    		 CALL Z, UPLOD	;
459)   8208 FE 58       		 CP 'X'	;
460)   820A CA 67 82    		 JP Z, EXEC	;
461)   820D FE 53       		 CP 'S'	;
462)   820F CC E8 82    		 CALL Z, TXTSCR	;
463)   8212 FE 4E       		 CP 'N'	;
464)   8214 CA 46 82    		 JP Z, GONB        ;$E090	;$E090
465)   8217 FE 44       		 CP 'D'	;
466)   8219 CC CD 82    		 CALL Z, DNLOD	;
468)   821C C3 E3 81    		 JP MENU	;
471)   821F AF          		GET_KBCHAR: XOR A	;
474)   8220 CD 93 8B    		 CALL RS_KEYRD        ;CHAR IN RS232?	;CHAR IN RS232?
475)   8223 28 04       		 JR Z, GT_TST2	;
477)   8225 CD 63 8B    		 CALL RS_RX        ; GET THAT CHAR	; GET THAT CHAR
478)   8228 C9          		 RET	;
480)   8229 CD C4 89    		GT_TST2: CALL PS2KEYAVAIL      ;ZF=0 IF WE HAVE A KEY ELSE 1	;ZF=0 IF WE HAVE A KEY ELSE 1
481)   822C 20 F1       		 JR NZ, GET_KBCHAR       ;RECHECK	;RECHECK
482)   822E CD C9 89    		 CALL READKBCHAR	;
483)   8231 B7          		 OR A	;
484)   8232 CA 1F 82    		 JP Z,GET_KBCHAR	;
493)   8235 C9          		 RET	;
495)   8236 16 00       		LCDLN1: LD D, 0	;
496)   8238 1E 00       		 LD E, 0	;
497)   823A CD 5B 94    		 CALL LCD16_SETCURS  ; D HAS THE COLUMN E HAS THE ROW	; D HAS THE COLUMN E HAS THE ROW
498)   823D C9          		 RET	;
500)   823E 16 00       		LCDLN2: LD D, 0	;
501)   8240 1E 01       		 LD E, 1	;
502)   8242 CD 5B 94    		 CALL LCD16_SETCURS ; D HAS THE COLUMN E HAS THE ROW	; D HAS THE COLUMN E HAS THE ROW
503)   8245 C9          		 RET	;
507)   8246 21 E0 00    		GONB: LD HL,DIRNM	;
508)   8249 3E 2F       		 LD A,'/'	;
509)   824B 77          		 LD (HL),A	;
510)   824C 23          		 INC HL	;
511)   824D 36 00       		 LD (HL),0	;
512)   824F 23          		 INC HL	;
513)   8250 36 00       		 LD (HL),0	;
514)   8252 CD 3E 82    		 CALL LCDLN2	;
515)   8255 21 00 83    		 LD HL, DSPMES	;
516)   8258 CD 40 94    		 CALL LCD16_PRINT	;
517)   825B CD 6A 94    		 CALL LCD16_CURSOFF       ;CURSOR OFF	;CURSOR OFF
518)   825E CD 94 94    		 CALL LCD16_BLINKON       ;BLINK ON	;BLINK ON
519)   8261 AF          		 XOR A	;
520)   8262 D3 E0       		 OUT (INTENB),A       ;ENABLE INTERRUPTS ON NB	;ENABLE INTERRUPTS ON NB
521)   8264 C3 15 A0    		 JP $A015	;
526)   8267 CD 37 94    		EXEC: CALL LCD16_CLR	;
527)   826A CD 3E 82    		 CALL LCDLN2	;
528)   826D 21 67 83    		 LD HL, SPRGX	;
529)   8270 CD 40 94    		 CALL LCD16_PRINT	;
530)   8273 CD 36 82    		 CALL LCDLN1	;
532)   8276 3E 05       		 LD A, 5	;
533)   8278 CD 4B 84    		 CALL SCPRN	;
535)   827B 11 A9 00    		 LD DE, PRGEX	;
536)   827E 1A          		 LD A, (DE)	;
537)   827F 6F          		 LD L, A	;
538)   8280 13          		 INC DE	;
539)   8281 1A          		 LD A, (DE)	;
540)   8282 67          		 LD H, A	;
541)   8283 E9          		 JP (HL)	;
544)   8284 21 5A 83    		UPLOD: LD HL, DATST	;
545)   8287 CD 3E 82    		 CALL LCDLN2	;
546)   828A CD 40 94    		 CALL LCD16_PRINT	;
548)   828D CD 63 8B    		 CALL RS_RX        ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
549)   8290 6F          		 LD L, A	;
550)   8291 CD 63 8B    		 CALL RS_RX	;
551)   8294 67          		 LD H, A	;
552)   8295 CD 63 8B    		 CALL RS_RX        ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
553)   8298 4F          		 LD C, A	;
554)   8299 CD 63 8B    		 CALL RS_RX	;
555)   829C 47          		 LD B, A	;
557)   829D 11 A9 00    		 LD DE, PRGEX        ;SAVE TO PRGEX THE PROG EXEC ADDR=HL	;SAVE TO PRGEX THE PROG EXEC ADDR=HL
558)   82A0 7D          		 LD A, L	;
559)   82A1 12          		 LD (DE), A	;
560)   82A2 13          		 INC DE	;
561)   82A3 7C          		 LD A, H	;
562)   82A4 12          		 LD (DE), A	;
564)   82A5 FE 80       		 CP $80	;
565)   82A7 28 02       		 JR Z, ROMWR	;
566)   82A9 38 02       		 JR C, NORWR	;
568)   82AB D3 7C       		ROMWR: OUT (124), A       ;SET ROM WRITABLE = '0'     	;SET ROM WRITABLE = '0'
570)   82AD E5          		NORWR: PUSH HL	;
571)   82AE CD 63 8B    		NXB: CALL RS_RX	;
572)   82B1 77          		 LD (HL), A	;
573)   82B2 23          		 INC HL	;
574)   82B3 0B          		 DEC BC	;
575)   82B4 78          		 LD A, B	;
576)   82B5 B1          		 OR C	;
577)   82B6 20 F6       		 JR NZ, NXB        ;LOOP ALL BYTES	;LOOP ALL BYTES
579)   82B8 D3 7D       		 OUT (125), A        ;SET ROM NON WRITABLE ='1'	;SET ROM NON WRITABLE ='1'
581)   82BA 21 4B 83    		 LD HL, DATTR	;
582)   82BD CD 37 94    		 CALL LCD16_CLR	;
583)   82C0 CD 40 94    		 CALL LCD16_PRINT	;
584)   82C3 3E 05       		 LD A, 5	;
585)   82C5 CD 4B 84    		 CALL SCPRN	;
586)   82C8 CD 8A 9A    		 CALL DELAY	;
588)   82CB E1          		 POP HL	;
590)   82CC C9          		 RET	;
597)   82CD CD 63 8B    		DNLOD: CALL RS_RX        ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
598)   82D0 6F          		 LD L, A	;
599)   82D1 CD 63 8B    		 CALL RS_RX	;
600)   82D4 67          		 LD H, A	;
601)   82D5 CD 63 8B    		 CALL RS_RX        ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
602)   82D8 4F          		 LD C, A	;
603)   82D9 CD 63 8B    		 CALL RS_RX	;
604)   82DC 47          		 LD B, A	;
606)   82DD 7E          		NXB3: LD A, (HL)	;
607)   82DE CD 2C 8B    		 CALL RS_TX        ;SEND BYTE	;SEND BYTE
608)   82E1 23          		 INC HL	;
609)   82E2 0B          		 DEC BC	;
610)   82E3 78          		 LD A, B	;
611)   82E4 B1          		 OR C	;
612)   82E5 20 F6       		 JR NZ, NXB3        ;LOOP ALL BYTES   	;LOOP ALL BYTES
613)   82E7 C9          		 RET	;
616)   82E8 21 73 83    		TXTSCR: LD HL, TXTMES        ;SCREEN START	;SCREEN START
617)   82EB 11 82 02    		 LD DE, TXTRAM	;
618)   82EE 01 15 00    		 LD BC, 21	;
619)   82F1 ED B0       		 LDIR	;
621)   82F3 21 73 83    		 LD HL, TXTMES	;
622)   82F6 11 C2 02    		 LD DE, TXTRAM + 64       ;SCREEN START+64 40chars screen +24 excess	;SCREEN START+64 40chars screen +24 excess
623)   82F9 01 15 00    		 LD BC, 21	;
624)   82FC ED B0       		 LDIR	;
626)   82FE AF          		 XOR A	;
627)   82FF C9          		 RET	;
630)   8300 3C 3C 20 43 		DSPMES: DEFM "<< CDESP 2022 >>"	;
630)   8304 44 45 53 50 		DSPMES: DEFM "<< CDESP 2022 >>"	;
630)   8308 20 32 30 32 		DSPMES: DEFM "<< CDESP 2022 >>"	;
630)   830C 32 20 3E 3E 		DSPMES: DEFM "<< CDESP 2022 >>"	;
631)   8310 00          		 DB 0  	;
633)   8311 55 3A 55 50 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   8315 2C 58 3A 52 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   8319 55 4E 2C 53 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   831D 3A 44 49 53 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   8321 50 2C 4E 3A 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   8325 4E 42 52 4F 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   8329 4D 2C 44 3A 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
633)   832D 44 4E       		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
634)   832F 00          		 DB 0 	;
636)   8330 4C 43 44 20 		STR0: DEFM "LCD INITIALIZED"	;
636)   8334 49 4E 49 54 		STR0: DEFM "LCD INITIALIZED"	;
636)   8338 49 41 4C 49 		STR0: DEFM "LCD INITIALIZED"	;
636)   833C 5A 45 44    		STR0: DEFM "LCD INITIALIZED"	;
637)   833F 00          		 DB 0	;
639)   8340 57 41 49 54 		STR02: DEFM "WAITING..."	;
639)   8344 49 4E 47 2E 		STR02: DEFM "WAITING..."	;
639)   8348 2E 2E       		STR02: DEFM "WAITING..."	;
640)   834A 00          		 DB 0	;
642)   834B 50 52 47 20 		DATTR: DEFM "PRG TRANSFERED"	;
642)   834F 54 52 41 4E 		DATTR: DEFM "PRG TRANSFERED"	;
642)   8353 53 46 45 52 		DATTR: DEFM "PRG TRANSFERED"	;
642)   8357 45 44       		DATTR: DEFM "PRG TRANSFERED"	;
643)   8359 00          		 DB 0	;
645)   835A 52 45 43 45 		DATST: DEFM "RECEIVING..."	;
645)   835E 49 56 49 4E 		DATST: DEFM "RECEIVING..."	;
645)   8362 47 2E 2E 2E 		DATST: DEFM "RECEIVING..."	;
646)   8366 00          		 DB 0	;
648)   8367 50 52 47 20 		SPRGX: DEFM "PRG EXECUTE"	;
648)   836B 45 58 45 43 		SPRGX: DEFM "PRG EXECUTE"	;
648)   836F 55 54 45    		SPRGX: DEFM "PRG EXECUTE"	;
649)   8372 00          		 DB 0	;
651)   8373 4E 45 57 42 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
651)   8377 52 41 49 4E 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
651)   837B 20 53 43 52 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
651)   837F 45 45 4E 20 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
651)   8383 52 45 41 44 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
651)   8387 59          		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
652)   8388 00          		 DB 0	;
654)   8389 55 3A 55 50 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   838D 2C 58 3A 52 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   8391 55 4E 2C 53 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   8395 3A 44 49 53 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   8399 50 2C 4E 3A 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   839D 4E 42 52 4F 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   83A1 4D 2C 44 3A 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
654)   83A5 44 4E       		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
655)   83A7 0A 0D 00    		 DB 10,13,0	;
657)   83AA 4E 45 57 42 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
657)   83AE 52 41 49 4E 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
657)   83B2 20 42 4F 4F 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
657)   83B6 54 45 44 20 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
657)   83BA 4F 4B       		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
658)   83BC 0A 0D 00    		 DB 10,13,0	;
660)   83BF 43 4C 45 41 		STRSCR: DEFM "CLEARING SCREEN."	;
660)   83C3 52 49 4E 47 		STRSCR: DEFM "CLEARING SCREEN."	;
660)   83C7 20 53 43 52 		STRSCR: DEFM "CLEARING SCREEN."	;
660)   83CB 45 45 4E 2E 		STRSCR: DEFM "CLEARING SCREEN."	;
661)   83CF 0A 0D 00    		 DB 10,13,0	;
663)   83D2 0A 0D       		STR00: DB 10,13	;
664)   83D4 52 53 32 33 		 DEFM "RS232 INITIALIZED"	;
664)   83D8 32 20 49 4E 		 DEFM "RS232 INITIALIZED"	;
664)   83DC 49 54 49 41 		 DEFM "RS232 INITIALIZED"	;
664)   83E0 4C 49 5A 45 		 DEFM "RS232 INITIALIZED"	;
664)   83E4 44          		 DEFM "RS232 INITIALIZED"	;
665)   83E5 0A 0D 00    		 DB 10,13,0	;
667)   83E8 0A 0D       		STR01: DB 10,13	;
668)   83EA 57 41 49 54 		 DEFM "WAITING..."	;
668)   83EE 49 4E 47 2E 		 DEFM "WAITING..."	;
668)   83F2 2E 2E       		 DEFM "WAITING..."	;
669)   83F4 0A 0D 00    		 DB 10,13,0	;
670)   83F7 00          		 DB 0	;
 14)   83F8 E5          		SCCLL: PUSH HL	;
 15)   83F9 F5          		 PUSH AF	;
 16)   83FA 21 6A 84    		 LD HL, STCL4        ;40 LINE CLEAR	;40 LINE CLEAR
 17)   83FD CD 4E 84    		 CALL SCPRN1	;
 18)   8400 F1          		 POP AF	;
 19)   8401 E1          		 POP HL	;
 20)   8402 C9          		 RET	;
 23)   8403 AF          		 XOR A         ;LINE 0	;LINE 0
 24)   8404 21 77 85    		 LD HL, SCRDY	;
 25)   8407 CD 4B 84    		 CALL SCPRN	;
 26)   840A C9          		 RET	;
 30)   840B 06 19       		SCCLS: LD B, 25	;
 31)   840D AF          		 XOR A         ;; PRINT STR0 AT LINE 1	;; PRINT STR0 AT LINE 1
 32)   840E C5          		 TSTLP1 PUSH BC	;
 33)   840F CD F8 83    		 CALL SCCLL	;
 34)   8412 3C          		 INC A         ; NEXT LINE	; NEXT LINE
 35)   8413 C1          		 POP BC	;
 36)   8414 10 F8       		 DJNZ TSTLP1	;
 37)   8416 CD 03 84    		 CALL SCMSG1	;
 38)   8419 C9          		 RET	;
 43)   841A F5          		 PRNRGA PUSH AF	;
 44)   841B 06 08       		 LD B, 8	;
 45)   841D CB 07       		LPN5: RLC A         ; BIT 7 FIRST	; BIT 7 FIRST
 46)   841F F5          		 PUSH AF	;
 47)   8420 3E 00       		 LD A, 0	;
 48)   8422 30 02       		 JR NC, SKP5	;
 49)   8424 3E 01       		 LD A, 1	;
 50)   8426 C6 30       		 SKP5 ADD A, 48	;
 51)   8428 CD 31 84    		 CALL PRNCL        ; PRINT A AT COL,LINE	; PRINT A AT COL,LINE
 52)   842B 1C          		 INC E	;
 53)   842C F1          		 POP AF	;
 54)   842D 10 EE       		 DJNZ LPN5	;
 55)   842F F1          		 POP AF	;
 56)   8430 C9          		 RET	;
 59)   8431 E5          		PRNCL: PUSH HL	;
 60)   8432 D5          		 PUSH DE	;
 61)   8433 F5          		 PUSH AF	;
 62)   8434 C5          		 PUSH BC	;
 63)   8435 21 82 02    		 LD HL, TXTRAM	;
 64)   8438 42          		 LD B, D        ; D HAS THE LINE	; D HAS THE LINE
 65)   8439 D5          		 PUSH DE	;
 66)   843A 11 40 00    		 LD DE, 40 + 24        ; FOR 40 COLUMN SCREEN	; FOR 40 COLUMN SCREEN
 67)   843D 19          		LPN2: ADD HL, DE	;
 68)   843E 10 FD       		 DJNZ LPN2	;
 69)   8440 D1          		 POP DE	;
 70)   8441 43          		 LD B, E        ; E HAS THE COLUMN	; E HAS THE COLUMN
 71)   8442 23          		LPN3: INC HL	;
 72)   8443 10 FD       		 DJNZ LPN3	;
 73)   8445 77          		 LD (HL), A        ; A HAS THE CHAR TO PRINT	; A HAS THE CHAR TO PRINT
 74)   8446 C1          		 POP BC	;
 75)   8447 F1          		 POP AF	;
 76)   8448 D1          		 POP DE	;
 77)   8449 E1          		 POP HL	;
 78)   844A C9          		 RET	;
 81)   844B CD F8 83    		SCPRN: CALL SCCLL        ; CLEAR THE LINE	; CLEAR THE LINE
 82)   844E E5          		SCPRN1: PUSH HL	;
 83)   844F 21 82 02    		 LD HL, TXTRAM	;
 84)   8452 FE 00       		 CP 0	;
 85)   8454 28 07       		 JR Z, SCSKIP        ;SKIP FOR LINE 0	;SKIP FOR LINE 0
 86)   8456 47          		 LD B, A	;
 87)   8457 11 40 00    		 LD DE, 40 + 24        ; FOR 40 COLUMN SCREEN	; FOR 40 COLUMN SCREEN
 88)   845A 19          		LPN1: ADD HL, DE	;
 89)   845B 10 FD       		 DJNZ LPN1	;
 90)   845D EB          		SCSKIP: EX DE, HL	;
 91)   845E E1          		 POP HL	;
 92)   845F 7E          		SCLP: LD A, (HL)	;
 93)   8460 FE 00       		 CP 0	;
 94)   8462 28 05       		 JR Z SCEXT	;
 95)   8464 12          		 LD (DE), A	;
 96)   8465 23          		 INC HL	;
 97)   8466 13          		 INC DE	;
 98)   8467 18 F6       		 JR SCLP	;
 99)   8469 C9          		SCEXT: RET	;
101)   846A 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   846E 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   8472 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   8476 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   847A 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   847E 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   8482 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   8486 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   848A 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   848E 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   8492 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   8496 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   849A 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   849E 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84A2 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84A6 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84AA 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84AE 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84B2 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84B6 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84BA 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84BE 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
101)   84C2 20          		STCL4: DEFM "                                                                                         "	;
102)   84C3 00          		 DB 0	;
104)   84C4 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84C8 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84CC 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84D0 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84D4 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84D8 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84DC 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84E0 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84E4 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84E8 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84EC 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84F0 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84F4 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84F8 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   84FC 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   8500 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   8504 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   8508 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   850C 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   8510 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   8514 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   8518 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
104)   851C 20          		STCL8: DEFM "                                                                                         "	;
105)   851D 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8521 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8525 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8529 20 20 20 20 		 DEFM "                                                                                         "	;
105)   852D 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8531 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8535 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8539 20 20 20 20 		 DEFM "                                                                                         "	;
105)   853D 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8541 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8545 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8549 20 20 20 20 		 DEFM "                                                                                         "	;
105)   854D 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8551 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8555 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8559 20 20 20 20 		 DEFM "                                                                                         "	;
105)   855D 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8561 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8565 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8569 20 20 20 20 		 DEFM "                                                                                         "	;
105)   856D 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8571 20 20 20 20 		 DEFM "                                                                                         "	;
105)   8575 20          		 DEFM "                                                                                         "	;
106)   8576 00          		 DB 0	;
108)   8577 53 43 52 45 		SCRDY: DEFM "SCREEN READY!!!"	;
108)   857B 45 4E 20 52 		SCRDY: DEFM "SCREEN READY!!!"	;
108)   857F 45 41 44 59 		SCRDY: DEFM "SCREEN READY!!!"	;
108)   8583 21 21 21    		SCRDY: DEFM "SCREEN READY!!!"	;
109)   8586 00          		 DB 0	;
 16)   8587 	            		 RBR EQU DEVSER+0       ;	;
 17)   8587 	            		 MCR EQU DEVSER+04	;
 18)   8587 	            		 LSR EQU DEVSER+05	;
 34)   8587 04          		 DEFB 4	;
 35)   8588 05          		 DEFB RS2OIN-$        ;OPEN IN	;OPEN IN
 36)   8589 04          		 DEFB RS2OOT-$        ;OPEN OUT	;OPEN OUT
 37)   858A 10          		 DEFB RS2INP-$        ;INPUT BYTE	;INPUT BYTE
 38)   858B 2A          		 DEFB RS2OTP-$        ;OUTPUT BYTE	;OUTPUT BYTE
 39)   858C 0A          		 DEFB RS2CLS-$        ;CLOSE	;CLOSE
 51)   858D C5          		RS2OOT: PUSH BC        ;OPENOUT	;OPENOUT
 52)   858E 01 01 00    		 LD BC, 1        ;NO OF BYTES REQUIRED	;NO OF BYTES REQUIRED
 53)   8591 E7 37       		 DEFW ZMKBUFF        ;	;
 54)   8593 C1          		 POP BC         ;	;
 55)   8594 D8          		 RET C         ;	;
 57)   8595 72          		 LD (HL), D        ;PORT NUMBER	;PORT NUMBER
 58)   8596 AF          		RS2CLS: XOR A         ; CLOSE STREAM	; CLOSE STREAM
 59)   8597 47          		 LD B A         ;	;
 60)   8598 4F          		 LD C A         ;	;
 61)   8599 C9          		 RET         ;	;
 71)   859A F3          		RS2INP: DI         ;	;
 72)   859B 21 24 00    		 LD HL ENREGMAP        ;	;
 73)   859E CB 86       		 RES VIDEO, (HL)       ; NO VIDEO	; NO VIDEO
 74)   85A0 7E          		 LD A, (HL)	;
 75)   85A1 D3 07       		 OUT (ENREG) A        ;	;
 76)   85A3 3E 01       		 LD A, 1	;
 77)   85A5 D3 24       		 OUT (MCR), A	;
 78)   85A7 CD C5 85    		 CALL MWAIT        ;	;
 79)   85AA AF          		 XOR A         ;NOT ready to receive SIGNAL DSR 0	;NOT ready to receive SIGNAL DSR 0
 80)   85AB D3 24       		 OUT (MCR), A	;
 81)   85AD DB 20       		 IN A, (RBR)        ;GET THE CHAR	;GET THE CHAR
 82)   85AF CD 48 E5    		 CALL STOPTV        ;	;
 83)   85B2 FB          		 EI         ;	;
 84)   85B3 B7          		 OR A         ;	;
 85)   85B4 C9          		 RET	;
 88)   85B5 4F          		RS2OTP: LD C, A        ;	;
 94)   85B6 F3          		 DI         ;	;
 95)   85B7 CD 1C E2    		 CALL $E21C        ;NOVID ;	;NOVID ;
 96)   85BA 79          		 LD A, C	;
 97)   85BB CD 07 80    		 CALL $8007        ;RSTX   ;SEND CHAR IN A	;RSTX   ;SEND CHAR IN A
 98)   85BE CD 48 E5    		 CALL STOPTV        ;	;
 99)   85C1 FB          		 EI         ;	;
100)   85C2 2B          		 DEC HL         ;	;
101)   85C3 B7          		 OR A         ;	;
102)   85C4 C9          		 RET         ;	;
105)   85C5 21 00 64    		MWAIT: LD HL 25600	;
107)   85C8 DB 25       		MWAIT2: IN A, (LSR)	;
108)   85CA 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
109)   85CB D8          		 RET C	;
110)   85CC 10 FA       		 DJNZ MWAIT2	;
111)   85CE DB 25       		 IN A, (LSR)	;
112)   85D0 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
113)   85D1 D8          		 RET C	;
114)   85D2 2D          		 DEC L	;
115)   85D3 DB 25       		 IN A, (LSR)	;
116)   85D5 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
117)   85D6 D8          		 RET C	;
118)   85D7 C2 C8 85    		 JP NZ MWAIT2	;
119)   85DA DB 25       		 IN A, (LSR)	;
120)   85DC 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
121)   85DD D8          		 RET C	;
122)   85DE 25          		 DEC H	;
123)   85DF DB 25       		 IN A, (LSR)	;
124)   85E1 1F          		 RRA	;
125)   85E2 D8          		 RET C	;
126)   85E3 C2 C8 85    		 JP NZ, MWAIT2	;
127)   85E6 F1          		 POP AF         ;POP LAST RETURN ADDRESS FROM STACK	;POP LAST RETURN ADDRESS FROM STACK
128)   85E7 3E C8       		 LD A, 200        ;TIMEOUT ERROR	;TIMEOUT ERROR
129)   85E9 37          		 SCF	;
130)   85EA C9          		 RET         ;RETURN TO BASIC WITH ERROR TIMEOUT	;RETURN TO BASIC WITH ERROR TIMEOUT
 26)   85EB 04          		 DEFB 4                                                          ;COUNT OF DISPLACEMENTS-1	;COUNT OF DISPLACEMENTS-1
 27)   85EC 18          		 DEFB SG2OIN-$        ;OPEN IN	;OPEN IN
 28)   85ED 1B          		 DEFB SG2OOT-$        ;OPEN OUT	;OPEN OUT
 29)   85EE 85          		 DEFB SG2INP-$        ;INPUT BYTE	;INPUT BYTE
 30)   85EF EF          		 DEFB SG2OTP-$        ;OUTPUT BYTE	;OUTPUT BYTE
 31)   85F0 68          		 DEFB SG2CLS-$        ;CLOSE	;CLOSE
 34)   85F1 11 8B 00    		CPYFNAME:      LD DE,STRGBUFF	;
 35)   85F4 ED B0       		               LDIR	;
 36)   85F6 C9          		               RET	;
 40)   85F7 E5          		MKCAPS:        PUSH HL	;
 41)   85F8 7E          		MC_NXT:        LD A,(HL)	;
 42)   85F9 B7          		               OR A	;
 43)   85FA 28 06       		               JR Z,MC_EXIT	;
 44)   85FC E7 2F       		               DEFW ZTTCAPS	;
 45)   85FE 77          		               LD (HL),A	;
 46)   85FF 23          		               INC HL	;
 47)   8600 18 F6       		               JR MC_NXT	;
 48)   8602 E1          		MC_EXIT:       POP HL	;
 49)   8603 C9          		               RET	;
 76)   8604 3E 00       		SG2OIN: LD A,0        ;OPENIN	;OPENIN
 77)   8606 18 02       		               JR SG2OPN	;
 80)   8608 3E 01       		SG2OOT: LD A,1	;
 81)   860A E5          		SG2OPN:        PUSH HL	;
 82)   860B C5          		               PUSH BC        ;OPENOUT	;OPENOUT
 83)   860C F5          		               PUSH AF	;
 84)   860D 01 10 02    		 LD BC, SPCNEED        ;NO OF BYTES REQUIRED	;NO OF BYTES REQUIRED
 85)   8610 E7 37       		 DEFW ZMKBUFF        ;	;
 86)   8612 D1          		               POP DE	;
 87)   8613 C1          		 POP BC                                 	;
 88)   8614 38 3F       		 JR C, ERREXIT                	;
 89)   8616 E5          		               PUSH HL                                                         ;SAVE START OF STRUCT	;SAVE START OF STRUCT
 90)   8617 7A          		               LD A,D	;
 92)   8618 77          		 LD (HL), A        ;OPEN TYPE	;OPEN TYPE
 93)   8619 23          		               INC HL	;
 94)   861A 36 00       		               LD (HL),0                                                       ;FILE POS ZERO	;FILE POS ZERO
 95)   861C 23          		               INC HL	;
 96)   861D 36 00       		               LD (HL),0	;
 97)   861F 23          		               INC HL	;
 98)   8620 36 00       		               LD (HL),0                                                     ;BUF POS 0 	;BUF POS 0
 99)   8622 23          		               INC HL	;
100)   8623 36 00       		               LD (HL),0	;
101)   8625 23          		               INC HL	;
102)   8626 E5          		               PUSH HL	;
103)   8627 C5          		               PUSH BC	;
104)   8628 01 14 00    		               LD BC,BYTREAD-FNAMEIX                                           ;SKIP FILENAME	;SKIP FILENAME
105)   862B 09          		               ADD HL,BC	;
106)   862C C1          		               POP BC	;
107)   862D 36 00       		               LD (HL),0                                                       ;BYTES READ TO 0 	;BYTES READ TO 0
108)   862F 23          		               INC HL	;
109)   8630 36 00       		               LD (HL),0                                                     	;
110)   8632 D1          		               POP DE                                                          ;DE AT FNAMEIX       	;DE AT FNAMEIX
111)   8633 DD E1       		               POP IX                                                          ;IX THE START OF STRUCT                	;IX THE START OF STRUCT
112)   8635 E1          		               POP HL                                                          ;HL THE FILE NAME	;HL THE FILE NAME
113)   8636 D5          		               PUSH DE                                                         ;SAVE THE START OF FILENAME        	;SAVE THE START OF FILENAME
114)   8637 ED B0       		               LDIR                                                            ;TRANSFER THE FNAME TO OUR STRUCT        	;TRANSFER THE FNAME TO OUR STRUCT
115)   8639 AF          		               XOR A	;
116)   863A 12          		               LD (DE),A                                                       ;NULL TERMINATED STRING	;NULL TERMINATED STRING
117)   863B E1          		               POP HL                                                          ;START OF FNAME                	;START OF FNAME
118)   863C CD F7 85    		               CALL MKCAPS                                                     ;make hl filename caps  	;make hl filename caps
119)   863F DD 7E 00    		               LD A,(IX)	;
120)   8642 FE 00       		               CP 0	;
121)   8644 20 0D       		               JR NZ,SG2EX                                                      ;IF FILE OPEN OUT EXIT	;IF FILE OPEN OUT EXIT
123)   8646 01 00 00    		               LD BC,0	;
124)   8649 13          		               INC DE	;
125)   864A CD 6A 8C    		               CALL STRG_OPENCDIR ;OPEN UP TO CURRENT DIR  	;OPEN UP TO CURRENT DIR
126)   864D CD C7 8E    		               CALL STRG_LOADFILE	;
127)   8650 3E 96       		               LD A,ERROPF                                                     ;ERROR NO IF FILE ERROR	;ERROR NO IF FILE ERROR
128)   8652 D8          		               RET C	;
129)   8653 AF          		SG2EX:         XOR A	;
130)   8654 C9          		               RET	;
133)   8655 E1          		ERREXIT:       POP HL	;
134)   8656 37          		               SCF	;
135)   8657 C9          		               RET	;
137)   8658 7E          		SG2CLS: LD A,(HL)	;
138)   8659 FE 01       		               CP 1                                                            ;CHECK IF OPENOUT	;CHECK IF OPENOUT
139)   865B 20 12       		               JR NZ,SCL_EX	;
146)   865D DD E5       		               PUSH IX	;
147)   865F E5          		               PUSH HL	;
148)   8660 DD E1       		               POP IX	;
149)   8662 01 05 00    		               LD BC,FNAMEIX	;
150)   8665 09          		               ADD HL,BC	;
151)   8666 DD 4E 03    		               LD C,(IX+BUFFOFS)	;
152)   8669 DD 46 04    		               LD B,(IX+BUFFOFS+1)	;
153)   866C CD 0D 87    		               CALL SO_STFILE	;
154)   866F AF          		SCL_EX:        XOR A         ; CLOSE STREAM	; CLOSE STREAM
155)   8670 47          		 LD B A         ;	;
156)   8671 4F          		 LD C A         ;	;
157)   8672 C9          		 RET         ;	;
164)   8673 DD E5       		SG2INP:        PUSH IX	;
165)   8675 CD 7B 86    		               CALL SG2INP2	;
166)   8678 DD E1       		               POP IX	;
167)   867A C9          		               RET	;
169)   867B 7E          		SG2INP2:       LD A,(HL)	;
170)   867C FE 00       		               CP 0	;
171)   867E 3E 9B       		               LD A,ERRTRA	;
172)   8680 37          		               SCF	;
173)   8681 C0          		               RET NZ                                                          ;IF NOT INPUT THEN ERROR                	;IF NOT INPUT THEN ERROR
174)   8682 CD 38 87    		               CALL SGCHKEOF                                                   ;TEST EOF	;TEST EOF
175)   8685 23          		               INC HL                	;
176)   8686 E5          		               PUSH HL                                                         ;SAVE OFFSET POS	;SAVE OFFSET POS
177)   8687 4E          		               LD C,(HL)	;
178)   8688 23          		               INC HL	;
179)   8689 46          		               LD B,(HL)                                                       ;BC THE FILE OFFS	;BC THE FILE OFFS
180)   868A 23          		               INC HL	;
181)   868B 5E          		               LD E,(HL)	;
182)   868C 23          		               INC HL	;
183)   868D 56          		               LD D,(HL)                                                       ;DE THE BUFFER OFFS	;DE THE BUFFER OFFS
184)   868E 23          		               INC HL                                                          ;NOW ON FILENAME OFFS	;NOW ON FILENAME OFFS
186)   868F 3E 97       		               LD A,ERREOF	;
187)   8691 DA 55 86    		               JP C,ERREXIT                                                    ;ON C EOF REACHED                	;ON C EOF REACHED
188)   8694 28 0E       		               JR Z,RDFMFILE                                                   ;ON Z=EOB READ FROM FILE	;ON Z=EOB READ FROM FILE
197)   8696 01 16 00    		RDFMBUFF:      LD BC,FBUFFIX-FNAMEIX                                           ;500 BYTES BUFFER OFFSET	;500 BYTES BUFFER OFFSET
198)   8699 09          		               ADD HL,BC                                                       ;HL ON BUFFER        	;HL ON BUFFER
199)   869A 19          		               ADD HL,DE                                                       ;HL ON NXT BYTE INSIDE BUFFER	;HL ON NXT BYTE INSIDE BUFFER
201)   869B 7E          		               LD A,(HL)                                                       ;READ BYTE TO A                	;READ BYTE TO A
202)   869C E1          		               POP HL                                                          ;HL AT THE FILE OFFSET	;HL AT THE FILE OFFSET
203)   869D 23          		               INC HL	;
204)   869E 23          		               INC HL                                                          ;AT THE BUFFER OFFSET	;AT THE BUFFER OFFSET
205)   869F 13          		               INC DE                                                          ;POINT TO NEXT BYTE	;POINT TO NEXT BYTE
206)   86A0 73          		               LD (HL),E                                                       ;SAVE 	;SAVE
207)   86A1 23          		               INC HL	;
208)   86A2 72          		               LD (HL),D	;
209)   86A3 C9          		               RET	;
210)   86A4 E5          		RDFMFILE:      PUSH HL                                                         ;HL FILENAME        	;HL FILENAME
211)   86A5 D1          		               POP DE                                                          ;DE FILENAME	;DE FILENAME
212)   86A6 EB          		               EX DE,HL	;
213)   86A7 C5          		               PUSH BC	;
214)   86A8 01 16 00    		               LD BC,FBUFFIX-FNAMEIX                                           ;500 BYTES BUFFER OFFSET	;500 BYTES BUFFER OFFSET
215)   86AB 09          		               ADD HL,BC	;
216)   86AC C1          		               POP BC	;
217)   86AD EB          		               EX DE,HL                                                        ;HL TO FNAME OFFSET, DE TO BUFFER OFFSET	;HL TO FNAME OFFSET, DE TO BUFFER OFFSET
220)   86AE D5          		               PUSH DE                                                         ;BC THE FILE OFFSET TO READ FROM	;BC THE FILE OFFSET TO READ FROM
223)   86AF CD 6A 8C    		               CALL STRG_OPENCDIR ;OPEN UP TO CURRENT DIR                                                                                	;OPEN UP TO CURRENT DIR
224)   86B2 CD 47 8F    		               CALL STRG_READBUFR                                              ;READ 500 BYTES FROM FILE TO BUFFER BC= BYTES READ	;READ 500 BYTES FROM FILE TO BUFFER BC= BYTES READ
225)   86B5 D1          		               POP DE                                                          ;THE BUFFER TO READ THE BYTE	;THE BUFFER TO READ THE BYTE
226)   86B6 3E 98       		               LD A,ERRRDF                                                     ;ERROR CODE CAN'T READ FROM FILE	;ERROR CODE CAN'T READ FROM FILE
227)   86B8 DA 55 86    		               JP C,ERREXIT	;
229)   86BB E1          		               POP HL                                                          ;GET FILE OFFSET POS ADDR	;GET FILE OFFSET POS ADDR
230)   86BC D5          		               PUSH DE                                                         ;SAVE START OF BUFFER	;SAVE START OF BUFFER
231)   86BD EB          		               EX DE,HL                                                        ;DE THE OFFSET ADDR	;DE THE OFFSET ADDR
232)   86BE 1A          		               LD A,(DE)                                                       ;OFFSET OF FILE 	;OFFSET OF FILE
233)   86BF 6F          		               LD L,A	;
234)   86C0 13          		               INC DE	;
235)   86C1 1A          		               LD A,(DE)	;
236)   86C2 67          		               LD H,A	;
237)   86C3 09          		               ADD HL,BC                                                       ;ADD NEW READ BYTES TO PREVIOUS OFFSET	;ADD NEW READ BYTES TO PREVIOUS OFFSET
238)   86C4 EB          		               EX DE,HL                                                        ;HL THE OFFSET ADDR, DE THE NEW OFFSET	;HL THE OFFSET ADDR, DE THE NEW OFFSET
239)   86C5 72          		               LD (HL),D                                                       ;SAVE BACK	;SAVE BACK
240)   86C6 2B          		               DEC HL	;
241)   86C7 73          		               LD (HL),E	;
242)   86C8 23          		               INC HL	;
243)   86C9 23          		               INC HL                                                          ;TO THE BUF OFFSET 	;TO THE BUF OFFSET
244)   86CA 3E 01       		               LD A,1	;
245)   86CC 77          		               LD (HL),A                                                       ;SET THE BUF OFFS TO 1	;SET THE BUF OFFS TO 1
246)   86CD 23          		               INC HL	;
247)   86CE AF          		               XOR A	;
248)   86CF 77          		               LD (HL),A     	;
249)   86D0 23          		               INC HL                                                  	;
252)   86D1 C5          		               PUSH BC	;
253)   86D2 01 14 00    		               LD BC,20	;
254)   86D5 09          		               ADD HL,BC                                                       ;NOW AT BYTREAD	;NOW AT BYTREAD
255)   86D6 C1          		               POP BC	;
256)   86D7 71          		               LD (HL),C                                                       ;SAVE BYTES READ FROM FILE	;SAVE BYTES READ FROM FILE
257)   86D8 23          		               INC HL	;
258)   86D9 70          		               LD (HL),B	;
259)   86DA D1          		               POP DE                                                          ;GET START OF BUFFER	;GET START OF BUFFER
260)   86DB AF          		               XOR A                                                           ;CLEAR CARRY FLAG	;CLEAR CARRY FLAG
261)   86DC 1A          		               LD A,(DE)                                                       ;READ THE 1ST BYTE TO A	;READ THE 1ST BYTE TO A
262)   86DD C9          		               RET	;
271)   86DE DD E5       		SG2OTP:        PUSH IX	;
272)   86E0 E5          		               PUSH HL	;
273)   86E1 DD E1       		               POP IX	;
274)   86E3 57          		               LD D,A                                                          ;SAVE BYTE TO BE WRITTEN	;SAVE BYTE TO BE WRITTEN
275)   86E4 7E          		               LD A,(HL)	;
276)   86E5 FE 00       		               CP 0	;
277)   86E7 3E 9B       		               LD A,ERRTRA	;
278)   86E9 37          		               SCF	;
279)   86EA 28 47       		               JR Z,SO_EX	;
280)   86EC 7A          		               LD A,D                                                          ;RESTORE A BYTE TO WRITE	;RESTORE A BYTE TO WRITE
281)   86ED 01 05 00    		               LD BC,FNAMEIX	;
282)   86F0 09          		               ADD HL,BC                	;
283)   86F1 DD E5       		               PUSH IX	;
284)   86F3 D1          		               POP DE	;
285)   86F4 EB          		               EX DE,HL	;
286)   86F5 01 1B 00    		               LD BC,FBUFFIX	;
287)   86F8 09          		               ADD HL,BC                	;
288)   86F9 DD 4E 03    		               LD C,(IX+BUFFOFS)	;
289)   86FC DD 46 04    		               LD B,(IX+BUFFOFS+1)	;
290)   86FF 09          		               ADD HL,BC	;
291)   8700 EB          		               EX DE,HL                                	;
292)   8701 12          		               LD (DE),A	;
294)   8702 79          		               LD A,C	;
295)   8703 FE F3       		               CP $F3                                                          ;499 WE START AT 0  	;499 WE START AT 0
296)   8705 20 25       		               JR NZ,SO_BUFFNXT	;
297)   8707 78          		               LD A,B	;
298)   8708 FE 01       		               CP $01	;
299)   870A 20 20       		               JR NZ,SO_BUFFNXT	;
300)   870C 03          		               INC BC                                                          ;500	;500
308)   870D EB          		 SO_STFILE:    EX DE,HL	;
309)   870E DD E5       		               PUSH IX	;
310)   8710 E1          		               POP HL	;
311)   8711 C5          		               PUSH BC	;
312)   8712 01 1B 00    		               LD BC,FBUFFIX	;
313)   8715 09          		               ADD HL,BC	;
314)   8716 C1          		               POP BC	;
315)   8717 EB          		               EX DE,HL	;
318)   8718 CD 6A 8C    		               CALL STRG_OPENCDIR ;OPEN UP TO CURRENT DIR	;OPEN UP TO CURRENT DIR
319)   871B CD A1 90    		               CALL STRG_WRITEBUFR                             ;WRITES 500 BYTES FROM BUFFER DE TO THE END OF THE FILE	;WRITES 500 BYTES FROM BUFFER DE TO THE END OF THE FILE
320)   871E 3E 96       		               LD A,ERROPF	;
321)   8720 38 06       		               JR C,SO_ERROUT	;
322)   8722 3E 99       		               LD A,ERRWTF	;
323)   8724 37          		               SCF	;
324)   8725 20 01       		               JR NZ,SO_ERROUT	;
325)   8727 AF          		               XOR A	;
326)   8728 01 00 00    		SO_ERROUT:     LD BC,0                                         ;ZERO BUFFER OFFSET	;ZERO BUFFER OFFSET
327)   872B 16          		               DB $16                                          ;SKIP INC BC LD D,NN	;SKIP INC BC LD D,NN
328)   872C 03          		SO_BUFFNXT:    INC BC                                          	;
329)   872D DD 71 03    		               LD (IX+BUFFOFS),C	;
330)   8730 DD 70 04    		               LD (IX+BUFFOFS+1),B	;
331)   8733 DD E1       		SO_EX          POP IX	;
332)   8735 FE 00       		               CP 0	;
333)   8737 C9          		               RET	;
340)   8738 DD E5       		SGCHKEOF:      PUSH IX	;
341)   873A D5          		               PUSH DE	;
342)   873B C5          		               PUSH BC	;
344)   873C E5          		               PUSH HL	;
345)   873D DD E1       		               POP IX	;
346)   873F DD 5E 03    		               LD E,(IX+BUFFOFS)	;
347)   8742 DD 56 04    		               LD D,(IX+BUFFOFS+1)	;
348)   8745 DD 4E 19    		               LD C,(IX+BYTREAD)	;
349)   8748 DD 46 1A    		               LD B,(IX+BYTREAD+1)	;
351)   874B 78          		               LD A,B	;
352)   874C B1          		               OR C	;
353)   874D 3E 03       		               LD A,3	;
354)   874F 28 1C       		               JR Z, SGEFEXIT                                                  ;Z=EOB	;Z=EOB
355)   8751 EB          		               EX DE,HL                                                        ;SAVE HL SET HL=DE	;SAVE HL SET HL=DE
356)   8752 B7          		               OR A	;
357)   8753 ED 42       		               SBC HL,BC	;
358)   8755 7C          		               LD A,H	;
359)   8756 B5          		               OR L	;
360)   8757 EB          		               EX DE,HL                                                        ;RESTORE HL	;RESTORE HL
361)   8758 3E 01       		               LD A,1                                                          ;NO EOF NO EOB = NZ	;NO EOF NO EOB = NZ
362)   875A 20 11       		               JR NZ,SGEFEXIT	;
364)   875C 78          		               LD A,B	;
365)   875D D6 01       		               SUB $01	;
366)   875F 20 09       		               JR NZ, SGDOEOF	;
367)   8761 79          		               LD A,C	;
368)   8762 D6 F4       		               SUB $F4	;
369)   8764 20 04       		               JR NZ, SGDOEOF	;
370)   8766 3E 02       		               LD A,2                                                          ;Z MEANS EOB END OF BUFFER                	;Z MEANS EOB END OF BUFFER
371)   8768 18 03       		               JR  SGEFEXIT	;
373)   876A 3E 97       		SGDOEOF:       LD A,ERREOF                                                           ;RETURN 0 ON EOF	;RETURN 0 ON EOF
374)   876C 37          		               SCF         	;
375)   876D C1          		SGEFEXIT:      POP BC	;
376)   876E D1          		               POP DE	;
377)   876F DD E1       		               POP IX	;
378)   8771 C9          		               RET	;
381)   8772 E5          		PRNHL:         PUSH HL	;
382)   8773 C5          		               PUSH BC	;
383)   8774 D5          		               PUSH DE	;
384)   8775 CD 5C 9B    		 CALL B2D16	;
385)   8778 21 CB 00    		 LD HL,B2DBUF	;
386)   877B CD F0 9B    		 CALL SKIPSPC	;
387)   877E CD 3B 8B    		 CALL RS_TXT	;
388)   8781 D1          		               POP DE	;
389)   8782 C1          		               POP BC	;
390)   8783 E1          		               POP HL	;
391)   8784 C9          		               RET	;
393)   8785 E5          		PRINTDBG:      PUSH HL	;
394)   8786 C5          		               PUSH BC	;
395)   8787 D5          		               PUSH DE	;
396)   8788 F5          		               PUSH AF	;
398)   8789 CD 72 87    		               CALL PRNHL	;
399)   878C D5          		               PUSH DE	;
400)   878D C5          		               PUSH BC	;
401)   878E CD 26 80    		 CALL OS_PRINTMSG	;
402)   8791 20 48 4C    		 DEFM " HL"	;
403)   8794 0A 0D 00    		 DB 10,13,0	;
404)   8797 C1          		               POP BC	;
405)   8798 D1          		               POP DE	;
407)   8799 D5          		               PUSH DE	;
408)   879A E1          		               POP HL	;
409)   879B CD 72 87    		               CALL PRNHL	;
410)   879E D5          		               PUSH DE	;
411)   879F C5          		               PUSH BC	;
412)   87A0 CD 26 80    		 CALL OS_PRINTMSG	;
413)   87A3 20 44 45    		 DEFM " DE"	;
414)   87A6 0A 0D 00    		 DB 10,13,0	;
415)   87A9 C1          		               POP BC	;
416)   87AA D1          		               POP DE	;
418)   87AB C5          		               PUSH BC	;
419)   87AC E1          		               POP HL	;
420)   87AD CD 72 87    		               CALL PRNHL	;
421)   87B0 D5          		               PUSH DE	;
422)   87B1 C5          		               PUSH BC	;
423)   87B2 CD 26 80    		 CALL OS_PRINTMSG	;
424)   87B5 20 42 43    		 DEFM " BC"	;
425)   87B8 0A 0D 00    		 DB 10,13,0	;
426)   87BB C1          		               POP BC	;
427)   87BC D1          		               POP DE	;
430)   87BD F1          		               POP AF	;
431)   87BE D1          		               POP DE	;
432)   87BF C1          		               POP BC	;
433)   87C0 E1          		               POP HL	;
434)   87C1 C9          		               RET	;
438)   87C2 F5          		CLRBUFR:       PUSH AF	;
439)   87C3 E5          		               PUSH HL	;
440)   87C4 D5          		               PUSH DE	;
441)   87C5 C5          		               PUSH BC	;
442)   87C6 AF          		               XOR A	;
443)   87C7 12          		               LD (DE),A	;
444)   87C8 D5          		               PUSH DE	;
445)   87C9 E1          		               POP HL	;
446)   87CA 13          		               INC DE	;
447)   87CB 01 F3 01    		               LD BC,499	;
448)   87CE ED B0       		               LDIR        	;
449)   87D0 C1          		               POP BC	;
450)   87D1 D1          		               POP DE	;
451)   87D2 E1          		               POP HL	;
452)   87D3 F1          		               POP AF	;
453)   87D4 C9          		               RET	;
458)   87D5 04          		 DEFB 4                                                          ;COUNT OF DISPLACEMENTS-1	;COUNT OF DISPLACEMENTS-1
459)   87D6 2E          		 DEFB SG2OIN-$        ;OPEN IN	;OPEN IN
460)   87D7 31          		 DEFB SG2OOT-$        ;OPEN OUT	;OPEN OUT
461)   87D8 9B          		 DEFB SG2INP-$        ;INPUT BYTE	;INPUT BYTE
462)   87D9 05          		 DEFB SG2OTP-$        ;OUTPUT BYTE	;OUTPUT BYTE
463)   87DA 7E          		 DEFB SG2CLS-$        ;CLOSE	;CLOSE
 19)   87DB 21 58 00    		STNEWD: LD HL, $58        ;DEVTAB	;DEVTAB
 20)   87DE 11 EB 87    		 LD DE, DEVTAB        ; NEW TABLE SET	; NEW TABLE SET
 21)   87E1 73          		 LD (HL), E	;
 22)   87E2 23          		 INC HL	;
 23)   87E3 72          		 LD (HL), D	;
 24)   87E4 21 13 00    		 LD HL, DEFSTOR	;
 25)   87E7 3E 0C       		 LD A, 12        ;DEFAULT STORE DEVICE IS 12 NB STORAGE MODULE	;DEFAULT STORE DEVICE IS 12 NB STORAGE MODULE
 26)   87E9 77          		 LD (HL), A	;
 27)   87EA C9          		 RET	;
 31)   87EB 11          		DEVTAB: DEFB 17        ;number of entries ;number of entries	;number of entries ;number of entries
 32)   87EC 83 E6       		 DEFW TVIO        ;	;
 33)   87EE EE ED       		 DEFW TP1IO        ;	;
 34)   87F0 F4 ED       		 DEFW TP2IO        ;	;
 35)   87F2 50 E6       		 DEFW LIIO        ;	;
 36)   87F4 75 E6       		 DEFW TLIO        ;	;
 37)   87F6 36 A1       		 DEFW NKBWIO        ;	;
 38)   87F8 1A A1       		 DEFW NKBIIO        ;	;
 39)   87FA 1F E4       		 DEFW UPIO        ;	;
 40)   87FC 3C E4       		 DEFW LPIO        ;	;
 41)   87FE 2F E4       		 DEFW JGIO        ;	;
 42)   8800 19 E4       		 DEFW DUMMY        ;	;
 43)   8802 96 A5       		 DEFW GRAPH        ;  	;
 44)   8804 EB 85       		               DEFW SG2IO        ;MY STORAGE DEVICE 13 BDISCIO BINARY SERIAL	;MY STORAGE DEVICE 13 BDISCIO BINARY SERIAL
 45)   8806 EB 85       		               DEFW SG2IO                                                      ;MY STORAGE DEVICE 14 TDISCIO SAME AS 13 FOR ME	;MY STORAGE DEVICE 14 TDISCIO SAME AS 13 FOR ME
 46)   8808 EB 85       		               DEFW SG2IO                                                      ;MY STORAGE DEVICE 15 RDISCIO RANDOM ACCESS	;MY STORAGE DEVICE 15 RDISCIO RANDOM ACCESS
 47)   880A EB 85       		               DEFW SG2IO                                                      ;MY STORAGE DEVICE 16 SDISCIO DIR COMMANDS	;MY STORAGE DEVICE 16 SDISCIO DIR COMMANDS
 48)   880C 87 85       		               DEFW RS2IO        ;MY SERIAL DEVICE 17	;MY SERIAL DEVICE 17
  6)   880E FE 00       		 CP 0	;
  7)   8810 C8          		 RET Z	;
  8)   8811 CD B5 88    		 CALL NBLOOKASC	;
  9)   8814 C9          		 RET	;
 12)   8815 21 33 88    		NBLOOK: LD HL, NBTAB	;
 13)   8818 06 00       		 LD B, 0	;
 14)   881A 4F          		 LD C, A	;
 15)   881B 09          		 ADD HL, BC	;
 16)   881C 7E          		 LD A, (HL)	;
 17)   881D FE 00       		 CP 0	;
 18)   881F C8          		 RET Z	;
 19)   8820 21 80 00    		 LD HL, KEYCTR        ;BIT 6=SHIFT BIT 7=CTRL  BIT 6+7=GRPH	;BIT 6=SHIFT BIT 7=CTRL  BIT 6+7=GRPH
 20)   8823 CB 6E       		 BIT 5, (HL)	;
 21)   8825 28 04       		 JR Z, NOGRPH	;
 22)   8827 06 C0       		 LD B, 192        ;SET BIT 6 AND 7	;SET BIT 6 AND 7
 23)   8829 18 06       		 JR NBLKEX	;
 24)   882B 4F          		NOGRPH: LD C, A	;
 25)   882C 7E          		 LD A, (HL)	;
 26)   882D E6 C0       		 AND 11000000	;
 27)   882F 47          		 LD B, A	;
 28)   8830 79          		 LD A, C	;
 29)   8831 B0          		NBLKEX: OR B	;
 30)   8832 C9          		 RET	;
 32)   8833 00 00 00 00 		NBTAB: DB 0,0,0,0,0,0,0,0,0,0       ;  0-  9	;  0-  9
 32)   8837 00 00 00 00 		NBTAB: DB 0,0,0,0,0,0,0,0,0,0       ;  0-  9	;  0-  9
 32)   883B 00 00       		NBTAB: DB 0,0,0,0,0,0,0,0,0,0       ;  0-  9	;  0-  9
 33)   883D 00 00 00 A4 		 DB 0,0,0,36+128,0,0,0,0,0,0      ; 10- 19 0,0,0,TAB	; 10- 19 0,0,0,TAB
 33)   8841 00 00 00 00 		 DB 0,0,0,36+128,0,0,0,0,0,0      ; 10- 19 0,0,0,TAB	; 10- 19 0,0,0,TAB
 33)   8845 00 00       		 DB 0,0,0,36+128,0,0,0,0,0,0      ; 10- 19 0,0,0,TAB	; 10- 19 0,0,0,TAB
 34)   8847 00 0E 09 00 		 DB 0,14,9,0,0,0,60,45,46,13      ; 20- 29	; 20- 29
 34)   884B 00 00 3C 2D 		 DB 0,14,9,0,0,0,60,45,46,13      ; 20- 29	; 20- 29
 34)   884F 2E 0D       		 DB 0,14,9,0,0,0,60,45,46,13      ; 20- 29	; 20- 29
 35)   8851 08 00 00 3A 		 DB 8,0,0,58,59,44,12,6,7,0      ; 30- 39	; 30- 39
 35)   8855 3B 2C 0C 06 		 DB 8,0,0,58,59,44,12,6,7,0      ; 30- 39	; 30- 39
 35)   8859 07 00       		 DB 8,0,0,58,59,44,12,6,7,0      ; 30- 39	; 30- 39
 36)   885B 00 0F 39 2B 		 DB 0,15,57,43,10,11,5,0,0,52      ; 40- 49	; 40- 49
 36)   885F 0A 0B 05 00 		 DB 0,15,57,43,10,11,5,0,0,52      ; 40- 49	; 40- 49
 36)   8863 00 34       		 DB 0,15,57,43,10,11,5,0,0,52      ; 40- 49	; 40- 49
 37)   8865 38 29 2A 25 		 DB 56,41,42,37,4,0,0,0,53,51      ; 50- 59	; 50- 59
 37)   8869 04 00 00 00 		 DB 56,41,42,37,4,0,0,0,53,51      ; 50- 59	; 50- 59
 37)   886D 35 33       		 DB 56,41,42,37,4,0,0,0,53,51      ; 50- 59	; 50- 59
 38)   886F 23 03 13 00 		 DB 35,3,19,0,0,54,62,36,38,21      ; 60- 69	; 60- 69
 38)   8873 00 36 3E 24 		 DB 35,3,19,0,0,54,62,36,38,21      ; 60- 69	; 60- 69
 38)   8877 26 15       		 DB 35,3,19,0,0,54,62,36,38,21      ; 60- 69	; 60- 69
 39)   8879 14 00 00 37 		 DB 20,0,0,55,47,39,40,26,28,0      ; 70- 79	; 70- 79
 39)   887D 2F 27 28 1A 		 DB 20,0,0,55,47,39,40,26,28,0      ; 70- 79	; 70- 79
 39)   8881 1C 00       		 DB 20,0,0,55,47,39,40,26,28,0      ; 70- 79	; 70- 79
 40)   8883 00 00 43 00 		 DB 0,0,67,0,86,27,0,0,0,0      ; 80- 89	; 80- 89
 40)   8887 56 1B 00 00 		 DB 0,0,67,0,86,27,0,0,0,0      ; 80- 89	; 80- 89
 40)   888B 00 00       		 DB 0,0,67,0,86,27,0,0,0,0      ; 80- 89	; 80- 89
 41)   888D 1E 00 00 00 		 DB 30,0,0,0,0,0,0,0,0,0      ; 90- 99	; 90- 99
 41)   8891 00 00 00 00 		 DB 30,0,0,0,0,0,0,0,0,0      ; 90- 99	; 90- 99
 41)   8895 00 00       		 DB 30,0,0,0,0,0,0,0,0,0      ; 90- 99	; 90- 99
 42)   8897 00 00 40 00 		 DB 0,0,64,0,0,26+128,0,2,63,0      ;100-109  0,0,64,0,0,END	;100-109  0,0,64,0,0,END
 42)   889B 00 9A 00 02 		 DB 0,0,64,0,0,26+128,0,2,63,0      ;100-109  0,0,64,0,0,END	;100-109  0,0,64,0,0,END
 42)   889F 3F 00       		 DB 0,0,64,0,0,26+128,0,2,63,0      ;100-109  0,0,64,0,0,END	;100-109  0,0,64,0,0,END
 43)   88A1 00 00 3D A5 		 DB 0,0,61,37+128,34,0,18,50,31,25     ;110-119  0,0,INS,DEL	;110-119  0,0,INS,DEL
 43)   88A5 22 00 12 32 		 DB 0,0,61,37+128,34,0,18,50,31,25     ;110-119  0,0,INS,DEL	;110-119  0,0,INS,DEL
 43)   88A9 1F 19       		 DB 0,0,61,37+128,34,0,18,50,31,25     ;110-119  0,0,INS,DEL	;110-119  0,0,INS,DEL
 44)   88AB 00 1D 07 1C 		 DB 0,29,7,28,24,20,0,0,0,0      ;120-129	;120-129
 44)   88AF 18 14 00 00 		 DB 0,29,7,28,24,20,0,0,0,0      ;120-129	;120-129
 44)   88B3 00 00       		 DB 0,29,7,28,24,20,0,0,0,0      ;120-129	;120-129
 47)   88B5 21 BE 88    		NBLOOKASC:     LD HL, NBRSTAB	;
 48)   88B8 06 00       		 LD B, 0	;
 49)   88BA 4F          		 LD C, A	;
 50)   88BB 09          		 ADD HL, BC	;
 51)   88BC 7E          		 LD A, (HL)	;
 52)   88BD C9          		 RET	;
 55)   88BE 00 3D 52 12 		NBRSTAB:      DB 0,61,18+64,18,2,0,64,0,64,27+128    ;  0-  9	;  0-  9
 55)   88C2 02 00 40 00 		NBRSTAB:      DB 0,61,18+64,18,2,0,64,0,64,27+128    ;  0-  9	;  0-  9
 55)   88C6 40 9B       		NBRSTAB:      DB 0,61,18+64,18,2,0,64,0,64,27+128    ;  0-  9	;  0-  9
 56)   88C8 22 32 00 1E 		 DB 34,50,0,30,0,0,0,0,0,0     ; 10- 19 	; 10- 19
 56)   88CC 00 00 00 00 		 DB 34,50,0,30,0,0,0,0,0,0     ; 10- 19 	; 10- 19
 56)   88D0 00 00       		 DB 34,50,0,30,0,0,0,0,0,0     ; 10- 19 	; 10- 19
 57)   88D2 00 00 00 00 		 DB 0,0,0,0,0,0,0,31,28+128,29+128    ; 20- 29	; 20- 29
 57)   88D6 00 00 00 1F 		 DB 0,0,0,0,0,0,0,31,28+128,29+128    ; 20- 29	; 20- 29
 57)   88DA 9C 9D       		 DB 0,0,0,0,0,0,0,31,28+128,29+128    ; 20- 29	; 20- 29
 58)   88DC 00 00 0F 49 		 DB 0,0,15,9+64,8+64,7+64,6+64,5+64,0,3+64          ; 30- 39  	; 30- 39
 58)   88E0 48 47 46 45 		 DB 0,0,15,9+64,8+64,7+64,6+64,5+64,0,3+64          ; 30- 39  	; 30- 39
 58)   88E4 00 43       		 DB 0,0,15,9+64,8+64,7+64,6+64,5+64,0,3+64          ; 30- 39  	; 30- 39
 59)   88E6 16 17 18 1D 		 DB 22,23,24,29,54,28,55,47,21,9     ; 40- 49	; 40- 49
 59)   88EA 36 1C 37 2F 		 DB 22,23,24,29,54,28,55,47,21,9     ; 40- 49	; 40- 49
 59)   88EE 15 09       		 DB 22,23,24,29,54,28,55,47,21,9     ; 40- 49	; 40- 49
 60)   88F0 08 07 06 05 		 DB 8,7,6,5,4,3,19,20,40+64,40             ; 50- 59	; 50- 59
 60)   88F4 04 03 13 14 		 DB 8,7,6,5,4,3,19,20,40+64,40             ; 50- 59	; 50- 59
 60)   88F8 68 28       		 DB 8,7,6,5,4,3,19,20,40+64,40             ; 50- 59	; 50- 59
 61)   88FA 00 1B 00 6F 		 DB 0,27,0,47+64,0,46+64,56+64,58+64,44+64,12+64   ; 60- 69	; 60- 69
 61)   88FE 00 6E 78 7A 		 DB 0,27,0,47+64,0,46+64,56+64,58+64,44+64,12+64   ; 60- 69	; 60- 69
 61)   8902 6C 4C       		 DB 0,27,0,47+64,0,46+64,56+64,58+64,44+64,12+64   ; 60- 69	; 60- 69
 62)   8904 6B 6A 69 64 		 DB 43+64,42+64,41+64,36+64,51+64,62+64,39+64,53+64,52+64,38+64 ; 70- 79	; 70- 79
 62)   8908 73 7E 67 75 		 DB 43+64,42+64,41+64,36+64,51+64,62+64,39+64,53+64,52+64,38+64 ; 70- 79	; 70- 79
 62)   890C 74 66       		 DB 43+64,42+64,41+64,36+64,51+64,62+64,39+64,53+64,52+64,38+64 ; 70- 79	; 70- 79
 63)   890E 5A 4E 4B 6D 		 DB 26+64,14+64,11+64,45+64,10+64,35+64,57+64,13+64,59+64,37+64 ; 80- 89	; 80- 89
 63)   8912 4A 63 79 4D 		 DB 26+64,14+64,11+64,45+64,10+64,35+64,57+64,13+64,59+64,37+64 ; 80- 89	; 80- 89
 63)   8916 7B 65       		 DB 26+64,14+64,11+64,45+64,10+64,35+64,57+64,13+64,59+64,37+64 ; 80- 89	; 80- 89
 64)   8918 7C 56 5C 57 		 DB 60+64,22+64,92,23+64,0,0,0,46,56,58    ; 90- 99	; 90- 99
 64)   891C 00 00 00 2E 		 DB 60+64,22+64,92,23+64,0,0,0,46,56,58    ; 90- 99	; 90- 99
 64)   8920 38 3A       		 DB 60+64,22+64,92,23+64,0,0,0,46,56,58    ; 90- 99	; 90- 99
 65)   8922 2C 0C 2B 2A 		 DB 44,12,43,42,41,36,51,62,39,53    ;100-109  	;100-109
 65)   8926 29 24 33 3E 		 DB 44,12,43,42,41,36,51,62,39,53    ;100-109  	;100-109
 65)   892A 27 35       		 DB 44,12,43,42,41,36,51,62,39,53    ;100-109  	;100-109
 66)   892C 34 26 1A 0E 		 DB 52,38,26,14,11,45,10,35,57,13           ;110-119  	;110-119
 66)   8930 0B 2D 0A 23 		 DB 52,38,26,14,11,45,10,35,57,13           ;110-119  	;110-119
 66)   8934 39 0D       		 DB 52,38,26,14,11,45,10,35,57,13           ;110-119  	;110-119
 67)   8936 3B 25 3C 00 		 DB 59,37,60,0,0,0,0,0,0,0       ;120-129	;120-129
 67)   893A 00 00 00 00 		 DB 59,37,60,0,0,0,0,0,0,0       ;120-129	;120-129
 67)   893E 00 00       		 DB 59,37,60,0,0,0,0,0,0,0       ;120-129	;120-129
 68)   8940 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;130-  9	;130-  9
 68)   8944 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;130-  9	;130-  9
 68)   8948 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;130-  9	;130-  9
 69)   894A 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;140-  9	;140-  9
 69)   894E 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;140-  9	;140-  9
 69)   8952 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;140-  9	;140-  9
 70)   8954 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;150-  9	;150-  9
 70)   8958 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;150-  9	;150-  9
 70)   895C 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;150-  9	;150-  9
 71)   895E 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;160-  9	;160-  9
 71)   8962 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;160-  9	;160-  9
 71)   8966 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;160-  9	;160-  9
 72)   8968 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;170-  9	;170-  9
 72)   896C 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;170-  9	;170-  9
 72)   8970 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;170-  9	;170-  9
 73)   8972 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;180-  9	;180-  9
 73)   8976 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;180-  9	;180-  9
 73)   897A 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;180-  9	;180-  9
 74)   897C 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;190-  9	;190-  9
 74)   8980 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;190-  9	;190-  9
 74)   8984 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;190-  9	;190-  9
 75)   8986 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;200-  9	;200-  9
 75)   898A 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;200-  9	;200-  9
 75)   898E 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;200-  9	;200-  9
 76)   8990 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;210-  9	;210-  9
 76)   8994 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;210-  9	;210-  9
 76)   8998 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;210-  9	;210-  9
 77)   899A 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;220-  9	;220-  9
 77)   899E 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;220-  9	;220-  9
 77)   89A2 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;220-  9	;220-  9
 78)   89A4 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;230-  9	;230-  9
 78)   89A8 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;230-  9	;230-  9
 78)   89AC 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;230-  9	;230-  9
 79)   89AE 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;240-  9	;240-  9
 79)   89B2 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;240-  9	;240-  9
 79)   89B6 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;240-  9	;240-  9
 80)   89B8 00 00 00 00 		               DB 0,0,0,0,0,0           ;250-  5	;250-  5
 80)   89BC 00 00       		               DB 0,0,0,0,0,0           ;250-  5	;250-  5
  7)   89BE 21 80 00    		@PS2KBINIT: LD HL,KEYCTR	;
  8)   89C1 36 00       		 LD (HL),0	;
  9)   89C3 C9          		 RET	;
 12)   89C4 DB 06       		@PS2KEYAVAIL: IN A,(6)	;
 13)   89C6 FE 38       		 CP 56  ;38H =0011 1000  0011 IS 3 MEANS KBD INPUT 1000 MEANS REAL KEYBOARD	;38H =0011 1000  0011 IS 3 MEANS KBD INPUT 1000 MEANS REAL KEYBOARD
 14)   89C8 C9          		 RET	;
 16)   89C9 CD D5 89    		@READKBCHAR: CALL GETKBKEY ;GET HARDWARE KEY WITH CHECKS ON SHIFT...	;GET HARDWARE KEY WITH CHECKS ON SHIFT...
 17)   89CC B7          		 OR A ;	;
 18)   89CD C8          		 RET Z	;
 19)   89CE 32 81 00    		 LD (LASTKEY),A	;
 20)   89D1 CD EE 98    		 CALL PS2LOK  ;RETURN ASCII CHAR	;RETURN ASCII CHAR
 21)   89D4 C9          		 RET	;
 24)   89D5 CD DE 89    		GETKBKEY: CALL GETPS2HWKEY ;GET SCANCODE FROM PS/2 KEYB	;GET SCANCODE FROM PS/2 KEYB
 25)   89D8 B7          		 OR A 	;
 26)   89D9 C8          		 RET Z   ;IF KEYBRD KEY IS ZERO	;IF KEYBRD KEY IS ZERO
 27)   89DA CD 2D 98    		 CALL CHECKEXT  ;CHECKEXT SHIFTS CTRL ALT CAPS	;CHECKEXT SHIFTS CTRL ALT CAPS
 28)   89DD C9          		 RET	;
 32)   89DE F3          		GETPS2HWKEY: DI	;
 33)   89DF DB 48       		 IN A,(DEVKBI)  	;
 34)   89E1 4F          		 LD C,A	;
 35)   89E2 CD ED 89    		 CALL KBENABLE	;
 36)   89E5 79          		 LD A,C	;
 37)   89E6 FB          		 EI	;
 38)   89E7 C9          		 RET	;
 40)   89E8 3E 02       		@KBDISABLE: LD A, 2	;
 41)   89EA D3 48       		 OUT (DEVKBI), A	;
 42)   89EC C9          		 RET	;
 44)   89ED AF          		@KBENABLE: XOR A	;
 45)   89EE D3 48       		 OUT (DEVKBI), A	;
 46)   89F0 D3 48       		 OUT (DEVKBI), A	;
 47)   89F2 D3 48       		 OUT (DEVKBI), A	;
 48)   89F4 C9          		 RET	;
 35)   89F5 3E 03       		PATCHCMDS: LD A,11b ;DISABLE INTS & DISABLE NB=RAM WRITABLE	;DISABLE INTS & DISABLE NB=RAM WRITABLE
 36)   89F7 D3 E0       		 OUT (INTENB),A	;
 37)   89F9 21 F9 A2    		 LD HL,$A2F9	;
 38)   89FC 36 CD       		 LD (HL),$CD ;CALL	;CALL
 39)   89FE 11 35 8A    		 LD DE,CHKNEWCMD	;
 40)   8A01 23          		 INC HL	;
 41)   8A02 73          		 LD (HL),E	;
 42)   8A03 23          		 INC HL	;
 43)   8A04 72          		 LD (HL),D	;
 44)   8A05 21 85 A4    		 LD HL,$A485  ;PXCL3	;PXCL3
 45)   8A08 36 C3       		 LD (HL),$C3 ;JP	;JP
 46)   8A0A 11 19 8A    		 LD DE,OSXCL3	;
 47)   8A0D 23          		 INC HL	;
 48)   8A0E 73          		 LD (HL),E	;
 49)   8A0F 23          		 INC HL	;
 50)   8A10 72          		 LD (HL),D	;
 51)   8A11 3E 01       		 LD A,01b  ;DISABLE INTS & ENABLE NB=RAM NON WRITABLE	;DISABLE INTS & ENABLE NB=RAM NON WRITABLE
 52)   8A13 D3 E0       		 OUT (INTENB),A  	;
 53)   8A15 C9          		 RET	;
 57)   8A16 01          		 TOS DEFB 1	;
 58)   8A17 4F          		 DEFM 'O'	;
 59)   8A18 D3          		 DEFB 'S'+80H	;
 62)   8A19 01 14 DD    		OSXCL3: LD BC,XTABLE	;
 63)   8A1C FA 35 C3    		 JP M,ENTER	;
 64)   8A1F 01 00 DE    		 LD BC,XTABL2	;
 65)   8A22 FE 56       		 CP LPCODE	;
 66)   8A24 DA 35 C3    		 JP C,ENTER       ;IF <$56 GOTO TAB2 	;IF <$56 GOTO TAB2
 67)   8A27 01 43 A4    		 LD BC,XTABL3	;
 68)   8A2A FE 62       		 CP OSCODE	;
 69)   8A2C DA 35 C3    		 JP C,ENTER ;IF <$62 GOTO TAB3	;IF <$62 GOTO TAB3
 70)   8A2F 01 00 8A    		 LD BC,XTABL4 ;ELSE  OUR TAB4	;ELSE  OUR TAB4
 71)   8A32 C3 35 C3    		 JP ENTER	;
 74)   8A35 DD E5       		 PUSH IX	;
 75)   8A37 FD E5       		 PUSH IY	;
 76)   8A39 D5          		 PUSH DE	;
 77)   8A3A 21 16 8A    		 LD HL,TOS	;
 78)   8A3D CD D4 A2    		 CALL PSCAN	;
 79)   8A40 D4 4C 8A    		 CALL NC, COSCMD	;
 80)   8A43 D1          		 POP DE	;
 81)   8A44 FD E1       		 POP IY	;
 82)   8A46 DD E1       		 POP IX	;
 84)   8A48 21 5A A3    		 LD HL,TPLOT	;
 85)   8A4B C9          		 RET	;
 88)   8A4C 21 6C 8A    		COSCMD: LD HL,OSLST	;
 89)   8A4F CD D4 A2    		 CALL PSCAN ;check for any of the OS COMMAND-list	;check for any of the OS COMMAND-list
 90)   8A52 D8          		 RET C	;
 91)   8A53 61          		 LD H,C  ;THE OS LIST COMMAND ID ON C	;THE OS LIST COMMAND ID ON C
 92)   8A54 2E B1       		 LD L,YOSCMD ;THE OS COMMAND	;THE OS COMMAND
 93)   8A56 D7 01       		 DEFW ZCM2HL	;
 94)   8A58 05          		 DEC B  ;CHECK FOR ARGS	;CHECK FOR ARGS
 95)   8A59 C8          		 RET Z	;
 99)   8A5A DF 18       		 DEFW WEXPN	;
100)   8A5C D8          		 RET C	;
108)   8A5D C9          		 RET	;
111)   8A5E 76 8A       		OSCMDTBL: DEFW CMD_DIR	;
112)   8A60 8E 8A       		 DEFW CMD_CD	;
125)   8A62 64 8A       		       DEFW XOSCMD	;
127)   8A64 7E          		XOSCMD: LD A,(HL) ;GET SUB COMMAND 0=DIR 1=CD	;GET SUB COMMAND 0=DIR 1=CD
128)   8A65 B7          		 OR A	;
129)   8A66 28 0E       		 JR Z,CMD_DIR	;
130)   8A68 3D          		 DEC A	;
131)   8A69 28 23       		 JR Z,CMD_CD	;
133)   8A6B C9          		 RET	;
135)   8A6C 02          		OSLST: DEFB 2 ;no of sub-commands	;no of sub-commands
137)   8A6D 44 49       		 DEFM 'DI' 	;
138)   8A6F D2 00 01    		 DEFB 'R'+80H,CDIR,1 ;+1 OF ARGS	;+1 OF ARGS
140)   8A72 43          		 DEFM 'C' 	;
141)   8A73 C4 01 02    		 DEFB 'D'+80H,CCD,2	;
145)   8A76 D7 39       		CMD_DIR: DEFW ZPTMSG ;	;
146)   8A78 11          		 DEFB 17	;
147)   8A79 0D          		 DEFB $0D	;
148)   8A7A 2D 2D 2D 5B 		 DEFM "---[DIR INFO]--"	;
148)   8A7E 44 49 52 20 		 DEFM "---[DIR INFO]--"	;
148)   8A82 49 4E 46 4F 		 DEFM "---[DIR INFO]--"	;
148)   8A86 5D 2D 2D    		 DEFM "---[DIR INFO]--"	;
149)   8A89 0D          		 DEFB $0D	;
150)   8A8A CD 38 8C    		 CALL STRG_DIRLIST  ;PRINT DIR	;PRINT DIR
151)   8A8D C9          		 RET	;
153)   8A8E CD 36 DC    		CMD_CD: CALL GUSTP   ;SETS HL FROM IX+11,12 USRTOP	;SETS HL FROM IX+11,12 USRTOP
154)   8A91 CD E7 8C    		 CALL STRG_DIRCHG	;
155)   8A94 38 09       		 JR C, CD_ERR	;
156)   8A96 3E 96       		 LD A,150   ;ERROR MISSING FILE	;ERROR MISSING FILE
157)   8A98 28 05       		 JR Z,CD_ERR	;
164)   8A9A CD 89 8C    		 CALL STRG_DIRNMCHG	;
165)   8A9D 18 0F       		 JR CD_CONT	;
167)   8A9F E5          		 PUSH HL	;
168)   8AA0 F5          		 PUSH AF  	;
169)   8AA1 D7 39       		 DEFW ZPTMSG ;	;
170)   8AA3 05          		 DEFB 5	;
171)   8AA4 45 52 52 5F 		 DEFM "ERR_R"	;
171)   8AA8 52          		 DEFM "ERR_R"	;
172)   8AA9 F1          		 POP AF  	;
173)   8AAA CD D9 80    		 CALL SOUTAS  	;
174)   8AAD E1          		 POP HL  	;
175)   8AAE F5          		CD_CONT: PUSH AF   ;SAVE FLAGS  	;SAVE FLAGS
177)   8AAF 54          		 LD D,H	;
178)   8AB0 5D          		 LD E,L	;
179)   8AB1 1A          		CD_AGN: LD A,(DE)	;
180)   8AB2 FE 00       		 CP 0	;
181)   8AB4 3E 00       		 LD A,0	;
182)   8AB6 12          		 LD (DE),A    ;ZERO THIS	;ZERO THIS
183)   8AB7 13          		 INC DE	;
184)   8AB8 20 F7       		 JR NZ,CD_AGN	;
185)   8ABA 06 04       		 LD B,4	;
186)   8ABC 12          		CD_AGN2: LD (DE),A	;
187)   8ABD 13          		 INC DE	;
188)   8ABE 10 FC       		 DJNZ CD_AGN2	;
190)   8AC0 E5          		 PUSH HL	;
191)   8AC1 D5          		 PUSH DE	;
192)   8AC2 21 E0 00    		 LD HL,DIRNM	;
193)   8AC5 7E          		NXTCHR: LD A,(HL)	;
194)   8AC6 B7          		 OR A 	;
195)   8AC7 28 05       		 JR Z,NXTPATH	;
196)   8AC9 DF 3C       		 DEFW WPTCHAR	;
197)   8ACB 23          		 INC HL	;
198)   8ACC 18 F7       		 JR NXTCHR	;
199)   8ACE 23          		NXTPATH: INC HL	;
200)   8ACF 7E          		 LD A,(HL)	;
201)   8AD0 B7          		 OR A	;
202)   8AD1 20 F2       		 JR NZ,NXTCHR	;
203)   8AD3 D1          		 POP DE	;
204)   8AD4 E1          		 POP HL	;
205)   8AD5 EB          		 EX DE,HL	;
206)   8AD6 CD 8C C5    		 CALL LDUSTP	;
210)   8AD9 F1          		 POP AF  ;REST FLAGS  	;REST FLAGS
211)   8ADA AF          		 XOR A	;
212)   8ADB C9          		 RET	;
 10)   8ADC 21 82 00    		INITMMU:       LD HL,BANKS	;
 11)   8ADF 06 08       		               LD B,8	;
 12)   8AE1 AF          		               XOR A	;
 13)   8AE2 77          		INM_AGN:       LD (HL),A	;
 14)   8AE3 3C          		               INC A	;
 15)   8AE4 23          		 INC HL	;
 16)   8AE5 10 FB       		               DJNZ INM_AGN	;
 17)   8AE7 C9          		               RET                	;
 23)   8AE8 4F          		PUTPGINBANK: LD C, A       ;SAVE PAGE	;SAVE PAGE
 24)   8AE9 78          		 LD A, B                                                         ;BANK IN A	;BANK IN A
 25)   8AEA FE 02       		 CP 2	;
 26)   8AEC D8          		 RET C         ;BANK 0,1 WILL NEVER CHANGE	;BANK 0,1 WILL NEVER CHANGE
 27)   8AED FE 07       		 CP 7	;
 28)   8AEF C8          		 RET Z         ;BANK 7 WILL NEVER CHANGE	;BANK 7 WILL NEVER CHANGE
 29)   8AF0 21 82 00    		 LD HL, BANKS	;
 30)   8AF3 16 00       		 LD D, 0	;
 31)   8AF5 5F          		 LD E, A	;
 32)   8AF6 19          		 ADD HL, DE	;
 33)   8AF7 79          		 LD A, C        ;RESTORE PAGE	;RESTORE PAGE
 34)   8AF8 77          		 LD (HL), A        ;SAVE PG IN BANK B MEMORY	;SAVE PG IN BANK B MEMORY
 35)   8AF9 0E 00       		 LD C, DEVMMU	;
 36)   8AFB 58          		 LD E,B	;
 37)   8AFC CB 20       		 SLA B         ;SHIFT BANK TO A15..A13 FROM A2..A0 WE USE THESE PINS ON THE CPLD FOR BANK INPUT	;SHIFT BANK TO A15..A13 FROM A2..A0 WE USE THESE PINS ON THE CPLD FOR BANK INPUT
 38)   8AFE CB 20       		 SLA B	;
 39)   8B00 CB 20       		 SLA B	;
 40)   8B02 CB 20       		 SLA B	;
 41)   8B04 CB 20       		 SLA B         ;SET TO A15,A14,A13	;SET TO A15,A14,A13
 42)   8B06 ED 79       		 OUT (C), A	;
 43)   8B08 43          		 LD B,E	;
 44)   8B09 C9          		 RET	;
 49)   8B0A 21 82 00    		GETPGINBANK:   LD HL,BANKS	;
 50)   8B0D 16 00       		               LD D,0	;
 51)   8B0F 58          		               LD E,B	;
 52)   8B10 19          		               ADD HL,DE	;
 53)   8B11 7E          		               LD A,(HL)	;
 54)   8B12 C9          		               RET	;
 17)   8B13 	            		 RBR EQU DEVSER+0      ;RECEIVER BUFFER REGISTER (READ ONLY) (DLAB = 0)	;RECEIVER BUFFER REGISTER (READ ONLY) (DLAB = 0)
 18)   8B13 	            		 THR EQU DEVSER+0      ;TRANSMITER HOLDING REGISTER (WRITE ONLY) (DLAB = 0)	;TRANSMITER HOLDING REGISTER (WRITE ONLY) (DLAB = 0)
 19)   8B13 	            		 IER EQU DEVSER+1      ;INTERRUPT ENABLE REGISTER (DLAB = 0)	;INTERRUPT ENABLE REGISTER (DLAB = 0)
 24)   8B13 	            		 IIR EQU DEVSER+2      ;INTERRUPT IDENT. REGISTER (READ ONLY)	;INTERRUPT IDENT. REGISTER (READ ONLY)
 29)   8B13 	            		 FCR EQU DEVSER+2      ;FIFO CONTROL REGISTER (WRITE ONLY)	;FIFO CONTROL REGISTER (WRITE ONLY)
 37)   8B13 	            		 LCR EQU DEVSER+3      ;LINE CONTROL REGISTER	;LINE CONTROL REGISTER
 45)   8B13 	            		 MCR EQU DEVSER+4      ;MODEM CONTROL REGISTER	;MODEM CONTROL REGISTER
 46)   8B13 	            		 LSR EQU DEVSER+5      ;LINE STATUS REGISTER	;LINE STATUS REGISTER
 55)   8B13 	            		 MSR EQU DEVSER+6      ;MODEM STATUS REGISTER	;MODEM STATUS REGISTER
 56)   8B13 	            		 SCR EQU DEVSER+7      ;SCRATCH REGISTER	;SCRATCH REGISTER
 57)   8B13 	            		 DLL EQU DEVSER+0      ;DIVISOR LATCH (LEAST SIGNIFICANT BYTE) (DLAB = 1)	;DIVISOR LATCH (LEAST SIGNIFICANT BYTE) (DLAB = 1)
 58)   8B13 	            		 DLM EQU DEVSER+1      ;DIVISOR LATCH (MOST SIGNIFICANT BYTE) (DLAB = 1)	;DIVISOR LATCH (MOST SIGNIFICANT BYTE) (DLAB = 1)
 64)   8B13 F5          		RS_INI: PUSH AF	;
 65)   8B14 3E 80       		 LD A, $80        ; Mask to set DLAB on	; Mask to set DLAB on
 66)   8B16 D3 23       		 OUT (LCR), A        ; Send to LINe Control Register	; Send to LINe Control Register
 75)   8B18 F1          		 POP AF	;
 76)   8B19 D3 20       		 OUT (DLL), A        ; Set LSB of divisor	; Set LSB of divisor
 77)   8B1B 3E 00       		 LD A, 00        ; This will be the MSB of the divisior	; This will be the MSB of the divisior
 78)   8B1D D3 21       		 OUT (DLM), A        ; Send to the MSB register	; Send to the MSB register
 79)   8B1F 3E 03       		 LD A, $03        ; 8 bits, 1 stop, no parity (and clear DLAB)	; 8 bits, 1 stop, no parity (and clear DLAB)
 80)   8B21 D3 23       		 OUT (LCR), A        ; Write new value to LCR	; Write new value to LCR
 82)   8B23 3E 00       		 LD A, 0	;
 83)   8B25 D3 22       		 OUT (FCR), A        ;//was commented	;//was commented
 84)   8B27 3E 00       		 LD A, $00        ; 5 A=0 Disable all INterrupts	; 5 A=0 Disable all INterrupts
 85)   8B29 D3 21       		 OUT (IER), A        ; Send to INterrupt Enable Register	; Send to INterrupt Enable Register
 86)   8B2B C9          		 RET	;
 89)   8B2C CD 32 8B    		RS_TX: CALL RSTXRD	;
 90)   8B2F D3 20       		 OUT (THR), A	;
 92)   8B31 C9          		 RET	;
 95)   8B32 F5          		RSTXRD: PUSH AF	;
 96)   8B33 DB 25       		RSTXLP: IN A, (LSR)        ; fetch the control register	; fetch the control register
 97)   8B35 CB 6F       		 BIT 5, A        ; bit will be set if UART is ready	; bit will be set if UART is ready
 98)   8B37 28 FA       		 JR Z, RSTXLP	;
 99)   8B39 F1          		 POP AF	;
100)   8B3A C9          		 RET	;
104)   8B3B 7E          		RS_TXT: LD A, (HL)	;
105)   8B3C 23          		 INC HL	;
106)   8B3D FE 00       		 CP 0	;
107)   8B3F C8          		 RET Z	;
108)   8B40 CD 2C 8B    		 CALL RS_TX	;
109)   8B43 18 F6       		 JR RS_TXT	;
113)   8B45 E5          		RS_MESG: PUSH HL	;
114)   8B46 C5          		 PUSH BC	;
115)   8B47 D5          		 PUSH DE	;
116)   8B48 F5          		 PUSH AF	;
117)   8B49 21 09 00    		 LD HL,9 ;POINTS TO RET ADDRESS +10 FROM SP = OUR STRING	;POINTS TO RET ADDRESS +10 FROM SP = OUR STRING
118)   8B4C 39          		 ADD HL,SP	;
119)   8B4D 46          		 LD B,(HL)    	;
120)   8B4E 2B          		 DEC HL	;
121)   8B4F 4E          		 LD C,(HL)	;
122)   8B50 60          		 LD H,B	;
123)   8B51 69          		 LD L,C	;
124)   8B52 CD 3B 8B    		 CALL RS_TXT	;
125)   8B55 F1          		 POP AF	;
126)   8B56 D1          		 POP DE	;
127)   8B57 44          		 LD B,H  ;NEW RET ADDRESS	;NEW RET ADDRESS
128)   8B58 4D          		 LD C,L	;
129)   8B59 21 05 00    		 LD HL,5 ;POINTS TO RET ADDRESS +6 FROM SP	;POINTS TO RET ADDRESS +6 FROM SP
130)   8B5C 39          		 ADD HL,SP  	;
131)   8B5D 70          		 LD (HL),B	;
132)   8B5E 2B          		 DEC HL	;
133)   8B5F 71          		 LD (HL),C  	;
134)   8B60 C1          		 POP BC	;
135)   8B61 E1          		 POP HL	;
136)   8B62 C9          		 RET 	;
143)   8B63 ED 57       		RS_RX: LD A,I        ;SETS PV IF INTS ARE ENABLED	;SETS PV IF INTS ARE ENABLED
144)   8B65 F5          		 PUSH AF	;
145)   8B66 D1          		 POP DE	;
146)   8B67 F3          		 DI	;
147)   8B68 3E 01       		 LD A, 1        ;ready to receive SIGNAL DSR 1	;ready to receive SIGNAL DSR 1
148)   8B6A D3 24       		 OUT (MCR), A	;
149)   8B6C CD 8A 8B    		 CALL RSRXRD	;
150)   8B6F AF          		RS_GTCH: XOR A        ;NOT ready to receive SIGNAL DSR 0	;NOT ready to receive SIGNAL DSR 0
151)   8B70 D3 24       		 OUT (MCR), A	;
153)   8B72 DB 20       		 IN A, (RBR)  	;
154)   8B74 D5          		 PUSH DE	;
155)   8B75 57          		 LD D,A	;
156)   8B76 F1          		 POP AF	;
157)   8B77 7A          		 LD A,D	;
158)   8B78 E0          		 RET PO  	;
159)   8B79 FB          		 EI	;
160)   8B7A C9          		 RET	;
162)   8B7B 3E 01       		RS_RXNW: LD A, 1       ;ready to receive SIGNAL DSR 1	;ready to receive SIGNAL DSR 1
163)   8B7D D3 24       		 OUT (MCR), A	;
164)   8B7F DB 25       		 IN A, (LSR)        ; fetch the conrtol register	; fetch the conrtol register
165)   8B81 CB 47       		 BIT 0, A	;
166)   8B83 28 03       		 JR Z, RS_NOCHAR	;
167)   8B85 F3          		 DI	;
168)   8B86 18 E7       		 JR RS_GTCH	;
169)   8B88 AF          		RS_NOCHAR: XOR A        ;RETURN ZERO	;RETURN ZERO
170)   8B89 C9          		 RET	;
178)   8B8A F5          		 PUSH AF	;
184)   8B8B DB 25       		 IN A, (LSR)        ; fetch the control register	; fetch the control register
185)   8B8D CB 47       		 BIT 0, A        ; bit will be set if UART has data	; bit will be set if UART has data
186)   8B8F 28 FA       		 JR Z, RSRXLP	;
188)   8B91 F1          		 POP AF	;
190)   8B92 C9          		 RET	;
194)   8B93 DB 25       		RS_KEYRD: IN A, (LSR)       ; fetch the conrtol register	; fetch the conrtol register
195)   8B95 CB 47       		 BIT 0, A        ; bit will be set if UART has data	; bit will be set if UART has data
196)   8B97 C9          		 RET	;
198)   8B98 F5          		SHLCD: PUSH AF	;
200)   8B99 F1          		 POP AF	;
202)   8B9A C9          		 RET	;
204)   8B9B F5          		RS_NEWLINE: PUSH AF	;
205)   8B9C 3E 0D       		 LD A,13	;
206)   8B9E CD 2C 8B    		 CALL RS_TX	;
207)   8BA1 3E 0A       		 LD A,10	;
208)   8BA3 CD 2C 8B    		 CALL RS_TX	;
209)   8BA6 F1          		 POP AF	;
210)   8BA7 C9          		 RET  	;
213)   8BA8 F5          		CHKERR: PUSH AF	;
214)   8BA9 E5          		 PUSH HL	;
215)   8BAA C5          		 PUSH BC	;
216)   8BAB DB 25       		 IN A, (LSR)        ;FETCH LINE STATUS REGISTER	;FETCH LINE STATUS REGISTER
217)   8BAD CB 67       		 BIT 4, A	;
218)   8BAF 28 04       		 JR Z, LBLPE	;
219)   8BB1 3E 42       		 LD A, 'B'       ;$20  ;BREAK	;$20  ;BREAK
220)   8BB3 18 1A       		 JR EXIT	;
221)   8BB5 CB 57       		LBLPE: BIT 2, A	;
222)   8BB7 28 04       		 JR Z, LBLFE	;
223)   8BB9 3E 50       		 LD A, 'P'       ;$40  ;PARITY	;$40  ;PARITY
224)   8BBB 18 12       		 JR EXIT	;
225)   8BBD CB 5F       		LBLFE: BIT 3, A	;
226)   8BBF 28 04       		 JR Z, LBLOE	;
227)   8BC1 3E 46       		 LD A, 'F'       ;$60  ;FRAME	;$60  ;FRAME
228)   8BC3 18 0A       		 JR EXIT	;
229)   8BC5 CB 4F       		LBLOE: BIT 1, A	;
230)   8BC7 28 04       		 JR Z, LBLNE	;
231)   8BC9 3E 4F       		 LD A, 'O'        ;$80  ;OVERRUN	;$80  ;OVERRUN
232)   8BCB 18 02       		 JR EXIT	;
233)   8BCD 3E 4E       		LBLNE: LD A, 'N'        ;NO ERROR	;NO ERROR
234)   8BCF 21 7A 00    		EXIT: LD HL, SERERR	;
235)   8BD2 77          		 LD (HL), A	;
237)   8BD3 C1          		 POP BC	;
238)   8BD4 E1          		 POP HL	;
239)   8BD5 F1          		 POP AF	;
240)   8BD6 C9          		 RET	;
 32)   8BD7 	            		@CH376_ERROR EQU RS_MESG	;
 42)   8BD7 57          		STRG_INIT: LD D,A	;
 43)   8BD8 AF          		 XOR A  	;
 44)   8BD9 32 8A 00    		 LD (STRG_STAT),A  ;NOT CONNECTED, NOT EXISTS	;NOT CONNECTED, NOT EXISTS
 45)   8BDC CD B4 91    		 CALL CH376_INIT	;
 46)   8BDF 20 06       		 JR NZ,INIERR	;
 47)   8BE1 7A          		 LD A,D   ;SELECT USB DEVICE 3 FOR SDCARD, 6 FOR FLASH	;SELECT USB DEVICE 3 FOR SDCARD, 6 FOR FLASH
 48)   8BE2 CD C9 91    		 CALL CH376_SETUSB	;
 49)   8BE5 28 03       		 JR Z,INIOK	;
 50)   8BE7 3E 00       		INIERR: LD A,0  	;
 51)   8BE9 C9          		 RET	;
 52)   8BEA CD A9 91    		INIOK: CALL CH376_VERSION	;
 53)   8BED BF          		 CP A  ;SET ZF	;SET ZF
 54)   8BEE 3E 80       		 LD A, $80  ;BIT 7 MEANS EXISTS	;BIT 7 MEANS EXISTS
 55)   8BF0 32 8A 00    		 LD (STRG_STAT),A  ;	;
 56)   8BF3 C9          		 RET	;
 59)   8BF4 3A 8A 00    		STRG_EXISTS: LD A,(STRG_STAT)	;
 60)   8BF7 CB 7F       		 BIT 7,A	;
 61)   8BF9 C9          		 RET	;
 67)   8BFA CD F4 8B    		STRG_CHECK: CALL STRG_EXISTS	;
 68)   8BFD 37          		 SCF	;
 69)   8BFE C8          		 RET Z    ;Z MEANS NOT EXISTS	;Z MEANS NOT EXISTS
 70)   8BFF 06 05       		 LD B,5	;
 71)   8C01 CD F9 91    		SC_AGN1: CALL CH376_CONNECT 	;
 72)   8C04 28 06       		 JR Z,DOCON	;
 73)   8C06 30 1C       		 JR NC,DODISC	;
 74)   8C08 10 F7       		 DJNZ SC_AGN1    	;
 78)   8C0A AF          		 XOR A   	;
 79)   8C0B C9          		 RET   ;TIMEOUT	;TIMEOUT
 81)   8C0C AF          		DOCON: XOR A    ;CLCF	;CLCF
 82)   8C0D 3A 8A 00    		 LD A,(STRG_STAT)	;
 83)   8C10 CB 47       		 BIT 0,A	;
 84)   8C12 C0          		 RET NZ    ;ALREADY MOUNTED THE DRIVE	;ALREADY MOUNTED THE DRIVE
 88)   8C13 CD 04 92    		 CALL CH376_MOUNT   ;MOUNT THE DRIVE	;MOUNT THE DRIVE
 89)   8C16 20 0C       		 JR NZ, DONOMNT	;
 93)   8C18 3A 8A 00    		 LD A,(STRG_STAT)	;
 94)   8C1B CB C7       		 SET 0,A	;
 95)   8C1D 32 8A 00    		 LD (STRG_STAT),A	;
 96)   8C20 AF          		 XOR A    ;CLEAR CARRY FLAG MEANS WE ARE OK	;CLEAR CARRY FLAG MEANS WE ARE OK
 97)   8C21 3E 01       		 LD A,1    ;A=1 IS JUST CONNECTED	;A=1 IS JUST CONNECTED
 98)   8C23 C9          		 RET	;
106)   8C24 AF          		 XOR A 	;
107)   8C25 3A 8A 00    		 LD A,(STRG_STAT)  	;
108)   8C28 CB 47       		 BIT 0,A	;
109)   8C2A C8          		 RET Z    ;ALREADY DISCONNECTED	;ALREADY DISCONNECTED
110)   8C2B CB 87       		 RES 0,A    ;SET BIT 0 TO 0=DISCONNECTED	;SET BIT 0 TO 0=DISCONNECTED
111)   8C2D 32 8A 00    		 LD (STRG_STAT),A  	;
112)   8C30 3E 02       		 LD A,2    ;A=2 IS JUST DISCONNECTED	;A=2 IS JUST DISCONNECTED
113)   8C32 C9          		 RET	;
119)   8C33 C3 0D 92    		STRG_OPENCRD:  JP CH376_MOUNTDEV  	;
122)   8C36 2A 00       		SDIRTP  DEFB '*',0	;
124)   8C38 CD 6A 8C    		STRG_DIRLIST: CALL STRG_OPENCDIR ;OPEN CURRENT DIR	;OPEN CURRENT DIR
125)   8C3B 21 36 8C    		 LD HL,SDIRTP	;
126)   8C3E CD E7 8C    		 CALL STRG_OPENFD	;
127)   8C41 C8          		DL_NXTFILE: RET Z   ;NO  MORE FILES	;NO  MORE FILES
128)   8C42 3E 27       		 LD A,CMD_RDUSB_DATA0	;
129)   8C44 CD 93 91    		 CALL CH376_COMMD	;
130)   8C47 CD D2 90    		 CALL CH376_GETDATA ;DATA ON USBBUF A=BYTES TO READ	;DATA ON USBBUF A=BYTES TO READ
131)   8C4A 3E 00       		 LD A,0	;
132)   8C4C 12          		 LD (DE),A   ;ZT STRING	;ZT STRING
134)   8C4D 21 8B 00    		 LD HL,USBBUF	;
135)   8C50 CD 38 80    		 CALL OS_PRMESSCRSFE	;
136)   8C53 3E 0D       		 LD A,$0D	;
137)   8C55 CD 2D 80    		 CALL OS_PRCHSCR	;
139)   8C58 3E 33       		 LD A, CMD_FILEENUM_GO	;
140)   8C5A CD 93 91    		 CALL CH376_COMMD	;
141)   8C5D CD 24 91    		 CALL CH376_WTCMDEND	;
142)   8C60 FE 42       		 CP ERR_MISS_FILE	;
143)   8C62 18 DD       		 JR DL_NXTFILE	;
147)   8C64 7E          		NEXTDIR: LD A,(HL)	;
148)   8C65 23          		 INC HL	;
149)   8C66 B7          		 OR A	;
150)   8C67 C8          		 RET Z	;
151)   8C68 18 FA       		 JR NEXTDIR	;
157)   8C6A E5          		STRG_OPENCDIR: PUSH HL	;
158)   8C6B D5          		 PUSH DE	;
159)   8C6C C5          		 PUSH BC  	;
160)   8C6D 21 E0 00    		 LD HL,DIRNM	;
161)   8C70 CD 77 8C    		 CALL STRG_OPENCDIR2	;
162)   8C73 C1          		        POP BC	;
163)   8C74 D1          		 POP DE	;
164)   8C75 E1          		 POP HL	;
165)   8C76 C9          		 RET	;
167)   8C77 7E          		STRG_OPENCDIR2: LD A,(HL)	;
168)   8C78 B7          		 OR A	;
169)   8C79 C8          		 RET Z  ;WHEN ZERO MEANS NO MORE DIR TO OPEN	;WHEN ZERO MEANS NO MORE DIR TO OPEN
173)   8C7A E5          		 PUSH HL	;
174)   8C7B CD E7 8C    		 CALL STRG_OPENFD	;
175)   8C7E E1          		 POP HL	;
176)   8C7F D8          		 RET C  ;ERROR	;ERROR
177)   8C80 37          		 SCF	;
178)   8C81 3E 96       		 LD A,150 ;MISSING FILENAME	;MISSING FILENAME
179)   8C83 C8          		 RET Z  ;FILE MISSING	;FILE MISSING
181)   8C84 CD 64 8C    		 CALL NEXTDIR	;
182)   8C87 18 EE       		 JR STRG_OPENCDIR2	;
186)   8C89 E5          		STRG_DIRNMCHG: PUSH HL 	;
187)   8C8A 7E          		 LD A,(HL)	;
188)   8C8B FE 5C       		 CP '\'        ;changed from '/' on 18/2/2024	;changed from '/' on 18/2/2024
189)   8C8D 28 0E       		 JR Z,DNC_RESET	;
190)   8C8F FE 2F       		 CP '/'        ; 25/2/2024	; 25/2/2024
191)   8C91 28 0A       		 JR Z,DNC_RESET  	;
192)   8C93 FE 2E       		 CP '.'	;
193)   8C95 20 2D       		 JR NZ, DNC_ADD	;
194)   8C97 FE 2E       		 CP '.'	;
195)   8C99 28 0F       		 JR Z,DNC_RMV	;
196)   8C9B E1          		 POP HL	;
197)   8C9C C9          		 RET ;DO NOTHING IF . OR .\ OR .<x>	;DO NOTHING IF . OR .\ OR .<x>
198)   8C9D 21 E0 00    		DNC_RESET: LD HL,DIRNM	;
199)   8CA0 36 5C       		 LD (HL),'\'	;
200)   8CA2 23          		 INC HL	;
201)   8CA3 36 00       		 LD (HL),0	;
202)   8CA5 23          		 INC HL	;
203)   8CA6 36 00       		 LD (HL),0	;
204)   8CA8 E1          		 POP HL	;
205)   8CA9 C9          		 RET	;
207)   8CAA 21 E0 00    		DNC_RMV: LD HL,DIRNM	;
208)   8CAD CD 64 8C    		 CALL NEXTDIR	;
209)   8CB0 7E          		 LD A,(HL)	;
210)   8CB1 B7          		 OR A	;
211)   8CB2 EB          		 EX DE,HL ;DE THE NEXT DIR	;DE THE NEXT DIR
212)   8CB3 E1          		 POP HL	;
213)   8CB4 C8          		 RET Z ;RET IF WE ARE ON 1ST DIRECTORY  	;RET IF WE ARE ON 1ST DIRECTORY
214)   8CB5 E5          		 PUSH HL	;
215)   8CB6 EB          		 EX DE,HL ;HL THE NEXT DIR	;HL THE NEXT DIR
216)   8CB7 44          		RMV_NXT: LD B,H	;
217)   8CB8 4D          		 LD C,L	;
218)   8CB9 CD 64 8C    		 CALL NEXTDIR	;
219)   8CBC 7E          		 LD A,(HL)	;
220)   8CBD B7          		 OR A	;
221)   8CBE 20 F7       		 JR NZ,RMV_NXT ;GO TO NEXT DIR 	;GO TO NEXT DIR
224)   8CC0 AF          		 XOR A	;
225)   8CC1 02          		 LD (BC),A	;
226)   8CC2 E1          		 POP HL	;
227)   8CC3 C9          		 RET	;
228)   8CC4 EB          		DNC_ADD: EX DE,HL ;DE THE NEW FILE	;DE THE NEW FILE
229)   8CC5 21 E0 00    		 LD HL,DIRNM	;
230)   8CC8 CD 64 8C    		ADDNXT: CALL NEXTDIR	;
231)   8CCB 7E          		 LD A,(HL)	;
232)   8CCC B7          		 OR A	;
233)   8CCD 20 F9       		 JR NZ,ADDNXT	;
235)   8CCF EB          		 EX DE,HL	;
237)   8CD0 7E          		ADDNXT2: LD A,(HL)	;
238)   8CD1 12          		 LD (DE),A	;
239)   8CD2 23          		 INC HL	;
240)   8CD3 13          		 INC DE	;
241)   8CD4 B7          		 OR A	;
242)   8CD5 20 F9       		 JR NZ,ADDNXT2	;
244)   8CD7 EB          		 EX DE,HL	;
245)   8CD8 36 00       		 LD (HL),0 ;SIGNAL END OF DIRECTORIES WITH A SECOND ZERO	;SIGNAL END OF DIRECTORIES WITH A SECOND ZERO
246)   8CDA E1          		 POP HL	;
247)   8CDB C9          		 RET	;
251)   8CDC F5          		TEMPPRMSG: PUSH AF	;
252)   8CDD CD 30 80    		 CALL OS_PRMESSCR	;
253)   8CE0 3E 0A       		 LD A,$0A	;
254)   8CE2 CD 2D 80    		 CALL OS_PRCHSCR	;
255)   8CE5 F1          		 POP AF	;
256)   8CE6 C9          		 RET	;
265)   8CE7 E5          		STRG_DIRCHG: PUSH HL	;
269)   8CE8 3E 2F       		 LD A, CMD_SETFILENAME	;
270)   8CEA CD 93 91    		     CALL CH376_COMMD  	;
271)   8CED CD 48 92    		     CALL CH376_WRSTRING	;
272)   8CF0 20 0E       		 JR NZ,DC_WSERR  	;
273)   8CF2 3E 32       		 LD A, CMD_FILE_OPEN	;
274)   8CF4 CD 93 91    		 CALL CH376_COMMD	;
275)   8CF7 CD 24 91    		 CALL CH376_WTCMDEND   	;
276)   8CFA E1          		 POP HL	;
277)   8CFB FE 42       		 CP ERR_MISS_FILE	;
278)   8CFD C8          		 RET Z	;
279)   8CFE B7          		 OR A  ;CLEAR CARRY	;CLEAR CARRY
280)   8CFF C9          		 RET	;
282)   8D00 E1          		DC_WSERR: POP HL	;
283)   8D01 37          		 SCF	;
284)   8D02 C9          		 RET  	;
286)   8D03 C9          		STRG_TPFILE: RET	;
287)   8D04 C9          		STRG_GETPOS: RET	;
291)   8D05 D5          		STRG_SETPOS16: PUSH DE	;
292)   8D06 11 00 00    		 LD DE,0	;
293)   8D09 CD 0E 8D    		 CALL STRG_SETPOS 	;
294)   8D0C D1          		 POP DE	;
295)   8D0D C9          		 RET	;
297)   8D0E 3E 39       		STRG_SETPOS: LD A,CMD_BYTE_LOCATE	;
298)   8D10 CD 93 91    		 CALL CH376_COMMD	;
299)   8D13 79          		 LD A,C                             ; 4 BYTES TO SET THE OFFSET LOW IN FRONT	; 4 BYTES TO SET THE OFFSET LOW IN FRONT
300)   8D14 CD 97 91    		     CALL CH376_DATAWR	;
301)   8D17 78          		 LD A,B	;
302)   8D18 CD 97 91    		 CALL CH376_DATAWR	;
303)   8D1B 7B          		 LD A,E	;
304)   8D1C CD 97 91    		 CALL CH376_DATAWR            ;LAST 2 BYTES 0 MAX 65535 SKIP	;LAST 2 BYTES 0 MAX 65535 SKIP
305)   8D1F 7A          		 LD A,D	;
306)   8D20 CD 97 91    		 CALL CH376_DATAWR	;
307)   8D23 CD 24 91    		     CALL CH376_WTCMDEND	;
308)   8D26 C9          		 RET	;
311)   8D27 C9          		STRG_GETSIZE: RET	;
312)   8D28 C9          		STRG_GETEOF: RET	;
319)   8D29 3E 27       		STRG_PRDRVINFO: LD A,CMD_RDUSB_DATA0	;
320)   8D2B CD 93 91    		 CALL CH376_COMMD	;
321)   8D2E CD D2 90    		 CALL CH376_GETDATA	;
322)   8D31 F5          		 PUSH AF	;
323)   8D32 D6 08       		 SUB 8  	;
324)   8D34 47          		 LD B,A	;
325)   8D35 F1          		 POP AF   	;
326)   8D36 21 93 00    		 LD HL,USBBUF+8  ;SKIP 8 BYTES	;SKIP 8 BYTES
327)   8D39 7E          		PDI_NXT: LD A,(HL)	;
328)   8D3A E5          		 PUSH HL	;
329)   8D3B C5          		 PUSH BC	;
330)   8D3C CD 16 80    		 CALL OS_PRINTCHAR	;
331)   8D3F C1          		 POP BC	;
332)   8D40 E1          		 POP HL	;
333)   8D41 23          		 INC HL	;
334)   8D42 10 F5       		 DJNZ PDI_NXT  	;
335)   8D44 CD 9B 8B    		 CALL RS_NEWLINE	;
337)   8D47 3E 3F       		 LD A,CMD_DISK_QUERY   	;
338)   8D49 CD 93 91    		 CALL CH376_COMMD	;
339)   8D4C CD 24 91    		 CALL CH376_WTCMDEND	;
340)   8D4F C0          		 RET NZ	;
341)   8D50 3E 27       		 LD A,CMD_RDUSB_DATA0	;
342)   8D52 CD 93 91    		 CALL CH376_COMMD  	;
343)   8D55 CD D2 90    		 CALL CH376_GETDATA	;
345)   8D58 DD 21 8B 00 		 LD IX,USBBUF 	;
346)   8D5C DD E5       		 PUSH IX   	;
347)   8D5E DD 56 03    		 LD D,(IX+3)	;
348)   8D61 DD 5E 02    		 LD E,(IX+2)	;
349)   8D64 DD 66 01    		 LD H,(IX+1)	;
350)   8D67 DD 6E 00    		 LD L,(IX+0)	;
351)   8D6A CD 60 9B    		 CALL B2D32    ;DE:HL RES ON B2DBUF	;DE:HL RES ON B2DBUF
352)   8D6D 21 CB 00    		 LD HL,B2DBUF	;
353)   8D70 CD F0 9B    		 CALL SKIPSPC	;
354)   8D73 CD 1A 80    		 CALL OS_PRINTTEXT	;
355)   8D76 CD 26 80    		 CALL OS_PRINTMSG	;
356)   8D79 20 53 45 43 		 DEFM " SECTORS"	;
356)   8D7D 54 4F 52 53 		 DEFM " SECTORS"	;
357)   8D81 0A 0D 00    		 DB 10,13 0	;
358)   8D84 DD E1       		 POP IX	;
360)   8D86 DD E5       		 PUSH IX     	;
361)   8D88 DD 56 07    		 LD D,(IX+7)	;
362)   8D8B DD 5E 06    		 LD E,(IX+6)	;
363)   8D8E DD 66 05    		 LD H,(IX+5)	;
364)   8D91 DD 6E 04    		 LD L,(IX+4)  	;
365)   8D94 CD 60 9B    		 CALL B2D32  ;DE:HL RES ON B2DBUF	;DE:HL RES ON B2DBUF
366)   8D97 21 CB 00    		 LD HL,B2DBUF	;
367)   8D9A CD F0 9B    		 CALL SKIPSPC	;
368)   8D9D CD 1A 80    		 CALL OS_PRINTTEXT	;
369)   8DA0 CD 26 80    		 CALL OS_PRINTMSG	;
370)   8DA3 20 53 45 43 		 DEFM " SECTORS FREE   "	;
370)   8DA7 54 4F 52 53 		 DEFM " SECTORS FREE   "	;
370)   8DAB 20 46 52 45 		 DEFM " SECTORS FREE   "	;
370)   8DAF 45 20 20 20 		 DEFM " SECTORS FREE   "	;
371)   8DB3 0A 0D 00    		 DB 10,13,0   	;
372)   8DB6 DD E1       		 POP IX	;
374)   8DB8 DD 7E 08    		FILESYSTEM: LD A,(IX+8) ;1-FAT12,2-FAT16,3-FAT32	;1-FAT12,2-FAT16,3-FAT32
375)   8DBB 3D          		 DEC A	;
376)   8DBC 28 08       		 JR Z,PDI_NXT0	;
377)   8DBE 3D          		 DEC A	;
378)   8DBF 28 18       		 JR Z,PDI_NXT1	;
379)   8DC1 3D          		 DEC A	;
380)   8DC2 28 28       		 JR Z,PDI_NXT2	;
381)   8DC4 18 39       		 JR PDI_NXT3	;
383)   8DC6 CD 26 80    		PDI_NXT0: CALL OS_PRINTMSG	;
384)   8DC9 46 53 20 49 		 DEFM "FS IS FAT-12"	;
384)   8DCD 53 20 46 41 		 DEFM "FS IS FAT-12"	;
384)   8DD1 54 2D 31 32 		 DEFM "FS IS FAT-12"	;
385)   8DD5 0A 0D 00    		 DB 10,13,0	;
386)   8DD8 C9          		 RET	;
387)   8DD9 CD 26 80    		PDI_NXT1: CALL OS_PRINTMSG	;
388)   8DDC 46 53 20 49 		 DEFM "FS IS FAT-16"	;
388)   8DE0 53 20 46 41 		 DEFM "FS IS FAT-16"	;
388)   8DE4 54 2D 31 36 		 DEFM "FS IS FAT-16"	;
389)   8DE8 0A 0D 00    		 DB 10,13,0	;
390)   8DEB C9          		 RET	;
391)   8DEC CD 26 80    		PDI_NXT2: CALL OS_PRINTMSG	;
392)   8DEF 46 53 20 49 		 DEFM "FS IS FAT-32"	;
392)   8DF3 53 20 46 41 		 DEFM "FS IS FAT-32"	;
392)   8DF7 54 2D 33 32 		 DEFM "FS IS FAT-32"	;
393)   8DFB 0A 0D 00    		 DB 10,13,0	;
394)   8DFE C9          		 RET	;
395)   8DFF CD 26 80    		PDI_NXT3: CALL OS_PRINTMSG	;
396)   8E02 55 4E 4B 4E 		 DEFM "UNKNOWN FS"	;
396)   8E06 4F 57 4E 20 		 DEFM "UNKNOWN FS"	;
396)   8E0A 46 53       		 DEFM "UNKNOWN FS"	;
397)   8E0C 0A 0D 00    		 DB 10,13,0	;
398)   8E0F DD 7E 08    		 LD A,(IX+8)  ;TO BE PRINTED MAYBE	;TO BE PRINTED MAYBE
399)   8E12 C9          		 RET	;
404)   8E13 F5          		STRG_OPNFILE: PUSH AF	;
405)   8E14 3E 2F       		 LD A, CMD_SETFILENAME	;
406)   8E16 CD 93 91    		     CALL CH376_COMMD	;
407)   8E19 21 8B 00    		 LD HL, STRGBUFF	;
408)   8E1C CD 48 92    		     CALL CH376_WRSTRING	;
409)   8E1F 28 1E       		 JR Z,OF_WSOK	;
410)   8E21 F1          		 POP AF	;
411)   8E22 CD 26 80    		 CALL OS_PRINTMSG	;
412)   8E25 45 52 52 4F 		 DEFM "ERROR SETTING FILENAME"	;
412)   8E29 52 20 53 45 		 DEFM "ERROR SETTING FILENAME"	;
412)   8E2D 54 54 49 4E 		 DEFM "ERROR SETTING FILENAME"	;
412)   8E31 47 20 46 49 		 DEFM "ERROR SETTING FILENAME"	;
412)   8E35 4C 45 4E 41 		 DEFM "ERROR SETTING FILENAME"	;
412)   8E39 4D 45       		 DEFM "ERROR SETTING FILENAME"	;
413)   8E3B 0A 0D 00    		 DB 10,13,0  	;
414)   8E3E C9          		 RET	;
415)   8E3F F1          		OF_WSOK: POP AF	;
419)   8E40 B7          		 OR A  ;0 READ	;0 READ
420)   8E41 28 0C       		 JR Z,OF_OPEN	;
421)   8E43 D6 01       		 SUB 1  ;1 WRITE	;1 WRITE
422)   8E45 28 08       		 JR Z,OF_OPEN	;
423)   8E47 D6 01       		 SUB 1  ;2 READ/WRITE	;2 READ/WRITE
424)   8E49 28 04       		 JR Z,OF_OPEN	;
434)   8E4B 3E 34       		 LD A, CMD_FILE_CREATE  	;
435)   8E4D 18 02       		 JR OF_EXEC	;
440)   8E4F 3E 32       		 LD A, CMD_FILE_OPEN	;
444)   8E51 CD 93 91    		 CALL CH376_COMMD	;
445)   8E54 CD 24 91    		 CALL CH376_WTCMDEND	;
446)   8E57 C9          		 RET	;
448)   8E58 3E 36       		STRG_CLSFILE: LD A, CMD_FILE_CLOSE	;
449)   8E5A CD 93 91    		     CALL CH376_COMMD	;
450)   8E5D 3E 01       		     LD A, 1                             ; 1 = update file size if necessary	; 1 = update file size if necessary
451)   8E5F CD 97 91    		     CALL CH376_DATAWR	;
452)   8E62 CD 24 91    		     CALL CH376_WTCMDEND	;
453)   8E65 C9          		     RET	;
459)   8E66 D5          		STRG_BLKREAD: PUSH DE	;
460)   8E67 3E 3A       		 LD A, CMD_BYTE_READ	;
461)   8E69 CD 93 91    		     CALL CH376_COMMD	;
462)   8E6C 79          		     LD A, C                           ; BYTES REQUEST ON BC	; BYTES REQUEST ON BC
463)   8E6D CD 97 91    		     CALL CH376_DATAWR	;
464)   8E70 78          		     LD A, B	;
465)   8E71 CD 97 91    		     CALL CH376_DATAWR	;
466)   8E74 2F          		 CPL	;
467)   8E75 2F          		 CPL    	;
471)   8E76 D1          		 POP DE	;
472)   8E77 21 00 00    		 LD HL,0      ;BYTE RECEIVE COUNTER	;BYTE RECEIVE COUNTER
473)   8E7A E5          		STBR_DOREST: PUSH HL	;
474)   8E7B D5          		 PUSH DE	;
475)   8E7C CD 24 91    		 CALL CH376_WTCMDEND	;
476)   8E7F D1          		 POP DE	;
477)   8E80 E1          		 POP HL	;
478)   8E81 28 1C       		 JR Z, FR_DONE   ;Z=NO MORE OR CANNOT READ	;Z=NO MORE OR CANNOT READ
479)   8E83 FE 1D       		 CP USB_INT_DISK_READ                    	;
480)   8E85 20 1C       		     JR NZ, FR_ERROR	;
482)   8E87 3E 27       		 LD A,CMD_RDUSB_DATA0	;
483)   8E89 CD 93 91    		 CALL CH376_COMMD 	;
484)   8E8C CD A6 91    		 CALL CH376_DATARD  ;A= BYTES TO READ TO BUFFER	;A= BYTES TO READ TO BUFFER
485)   8E8F 47          		 LD B,A	;
498)   8E90 CD A6 91    		STBR_NXT1: CALL CH376_DATARD ;READ THE BYTES TO BUFFER	;READ THE BYTES TO BUFFER
499)   8E93 12          		 LD (DE),A	;
500)   8E94 13          		 INC DE	;
501)   8E95 23          		 INC HL    ;TOTAL BYTES READ COUNTER	;TOTAL BYTES READ COUNTER
502)   8E96 10 F8       		 DJNZ STBR_NXT1  	;
503)   8E98 3E 3B       		 LD A, CMD_BYTE_RD_GO 	;
504)   8E9A CD 93 91    		 CALL CH376_COMMD 	;
505)   8E9D 18 DB       		 JR STBR_DOREST	;
511)   8E9F 44          		 LD B,H	;
512)   8EA0 4D          		 LD C,L	;
513)   8EA1 AF          		 XOR A	;
514)   8EA2 C9          		 RET	;
515)   8EA3 F5          		FR_ERROR: PUSH AF	;
516)   8EA4 CD E9 9C    		 CALL PRINTNUM	;
517)   8EA7 CD 26 80    		 CALL OS_PRINTMSG	;
518)   8EAA 45 52 52 4F 		 DEFM "ERROR READING BLOCK!!! "	;
518)   8EAE 52 20 52 45 		 DEFM "ERROR READING BLOCK!!! "	;
518)   8EB2 41 44 49 4E 		 DEFM "ERROR READING BLOCK!!! "	;
518)   8EB6 47 20 42 4C 		 DEFM "ERROR READING BLOCK!!! "	;
518)   8EBA 4F 43 4B 21 		 DEFM "ERROR READING BLOCK!!! "	;
518)   8EBE 21 21 20    		 DEFM "ERROR READING BLOCK!!! "	;
519)   8EC1 00          		 DB 0 	;
520)   8EC2 F1          		 POP AF	;
521)   8EC3 06 02       		 LD B,2	;
522)   8EC5 05          		 DEC B	;
523)   8EC6 C9          		 RET  	;
530)   8EC7 D5          		STRG_LOADFILE: PUSH DE	;
531)   8EC8 C5          		 PUSH BC	;
537)   8EC9 CD 1E 9D    		 CALL COPYFNAME	;
538)   8ECC AF          		 XOR A   ;READ ONLY 	;READ ONLY
539)   8ECD CD 13 8E    		 CALL STRG_OPNFILE  	;
540)   8ED0 20 4B       		 JR NZ, FOPENERR	;
545)   8ED2 C1          		 POP BC  ;BYTECOUNT	;BYTECOUNT
546)   8ED3 D1          		 POP DE  ;DEST BUFFER	;DEST BUFFER
547)   8ED4 CD 66 8E    		 CALL STRG_BLKREAD	;
548)   8ED7 28 20       		 JR Z, FREADOK	;
549)   8ED9 CD E9 9C    		 CALL PRINTNUM	;
550)   8EDC CD 26 80    		 CALL OS_PRINTMSG	;
551)   8EDF 20 45 52 52 		 DEFM " ERROR READING FILE"	;
551)   8EE3 4F 52 20 52 		 DEFM " ERROR READING FILE"	;
551)   8EE7 45 41 44 49 		 DEFM " ERROR READING FILE"	;
551)   8EEB 4E 47 20 46 		 DEFM " ERROR READING FILE"	;
551)   8EEF 49 4C 45    		 DEFM " ERROR READING FILE"	;
552)   8EF2 0A 0D 00    		 DB 10,13,0	;
553)   8EF5 D5          		 PUSH DE	;
554)   8EF6 C5          		 PUSH BC	;
555)   8EF7 18 24       		 JR FOPENERR	;
556)   8EF9 C5          		FREADOK: PUSH BC	;
557)   8EFA CD 5C 9B    		 CALL B2D16	;
558)   8EFD 21 CB 00    		 LD HL,B2DBUF	;
559)   8F00 CD F0 9B    		 CALL SKIPSPC	;
560)   8F03 CD 3B 8B    		 CALL RS_TXT	;
561)   8F06 CD 26 80    		 CALL OS_PRINTMSG	;
562)   8F09 20 42 59 54 		 DEFM " BYTES READ"	;
562)   8F0D 45 53 20 52 		 DEFM " BYTES READ"	;
562)   8F11 45 41 44    		 DEFM " BYTES READ"	;
563)   8F14 0A 0D 00    		 DB 10,13,0	;
564)   8F17 CD 58 8E    		 CALL STRG_CLSFILE	;
565)   8F1A C1          		 POP BC   ;BYTES LOADED TO BUFFER	;BYTES LOADED TO BUFFER
566)   8F1B AF          		 XOR A	;
567)   8F1C C9          		 RET	;
568)   8F1D C1          		FOPENERR: POP BC	;
569)   8F1E D1          		 POP DE	;
570)   8F1F CD E9 9C    		 CALL PRINTNUM	;
571)   8F22 CD 26 80    		 CALL OS_PRINTMSG	;
572)   8F25 2D 2D 3E 45 		 DEFM "-->ERROR AT LOADFILE"	;
572)   8F29 52 52 4F 52 		 DEFM "-->ERROR AT LOADFILE"	;
572)   8F2D 20 41 54 20 		 DEFM "-->ERROR AT LOADFILE"	;
572)   8F31 4C 4F 41 44 		 DEFM "-->ERROR AT LOADFILE"	;
572)   8F35 46 49 4C 45 		 DEFM "-->ERROR AT LOADFILE"	;
573)   8F39 0A 0D 00    		 DB 10,13,0	;
574)   8F3C 21 8B 00    		 LD HL,STRGBUFF	;
575)   8F3F CD 3B 8B    		 CALL RS_TXT	;
576)   8F42 CD 9B 8B    		 CALL RS_NEWLINE	;
577)   8F45 37          		 SCF	;
578)   8F46 C9          		 RET	;
586)   8F47 D5          		STRG_READBUFR: PUSH DE	;
587)   8F48 C5          		 PUSH BC	;
593)   8F49 CD 1E 9D    		 CALL COPYFNAME	;
594)   8F4C AF          		 XOR A   ;READ ONLY 	;READ ONLY
595)   8F4D CD 13 8E    		 CALL STRG_OPNFILE  	;
596)   8F50 20 32       		 JR NZ, RB_FOPENERR	;
601)   8F52 C1          		 POP BC  ;BYTE OFFSET	;BYTE OFFSET
602)   8F53 CD 05 8D    		 CALL STRG_SETPOS16	;
603)   8F56 01 F4 01    		 LD BC, 500 ;READ 500 BYTES  	;READ 500 BYTES
604)   8F59 D1          		 POP DE  ;DEST BUFFER	;DEST BUFFER
605)   8F5A CD 66 8E    		 CALL STRG_BLKREAD	;
606)   8F5D 28 1E       		 JR Z, RB_FREADOK	;
607)   8F5F CD E9 9C    		 CALL PRINTNUM	;
608)   8F62 CD 26 80    		 CALL OS_PRINTMSG	;
609)   8F65 20 45 52 52 		 DEFM " ERROR READING FILE"	;
609)   8F69 4F 52 20 52 		 DEFM " ERROR READING FILE"	;
609)   8F6D 45 41 44 49 		 DEFM " ERROR READING FILE"	;
609)   8F71 4E 47 20 46 		 DEFM " ERROR READING FILE"	;
609)   8F75 49 4C 45    		 DEFM " ERROR READING FILE"	;
610)   8F78 0A 0D 00    		 DB 10,13,0	;
611)   8F7B 18 09       		 JR RB_FOPENERR2	;
612)   8F7D C5          		RB_FREADOK: PUSH BC	;
620)   8F7E CD 58 8E    		 CALL STRG_CLSFILE	;
621)   8F81 C1          		 POP BC   ;BYTES LOADED TO BUFFER	;BYTES LOADED TO BUFFER
622)   8F82 AF          		 XOR A	;
623)   8F83 C9          		 RET	;
624)   8F84 C1          		RB_FOPENERR: POP BC	;
625)   8F85 D1          		 POP DE	;
626)   8F86 CD E9 9C    		RB_FOPENERR2: CALL PRINTNUM	;
627)   8F89 CD 26 80    		 CALL OS_PRINTMSG	;
628)   8F8C 2D 2D 3E 45 		 DEFM "-->ERROR OPENING FILE"	;
628)   8F90 52 52 4F 52 		 DEFM "-->ERROR OPENING FILE"	;
628)   8F94 20 4F 50 45 		 DEFM "-->ERROR OPENING FILE"	;
628)   8F98 4E 49 4E 47 		 DEFM "-->ERROR OPENING FILE"	;
628)   8F9C 20 46 49 4C 		 DEFM "-->ERROR OPENING FILE"	;
628)   8FA0 45          		 DEFM "-->ERROR OPENING FILE"	;
629)   8FA1 0A 0D 00    		 DB 10,13,0	;
630)   8FA4 21 8B 00    		 LD HL,STRGBUFF	;
631)   8FA7 CD 3B 8B    		 CALL RS_TXT	;
632)   8FAA CD 9B 8B    		 CALL RS_NEWLINE	;
633)   8FAD 37          		 SCF	;
634)   8FAE C9          		 RET	;
639)   8FAF D5          		STRG_BLKWRITE: PUSH DE	;
640)   8FB0 3E 3C       		 LD A, CMD_BYTE_WRITE	;
641)   8FB2 CD 93 91    		     CALL CH376_COMMD	;
642)   8FB5 79          		     LD A, C                           ; BYTES REQUEST ON BC	; BYTES REQUEST ON BC
643)   8FB6 CD 97 91    		     CALL CH376_DATAWR	;
644)   8FB9 78          		     LD A, B	;
645)   8FBA CD 97 91    		     CALL CH376_DATAWR    	;
649)   8FBD E1          		 POP HL	;
650)   8FBE CD 24 91    		STBW_DOREST: CALL CH376_WTCMDEND 	;
651)   8FC1 28 1B       		 JR Z, WFR_DONE   ;Z=NO MORE OR CANNOT READ	;Z=NO MORE OR CANNOT READ
652)   8FC3 FE 1E       		 CP USB_INT_DISK_WRITE                    	;
653)   8FC5 20 19       		     JR NZ, WFR_ERROR	;
654)   8FC7 3E 2D       		 LD A,CMD_WR_REQ_DATA	;
655)   8FC9 CD 93 91    		 CALL CH376_COMMD 	;
657)   8FCC CD A6 91    		 CALL CH376_DATARD ;READ BYTE COUNT UP TO 255 BYTES	;READ BYTE COUNT UP TO 255 BYTES
658)   8FCF 47          		 LD B,A   	;
660)   8FD0 7E          		STBW_NXT1: LD A,(HL)	;
661)   8FD1 CD 97 91    		 CALL CH376_DATAWR	;
662)   8FD4 23          		 INC HL	;
663)   8FD5 10 F9       		 DJNZ STBW_NXT1	;
664)   8FD7 3E 3D       		 LD A, CMD_BYTE_WR_GO 	;
665)   8FD9 CD 93 91    		 CALL CH376_COMMD 	;
666)   8FDC 18 E0       		 JR STBW_DOREST	;
672)   8FDE B7          		 OR A	;
673)   8FDF C9          		 RET	;
674)   8FE0 F5          		WFR_ERROR: PUSH AF	;
675)   8FE1 CD E9 9C    		 CALL PRINTNUM	;
676)   8FE4 CD 26 80    		 CALL OS_PRINTMSG	;
677)   8FE7 45 52 52 4F 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   8FEB 52 20 57 52 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   8FEF 49 54 49 4E 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   8FF3 47 20 42 4C 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   8FF7 4F 43 4B 21 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   8FFB 21 21 20    		 DEFM "ERROR WRITING BLOCK!!! "	;
678)   8FFE 0D 0A 00    		 DB 13,10,0 	;
679)   9001 F1          		 POP AF	;
680)   9002 06 02       		 LD B,2	;
681)   9004 05          		 DEC B	;
682)   9005 C9          		 RET  	;
690)   9006 D5          		STRG_SAVEFILE: PUSH DE	;
691)   9007 C5          		 PUSH BC	;
692)   9008 E5          		 PUSH HL  	;
693)   9009 CD 26 80    		 CALL OS_PRINTMSG	;
694)   900C 0A 0D       		 DB 10,13	;
695)   900E 53 41 56 45 		 DEFM "SAVE FILE"	;
695)   9012 20 46 49 4C 		 DEFM "SAVE FILE"	;
695)   9016 45          		 DEFM "SAVE FILE"	;
696)   9017 0A 0D 0A 0D 		 DB 10,13,10,13,0	;
696)   901B 00          		 DB 10,13,10,13,0	;
697)   901C E1          		 POP HL	;
698)   901D CD 1E 9D    		 CALL COPYFNAME	;
699)   9020 3E 04       		 LD A,4   ;CREATE THE FILE	;CREATE THE FILE
700)   9022 CD 13 8E    		 CALL STRG_OPNFILE  	;
701)   9025 20 4E       		 JR NZ, FSAVEERR	;
702)   9027 CD 26 80    		 CALL OS_PRINTMSG	;
703)   902A 0A 0D       		 DB 10,13	;
704)   902C 46 49 4C 45 		 DEFM "FILE CREATED OK"	;
704)   9030 20 43 52 45 		 DEFM "FILE CREATED OK"	;
704)   9034 41 54 45 44 		 DEFM "FILE CREATED OK"	;
704)   9038 20 4F 4B    		 DEFM "FILE CREATED OK"	;
705)   903B 0A 0D 00    		 DB 10,13,0	;
706)   903E C1          		 POP BC  ;BYTECOUNT	;BYTECOUNT
707)   903F D1          		 POP DE  ;SOURCE BUFFER	;SOURCE BUFFER
708)   9040 CD AF 8F    		 CALL STRG_BLKWRITE	;
709)   9043 28 19       		 JR Z, FWRITEOK	;
711)   9045 CD 26 80    		 CALL OS_PRINTMSG	;
712)   9048 20 45 52 52 		 DEFM " ERROR WRITING FILE"	;
712)   904C 4F 52 20 57 		 DEFM " ERROR WRITING FILE"	;
712)   9050 52 49 54 49 		 DEFM " ERROR WRITING FILE"	;
712)   9054 4E 47 20 46 		 DEFM " ERROR WRITING FILE"	;
712)   9058 49 4C 45    		 DEFM " ERROR WRITING FILE"	;
713)   905B 0A 0D 00    		 DB 10,13,0	;
714)   905E CD 26 80    		FWRITEOK: CALL OS_PRINTMSG	;
715)   9061 42 59 54 45 		 DEFM "BYTE WRITTEN"	;
715)   9065 20 57 52 49 		 DEFM "BYTE WRITTEN"	;
715)   9069 54 54 45 4E 		 DEFM "BYTE WRITTEN"	;
716)   906D 0A 0D 00    		 DB 10,13,0	;
717)   9070 CD 58 8E    		 CALL STRG_CLSFILE	;
718)   9073 AF          		 XOR A	;
719)   9074 C9          		 RET	;
720)   9075 C1          		FSAVEERR: POP BC	;
721)   9076 D1          		 POP DE	;
722)   9077 CD E9 9C    		 CALL PRINTNUM	;
723)   907A CD 26 80    		 CALL OS_PRINTMSG	;
724)   907D 2D 2D 3E 45 		 DEFM "-->ERROR CREATING FILE"	;
724)   9081 52 52 4F 52 		 DEFM "-->ERROR CREATING FILE"	;
724)   9085 20 43 52 45 		 DEFM "-->ERROR CREATING FILE"	;
724)   9089 41 54 49 4E 		 DEFM "-->ERROR CREATING FILE"	;
724)   908D 47 20 46 49 		 DEFM "-->ERROR CREATING FILE"	;
724)   9091 4C 45       		 DEFM "-->ERROR CREATING FILE"	;
725)   9093 0A 0D 00    		 DB 10,13,0	;
726)   9096 21 8B 00    		 LD HL,STRGBUFF	;
727)   9099 CD 3B 8B    		 CALL RS_TXT	;
728)   909C CD 9B 8B    		 CALL RS_NEWLINE	;
729)   909F 37          		 SCF	;
730)   90A0 C9          		 RET	;
740)   90A1 C5          		STRG_WRITEBUFR: PUSH BC	;
741)   90A2 D5          		 PUSH DE	;
742)   90A3 CD 1E 9D    		 CALL COPYFNAME   ;HL NOT NEEDED AFTER THIS	;HL NOT NEEDED AFTER THIS
743)   90A6 3E 01       		 LD A,1    ;OPEN THE FILE FOR W	;OPEN THE FILE FOR W
744)   90A8 CD 13 8E    		 CALL STRG_OPNFILE  	;
745)   90AB 20 0B       		 JR NZ,SWB_CREATE  ;ON ERROR TRY TO CREATE THE FILE	;ON ERROR TRY TO CREATE THE FILE
747)   90AD 01 FF FF    		 LD BC,$FFFF	;
748)   90B0 11 FF FF    		 LD DE,$FFFF 	;
749)   90B3 CD 0E 8D    		 CALL STRG_SETPOS  ;GOTO EOF	;GOTO EOF
750)   90B6 18 09       		 JR SWB_WRITEBUF	;
752)   90B8 3E 04       		 LD A,4	;
753)   90BA CD 13 8E    		 CALL STRG_OPNFILE  	;
754)   90BD 3E 97       		 LD A,151   ;ERROR NUMBER	;ERROR NUMBER
755)   90BF 20 0D       		 JR NZ, SWB_ERR	;
756)   90C1 D1          		SWB_WRITEBUF: POP DE	;
757)   90C2 C1          		 POP BC    ;THE BYTE COUNT  	;THE BYTE COUNT
758)   90C3 CD AF 8F    		 CALL STRG_BLKWRITE  	;
759)   90C6 F5          		 PUSH AF	;
760)   90C7 CD 58 8E    		 CALL STRG_CLSFILE  ;ALWAYS CLOSE FILE	;ALWAYS CLOSE FILE
761)   90CA F1          		 POP AF	;
762)   90CB C0          		 RET NZ    ;NZ IF ERROR	;NZ IF ERROR
763)   90CC AF          		 XOR A	;
764)   90CD C9          		 RET	;
765)   90CE D1          		SWB_ERR: POP DE	;
766)   90CF C1          		 POP BC  	;
767)   90D0 37          		 SCF	;
768)   90D1 C9          		 RET  	;
  3)   90D2 	            		INT376CMD EQU DEV376+1	;
  4)   90D2 	            		INT376DAT EQU DEV376	;
 90)   90D2 CD A6 91    		CH376_GETDATA: CALL CH376_DATARD	;
 91)   90D5 FE 00       		 CP 0	;
 92)   90D7 C8          		 RET Z   ;NO DATA AVAILABLE	;NO DATA AVAILABLE
 99)   90D8 F5          		               PUSH AF	;
100)   90D9 11 8B 00    		 LD DE,USBBUF	;
101)   90DC 47          		 LD B,A	;
102)   90DD CD A6 91    		UDC_NXT1: CALL CH376_DATARD	;
104)   90E0 12          		 LD (DE),A	;
105)   90E1 13          		 INC DE	;
109)   90E2 10 F9       		 DJNZ UDC_NXT1 	;
110)   90E4 F1          		               POP AF	;
111)   90E5 C9          		 RET	;
114)   90E6 F5          		DISKERROR: PUSH AF	;
115)   90E7 CD 45 8B    		 CALL RS_MESG	;
116)   90EA 46 41 54 41 		 DEFM "FATAL ERROR:" 	;
116)   90EE 4C 20 45 52 		 DEFM "FATAL ERROR:" 	;
116)   90F2 52 4F 52 3A 		 DEFM "FATAL ERROR:" 	;
117)   90F6 00          		 DB 0  	;
118)   90F7 F1          		 POP AF	;
119)   90F8 CD E9 9C    		 CALL PRINTNUM	;
120)   90FB 21 07 91    		 LD HL,ERR_PART	;
121)   90FE FE 92       		 CP ERR_TYPE_ERROR	;
122)   9100 28 01       		 JR Z,PRNMES	;
123)   9102 C9          		 RET	;
124)   9103 CD 3B 8B    		PRNMES: CALL RS_TXT 	;
125)   9106 C9          		 RET	;
127)   9107 50 41 52 54 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   910B 49 54 49 4F 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   910F 4E 2E 4E 4F 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   9113 54 2E 53 55 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   9117 50 50 4F 52 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   911B 54 45 44 21 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   911F 21 21       		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
128)   9121 0A 0D 00    		 DB 10,13,0	;
138)   9124 E5          		CH376_WTCMDEND: PUSH HL	;
139)   9125 CD 32 91    		 CALL CH376_WAITINT	;
140)   9128 E1          		 POP HL	;
141)   9129 C0          		               RET NZ	;
142)   912A D8          		 RET C	;
143)   912B AF          		 XOR A	;
144)   912C CD 51 91    		 CALL CH376_GETSTAT	;
145)   912F FE 14       		 CP USB_INT_SUCCESS  	;
146)   9131 C9          		 RET  ;NZ FLAG MEANS ERROR USUALLY	;NZ FLAG MEANS ERROR USUALLY
152)   9132 AF          		CH376_WAITINT: XOR A	;
153)   9133 01 32 00    		 LD BC,50	;
154)   9136 CD A3 91    		C3AGN2: CALL CH376_INSTAT	;
155)   9139 CB 7F       		 BIT 7,A	;
156)   913B C8          		 RET Z	;
157)   913C F5          		 PUSH AF	;
158)   913D C5          		 PUSH BC	;
159)   913E 06 14       		 LD B,20	;
160)   9140 CD 84 9A    		 CALL DELAYMICRO	;
161)   9143 C1          		 POP BC	;
162)   9144 F1          		 POP AF	;
163)   9145 0B          		 DEC BC	;
164)   9146 5F          		 LD E,A	;
165)   9147 78          		 LD A,B	;
166)   9148 B1          		 OR C	;
167)   9149 7B          		 LD A,E	;
168)   914A 20 EA       		 JR NZ, C3AGN2  	;
173)   914C 37          		 SCF ;TIMEOUT       	;TIMEOUT
174)   914D 06 02       		 LD B,2	;
175)   914F 05          		 DEC B  ;NZ FLAG	;NZ FLAG
176)   9150 C9          		 RET	;
178)   9151 3E 22       		CH376_GETSTAT: LD A,CMD_GET_STATUS	;
179)   9153 CD 93 91    		 CALL CH376_COMMD	;
180)   9156 CD A6 91    		 CALL CH376_DATARD	;
181)   9159 C9          		 RET	;
189)   915A 01 C4 09    		CH376_CHOK: LD BC,2500	;
190)   915D CD A3 91    		C3AGN: CALL CH376_INSTAT	;
191)   9160 CB 67       		 BIT 4,A   ;CHECK BUSY	;CHECK BUSY
192)   9162 C8          		 RET Z   	;
193)   9163 C5          		 PUSH BC	;
194)   9164 F5          		 PUSH AF	;
195)   9165 06 32       		 LD B,50	;
196)   9167 CD 84 9A    		 CALL DELAYMICRO	;
197)   916A F1          		 POP AF	;
198)   916B C1          		 POP BC	;
199)   916C 0B          		 DEC BC	;
200)   916D 5F          		 LD E,A	;
201)   916E 78          		 LD A,B	;
202)   916F B1          		 OR C	;
203)   9170 7B          		 LD A,E	;
204)   9171 20 EA       		 JR NZ,C3AGN	;
205)   9173 F5          		 PUSH AF  	;
206)   9174 CD E9 9C    		 CALL PRINTNUM  	;
207)   9177 F1          		 POP AF	;
208)   9178 CD 45 8B    		 CALL RS_MESG	;
209)   917B 2A 2A 2A 43 		 DEFM "***CMD TIMEOUT***"	;
209)   917F 4D 44 20 54 		 DEFM "***CMD TIMEOUT***"	;
209)   9183 49 4D 45 4F 		 DEFM "***CMD TIMEOUT***"	;
209)   9187 55 54 2A 2A 		 DEFM "***CMD TIMEOUT***"	;
209)   918B 2A          		 DEFM "***CMD TIMEOUT***"	;
210)   918C 0A 0D 00    		 DB 10,13,0       	;
211)   918F 06 02       		 LD B,2	;
212)   9191 05          		 DEC B  ;NZ FLAG	;NZ FLAG
213)   9192 C9          		 RET	;
219)   9193 D3 31       		CH376_COMMD: OUT (INT376CMD),A	;
220)   9195 18 02       		 JR C3D_CONT	;
223)   9197 D3 30       		CH376_DATAWR: OUT (INT376DAT),A 	;
224)   9199 C5          		C3D_CONT: PUSH BC	;
225)   919A D5          		 PUSH DE	;
226)   919B E5          		 PUSH HL	;
227)   919C CD 5A 91    		 CALL CH376_CHOK  ;CHECK NOT BUSY	;CHECK NOT BUSY
228)   919F E1          		 POP HL	;
229)   91A0 D1          		 POP DE	;
230)   91A1 C1          		 POP BC	;
231)   91A2 C9          		 RET	;
233)   91A3 DB 31       		CH376_INSTAT: IN A,(INT376CMD)	;
235)   91A5 C9          		 RET	;
238)   91A6 DB 30       		CH376_DATARD: IN A,(INT376DAT)	;
243)   91A8 C9          		 RET	;
246)   91A9 3E 01       		CH376_VERSION: LD A,CMD_GET_IC_VER 	;
247)   91AB CD 93 91    		 CALL CH376_COMMD	;
248)   91AE CD A6 91    		 CALL CH376_DATARD	;
249)   91B1 E6 0F       		 AND 00001111B	;
250)   91B3 C9          		               RET	;
252)   91B4 3E 05       		CH376_INIT:    LD A,CMD_RESET_ALL	;
253)   91B6 CD 93 91    		 CALL CH376_COMMD  	;
254)   91B9 3E 06       		 LD A,CMD_CHECK_EXIST 	;
255)   91BB CD 93 91    		 CALL CH376_COMMD	;
256)   91BE 3E 57       		 LD A,87	;
257)   91C0 CD 97 91    		 CALL CH376_DATAWR	;
258)   91C3 CD A6 91    		 CALL CH376_DATARD	;
259)   91C6 FE A8       		 CP 255 - 87 	;
260)   91C8 C9          		               RET               	;
264)   91C9 F5          		CH376_SETUSB: PUSH AF	;
265)   91CA 3E 15       		               LD A,CMD_SETUSB_MODE	;
266)   91CC CD 93 91    		 CALL CH376_COMMD	;
267)   91CF F1          		               POP AF	;
268)   91D0 CD 97 91    		 CALL CH376_DATAWR	;
270)   91D3 06 14       		 LD B,20	;
271)   91D5 CD 84 9A    		 CALL DELAYMICRO     ;WAIT A BIT	;WAIT A BIT
276)   91D8 CD 51 91    		 CALL CH376_GETSTAT	;
277)   91DB FE 15       		 CP USB_INT_CONNECT	;
278)   91DD C8          		 RET Z	;
280)   91DE F5          		 PUSH AF	;
281)   91DF CD 45 8B    		 CALL CH376_ERROR	;
282)   91E2 45 52 52 3A 		 DEFM "ERR: SETUSBMODE"	;
282)   91E6 20 53 45 54 		 DEFM "ERR: SETUSBMODE"	;
282)   91EA 55 53 42 4D 		 DEFM "ERR: SETUSBMODE"	;
282)   91EE 4F 44 45    		 DEFM "ERR: SETUSBMODE"	;
283)   91F1 0A 0D 00    		 DB 10,13,0	;
284)   91F4 F1          		 POP AF	;
285)   91F5 CD E9 9C    		 CALL PRINTNUM	;
286)   91F8 C9          		               RET	;
291)   91F9 3E 30       		CH376_CONNECT: LD A, CMD_DISK_CONNECT	;
292)   91FB CD 93 91    		     CALL CH376_COMMD	;
293)   91FE CD 24 91    		 CALL CH376_WTCMDEND	;
295)   9201 D8          		 RET C ;TIMEOUT	;TIMEOUT
296)   9202 C8          		 RET Z ;CONNECT OK	;CONNECT OK
301)   9203 C9          		 RET ;NZ HERE	;NZ HERE
311)   9204 3E 31       		CH376_MOUNT:   LD A,CMD_DISK_MOUNT  	;
312)   9206 CD 93 91    		 CALL CH376_COMMD	;
313)   9209 CD 24 91    		 CALL CH376_WTCMDEND  	;
314)   920C C9          		 RET	;
319)   920D 06 0A       		CH376_MOUNTDEV:   LD B,10  ;TRY TO MOUNT 10 TIMES	;TRY TO MOUNT 10 TIMES
320)   920F C5          		CM_AGN1: PUSH BC	;
321)   9210 CD C9 91    		 CALL CH376_SETUSB	;
322)   9213 20 10       		 JR NZ,CM_ERROR	;
323)   9215 CD F9 91    		 CALL CH376_CONNECT	;
324)   9218 20 0B       		 JR NZ,CM_ERROR	;
325)   921A 3E 31       		        LD A,CMD_DISK_MOUNT  	;
326)   921C CD 93 91    		 CALL CH376_COMMD	;
327)   921F CD 24 91    		 CALL CH376_WTCMDEND	;
328)   9222 C1          		 POP BC	;
329)   9223 C8          		 RET Z	;
330)   9224 C5          		 PUSH BC	;
331)   9225 06 64       		CM_ERROR: LD B,100	;
332)   9227 CD 99 9A    		 CALL DELAYMILI     ;WAIT A BIT	;WAIT A BIT
333)   922A C1          		 POP BC	;
334)   922B 10 E2       		 DJNZ CM_AGN1  	;
335)   922D 06 02       		 LD B,2	;
336)   922F 05          		 DEC B  ;NZ  	;NZ
337)   9230 F5          		 PUSH AF	;
338)   9231 CD 45 8B    		 CALL CH376_ERROR	;
339)   9234 45 52 52 3A 		 DEFM "ERR: MOUNT DISK"	;
339)   9238 20 4D 4F 55 		 DEFM "ERR: MOUNT DISK"	;
339)   923C 4E 54 20 44 		 DEFM "ERR: MOUNT DISK"	;
339)   9240 49 53 4B    		 DEFM "ERR: MOUNT DISK"	;
340)   9243 0A 0D 00    		 DB 10,13,0	;
341)   9246 F1          		     POP AF	;
342)   9247 C9          		               RET	;
345)   9248 7E          		CH376_WRSTRING: LD A,(HL)	;
351)   9249 CD 97 91    		 CALL CH376_DATAWR	;
352)   924C C0          		 RET NZ	;
353)   924D 7E          		 LD A,(HL)	;
354)   924E B7          		 OR A	;
355)   924F C8          		 RET Z	;
356)   9250 23          		 INC HL	;
357)   9251 18 F5       		 JR CH376_WRSTRING	;
  7)   9253 	            		 DI2C_STA EQU DEVI2C+0      ;00 A0=LOW A1=LOW READONLY  DEF $F8	;00 A0=LOW A1=LOW READONLY  DEF $F8
  8)   9253 	            		 DI2C_INDPTR EQU DEVI2C+0     ;00 A0=LOW A1=LOW WRITEONLY DEF $00	;00 A0=LOW A1=LOW WRITEONLY DEF $00
  9)   9253 	            		 DI2C_DAT EQU DEVI2C+1      ;01 A0=HIGH A1=LOW R/W   DEF $00	;01 A0=HIGH A1=LOW R/W   DEF $00
 10)   9253 	            		 DI2C_CON EQU DEVI2C+3      ;11 A0=HIGH A1=HIGH R/W  DEF $00	;11 A0=HIGH A1=HIGH R/W  DEF $00
 11)   9253 	            		 DI2C_INDIR EQU DEVI2C+2     ;10 A0=LOW A1=HIGH R/W  DEF $00	;10 A0=LOW A1=HIGH R/W  DEF $00
 56)   9253 C5          		I2C_RDSTAT_WT: PUSH BC	;
 57)   9254 01 00 20    		 LD BC, $2000	;
 58)   9257 DB 73       		I2CRWT_AGN: IN A, (DI2C_CON)      ;READ CONTROL REGISTER BIT 3 IS SI	;READ CONTROL REGISTER BIT 3 IS SI
 59)   9259 CB 5F       		 BIT 3, A        ;CHECK BIT 3 SI	;CHECK BIT 3 SI
 60)   925B 20 05       		 JR NZ, I2CRWT_OK       ;BIT 3 SHOULD BE SET IF VALID STATUS	;BIT 3 SHOULD BE SET IF VALID STATUS
 61)   925D 0B          		 DEC BC	;
 62)   925E 78          		 LD A, B	;
 63)   925F B1          		 OR C	;
 64)   9260 20 F5       		 JR NZ, I2CRWT_AGN	;
 65)   9262 C1          		I2CRWT_OK: POP BC	;
 66)   9263 DB 70       		 IN A, (DI2C_STA)       ;VALID HERE	;VALID HERE
 67)   9265 C9          		 RET	;
 69)   9266 DB 73       		I2C_RDSTAT_NW: IN A, (DI2C_CON)      ;READ CONTROL REGISTER BIT 3 IS SI	;READ CONTROL REGISTER BIT 3 IS SI
 70)   9268 CB 5F       		 BIT 3, A        ;CHECK BIT 3 SI	;CHECK BIT 3 SI
 71)   926A 3E FF       		 LD A, $FF        ;$FF=INVALID STATUS	;$FF=INVALID STATUS
 72)   926C C8          		 RET Z         ;BIT 3 SHOULD BE SET IF VALID STATUS	;BIT 3 SHOULD BE SET IF VALID STATUS
 73)   926D DB 70       		 IN A, (DI2C_STA)       ;VALID HERE	;VALID HERE
 74)   926F C9          		 RET	;
 77)   9270 3E 01       		I2C_INIT: LD A, I2CADR	;
 78)   9272 D3 70       		 OUT (DI2C_INDPTR), A	;
 79)   9274 3E E0       		 LD A, $E0	;
 80)   9276 D3 72       		 OUT (DI2C_INDIR), A       ;SET MY SLAVE ADDR	;SET MY SLAVE ADDR
 82)   9278 3E 40       		 LD A, $40        ;INIT	;INIT
 83)   927A D3 73       		 OUT (DI2C_CON), A      ;	;
 84)   927C 06 FA       		 LD B, 250	;
 85)   927E CD 84 9A    		 CALL DELAYMICRO	;
 86)   9281 06 FA       		 LD B, 250	;
 87)   9283 CD 84 9A    		 CALL DELAYMICRO       ;DELAY 500 MICROSECS	;DELAY 500 MICROSECS
 92)   9286 3E 06       		 LD A, I2CMODE	;
 93)   9288 D3 70       		 OUT (DI2C_INDPTR), A      ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
 94)   928A 3E 00       		 LD A, 0        ;SELECT MODE 0	;SELECT MODE 0
 95)   928C D3 72       		 OUT (DI2C_INDIR), A	;
 96)   928E 3E 02       		 LD A, I2CSCLL	;
 97)   9290 D3 70       		 OUT (DI2C_INDPTR), A      ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
 98)   9292 3E 9D       		 LD A, $9D        ;SELECT CLK L	;SELECT CLK L
 99)   9294 D3 72       		 OUT (DI2C_INDIR), A	;
100)   9296 3E 03       		 LD A, I2CSCLH	;
101)   9298 D3 70       		 OUT (DI2C_INDPTR), A      ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
102)   929A 3E 86       		 LD A, $86        ;SELECT CLK H	;SELECT CLK H
103)   929C D3 72       		 OUT (DI2C_INDIR), A	;
105)   929E C9          		 RET	;
112)   929F 3E 60       		I2C_WR_BYTE: LD A, $60       ;START	;START
113)   92A1 D3 73       		 OUT (DI2C_CON), A	;
114)   92A3 CD 53 92    		WRB_LP1: CALL I2C_RDSTAT_WT      ;WAIT FOR INTERRUPT SI=1	;WAIT FOR INTERRUPT SI=1
115)   92A6 5F          		 LD E, A        ;SAVE STATUS	;SAVE STATUS
116)   92A7 FE 08       		 CP MASTER_START_TXed      ;A HAS THE STATUS	;A HAS THE STATUS
117)   92A9 28 21       		 JR Z, WRB_S1	;
118)   92AB FE 10       		 CP MASTER_RESTART_TXed	;
119)   92AD 28 1D       		 JR Z, WRB_S1	;
120)   92AF FE 28       		 CP MASTER_DATA_W_ACK	;
121)   92B1 28 26       		 JR Z, WRB_S2	;
122)   92B3 FE 18       		 CP MASTER_SLA_W_ACK	;
123)   92B5 28 23       		 JR Z, WRB_S3	;
124)   92B7 FE 20       		 CP MASTER_SLA_W_NAK	;
125)   92B9 28 2D       		 JR Z, WRB_EXIT	;
126)   92BB FE 30       		 CP MASTER_DATA_W_NAK	;
127)   92BD 28 29       		 JR Z, WRB_EXIT	;
128)   92BF FE 38       		 CP MASTER_ARB_LOST	;
129)   92C1 C8          		 RET Z	;
130)   92C2 FE B0       		 CP SLAVE_AL_ADDRESSED_R	;
131)   92C4 C8          		 RET Z	;
132)   92C5 FE 68       		 CP SLAVE_AL_ADDRESSED_W	;
133)   92C7 C8          		 RET Z	;
134)   92C8 FE D8       		 CP SLAVE_GENERALCALL_AL	;
135)   92CA C8          		 RET Z	;
136)   92CB C9          		 RET	;
138)   92CC 7A          		WRB_S1: LD A, D        ;DEVICE ADDR	;DEVICE ADDR
139)   92CD CB 27       		 SLA A	;
140)   92CF E6 FE       		 AND $FE        ;ADDR+WRITE ON D0=0	;ADDR+WRITE ON D0=0
141)   92D1 D3 71       		 OUT (DI2C_DAT), A	;
142)   92D3 3E 40       		 LD A, $40	;
143)   92D5 D3 73       		 OUT (DI2C_CON), A	;
144)   92D7 18 CA       		 JR WRB_LP1	;
145)   92D9 0B          		WRB_S2: DEC BC	;
146)   92DA 78          		WRB_S3: LD A, B	;
147)   92DB B1          		 OR C	;
148)   92DC 28 0A       		 JR Z, WRB_EXIT	;
149)   92DE 7E          		 LD A, (HL)	;
150)   92DF 23          		 INC HL	;
151)   92E0 D3 71       		 OUT (DI2C_DAT), A	;
152)   92E2 3E 40       		 LD A, $40	;
153)   92E4 D3 73       		 OUT (DI2C_CON), A	;
154)   92E6 18 BB       		 JR WRB_LP1	;
156)   92E8 3E 50       		WRB_EXIT: LD A, $50       ;STOP	;STOP
157)   92EA D3 73       		 OUT (DI2C_CON), A	;
158)   92EC 78          		 LD A, B	;
159)   92ED B1          		 OR C	;
160)   92EE C9          		 RET         ;IF A NOT ZERO THEN ERROR	;IF A NOT ZERO THEN ERROR
166)   92EF 78          		I2C_RD_BYTE: LD A, B	;
167)   92F0 B1          		 OR C	;
168)   92F1 C8          		 RET Z        ;RETURN IF ZERO BYTE COUNT	;RETURN IF ZERO BYTE COUNT
169)   92F2 3E 60       		 LD A, $60	;
170)   92F4 D3 73       		 OUT (DI2C_CON), A	;
171)   92F6 CD 53 92    		RDB_LP1: CALL I2C_RDSTAT_WT      ;WAIT FOR INTERRUPT SI=1	;WAIT FOR INTERRUPT SI=1
172)   92F9 1E 00       		 LD E, 0	;
173)   92FB FE 08       		 CP MASTER_START_TXed	;
174)   92FD 28 1F       		 JR Z, RDB_S1	;
176)   92FF 28 1D       		 JR Z, RDB_S1	;
177)   9301 FE 58       		 CP MASTER_DATA_R_NAK	;
178)   9303 28 26       		 JR Z, RDB_S2	;
179)   9305 FE 50       		 CP MASTER_DATA_R_ACK	;
180)   9307 28 24       		 JR Z, RDB_S3	;
181)   9309 FE 40       		 CP MASTER_SLA_R_ACK	;
182)   930B 28 25       		 JR Z, RDB_S4	;
183)   930D FE 48       		 CP MASTER_SLA_R_NAK	;
184)   930F 28 38       		 JR Z, RDB_EXIT	;
185)   9311 FE 38       		 CP MASTER_ARB_LOST	;
186)   9313 C8          		 RET Z	;
187)   9314 FE B0       		 CP SLAVE_AL_ADDRESSED_R	;
188)   9316 C8          		 RET Z	;
189)   9317 FE 68       		 CP SLAVE_AL_ADDRESSED_W	;
190)   9319 C8          		 RET Z	;
191)   931A FE D8       		 CP SLAVE_GENERALCALL_AL	;
192)   931C C8          		 RET Z	;
193)   931D C9          		 RET	;
196)   931E 7A          		RDB_S1: LD A, D        ;DEVICE ADDR	;DEVICE ADDR
197)   931F CB 27       		 SLA A	;
198)   9321 F6 01       		 OR $01         ;ADDR + READ COMMAND	;ADDR + READ COMMAND
199)   9323 D3 71       		 OUT (DI2C_DAT), A	;
200)   9325 3E 40       		 LD A, $40	;
201)   9327 D3 73       		 OUT (DI2C_CON), A	;
202)   9329 18 CB       		 JR RDB_LP1	;
203)   932B 1E 01       		RDB_S2: LD E, 1        ;MEANS WE EXIT	;MEANS WE EXIT
204)   932D DB 71       		RDB_S3: IN A, (DI2C_DAT)       ;READ DATA	;READ DATA
205)   932F 77          		 LD (HL), A	;
206)   9330 23          		 INC HL	;
207)   9331 0B          		 DEC BC	;
208)   9332 78          		RDB_S4: LD A, B        ; IS LENGTH 0	; IS LENGTH 0
209)   9333 B1          		 OR C	;
210)   9334 28 13       		 JR Z, RDB_EXIT	;
211)   9336 7B          		 LD A, E	;
212)   9337 FE 01       		 CP 1	;
213)   9339 28 0E       		 JR Z, RDB_EXIT	;
214)   933B 78          		 LD A, B	;
215)   933C 81          		 ADD C	;
216)   933D FE 01       		 CP 1	;
217)   933F 3E 40       		 LD A, $40	;
218)   9341 28 02       		 JR Z, RDB_NXT1	;
219)   9343 3E C0       		 LD A, $C0	;
220)   9345 D3 73       		RDB_NXT1: OUT (DI2C_CON), A      ;WRITE $40 IF BYTE COUNT BC=1 ELSE WRITE $C0	;WRITE $40 IF BYTE COUNT BC=1 ELSE WRITE $C0
221)   9347 18 AD       		 JR RDB_LP1	;
223)   9349 3E 50       		RDB_EXIT: LD A, $50	;
224)   934B D3 73       		 OUT (DI2C_CON), A	;
225)   934D 78          		 LD A, B	;
226)   934E B1          		 OR C	;
227)   934F C9          		 RET         ;IF A NOT ZERO THEN ERROR	;IF A NOT ZERO THEN ERROR
112)   9350 16 00       		LCD16_WR4BITS: LD D, 0       ;PIN MAP VALUES FRO 8574 BIT 0-7	;PIN MAP VALUES FRO 8574 BIT 0-7
114)   9352 0F          		 RRCA         ;D4 = D0,D5=D1,D6=D2,D7=D3	;D4 = D0,D5=D1,D6=D2,D7=D3
115)   9353 30 02       		 JR NC, LWNXT1        ;BIT 0 NOT SET JR	;BIT 0 NOT SET JR
116)   9355 CB E2       		 SET D4, D	;
117)   9357 0F          		LWNXT1: RRCA	;
118)   9358 30 02       		 JR NC, LWNXT2        ;BIT 1 NOT SET JR	;BIT 1 NOT SET JR
119)   935A CB EA       		 SET D5, D	;
120)   935C 0F          		LWNXT2: RRCA	;
121)   935D 30 02       		 JR NC, LWNXT3        ;BIT 2 NOT SET JR	;BIT 2 NOT SET JR
122)   935F CB F2       		 SET D6, D	;
123)   9361 0F          		LWNXT3: RRCA	;
124)   9362 30 02       		 JR NC, LWNXT4        ;BIT 3 NOT SET JR	;BIT 3 NOT SET JR
125)   9364 CB FA       		 SET D7, D	;
126)   9366 7B          		LWNXT4: LD A, E	;
127)   9367 0F          		 RRCA	;
128)   9368 30 02       		 JR NC, LWNXT5	;
129)   936A CB C2       		 SET RS, D	;
131)   936C 3A 7F 00    		 LD A,(LCD_STSMASK)       ;ADD THE BACKLIGHT MASKS  	;ADD THE BACKLIGHT MASKS
132)   936F B2          		 OR D	;
133)   9370 57          		 LD D,A	;
135)   9371 CB D2       		 SET EN, D        ;EN=HIGH	;EN=HIGH
136)   9373 7A          		 LD A, D	;
137)   9374 CD 7E 93    		 CALL LCD16_I2CSEND	;
138)   9377 CB 92       		 RES EN, D        ;EN=LOW	;EN=LOW
139)   9379 7A          		 LD A, D	;
140)   937A CD 7E 93    		 CALL LCD16_I2CSEND	;
141)   937D C9          		 RET	;
145)   937E D5          		LCD16_I2CSEND: PUSH DE	;
146)   937F E5          		 PUSH HL	;
147)   9380 21 8B 00    		 LD HL, BUFFER	;
148)   9383 77          		 LD (HL), A	;
149)   9384 16 27       		 LD D, LCDADDR	;
150)   9386 01 01 00    		 LD BC, 1	;
151)   9389 CD 9F 92    		 CALL I2C_WRITE	;
152)   938C E1          		 POP HL	;
153)   938D D1          		 POP DE	;
154)   938E C9          		 RET	;
157)   938F 1E 00       		LCD16_COMMD: LD E, COMMAND	;
158)   9391 18 02       		 JR LCD16_SEND	;
161)   9393 1E 01       		LCD16_DATA: LD E, LCD_DATA 	;
164)   9395 57          		LCD16_SEND: LD D, A       ;SAVE A FOR LATER USE	;SAVE A FOR LATER USE
165)   9396 7B          		 LD A, E	;
166)   9397 0F          		 RRCA	;
167)   9398 38 07       		 JR C, ISCMDDATA	;
168)   939A 0F          		 RRCA	;
169)   939B 30 04       		 JR NC, ISCMDDATA	;
171)   939D 1E 00       		 LD E, COMMAND        ;SEND 4 BITS AS COMMAND E=0	;SEND 4 BITS AS COMMAND E=0
172)   939F 18 0E       		 JR LCSD_4BIT	;
173)   93A1 7A          		ISCMDDATA: LD A, D	;
174)   93A2 CB 3F       		 SRL A	;
175)   93A4 CB 3F       		 SRL A	;
176)   93A6 CB 3F       		 SRL A	;
177)   93A8 CB 3F       		 SRL A	;
178)   93AA D5          		 PUSH DE	;
179)   93AB CD 50 93    		 CALL LCD16_WR4BITS      ;HIGH 4 BITS FIRST	;HIGH 4 BITS FIRST
180)   93AE D1          		 POP DE	;
181)   93AF 7A          		LCSD_4BIT: LD A, D	;
182)   93B0 E6 0F       		 AND $0F	;
183)   93B2 CD 50 93    		 CALL LCD16_WR4BITS      ;LOW 4 BITS NEXT	;LOW 4 BITS NEXT
184)   93B5 C9          		 RET	;
186)   93B6 3E 03       		@LCD16_INIT: LD A, 3       ;SET LCD TO 4BIT MODE	;SET LCD TO 4BIT MODE
187)   93B8 1E 02       		 LD E, FOUR_BITS	;
188)   93BA CD 95 93    		 CALL LCD16_SEND	;
189)   93BD 01 00 30    		 LD BC, $3000	;
190)   93C0 CD 48 9B    		 CALL PAUSE_LOOP       ;DELAY 4,5ms	;DELAY 4,5ms
191)   93C3 3E 03       		 LD A, 3	;
192)   93C5 1E 02       		 LD E, FOUR_BITS	;
193)   93C7 CD 95 93    		 CALL LCD16_SEND	;
194)   93CA 01 00 30    		 LD BC, $3000	;
195)   93CD CD 48 9B    		 CALL PAUSE_LOOP       ;DELAY 4,5ms	;DELAY 4,5ms
196)   93D0 3E 03       		 LD A, 3	;
197)   93D2 1E 02       		 LD E, FOUR_BITS	;
198)   93D4 CD 95 93    		 CALL LCD16_SEND	;
199)   93D7 01 00 30    		 LD BC, $3000	;
200)   93DA CD 48 9B    		 CALL PAUSE_LOOP       ;DELAY 4,5ms	;DELAY 4,5ms
201)   93DD 3E 02       		 LD A, 2        ;PUT 4 BIT MODE	;PUT 4 BIT MODE
202)   93DF 1E 02       		 LD E, FOUR_BITS	;
203)   93E1 CD 95 93    		 CALL LCD16_SEND	;
204)   93E4 01 00 30    		 LD BC, $3000	;
205)   93E7 CD 48 9B    		 CALL PAUSE_LOOP       ;DELAY 4,5ms	;DELAY 4,5ms
207)   93EA 3E 28       		 LD A, LCD_FUNCTIONSET OR LCD_2LINE	;
208)   93EC CD 8F 93    		 CALL LCD16_COMMD	;
209)   93EF 3E 02       		 LD A, LCD_DISPLAYON OR LCD_CURSOROFF OR LCD_BLINKOFF	;
210)   93F1 32 7D 00    		 LD (LCD_DSPCTRL), A	;
211)   93F4 CD 1C 94    		 CALL LCD16_DISP	;
212)   93F7 CD 37 94    		 CALL LCD16_CLR	;
213)   93FA 3E 02       		 LD A, LCD_ENTRYLEFT OR LCD_ENTRYSHIFTDECREMENT	;
214)   93FC 32 7E 00    		 LD (LCD_DSPMODE), A	;
215)   93FF F6 04       		 OR LCD_ENTRYMODESET	;
216)   9401 CD 8F 93    		 CALL LCD16_COMMD	;
217)   9404 01 00 30    		 LD BC, $3000	;
218)   9407 CD 48 9B    		 CALL PAUSE_LOOP       ;DELAY 4,5ms	;DELAY 4,5ms
219)   940A CD BA 94    		 CALL LCD16_BKLTON      ;BACKLIGHT ON BY DEFAULT	;BACKLIGHT ON BY DEFAULT
220)   940D C9          		 RET	;
222)   940E 3A 7D 00    		@LCD16_NODISP: LD A, (LCD_DSPCTRL)	;
223)   9411 CB 97       		 RES LCD_DISPLAYON, A	;
224)   9413 32 7D 00    		 LD (LCD_DSPCTRL), A	;
225)   9416 F6 08       		 OR LCD_DISPLAYCONTROL	;
226)   9418 CD 8F 93    		 CALL LCD16_COMMD	;
227)   941B C9          		 RET	;
228)   941C 3A 7D 00    		@LCD16_DISP: LD A, (LCD_DSPCTRL)	;
229)   941F CB D7       		 SET LCD_DISPLAYON, A	;
230)   9421 32 7D 00    		 LD (LCD_DSPCTRL), A	;
231)   9424 F6 08       		 OR LCD_DISPLAYCONTROL	;
232)   9426 CD 8F 93    		 CALL LCD16_COMMD	;
233)   9429 C9          		 RET	;
235)   942A 01 D0 07    		LCDDELAY: LD BC, HOME_CLEAR_EXEC	;
236)   942D C5          		LCLR_AGN1: PUSH BC	;
237)   942E CD 84 9A    		 CALL DELAYMICRO	;
238)   9431 C1          		 POP BC	;
239)   9432 0D          		 DEC C	;
240)   9433 E2 2D 94    		 JP PO, LCLR_AGN1	;
241)   9436 C9          		 RET	;
243)   9437 3E 01       		@LCD16_CLR: LD A, LCD_CLEARDISPLAY      ;clear display, set cursor position to zero	;clear display, set cursor position to zero
244)   9439 CD 8F 93    		 CALL LCD16_COMMD	;
245)   943C CD 2A 94    		 CALL LCDDELAY	;
246)   943F C9          		 RET	;
249)   9440 7E          		@LCD16_PRINT: LD A, (HL)	;
250)   9441 FE 00       		 CP 0	;
251)   9443 C8          		 RET Z	;
252)   9444 CD 93 93    		 CALL LCD16_DATA	;
253)   9447 23          		 INC HL	;
254)   9448 18 F6       		 JR LCD16_PRINT	;
257)   944A CD 93 93    		@LCD16_PRCHR: CALL LCD16_DATA	;
258)   944D C9          		 RET	;
260)   944E 3E 02       		@LCD16_HOME: LD A, LCD_RETURNHOME	;
261)   9450 CD 8F 93    		 CALL LCD16_COMMD	;
262)   9453 CD 2A 94    		 CALL LCDDELAY	;
263)   9456 C9          		 RET	;
266)   9457 00 40 14 54 		ROWOFFSET: DB $00,$40,$14,$54	;
267)   945B 06 00       		@LCD16_SETCURS: LD B, 0	;
268)   945D 4B          		 LD C, E	;
269)   945E 21 57 94    		 LD HL, ROWOFFSET	;
270)   9461 09          		 ADD HL, BC	;
271)   9462 7E          		 LD A, (HL)	;
272)   9463 82          		 ADD D	;
273)   9464 F6 80       		 OR LCD_SETDDRAMADDR	;
274)   9466 CD 8F 93    		 CALL LCD16_COMMD	;
275)   9469 C9          		 RET	;
277)   946A 3A 7D 00    		@LCD16_CURSOFF: LD A, (LCD_DSPCTRL)	;
278)   946D CB 8F       		 RES LCD_CURSORON, A	;
279)   946F 32 7D 00    		 LD (LCD_DSPCTRL), A	;
280)   9472 F6 08       		 OR LCD_DISPLAYCONTROL	;
281)   9474 CD 8F 93    		 CALL LCD16_COMMD	;
282)   9477 C9          		 RET	;
285)   9478 3A 7D 00    		@LCD16_CURSON: LD A, (LCD_DSPCTRL)	;
286)   947B CB CF       		 SET LCD_CURSORON, A	;
287)   947D 32 7D 00    		 LD (LCD_DSPCTRL), A	;
288)   9480 F6 08       		 OR LCD_DISPLAYCONTROL	;
289)   9482 CD 8F 93    		 CALL LCD16_COMMD	;
290)   9485 C9          		 RET	;
292)   9486 3A 7D 00    		@LCD16_BLINKOFF: LD A, (LCD_DSPCTRL)	;
293)   9489 CB 87       		 RES LCD_BLINKON, A	;
294)   948B 32 7D 00    		 LD (LCD_DSPCTRL), A	;
295)   948E F6 08       		 OR LCD_DISPLAYCONTROL	;
296)   9490 CD 8F 93    		 CALL LCD16_COMMD	;
297)   9493 C9          		 RET	;
300)   9494 3A 7D 00    		@LCD16_BLINKON: LD A, (LCD_DSPCTRL)	;
301)   9497 CB C7       		 SET LCD_BLINKON, A	;
302)   9499 32 7D 00    		 LD (LCD_DSPCTRL), A	;
303)   949C F6 08       		 OR LCD_DISPLAYCONTROL	;
304)   949E CD 8F 93    		 CALL LCD16_COMMD	;
305)   94A1 C9          		 RET	;
307)   94A2 3E 18       		@LCD16_SCRLEFT: LD A, LCD_CURSORSHIFT OR LCD_DISPLAYMOVE OR LCD_MOVELEFT	;
308)   94A4 CD 8F 93    		 CALL LCD16_COMMD	;
309)   94A7 C9          		 RET	;
311)   94A8 3E 1C       		@LCD16_SCRRIGHT: LD A, LCD_CURSORSHIFT OR LCD_DISPLAYMOVE OR LCD_MOVERIGHT	;
312)   94AA CD 8F 93    		 CALL LCD16_COMMD	;
313)   94AD C9          		 RET	;
315)   94AE 3E 10       		@LCD16_MOVLEFT: LD A, LCD_CURSORSHIFT OR LCD_CURSORMOVE OR LCD_MOVELEFT	;
316)   94B0 CD 8F 93    		 CALL LCD16_COMMD	;
317)   94B3 C9          		 RET	;
319)   94B4 3E 14       		@LCD16_MOVRIGHT: LD A, LCD_CURSORSHIFT OR LCD_CURSORMOVE OR LCD_MOVERIGHT	;
320)   94B6 CD 8F 93    		 CALL LCD16_COMMD	;
321)   94B9 C9          		 RET	;
324)   94BA 3E 08       		@LCD16_BKLTON: LD A, BACKLIGHTPINMASK AND LCD_BACKLIGHT	;
325)   94BC 32 7F 00    		 LD (LCD_STSMASK),A	;
326)   94BF CD 7E 93    		 CALL LCD16_I2CSEND	;
327)   94C2 C9          		 RET	;
329)   94C3 3E 00       		@LCD16_BKLTOFF: LD A, BACKLIGHTPINMASK AND LCD_NOBACKLIGHT	;
330)   94C5 32 7F 00    		 LD (LCD_STSMASK),A	;
331)   94C8 CD 7E 93    		 CALL LCD16_I2CSEND	;
332)   94CB C9          		 RET	;
 29)   94CC 53 75 6E 64 		 SUN DEFM  "Sunday"	;
 29)   94D0 61 79       		 SUN DEFM  "Sunday"	;
 30)   94D2 00          		 DB 0	;
 31)   94D3 4D 6F 6E 64 		 MON DEFM  "Monday"	;
 31)   94D7 61 79       		 MON DEFM  "Monday"	;
 32)   94D9 00          		 DB 0	;
 33)   94DA 54 75 65 73 		 TUE DEFM  "Tuesday"	;
 33)   94DE 64 61 79    		 TUE DEFM  "Tuesday"	;
 34)   94E1 00          		 DB 0	;
 35)   94E2 57 65 64 6E 		 WED DEFM  "Wednesday"	;
 35)   94E6 65 73 64 61 		 WED DEFM  "Wednesday"	;
 35)   94EA 79          		 WED DEFM  "Wednesday"	;
 36)   94EB 00          		 DB 0	;
 37)   94EC 54 68 75 72 		 THU DEFM  "Thursday"	;
 37)   94F0 73 64 61 79 		 THU DEFM  "Thursday"	;
 38)   94F4 00          		 DB 0	;
 39)   94F5 46 72 69 64 		 FRI DEFM  "Friday"	;
 39)   94F9 61 79       		 FRI DEFM  "Friday"	;
 40)   94FB 00          		 DB 0	;
 41)   94FC 53 61 74 75 		 SAT DEFM  "Saturday"	;
 41)   9500 72 64 61 79 		 SAT DEFM  "Saturday"	;
 42)   9504 00          		 DB 0	;
 44)   9505 CC 94       		 DAYS DEFW SUN	;
 45)   9507 D3 94       		 DEFW MON	;
 46)   9509 DA 94       		 DEFW TUE	;
 47)   950B E2 94       		 DEFW WED	;
 48)   950D EC 94       		 DEFW THU	;
 49)   950F F5 94       		 DEFW FRI	;
 50)   9511 FC 94       		 DEFW SAT	;
 52)   9513 52 54 43 20 		 MESERR DEFM "RTC ER RV"	;
 52)   9517 45 52 20 52 		 MESERR DEFM "RTC ER RV"	;
 52)   951B 56          		 MESERR DEFM "RTC ER RV"	;
 53)   951C 0A 0D 00    		 DEFB 10,13,0	;
 55)   951F 52 54 43 20 		 MESERR0 DEFM "RTC ER SD"	;
 55)   9523 45 52 20 53 		 MESERR0 DEFM "RTC ER SD"	;
 55)   9527 44          		 MESERR0 DEFM "RTC ER SD"	;
 56)   9528 0A 0D 00    		 DEFB 10,13,0	;
 58)   952B 7B          		SHERR0: LD A, E	;
 59)   952C C5          		 PUSH BC	;
 60)   952D CD D9 80    		 CALL SOUTAS	;
 61)   9530 C1          		 POP BC	;
 62)   9531 79          		 LD A, C	;
 63)   9532 CD D9 80    		 CALL SOUTAS	;
 65)   9535 21 1F 95    		 LD HL, MESERR0	;
 66)   9538 CD 3B 8B    		 CALL RS_TXT	;
 67)   953B C9          		 RET	;
 70)   953C 79          		SHERR: LD A, C	;
 71)   953D CD D9 80    		 CALL SOUTAS	;
 72)   9540 21 13 95    		 LD HL, MESERR	;
 73)   9543 CD 3B 8B    		 CALL RS_TXT	;
 74)   9546 37          		 SCF	;
 75)   9547 C9          		 RET	;
 78)   9548 AF          		RST_BUF: XOR A	;
 79)   9549 06 14       		 LD B, 20	;
 80)   954B 21 8B 00    		 LD HL, BUFFER	;
 81)   954E 77          		LP1: LD (HL), A	;
 82)   954F 23          		 INC HL	;
 83)   9550 10 FC       		 DJNZ LP1	;
 84)   9552 C9          		 RET	;
 86)   9553 64 64 2F 6D 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   9557 6D 2F 79 79 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   955B 20 77 20 68 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   955F 68 3A 6D 6D 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   9563 3A 73 73    		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 89)   9566 21 53 95    		DS1307_INIT: LD HL,DATEMASK	;
 90)   9569 11 CB 00    		 LD DE,TIMMSG	;
 91)   956C 01 13 00    		 LD BC,19	;
 92)   956F ED B0       		 LDIR        	;
 93)   9571 C9          		 RET	;
 95)   9572 21 8B 00    		DS1307_GETNOW: LD HL, BUFFER	;
 96)   9575 AF          		 XOR A         ;SEND COMMAND 0	;SEND COMMAND 0
 97)   9576 77          		 LD (HL), A	;
 98)   9577 16 68       		 LD D, DS1307_ADDRESS	;
 99)   9579 01 01 00    		 LD BC, 1	;
100)   957C CD 9F 92    		 CALL I2C_WRITE	;
101)   957F C2 2B 95    		 JP NZ, SHERR0	;
103)   9582 21 8B 00    		 LD HL, BUFFER	;
104)   9585 16 68       		 LD D, DS1307_ADDRESS	;
105)   9587 01 07 00    		 LD BC, 7	;
106)   958A CD EF 92    		 CALL I2C_READ	;
107)   958D C2 3C 95    		 JP NZ, SHERR	;
108)   9590 AF          		 XOR A	;
109)   9591 C9          		 RET	;
113)   9592 11 8B 00    		DS1307_SETTIME: LD DE, BUFFER	;
114)   9595 AF          		 XOR A	;
115)   9596 12          		 LD (DE), A	;
116)   9597 13          		 INC DE	;
117)   9598 21 DC 00    		 LD HL,TIMMSG+17  ;SS	;SS
118)   959B CD C9 95    		 CALL SETTMPARAM	;
119)   959E 21 D9 00    		 LD HL,TIMMSG+14  ;MN	;MN
120)   95A1 CD C9 95    		 CALL SETTMPARAM	;
121)   95A4 21 D6 00    		 LD HL,TIMMSG+11  ;HH	;HH
122)   95A7 CD C9 95    		 CALL SETTMPARAM	;
123)   95AA 21 D4 00    		 LD HL,TIMMSG+9  ;D OF WEEK 1-7	;D OF WEEK 1-7
124)   95AD CD C9 95    		 CALL SETTMPARAM	;
125)   95B0 21 CB 00    		 LD HL,TIMMSG  ;DD	;DD
126)   95B3 CD C9 95    		 CALL SETTMPARAM	;
127)   95B6 21 CE 00    		 LD HL,TIMMSG+3  ;MM	;MM
128)   95B9 CD C9 95    		 CALL SETTMPARAM	;
129)   95BC 21 D1 00    		 LD HL,TIMMSG+6  ;YY	;YY
130)   95BF CD C9 95    		 CALL SETTMPARAM	;
131)   95C2 3E 00       		 LD A,0	;
132)   95C4 12          		 LD (DE), A	;
133)   95C5 CD 11 96    		 CALL DS1307_ADJUST	;
134)   95C8 C9          		 RET	;
136)   95C9 D5          		SETTMPARAM: PUSH DE	;
137)   95CA CD 3A 9C    		 CALL strtob	;
138)   95CD D1          		 POP DE	;
139)   95CE CD CB 9A    		 CALL BN2BCD	;
140)   95D1 7D          		 LD A,L	;
141)   95D2 12          		 LD (DE),A	;
142)   95D3 13          		 INC DE  	;
143)   95D4 C9          		 RET	;
148)   95D5 11 8B 00    		 LD DE, BUFFER	;
149)   95D8 AF          		 XOR A	;
150)   95D9 12          		 LD (DE), A	;
151)   95DA 13          		 INC DE	;
152)   95DB 3E 0A       		 LD A, 10        ; 10 SECS	; 10 SECS
153)   95DD CD CB 9A    		 CALL BN2BCD	;
154)   95E0 7D          		 LD A, L	;
155)   95E1 12          		 LD (DE), A	;
156)   95E2 13          		 INC DE	;
157)   95E3 3E 22       		 LD A, 34        ; 28 MINS	; 28 MINS
158)   95E5 CD CB 9A    		 CALL BN2BCD	;
159)   95E8 7D          		 LD A, L	;
160)   95E9 12          		 LD (DE), A	;
161)   95EA 13          		 INC DE	;
162)   95EB 3E 12       		 LD A, 18        ; 19 HOURS	; 19 HOURS
163)   95ED CD CB 9A    		 CALL BN2BCD	;
164)   95F0 7D          		 LD A, L	;
165)   95F1 12          		 LD (DE), A	;
166)   95F2 13          		 INC DE	;
167)   95F3 3E 05       		 LD A, 5        ; DAY OF WEEK	; DAY OF WEEK
168)   95F5 12          		 LD (DE), A	;
169)   95F6 13          		 INC DE	;
170)   95F7 3E 12       		 LD A, 18        ; 8 DAY	; 8 DAY
171)   95F9 CD CB 9A    		 CALL BN2BCD	;
172)   95FC 7D          		 LD A, L	;
173)   95FD 12          		 LD (DE), A	;
174)   95FE 13          		 INC DE	;
175)   95FF 3E 02       		 LD A, 02        ; 10 MONTH	; 10 MONTH
176)   9601 CD CB 9A    		 CALL BN2BCD	;
177)   9604 7D          		 LD A, L	;
178)   9605 12          		 LD (DE), A	;
179)   9606 13          		 INC DE	;
180)   9607 3E 15       		 LD A, 21        ; 21 YEAR (2020)	; 21 YEAR (2020)
181)   9609 CD CB 9A    		 CALL BN2BCD	;
182)   960C 7D          		 LD A, L	;
183)   960D 12          		 LD (DE), A	;
184)   960E 13          		 INC DE	;
185)   960F AF          		 XOR A	;
186)   9610 12          		 LD (DE), A	;
199)   9611 21 8B 00    		DS1307_ADJUST: LD HL, BUFFER	;
200)   9614 16 68       		 LD D, DS1307_ADDRESS	;
201)   9616 01 09 00    		 LD BC, 9	;
202)   9619 CD 9F 92    		 CALL I2C_WRITE	;
203)   961C C2 2B 95    		 JP NZ, SHERR0	;
204)   961F 01 FF FF    		 LD BC, FFFFh        ;8000H FOR 4MHZ	;8000H FOR 4MHZ
205)   9622 CD 48 9B    		 CALL PAUSE_LOOP       ; 0.5 second delay	; 0.5 second delay
206)   9625 01 FF FF    		 LD BC, FFFFh        ;8000H FOR 4MHZ	;8000H FOR 4MHZ
207)   9628 CD 48 9B    		 CALL PAUSE_LOOP       ; 0.5 second delay	; 0.5 second delay
208)   962B C9          		 RET	;
212)   962C 21 8B 00    		DS1307_SETSQ: LD HL, BUFFER	;
213)   962F E5          		 PUSH HL	;
214)   9630 3E 07       		 LD A, DS1307_CONTROL_REGISTER	;
215)   9632 77          		 LD (HL), A	;
216)   9633 23          		 INC HL	;
217)   9634 7A          		 LD A, D	;
218)   9635 77          		 LD (HL), A	;
219)   9636 E1          		 POP HL	;
220)   9637 16 68       		 LD D, DS1307_ADDRESS	;
221)   9639 01 02 00    		 LD BC, 2	;
222)   963C CD 9F 92    		 CALL I2C_WRITE	;
223)   963F C2 2B 95    		 JP NZ, SHERR0	;
224)   9642 C9          		 RET	;
228)   9643 CD 32 9B    		CONVHL: CALL Bcd2ASC	;
229)   9646 26 00       		 LD H, 0	;
230)   9648 C9          		 RET	;
233)   9649 06 07       		CHKERROR: LD B, 7	;
234)   964B 21 8B 00    		 LD HL, BUFFER	;
235)   964E 7E          		CEAGN: LD A, (HL)	;
236)   964F FE FF       		 CP $FF	;
237)   9651 28 05       		 JR Z, STER	;
238)   9653 23          		 INC HL	;
239)   9654 10 F8       		 DJNZ CEAGN	;
240)   9656 AF          		 XOR A	;
241)   9657 C9          		 RET	;
244)   9658 37          		 SCF	;
245)   9659 C9          		 RET	;
250)   965A CD 48 95    		DS1307_GETTIME: CALL RST_BUF	;
251)   965D CD 72 95    		 CALL DS1307_GETNOW	;
252)   9660 D8          		 RET C         ;ERROR RETURN	;ERROR RETURN
253)   9661 CD 49 96    		 CALL CHKERROR	;
254)   9664 D8          		 RET C         ;ERRREAD  ;IF ERROR DONT PRINT	;ERRREAD  ;IF ERROR DONT PRINT
255)   9665 DD 21 8B 00 		 LD IX, BUFFER	;
256)   9669 11 CB 00    		 LD DE, TIMMSG	;
257)   966C 26 00       		 LD H, 0	;
258)   966E DD 6E 04    		 LD L, (IX + 4)        ;DAY	;DAY
259)   9671 CD 43 96    		 CALL CONVHL	;
260)   9674 3E 2F       		 LD A, ' / '	;
261)   9676 12          		 LD (DE), A	;
262)   9677 13          		 INC DE	;
263)   9678 DD 6E 05    		 LD L, (IX + 5)        ;MONTH	;MONTH
264)   967B CD 43 96    		 CALL CONVHL	;
265)   967E 3E 2F       		 LD A, ' / '	;
266)   9680 12          		 LD (DE), A	;
267)   9681 13          		 INC DE	;
268)   9682 DD 6E 06    		 LD L, (IX + 6)        ;YEAR	;YEAR
269)   9685 CD 43 96    		 CALL CONVHL	;
270)   9688 3E 20       		 LD A, ' '	;
271)   968A 12          		 LD (DE), A	;
272)   968B 13          		 INC DE	;
273)   968C DD 6E 02    		 LD L, (IX + 2)        ;HOUR	;HOUR
274)   968F CD 43 96    		 CALL CONVHL	;
275)   9692 3E 3A       		 LD A, ':'	;
276)   9694 12          		 LD (DE), A	;
277)   9695 13          		 INC DE	;
278)   9696 DD 6E 01    		 LD L, (IX + 1)        ;MIN	;MIN
279)   9699 CD 43 96    		 CALL CONVHL	;
280)   969C 3E 3A       		 LD A, ':'	;
281)   969E 12          		 LD (DE), A	;
282)   969F 13          		 INC DE	;
283)   96A0 DD 6E 00    		 LD L, (IX)        ;SECS	;SECS
284)   96A3 CD 43 96    		 CALL CONVHL	;
285)   96A6 13          		 INC DE	;
286)   96A7 AF          		 XOR A	;
287)   96A8 12          		 LD (DE), A	;
288)   96A9 C9          		 RET	;
108)   96AA ED 44       		DELAYABIT: NEG  ;8 CLOCK CYCLES	;8 CLOCK CYCLES
109)   96AC ED 44       		 NEG	;
110)   96AE ED 44       		 NEG	;
111)   96B0 ED 44       		 NEG	;
112)   96B2 ED 44       		 NEG	;
113)   96B4 ED 44       		 NEG	;
114)   96B6 ED 44       		 NEG	;
115)   96B8 ED 44       		 NEG	;
116)   96BA C9          		 RET	;
123)   96BB D3 38       		SND_OUT: OUT (DEVSND),A ;SEND TO SOUND	;SEND TO SOUND
139)   96BD CD AA 96    		 CALL DELAYABIT	;
140)   96C0 C9          		 RET	;
142)   96C1 3E 9F       		SND_MUTEALL:   LD A,$9F  ;MUTE CHANNEL 0	;MUTE CHANNEL 0
143)   96C3 CD BB 96    		 CALL SND_OUT	;
144)   96C6 3E BF       		 LD A,$BF  ;MUTE CHANNEL 1	;MUTE CHANNEL 1
145)   96C8 CD BB 96    		 CALL SND_OUT	;
146)   96CB 3E DF       		 LD A,$DF  ;MUTE CHANNEL 2	;MUTE CHANNEL 2
147)   96CD CD BB 96    		 CALL SND_OUT	;
148)   96D0 3E FF       		 LD A,$FF  ;MUTE CHANNEL NOISE	;MUTE CHANNEL NOISE
149)   96D2 CD BB 96    		 CALL SND_OUT                	;
150)   96D5 C9          		               RET	;
152)   96D6 CD C1 96    		SND_INIT: CALL SND_MUTEALL	;
153)   96D9 AF          		               XOR A	;
154)   96DA 32 F4 00    		               LD (CHANST),A	;
155)   96DD AF          		SND_CLRDAT:    XOR A	;
156)   96DE 21 E0 00    		               LD HL,CHANDATA	;
157)   96E1 77          		               LD (HL),A	;
158)   96E2 54          		               LD D,H	;
159)   96E3 5D          		               LD E,L	;
160)   96E4 13          		               INC DE	;
161)   96E5 01 0B 00    		               LD BC,11  	;
162)   96E8 ED B0       		               LDIR	;
163)   96EA C9          		 RET	;
168)   96EB F5          		SND_NOTE:      PUSH AF	;
169)   96EC E6 03       		               AND $03                  ;KEEP 2 BITS	;KEEP 2 BITS
170)   96EE 07          		               RLCA	;
171)   96EF 07          		               RLCA	;
172)   96F0 07          		               RLCA	;
173)   96F1 07          		               RLCA	;
174)   96F2 07          		               RLCA                    ;TRANSFER TO BITS 6&5	;TRANSFER TO BITS 6&5
175)   96F3 B4          		               OR H                    ;A HAS THE HI BYTE TO SEND TO THE SOUND CHIP WITH CORRECT CHANNEL	;A HAS THE HI BYTE TO SEND TO THE SOUND CHIP WITH CORRECT CHANNEL
176)   96F4 CD BB 96    		               CALL SND_OUT	;
177)   96F7 7D          		SN_LOW:        LD A,L                	;
178)   96F8 CD BB 96    		               CALL SND_OUT	;
179)   96FB F1          		               POP AF	;
180)   96FC C9          		               RET	;
186)   96FD F5          		SND_DOBEEP:    PUSH AF	;
187)   96FE 3E 02       		               LD A,DEFCHN	;
188)   9700 0E 00       		               LD C,SNDVOLHI	;
189)   9702 CD 26 97    		               CALL SND_SETVOLUME                	;
190)   9705 3E 02       		               LD A,DEFCHN	;
191)   9707 CD EB 96    		               CALL SND_NOTE	;
192)   970A 06 A0       		               LD B,160	;
193)   970C CD 99 9A    		               CALL DELAYMILI	;
194)   970F 3E 02       		               LD A,DEFCHN	;
195)   9711 0E 04       		               LD C,SNDMUTE	;
196)   9713 CD 26 97    		               CALL SND_SETVOLUME	;
197)   9716 F1          		               POP AF	;
198)   9717 C9          		               RET	;
200)   9718 21 07 83    		SND_BEEP:      LD HL,nG4             ;NOTE G4 ON CHANNEL2	;NOTE G4 ON CHANNEL2
201)   971B CD FD 96    		               CALL SND_DOBEEP	;
202)   971E C9          		               RET	;
204)   971F 21 02 81    		SND_BEEP2:     LD HL,nD6             ;NOTE D6 ON CHANNEL2	;NOTE D6 ON CHANNEL2
205)   9722 CD FD 96    		               CALL SND_DOBEEP	;
206)   9725 C9          		               RET	;
213)   9726 07          		SND_SETVOLUME: RLCA                            ;DOUBLE CHANNEL 0-3 --> 0,2,4,6               	;DOUBLE CHANNEL 0-3 --> 0,2,4,6
214)   9727 3C          		               INC A                           ;E=A+1	;E=A+1
215)   9728 5F          		               LD E,A                          ;SAVE CHANNEL INFO	;SAVE CHANNEL INFO
216)   9729 79          		               LD A,C	;
217)   972A FE 04       		               CP SNDMUTE	;
218)   972C 3E 0F       		               LD A,$F	;
219)   972E 28 09       		               JR Z, SV_DOIT                   ;SNDMUTE=4 MEANS NO VOLUME = MUTE	;SNDMUTE=4 MEANS NO VOLUME = MUTE
220)   9730 3E 01       		               LD A,1                          ;VOLUME 0-3 --> 1,2,4,8 SET THE CORRESPONDING BIT 0-3	;VOLUME 0-3 --> 1,2,4,8 SET THE CORRESPONDING BIT 0-3
221)   9732 0C          		               INC C	;
222)   9733 0D          		SV_AGN:        DEC C	;
223)   9734 28 03       		               JR Z, SV_DOIT	;
224)   9736 07          		               RLCA	;
225)   9737 18 FA       		               JR SV_AGN	;
226)   9739 57          		SV_DOIT:       LD D,A                          ;D THE VOLUME , E THE CHANNEL  1&CCC&VVVV	;D THE VOLUME , E THE CHANNEL  1&CCC&VVVV
227)   973A 3E 80       		               LD A,$80	;
228)   973C CB 03       		               RLC E	;
229)   973E CB 03       		               RLC E	;
230)   9740 CB 03       		               RLC E	;
231)   9742 CB 03       		               RLC E	;
232)   9744 B2          		               OR D	;
233)   9745 B3          		               OR E	;
234)   9746 CD BB 96    		               CALL SND_OUT                    ;SET THE VOLUME        	;SET THE VOLUME
235)   9749 C9          		               RET	;
238)   974A F5          		SND_DISABLE:   PUSH AF	;
239)   974B CD 73 97    		               CALL SND_GETCHMASK	;
240)   974E 47          		               LD B,A	;
241)   974F 3A F4 00    		               LD A,(CHANST)	;
242)   9752 B0          		               OR B	;
243)   9753 32 F4 00    		               LD (CHANST),A	;
244)   9756 F1          		               POP AF	;
245)   9757 0E 04       		               LD C, SNDMUTE	;
246)   9759 CD 26 97    		               CALL SND_SETVOLUME	;
247)   975C C9          		               RET	;
250)   975D F5          		SND_ENABLE:    PUSH AF	;
251)   975E CD 73 97    		               CALL SND_GETCHMASK	;
252)   9761 ED 44       		               NEG	;
253)   9763 3D          		               DEC A	;
254)   9764 47          		               LD B,A	;
255)   9765 3A F4 00    		               LD A,(CHANST)	;
256)   9768 A0          		               AND B	;
257)   9769 32 F4 00    		               LD (CHANST),A	;
258)   976C F1          		               POP AF	;
259)   976D 0E 00       		               LD C, SNDVOLHI                  ;TODO: KEEP RECORD OF THE VOLUME IN EACH CHANNEL	;TODO: KEEP RECORD OF THE VOLUME IN EACH CHANNEL
260)   976F CD 26 97    		               CALL SND_SETVOLUME	;
261)   9772 C9          		               RET	;
266)   9773 3C          		SND_GETCHMASK: INC A	;
267)   9774 4F          		               LD C,A	;
268)   9775 AF          		               XOR A	;
269)   9776 3C          		               INC A                	;
270)   9777 0D          		GMCAGN:        DEC C	;
271)   9778 C8          		               RET Z	;
272)   9779 07          		               RLCA	;
273)   977A 18 FB       		               JR GMCAGN             	;
280)   977C F5          		SND_PLAYCH:    PUSH AF	;
281)   977D 21 E0 00    		               LD HL,CHANDATA	;
282)   9780 07          		               RLCA                            ;DOUBLE A	;DOUBLE A
283)   9781 06 00       		               LD B,0	;
284)   9783 4F          		               LD C,A	;
285)   9784 09          		               ADD HL,BC                       ;HL ON CHANNELS DATA ADDRESS VAR	;HL ON CHANNELS DATA ADDRESS VAR
286)   9785 5E          		               LD E,(HL)	;
287)   9786 23          		               INC HL	;
288)   9787 56          		               LD D,(HL)                       ;DE THE CHANNEL DATA ADDRESS	;DE THE CHANNEL DATA ADDRESS
289)   9788 7A          		               LD A,D	;
290)   9789 83          		               ADD E	;
291)   978A B7          		               OR A	;
292)   978B 28 4B       		               JR Z, PC_NOMORE                 ;IF CHANDATA ADDRESS IS ZERO RETURN	;IF CHANDATA ADDRESS IS ZERO RETURN
294)   978D F1          		               POP AF                          ;GET CHANNEL	;GET CHANNEL
295)   978E F5          		               PUSH AF	;
296)   978F CD 73 97    		               CALL SND_GETCHMASK	;
297)   9792 4F          		               LD C, A	;
298)   9793 3A F4 00    		               LD A,(CHANST)	;
299)   9796 A1          		               AND C	;
300)   9797 C1          		               POP BC	;
301)   9798 20 50       		               JR NZ,SNDOK                     ;SIGNAL OK BUT DON'T PLAY ANYTHING	;SIGNAL OK BUT DON'T PLAY ANYTHING
302)   979A C5          		               PUSH BC	;
303)   979B 48          		               LD C,B                          ;CHAN NO ON C	;CHAN NO ON C
304)   979C 06 00       		               LD B,0	;
305)   979E 21 F0 00    		               LD HL,CHANCN	;
306)   97A1 09          		               ADD HL,BC                       ;HL ON CHANNELS NOTE IDX	;HL ON CHANNELS NOTE IDX
307)   97A2 7E          		               LD A,(HL)                       ;A THE NOTE IDX 0-255 	;A THE NOTE IDX 0-255
308)   97A3 3C          		               INC A	;
309)   97A4 28 32       		               JR Z, PC_NOMORE                 ;IF 255 NO MORE NOTES TO PLAY	;IF 255 NO MORE NOTES TO PLAY
310)   97A6 3D          		               DEC A          	;
311)   97A7 34          		               INC (HL)                        ;NEXT NOTE	;NEXT NOTE
312)   97A8 6F          		               LD L,A                          ;HL THE NOTE IDX	;HL THE NOTE IDX
313)   97A9 26 00       		               LD H,0                          ;	;
314)   97AB 29          		               ADD HL,HL                       ;DOUBLE THE IDX CAUSE 2 BYTES PER NOTE	;DOUBLE THE IDX CAUSE 2 BYTES PER NOTE
315)   97AC 29          		               ADD HL,HL                       ;DOUBLE AGAIN THE IDX CAUSE 2 BYTES IS THE DURATION OF THE NOTE	;DOUBLE AGAIN THE IDX CAUSE 2 BYTES IS THE DURATION OF THE NOTE
316)   97AD 19          		               ADD HL,DE                       ;THE NOTE ADDRESS ON HL	;THE NOTE ADDRESS ON HL
317)   97AE 5E          		               LD E,(HL)                       ;E 2ND BYTE OF THE NOTE TO PLAY	;E 2ND BYTE OF THE NOTE TO PLAY
318)   97AF 23          		               INC HL	;
319)   97B0 56          		               LD D,(HL)                       ;D 1ST BYTE OF THE NOTE TO PLAY	;D 1ST BYTE OF THE NOTE TO PLAY
320)   97B1 23          		               INC HL	;
321)   97B2 4E          		               LD C,(HL)                      ;THE DURATION OF THE NOTE ON BC	;THE DURATION OF THE NOTE ON BC
322)   97B3 23          		               INC HL	;
323)   97B4 46          		               LD B,(HL)	;
324)   97B5 ED 43 A9 00 		               LD (PRGEX),BC                   ;SAVE BC                	;SAVE BC
325)   97B9 C1          		               POP BC                          ;CHANNEL ON B	;CHANNEL ON B
326)   97BA C5          		               PUSH BC                         	;
327)   97BB 21 E8 00    		               LD HL,CHANDEL                   ;SAVING DURATION ON CHANDEL + CHAN IDX         	;SAVING DURATION ON CHANDEL + CHAN IDX
328)   97BE CB 00       		               RLC B                           ;DOUBLE IDX	;DOUBLE IDX
329)   97C0 48          		               LD C,B	;
330)   97C1 06 00       		               LD B,0	;
331)   97C3 09          		               ADD HL,BC	;
332)   97C4 ED 4B A9 00 		               LD BC,(PRGEX)                      ;RESTORE BC	;RESTORE BC
333)   97C8 71          		               LD (HL),C                       ;SAVE NOTE DELAY ON CHANNEL DELAY	;SAVE NOTE DELAY ON CHANNEL DELAY
334)   97C9 23          		               INC HL	;
335)   97CA 70          		               LD (HL),B	;
336)   97CB 7A          		               LD A,D	;
337)   97CC C1          		               POP BC                          ;GET THE CHANNEL ON B	;GET THE CHANNEL ON B
338)   97CD FE 0A       		               CP 10                           ;CHECK IF 1ST BYTE IS UNDER 10  MAYBE DO SPECIAL OPS	;CHECK IF 1ST BYTE IS UNDER 10  MAYBE DO SPECIAL OPS
339)   97CF 38 0A       		               JR C,SND_SPOPS	;
340)   97D1 EB          		               EX DE,HL                        ;HL THE NOTE	;HL THE NOTE
341)   97D2 78          		               LD A,B                          ;CHANNEL ON A	;CHANNEL ON A
342)   97D3 CD EB 96    		               CALL SND_NOTE	;
343)   97D6 18 12       		               JR SNDOK                        ;NOTE PLAYED OK	;NOTE PLAYED OK
344)   97D8 C1          		PC_NOMORE:     POP BC	;
345)   97D9 18 11       		               JR SNDEND                       ;SIGNAL  SONG END	;SIGNAL  SONG END
349)   97DB FE 03       		SND_SPOPS:     CP 3	;
350)   97DD 30 07       		               JR NC,SNDOTOPS	;
351)   97DF 4F          		               LD C,A                          ;VOLUME	;VOLUME
352)   97E0 78          		               LD A,B                          ;CHANNEL	;CHANNEL
353)   97E1 CD 26 97    		               CALL SND_SETVOLUME	;
354)   97E4 18 04       		               JR SNDOK                        ;VOLUME SET OK	;VOLUME SET OK
356)   97E6 FE 09       		SNDOTOPS:      CP 9                            ;9 MEANS SONG ENDED	;9 MEANS SONG ENDED
357)   97E8 28 02       		               JR Z, SNDEND	;
359)   97EA AF          		SNDOK:         XOR A                           ;END OK                	;END OK
360)   97EB C9          		               RET	;
361)   97EC 3E 01       		SNDEND:        LD A,1                          ;SONG END	;SONG END
362)   97EE C9          		               RET	;
368)   97EF 21 E8 00    		SND_DOCHAN:    LD HL,CHANDEL	;
369)   97F2 4F          		               LD C,A	;
370)   97F3 06 00       		               LD B,0	;
371)   97F5 09          		               ADD HL,BC	;
372)   97F6 09          		               ADD HL,BC       ;DOUBLE CAUSE 2 BYTES PER DELAY VALUE	;DOUBLE CAUSE 2 BYTES PER DELAY VALUE
373)   97F7 4E          		               LD C,(HL)	;
374)   97F8 23          		               INC HL	;
375)   97F9 46          		               LD B,(HL)	;
376)   97FA 57          		               LD D,A          ;SAVE A	;SAVE A
377)   97FB 78          		               LD A,B	;
378)   97FC B1          		               OR C	;
379)   97FD 7A          		               LD A,D          ;RESTORE CHANNEL ON A	;RESTORE CHANNEL ON A
380)   97FE CA 7C 97    		               JP Z,SND_PLAYCH ;PLAY CHANNEL NOTES	;PLAY CHANNEL NOTES
381)   9801 AF          		               XOR A           ;DATA ON CHANNEL CAUSE WE DELAY 	;DATA ON CHANNEL CAUSE WE DELAY
383)   9802 C9          		               RET	;
389)   9803 21 E8 00    		SND_INTDELAY:  LD HL,CHANDEL	;
390)   9806 06 04       		               LD B,4                  	;
391)   9808 5E          		ID_NXTCH:      LD E,(HL)	;
392)   9809 23          		               INC HL	;
393)   980A 56          		               LD D,(HL)	;
394)   980B 7A          		               LD A, D	;
395)   980C B3          		               OR E	;
396)   980D 28 05       		               JR Z, ID_SKP	;
397)   980F 1B          		               DEC DE          ;MINUS NOTE DELAY VALUE	;MINUS NOTE DELAY VALUE
398)   9810 72          		               LD (HL),D	;
399)   9811 2B          		               DEC HL	;
400)   9812 73          		               LD (HL),E	;
401)   9813 23          		               INC HL	;
402)   9814 23          		ID_SKP:        INC HL	;
403)   9815 10 F1       		               DJNZ ID_NXTCH	;
404)   9817 C9          		               RET	;
408)   9818 06 04       		SND_PLAYMUSIC: LD B,4	;
409)   981A 0E 00       		               LD C,0	;
410)   981C 05          		PM_NXT:        DEC B                           ;PLAY 3,2,1,0	;PLAY 3,2,1,0
411)   981D 78          		               LD A,B	;
412)   981E C5          		               PUSH BC                	;
413)   981F CD EF 97    		               CALL SND_DOCHAN	;
414)   9822 C1          		               POP BC                	;
415)   9823 81          		               ADD A,C                         ;A=0 IF NOTE PLAYED A=1 IF CHANNEL NOT ENABLED OR NO MORE NOTES	;A=0 IF NOTE PLAYED A=1 IF CHANNEL NOT ENABLED OR NO MORE NOTES
416)   9824 4F          		               LD C,A	;
417)   9825 78          		               LD A,B	;
418)   9826 B7          		               OR A	;
419)   9827 20 F3       		               JR NZ, PM_NXT	;
420)   9829 79          		               LD A,C	;
421)   982A FE 04       		               CP 4                            ;MEANS ALL 4 CHANNELS ARE NOT ENABLED	;MEANS ALL 4 CHANNELS ARE NOT ENABLED
422)   982C C9          		               RET	;
  8)   982D FE E1       		@CHECKEXT:     CP $E1         ;BREAK KEY	;BREAK KEY
  9)   982F C8          		 RET Z        ;JUST SAVE IT  	;JUST SAVE IT
 10)   9830 FE F0       		 CP $F0         ;240 KEY RELEASED	;240 KEY RELEASED
 11)   9832 C8          		 RET Z        ;JUST SAVE IT  	;JUST SAVE IT
 12)   9833 FE E0       		 CP $E0         ;224 EXTENDED KEYS	;224 EXTENDED KEYS
 13)   9835 C8          		 RET Z        ;JUST SAVE IT	;JUST SAVE IT
 14)   9836 FE AA       		 CP $AA        ;POST TEST KB OK	;POST TEST KB OK
 15)   9838 C8          		 RET Z	;
 17)   9839 4F          		 LD C,A        ;SAVE KEY	;SAVE KEY
 18)   983A 3A 81 00    		 LD A,(LASTKEY)	;
 19)   983D FE E1       		 CP $E1	;
 20)   983F 28 23       		 JR Z, GTBRK	;
 21)   9841 FE F0       		 CP $F0	;
 22)   9843 28 59       		 JR Z, GTREL	;
 23)   9845 FE E0       		 CP $E0	;
 24)   9847 28 21       		 JR Z, GTEXT	;
 25)   9849 79          		 LD A,C	;
 27)   984A FE 12       		 CP 18         ;LEFT SHIFT	;LEFT SHIFT
 28)   984C CC CA 98    		 CALL Z, SHFTOG	;
 29)   984F FE 59       		 CP 89         ;RIGHT SHIFT	;RIGHT SHIFT
 30)   9851 CC CA 98    		 CALL Z, SHFTOG	;
 31)   9854 FE 14       		 CP 20         ;RIGHT CONTROL	;RIGHT CONTROL
 32)   9856 CC D3 98    		 CALL Z, CTRTOG	;
 33)   9859 FE 11       		 CP 17         ;LEFT ALT	;LEFT ALT
 34)   985B CC DC 98    		 CALL Z, ALTTOG	;
 35)   985E FE 58       		 CP $58         ;CAPS LOCK	;CAPS LOCK
 36)   9860 CC E5 98    		 CALL Z, CAPSTOG	;
 37)   9863 C9          		               RET	;
 39)   9864 79          		GTBRK: LD A,C       ;$14 OR $F0	;$14 OR $F0
 40)   9865 FE F0       		 CP $F0	;
 41)   9867 C8          		 RET Z  	;
 42)   9868 AF          		 XOR A        	;
 43)   9869 C9          		 RET	;
 45)   986A 79          		GTEXT: LD A,C       ; THIS IS THE EXTENDED KEY	; THIS IS THE EXTENDED KEY
 46)   986B FE 6B       		 CP $6B         ;LEFT	;LEFT
 47)   986D C8          		 RET Z	;
 48)   986E FE 72       		 CP $72        ;DOWN	;DOWN
 49)   9870 C8          		 RET Z	;
 50)   9871 FE 74       		 CP $74        ;RIGHT	;RIGHT
 51)   9873 C8          		 RET Z	;
 52)   9874 FE 75       		 CP $75        ;UP	;UP
 53)   9876 C8          		 RET Z	;
 54)   9877 FE 70       		 CP $70        ;INSERT	;INSERT
 55)   9879 C8          		 RET Z	;
 56)   987A FE 6C       		 CP $6C        ;HOME	;HOME
 57)   987C C8          		 RET Z	;
 58)   987D FE 7D       		 CP $7D        ;PG UP	;PG UP
 59)   987F C8          		 RET Z	;
 60)   9880 FE 7A       		 CP $7A        ;PG DN	;PG DN
 61)   9882 C8          		 RET Z	;
 62)   9883 FE 69       		 CP $69        ;END	;END
 63)   9885 C8          		 RET Z	;
 64)   9886 FE 71       		 CP $71        ;DEL	;DEL
 65)   9888 C8          		 RET Z	;
 66)   9889 FE 66       		 CP $66         ;BACKSPACE	;BACKSPACE
 67)   988B C8          		 RET Z	;
 68)   988C FE 5A       		 CP $5A        ;ENTER NUM	;ENTER NUM
 69)   988E C8          		 RET Z	;
 70)   988F FE 11       		 CP $11        ;RIGHT ALT	;RIGHT ALT
 71)   9891 C8          		 RET Z	;
 72)   9892 FE 14       		 CP $14        ;LEFT ALT	;LEFT ALT
 73)   9894 C8          		 RET Z	;
 74)   9895 FE 4A       		 CP $4A         ;NUMLOCK /	;NUMLOCK /
 75)   9897 C8          		 RET Z	;
 76)   9898 FE F0       		 CP $F0	;
 77)   989A 20 00       		 JR NZ, EXGTEX       ;GTREL ;EXTENDED KEY RELEASED $E0 $F0 $KEY  	;GTREL ;EXTENDED KEY RELEASED $E0 $F0 $KEY
 79)   989C AF          		EXGTEX: XOR A        ;NOT VALID EXTENDED KEY	;NOT VALID EXTENDED KEY
 80)   989D C9          		 RET	;
 83)   989E 79          		GTREL: LD A,C       ; THIS IS THE RELEASED KEY	; THIS IS THE RELEASED KEY
 84)   989F FE 12       		 CP 18         ; LSHIFT RELEASED	; LSHIFT RELEASED
 85)   98A1 CC B8 98    		 CALL Z, SHFRES       ; RESET SHIFT	; RESET SHIFT
 86)   98A4 FE 14       		 CP 20         ; LCTRL RELEASED	; LCTRL RELEASED
 87)   98A6 CC BE 98    		 CALL Z, CTRRES       ; RESET CONTROL	; RESET CONTROL
 88)   98A9 FE 11       		 CP 17         ; LALT RELEASED	; LALT RELEASED
 89)   98AB CC C4 98    		 CALL Z, ALTRES       ; RESET ALT	; RESET ALT
 90)   98AE FE 59       		 CP 89         ; RSHIFT RELEASED	; RSHIFT RELEASED
 91)   98B0 CC B8 98    		 CALL Z, SHFRES       ; RESET SHIFT  	; RESET SHIFT
 92)   98B3 32 81 00    		 LD (LASTKEY),A         ; SET LAST KEY	; SET LAST KEY
 93)   98B6 AF          		 XOR A         ; NO KEY  	; NO KEY
 94)   98B7 C9          		 RET	;
 96)   98B8 21 80 00    		SHFRES: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
 97)   98BB CB B6       		 RES 6, (HL)        ; BIT 6 IS SHIFT $40=64	; BIT 6 IS SHIFT $40=64
 98)   98BD C9          		 RET	;
100)   98BE 21 80 00    		CTRRES: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
101)   98C1 CB BE       		 RES 7, (HL)       ; BIT 7 IS CTRL $80=128	; BIT 7 IS CTRL $80=128
102)   98C3 C9          		 RET	;
104)   98C4 21 80 00    		ALTRES: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
105)   98C7 CB AE       		 RES 5, (HL)       ; BIT 5 IS SHIFT $20=32	; BIT 5 IS SHIFT $20=32
106)   98C9 C9          		 RET	;
108)   98CA 21 80 00    		SHFTOG: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
109)   98CD 3E 40       		 LD A, $40       ; MASK	; MASK
110)   98CF AE          		 XOR (HL)        ; BIT 6 IS SHIFT $40=64	; BIT 6 IS SHIFT $40=64
111)   98D0 77          		 LD (HL), A       ; SAVE	; SAVE
112)   98D1 AF          		 XOR A         ; NO KEY	; NO KEY
113)   98D2 C9          		 RET	;
115)   98D3 21 80 00    		CTRTOG: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
116)   98D6 3E 80       		 LD A, $80       ; MASK	; MASK
117)   98D8 AE          		 XOR (HL)       ; BIT 7 IS CTRL $80=128	; BIT 7 IS CTRL $80=128
118)   98D9 77          		 LD (HL), A       ; SAVE	; SAVE
119)   98DA AF          		 XOR A         ; NO KEY	; NO KEY
120)   98DB C9          		 RET	;
122)   98DC 21 80 00    		ALTTOG: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
123)   98DF 3E 20       		 LD A, $20	;
124)   98E1 AE          		 XOR (HL)       ; BIT 5 IS ALT $20=32	; BIT 5 IS ALT $20=32
125)   98E2 77          		 LD (HL), A       ; SAVE	; SAVE
126)   98E3 AF          		 XOR A         ; NO KEY	; NO KEY
127)   98E4 C9          		 RET	;
129)   98E5 21 80 00    		CAPSTOG: LD HL, KEYCTR      ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH,CAPS	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH,CAPS
130)   98E8 3E 10       		 LD A, $10	;
131)   98EA AE          		 XOR (HL)       ; BIT 4 IS CAPS $10=16	; BIT 4 IS CAPS $10=16
132)   98EB 77          		 LD (HL), A       ; SAVE	; SAVE
133)   98EC AF          		 XOR A         ; NO KEY	; NO KEY
134)   98ED C9          		 RET	;
138)   98EE FE AA       		@PS2LOK: CP $AA	;
139)   98F0 38 02       		 JR C,DOTRANS       ;ONLY 0-170	;ONLY 0-170
141)   98F2 AF          		 XOR A	;
142)   98F3 C9          		 RET	;
143)   98F4 21 2A 99    		DOTRANS: LD HL, PS2TAB1      ;UNSHIFTED	;UNSHIFTED
144)   98F7 57          		 LD D,A        ;SAVE KEY CODE	;SAVE KEY CODE
145)   98F8 CD 24 99    		 CALL PLK1       ;GET CHAR NO SHIFT NO CAPS	;GET CHAR NO SHIFT NO CAPS
146)   98FB 47          		 LD B,A        ;SAVE CHAR	;SAVE CHAR
147)   98FC FE 61       		 CP 'a'	;
148)   98FE 38 04       		 JR C,PS2CHKCAPS	;
149)   9900 FE 7B       		PS2SGT: CP 'z'+1  	;
150)   9902 38 09       		 JR C, PS2CPSF;ITS A LETTER CAPS AND SHIFT MATTERS	;ITS A LETTER CAPS AND SHIFT MATTERS
152)   9904 3A 80 00    		PS2CHKCAPS: LD A, (KEYCTR)      ; GET KEYBFLAGS ON A SHIFT  	; GET KEYBFLAGS ON A SHIFT
153)   9907 CB 77       		 BIT 6, A	;
154)   9909 78          		 LD A,B	;
155)   990A C8          		 RET Z        ;IF NO SHIFT RETURN TAB1 CHAR	;IF NO SHIFT RETURN TAB1 CHAR
157)   990B 18 0F       		 JR PS2SHIFT	;
159)   990D 3A 80 00    		PS2CPSF: LD A, (KEYCTR)      ; GET KEYBFLAGS ON A SHIFT	; GET KEYBFLAGS ON A SHIFT
160)   9910 4F          		 LD C, A        ;CAPS ON C	;CAPS ON C
161)   9911 CB 1F       		 RR A	;
162)   9913 CB 1F       		 RR A         ;2 ROTATIONS RIGHT SHIFT BECOMES BIT 4 FROM 6	;2 ROTATIONS RIGHT SHIFT BECOMES BIT 4 FROM 6
163)   9915 A9          		 XOR C         ;XOR SHIFT WITH CAPS	;XOR SHIFT WITH CAPS
164)   9916 CB 67       		 BIT 4, A        ;CHECK IF BIT 4 IS 0 = UNSHIFTED      	;CHECK IF BIT 4 IS 0 = UNSHIFTED
165)   9918 20 02       		 JR NZ,PS2SHIFT	;
169)   991A 78          		 LD A,B    	;
170)   991B C9          		 RET	;
171)   991C 7A          		PS2SHIFT: LD A, D       ;RESTORE A KEYCODE	;RESTORE A KEYCODE
172)   991D 21 D4 99    		 LD HL, PS2TAB2       ;SHIFTED	;SHIFTED
173)   9920 CD 24 99    		 CALL PLK1       ;GET CHAR	;GET CHAR
174)   9923 C9          		 RET	;
175)   9924 06 00       		PLK1: LD B, 0	;
176)   9926 4F          		 LD C, A	;
177)   9927 09          		 ADD HL, BC	;
178)   9928 7E          		 LD A, (HL)       ;GET THE CHAR	;GET THE CHAR
179)   9929 C9          		 RET	;
183)   992A 00 00 00 A5 		PS2TAB1: DB 0,0,0,165,0,0,0,0,0,0	;
183)   992E 00 00 00 00 		PS2TAB1: DB 0,0,0,165,0,0,0,0,0,0	;
183)   9932 00 00       		PS2TAB1: DB 0,0,0,165,0,0,0,0,0,0	;
184)   9934 A8 A6 00 00 		 DB 168,166,0,0,'`',0,0,0,0,0	;
184)   9938 60 00 00 00 		 DB 168,166,0,0,'`',0,0,0,0,0	;
184)   993C 00 00       		 DB 168,166,0,0,'`',0,0,0,0,0	;
185)   993E 00 71 31 00 		 DB 0,'q','1',0,0,0,'z','s','a','w'	;
185)   9942 00 00 7A 73 		 DB 0,'q','1',0,0,0,'z','s','a','w'	;
185)   9946 61 77       		 DB 0,'q','1',0,0,0,'z','s','a','w'	;
186)   9948 32 00 00 63 		 DB '2',0,0,'c','x','d','e','4','3',0	;
186)   994C 78 64 65 34 		 DB '2',0,0,'c','x','d','e','4','3',0	;
186)   9950 33 00       		 DB '2',0,0,'c','x','d','e','4','3',0	;
187)   9952 00 20 76 66 		 DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
187)   9956 74 72 35 00 		 DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
187)   995A 00 6E       		 DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
188)   995C 62 68 67 79 		 DB 'b','h','g','y','6',0,0,44,'m','j'     ;50-59	;50-59
188)   9960 36 00 00 2C 		 DB 'b','h','g','y','6',0,0,44,'m','j'     ;50-59	;50-59
188)   9964 6D 6A       		 DB 'b','h','g','y','6',0,0,44,'m','j'     ;50-59	;50-59
189)   9966 75 37 38 00 		 DB 'u','7','8',0,0,',','k','i','o','0'     ;60-69	;60-69
189)   996A 00 2C 6B 69 		 DB 'u','7','8',0,0,',','k','i','o','0'     ;60-69	;60-69
189)   996E 6F 30       		 DB 'u','7','8',0,0,',','k','i','o','0'     ;60-69	;60-69
190)   9970 39 00 00 2E 		 DB '9',0,0,'.','/','l',59,'p','-',0         ;70-79	;70-79
190)   9974 2F 6C 3B 70 		 DB '9',0,0,'.','/','l',59,'p','-',0         ;70-79	;70-79
190)   9978 2D 00       		 DB '9',0,0,'.','/','l',59,'p','-',0         ;70-79	;70-79
191)   997A 00 00 27 00 		 DB 0,0,39,0,'[','=',0,0,0,0                 ;80-89	;80-89
191)   997E 5B 3D 00 00 		 DB 0,0,39,0,'[','=',0,0,0,0                 ;80-89	;80-89
191)   9982 00 00       		 DB 0,0,39,0,'[','=',0,0,0,0                 ;80-89	;80-89
192)   9984 0D 5D 00 5C 		 DB 13,']',0,'\',0,0,0,0,0,0                 ;90-99	;90-99
192)   9988 00 00 00 00 		 DB 13,']',0,'\',0,0,0,0,0,0                 ;90-99	;90-99
192)   998C 00 00       		 DB 13,']',0,'\',0,0,0,0,0,0                 ;90-99	;90-99
193)   998E 00 00 06 00 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
193)   9992 00 08 00 04 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
193)   9996 09 00       		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
194)   9998 00 00 01 07 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
194)   999C 0A 00 03 0B 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
194)   99A0 1B 00       		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
195)   99A2 00 00 2B 2D 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
195)   99A6 2A 39 00 00 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
195)   99AA 00 00       		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
196)   99AC 00 A7 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
196)   99B0 00 00 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
196)   99B4 00 00       		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
197)   99B6 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
197)   99BA 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
197)   99BE 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
198)   99C0 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
198)   99C4 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
198)   99C8 00 00       		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
199)   99CA 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
199)   99CE 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
199)   99D2 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
202)   99D4 00 00 00 A5 		PS2TAB2: DB 0,0,0,165,0,0,0,0,0,0	;
202)   99D8 00 00 00 00 		PS2TAB2: DB 0,0,0,165,0,0,0,0,0,0	;
202)   99DC 00 00       		PS2TAB2: DB 0,0,0,165,0,0,0,0,0,0	;
203)   99DE A8 A6 00 00 		 DB 168,166,0,0,'~',0,0,0,0,0	;
203)   99E2 7E 00 00 00 		 DB 168,166,0,0,'~',0,0,0,0,0	;
203)   99E6 00 00       		 DB 168,166,0,0,'~',0,0,0,0,0	;
204)   99E8 00 51 21 00 		 DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
204)   99EC 00 00 5A 53 		 DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
204)   99F0 41 57       		 DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
205)   99F2 40 00 00 43 		 DB '@',0,0,'C','X','D','E','$','#',0	;
205)   99F6 58 44 45 24 		 DB '@',0,0,'C','X','D','E','$','#',0	;
205)   99FA 23 00       		 DB '@',0,0,'C','X','D','E','$','#',0	;
206)   99FC 00 20 56 46 		 DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
206)   9A00 54 52 25 00 		 DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
206)   9A04 00 4E       		 DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
207)   9A06 42 48 47 59 		 DB 'B','H','G','Y','^',0,0,34,'M','J'     ;50-59 34=""	;50-59 34=""
207)   9A0A 5E 00 00 22 		 DB 'B','H','G','Y','^',0,0,34,'M','J'     ;50-59 34=""	;50-59 34=""
207)   9A0E 4D 4A       		 DB 'B','H','G','Y','^',0,0,34,'M','J'     ;50-59 34=""	;50-59 34=""
208)   9A10 55 26 2A 00 		 DB 'U','&','*',0,0,'<','K','I','O',')'     ;60-69	;60-69
208)   9A14 00 3C 4B 49 		 DB 'U','&','*',0,0,'<','K','I','O',')'     ;60-69	;60-69
208)   9A18 4F 29       		 DB 'U','&','*',0,0,'<','K','I','O',')'     ;60-69	;60-69
209)   9A1A 28 00 00 3E 		 DB '(',0,0,'>','?','L',':','P','_',0        ;70-79	;70-79
209)   9A1E 3F 4C 3A 50 		 DB '(',0,0,'>','?','L',':','P','_',0        ;70-79	;70-79
209)   9A22 5F 00       		 DB '(',0,0,'>','?','L',':','P','_',0        ;70-79	;70-79
210)   9A24 00 00 22 00 		 DB 0,0,34,0,'{','+',0,0,0,0                 ;80-89	;80-89
210)   9A28 7B 2B 00 00 		 DB 0,0,34,0,'{','+',0,0,0,0                 ;80-89	;80-89
210)   9A2C 00 00       		 DB 0,0,34,0,'{','+',0,0,0,0                 ;80-89	;80-89
211)   9A2E 0D 7D 00 7C 		 DB 13,'}',0,'|',0,0,0,0,0,0                 ;90-99	;90-99
211)   9A32 00 00 00 00 		 DB 13,'}',0,'|',0,0,0,0,0,0                 ;90-99	;90-99
211)   9A36 00 00       		 DB 13,'}',0,'|',0,0,0,0,0,0                 ;90-99	;90-99
212)   9A38 00 00 06 00 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
212)   9A3C 00 08 00 04 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
212)   9A40 09 00       		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
213)   9A42 00 00 01 07 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
213)   9A46 0A 00 03 0B 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
213)   9A4A 1B 00       		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
214)   9A4C 00 00 2B 2D 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
214)   9A50 2A 39 00 00 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
214)   9A54 00 00       		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
215)   9A56 00 A7 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
215)   9A5A 00 00 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
215)   9A5E 00 00       		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
216)   9A60 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
216)   9A64 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
216)   9A68 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
217)   9A6A 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
217)   9A6E 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
217)   9A72 00 00       		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
218)   9A74 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
218)   9A78 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
218)   9A7C 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
 37)   9A7E F5          		DELAYMICROSEC: PUSH AF	;
 38)   9A7F D5          		 PUSH DE	;
 39)   9A80 1B          		 DEC DE	;
 40)   9A81 D1          		 POP DE	;
 41)   9A82 F1          		 POP AF	;
 42)   9A83 C9          		 RET	;
 45)   9A84 CD 7E 9A    		S21: CALL DELAYMICROSEC	;
 46)   9A87 10 FB       		 DJNZ S21	;
 47)   9A89 C9          		 RET	;
 51)   9A8A F5          		DELAYMILISEC: PUSH AF	;
 52)   9A8B D5          		 PUSH DE	;
 53)   9A8C 11 2C 01    		 LD DE, 300        ;2000 1 MILISEC =300 ON 8MHZ SO 30= 0.1 MILISECS = 100 MICROSECS	;2000 1 MILISEC =300 ON 8MHZ SO 30= 0.1 MILISECS = 100 MICROSECS
 54)   9A8F 1B          		DEL1: DEC DE	;
 55)   9A90 7A          		 LD A, D        ;TEST FOR DE=00	;TEST FOR DE=00
 56)   9A91 B3          		 OR E	;
 57)   9A92 20 FB       		 JR NZ, DEL1	;
 58)   9A94 D1          		 POP DE	;
 59)   9A95 F1          		 POP AF	;
 60)   9A96 C9          		 RET	;
 63)   9A97 06 50       		 LD B, 80	;
 65)   9A99 CD 8A 9A    		S1: CALL DELAYMILISEC	;
 66)   9A9C 10 FB       		 DJNZ S1	;
 67)   9A9E C9          		 RET	;
 72)   9A9F C5          		@DELAYSEC: PUSH BC	;
 73)   9AA0 01 E8 03    		 LD BC, 1000	;
 74)   9AA3 C5          		MYDLAGN: PUSH BC	;
 75)   9AA4 CD 8A 9A    		 CALL DELAY        ;1MS ON 8 MHZ	;1MS ON 8 MHZ
 76)   9AA7 C1          		 POP BC	;
 77)   9AA8 0B          		 DEC BC	;
 78)   9AA9 78          		 LD A, B	;
 79)   9AAA B1          		 OR C	;
 80)   9AAB 20 F6       		 JR NZ, MYDLAGN	;
 81)   9AAD C1          		 POP BC	;
 82)   9AAE 10 EF       		 DJNZ DELAYSEC	;
 83)   9AB0 C9          		 RET	;
 88)   9AB1 F5          		OUTASC: PUSH AF	;
 89)   9AB2 D5          		 PUSH DE	;
 90)   9AB3 CD E6 9A    		 CALL B2Bcd	;
 91)   9AB6 D1          		 POP DE	;
 92)   9AB7 CD 0C 9B    		 CALL BCD2HA	;
 93)   9ABA F1          		 POP AF	;
 94)   9ABB C9          		 RET	;
108)   9ABC B7          		BCD2BN: OR A	;
109)   9ABD 47          		 LD B, A	;
110)   9ABE E6 F0       		 AND $F0	;
111)   9AC0 0F          		 RRCA	;
112)   9AC1 4F          		 LD C, A	;
113)   9AC2 0F          		 RRCA	;
114)   9AC3 0F          		 RRCA	;
115)   9AC4 81          		 ADD A, C	;
116)   9AC5 4F          		 LD C, A	;
117)   9AC6 78          		 LD A, B	;
118)   9AC7 E6 0F       		 AND $0F	;
119)   9AC9 81          		 ADD A, C	;
120)   9ACA C9          		 RET	;
135)   9ACB 26 FF       		BN2BCD: LD H, $FF	;
136)   9ACD 24          		D100LP: INC H	;
137)   9ACE D6 64       		 SUB 100	;
138)   9AD0 30 FB       		 JR NC, D100LP	;
139)   9AD2 C6 64       		 ADD A, 100	;
140)   9AD4 2E FF       		 LD L, $FF	;
141)   9AD6 2C          		D10LP: INC L	;
142)   9AD7 D6 0A       		 SUB 10	;
143)   9AD9 30 FB       		 JR NC, D10LP	;
144)   9ADB C6 0A       		 ADD A, 10	;
145)   9ADD 4F          		 LD C, A	;
146)   9ADE 7D          		 LD A, L	;
147)   9ADF 07          		 RLCA	;
148)   9AE0 07          		 RLCA	;
149)   9AE1 07          		 RLCA	;
150)   9AE2 07          		 RLCA	;
151)   9AE3 B1          		 OR C	;
152)   9AE4 6F          		 LD L, A	;
153)   9AE5 C9          		 RET	;
167)   9AE6 01 00 10    		 LD BC, 16 * 256 + 0       ; handle 16 bits, one bit per iteration	; handle 16 bits, one bit per iteration
168)   9AE9 11 00 00    		 LD DE, 0	;
170)   9AEC 29          		 ADD HL, HL	;
171)   9AED 7B          		 LD A, E	;
172)   9AEE 8F          		 ADC A, A	;
173)   9AEF 27          		 DAA	;
174)   9AF0 5F          		 LD E, A	;
175)   9AF1 7A          		 LD A, D	;
176)   9AF2 8F          		 ADC A, A	;
177)   9AF3 27          		 DAA	;
178)   9AF4 57          		 LD D, A	;
179)   9AF5 79          		 LD A, C	;
180)   9AF6 8F          		 ADC A, A	;
181)   9AF7 27          		 DAA	;
182)   9AF8 4F          		 LD C, A	;
183)   9AF9 10 F1       		 DJNZ cvtLp	;
184)   9AFB EB          		 EX DE, HL	;
185)   9AFC C9          		 RET	;
199)   9AFD B7          		BCD2BN: OR A	;
200)   9AFE 47          		 LD B, A	;
201)   9AFF E6 F0       		 AND $F0	;
202)   9B01 0F          		 RRCA	;
203)   9B02 4F          		 LD C, A	;
204)   9B03 0F          		 RRCA	;
205)   9B04 0F          		 RRCA	;
206)   9B05 81          		 ADD A, C	;
207)   9B06 4F          		 LD C, A	;
208)   9B07 78          		 LD A, B	;
209)   9B08 E6 0F       		 AND $0F	;
210)   9B0A 81          		 ADD A, C	;
211)   9B0B C9          		 RET	;
223)   9B0C 79          		 LD A, C	;
224)   9B0D CD 39 9B    		 CALL cvtUN	;
225)   9B10 79          		 LD A, C	;
226)   9B11 CD 3D 9B    		 CALL cvtLN	;
227)   9B14 7C          		 LD A, H	;
228)   9B15 CD 39 9B    		 CALL cvtUN	;
229)   9B18 7C          		 LD A, H	;
230)   9B19 CD 3D 9B    		 CALL cvtLN	;
231)   9B1C 7D          		 LD A, L	;
232)   9B1D CD 39 9B    		 CALL cvtUN	;
233)   9B20 7D          		 LD A, L	;
234)   9B21 18 1A       		 JR cvtLN	;
236)   9B23 1F          		 RRA         ; move upper nibble into lower nibble	; move upper nibble into lower nibble
237)   9B24 1F          		 RRA	;
238)   9B25 1F          		 RRA	;
239)   9B26 1F          		 RRA	;
241)   9B27 E6 0F       		 AND 0Fh        ; isolate lower nibble	; isolate lower nibble
242)   9B29 C6 90       		 ADD A, 90h        ; old trick	; old trick
243)   9B2B 27          		 DAA         ; for converting	; for converting
244)   9B2C CE 40       		 ADC A, 40h        ; one nibble	; one nibble
245)   9B2E 27          		 DAA         ; to hex ASCII	; to hex ASCII
246)   9B2F 12          		 LD (DE), A	;
247)   9B30 13          		 INC DE	;
248)   9B31 C9          		 RET	;
260)   9B32 7D          		 LD A, L	;
261)   9B33 CD 23 9B    		 CALL cvtUN	;
262)   9B36 7D          		 LD A, L	;
263)   9B37 18 EE       		 JR cvtLN	;
265)   9B39 1F          		 RRA         ; move upper nibble into lower nibble	; move upper nibble into lower nibble
266)   9B3A 1F          		 RRA	;
267)   9B3B 1F          		 RRA	;
268)   9B3C 1F          		 RRA	;
270)   9B3D E6 0F       		 AND 0Fh        ; isolate lower nibble	; isolate lower nibble
271)   9B3F C6 90       		 ADD A, 90h        ; old trick	; old trick
272)   9B41 27          		 DAA         ; for converting	; for converting
273)   9B42 CE 40       		 ADC A, 40h        ; one nibble	; one nibble
274)   9B44 27          		 DAA         ; to hex ASCII	; to hex ASCII
275)   9B45 12          		 LD (DE), A	;
276)   9B46 13          		 INC DE	;
277)   9B47 C9          		 RET	;
294)   9B48 F5          		 PUSH AF        ; 11 T-states	; 11 T-states
296)   9B49 ED 44       		 NEG         ; 8 T-states	; 8 T-states
297)   9B4B ED 44       		 NEG         ; 8 T-states	; 8 T-states
298)   9B4D ED 44       		 NEG         ; 8 T-states	; 8 T-states
299)   9B4F ED 44       		 NEG         ; 8 T-states	; 8 T-states
300)   9B51 0B          		 DEC BC         ; 6 T-states	; 6 T-states
301)   9B52 79          		 LD A, C        ; 9 T-states	; 9 T-states
302)   9B53 B0          		 OR B         ; 4 T-states	; 4 T-states
303)   9B54 C2 49 9B    		 JP NZ, pau_lp        ; 10 T-states	; 10 T-states
304)   9B57 F1          		 POP AF         ; 10 T-states	; 10 T-states
305)   9B58 C9          		 RET         ; Pause complete, RETurn	; Pause complete, RETurn
343)   9B59 26 00       		@B2D8: LD H, 0	;
344)   9B5B 6F          		 LD L, A	;
345)   9B5C 1E 00       		@B2D16: LD E, 0	;
346)   9B5E 16 00       		@B2D24: LD D, 0	;
347)   9B60 01 00 00    		@B2D32: LD BC, 0	;
348)   9B63 DD 21 00 00 		@B2D48: LD IX, 0        ; zero all non-used bits	; zero all non-used bits
349)   9B67 22 C3 00    		@B2D64: LD (B2DINV), HL	;
350)   9B6A ED 53 C5 00 		 LD (B2DINV + 2), DE	;
351)   9B6E ED 43 C7 00 		 LD (B2DINV + 4), BC	;
352)   9B72 DD 22 C9 00 		 LD (B2DINV + 6), IX       ; place full 64-bit input value in buffer	; place full 64-bit input value in buffer
353)   9B76 21 CB 00    		 LD HL, B2DBUF	;
354)   9B79 11 CC 00    		 LD DE, B2DBUF + 1	;
355)   9B7C 36 20       		 LD (HL), ' '	;
357)   9B7E 01 12 00    		 LD BC, 18	;
358)   9B81 ED B0       		 LDIR         ; fill 1st 19 bytes of buffer with spaces	; fill 1st 19 bytes of buffer with spaces
359)   9B83 ED 43 DE 00 		 LD (B2DEND - 1), BC       ;set BCD value to "0" & place terminating 0	;set BCD value to "0" & place terminating 0
360)   9B87 1E 01       		 LD E, 1        ; no. of bytes in BCD value	; no. of bytes in BCD value
361)   9B89 21 CB 00    		 LD HL, B2DINV + 8       ; (address MSB input)+1	; (address MSB input)+1
362)   9B8C 01 09 09    		 LD BC, 0x0909	;
363)   9B8F AF          		 XOR A	;
364)   9B90 05          		B2DSKP0: DEC B	;
365)   9B91 28 29       		 JR Z, B2DSIZ        ; all 0: continue with postprocessing	; all 0: continue with postprocessing
366)   9B93 2B          		 DEC HL	;
367)   9B94 B6          		 OR (HL)        ; find first byte <>0	; find first byte <>0
368)   9B95 28 F9       		 JR Z, B2DSKP0	;
369)   9B97 0D          		B2DFND1: DEC C	;
370)   9B98 17          		 RLA	;
371)   9B99 30 FC       		 JR NC, B2DFND1        ; determine no. of most significant 1-bit	; determine no. of most significant 1-bit
372)   9B9B 1F          		 RRA	;
373)   9B9C 57          		 LD D, A        ; byte from binary input value	; byte from binary input value
374)   9B9D E5          		B2DLUS2: PUSH HL	;
375)   9B9E C5          		 PUSH BC	;
376)   9B9F 21 DE 00    		B2DLUS1: LD HL, B2DEND - 1      ; address LSB of BCD value	; address LSB of BCD value
377)   9BA2 43          		 LD B, E        ; current length of BCD value in bytes	; current length of BCD value in bytes
378)   9BA3 CB 12       		 RL D         ; highest bit from input value -> carry	; highest bit from input value -> carry
379)   9BA5 7E          		B2DLUS0: LD A, (HL)	;
380)   9BA6 8F          		 ADC A, A	;
381)   9BA7 27          		 DAA	;
382)   9BA8 77          		 LD (HL), A        ; double 1 BCD byte from intermediate result	; double 1 BCD byte from intermediate result
383)   9BA9 2B          		 DEC HL	;
384)   9BAA 10 F9       		 DJNZ B2DLUS0        ; and go on to double entire BCD value (+carry!)	; and go on to double entire BCD value (+carry!)
385)   9BAC 30 03       		 JR NC, B2DNXT	;
386)   9BAE 1C          		 INC E         ; carry at MSB -> BCD value grew 1 byte larger	; carry at MSB -> BCD value grew 1 byte larger
387)   9BAF 36 01       		 LD (HL), 1        ; initialize new MSB of BCD value	; initialize new MSB of BCD value
388)   9BB1 0D          		B2DNXT: DEC C	;
389)   9BB2 20 EB       		 JR NZ, B2DLUS1        ; repeat for remaining bits from 1 input byte	; repeat for remaining bits from 1 input byte
390)   9BB4 C1          		 POP BC         ; no. of remaining bytes in input value	; no. of remaining bytes in input value
391)   9BB5 0E 08       		 LD C, 8        ; reset bit-counter	; reset bit-counter
392)   9BB7 E1          		 POP HL         ; pointer to byte from input value	; pointer to byte from input value
393)   9BB8 2B          		 DEC HL	;
394)   9BB9 56          		 LD D, (HL)        ; get next group of 8 bits	; get next group of 8 bits
395)   9BBA 10 E1       		 DJNZ B2DLUS2        ; and repeat until last byte from input value	; and repeat until last byte from input value
396)   9BBC 21 DF 00    		B2DSIZ: LD HL, B2DEND        ; address of terminating 0	; address of terminating 0
397)   9BBF 4B          		 LD C, E        ; size of BCD value in bytes	; size of BCD value in bytes
398)   9BC0 B7          		 OR A	;
399)   9BC1 ED 42       		 SBC HL, BC        ; calculate address of MSB BCD	; calculate address of MSB BCD
400)   9BC3 54          		 LD D, H	;
401)   9BC4 5D          		 LD E, L	;
402)   9BC5 ED 42       		 SBC HL, BC	;
403)   9BC7 EB          		 EX DE, HL        ; HL=address BCD value, DE=start of decimal value	; HL=address BCD value, DE=start of decimal value
404)   9BC8 41          		 LD B, C        ; no. of bytes BCD	; no. of bytes BCD
405)   9BC9 CB 21       		 SLA C         ; no. of bytes decimal (possibly 1 too high)	; no. of bytes decimal (possibly 1 too high)
406)   9BCB 3E 30       		 LD A, '0'	;
407)   9BCD ED 6F       		 RLD         ; shift bits 4-7 of (HL) into bit 0-3 of A	; shift bits 4-7 of (HL) into bit 0-3 of A
408)   9BCF FE 30       		 CP '0'         ; (HL) was > 9h?	; (HL) was > 9h?
409)   9BD1 20 06       		 JR NZ, B2DEXPH        ; if yes, start with recording high digit	; if yes, start with recording high digit
410)   9BD3 0D          		 DEC C         ; correct number of decimals	; correct number of decimals
411)   9BD4 13          		 INC DE         ; correct start address	; correct start address
412)   9BD5 18 04       		 JR B2DEXPL        ; continue with converting low digit	; continue with converting low digit
413)   9BD7 ED 6F       		B2DEXP: RLD         ; shift high digit (HL) into low digit of A	; shift high digit (HL) into low digit of A
414)   9BD9 12          		B2DEXPH: LD (DE), A       ; record resulting ASCII-code	; record resulting ASCII-code
415)   9BDA 13          		 INC DE	;
416)   9BDB ED 6F       		B2DEXPL: RLD	;
417)   9BDD 12          		 LD (DE), A	;
418)   9BDE 13          		 INC DE	;
419)   9BDF 23          		 INC HL         ; next BCD-byte	; next BCD-byte
420)   9BE0 10 F5       		 DJNZ B2DEXP        ; and go on to convert each BCD-byte into 2 ASCII	; and go on to convert each BCD-byte into 2 ASCII
421)   9BE2 ED 42       		 SBC HL, BC        ; return with HL pointing to 1st decimal	; return with HL pointing to 1st decimal
422)   9BE4 C9          		 RET	;
426)   9BE5 EB          		 ex de, hl        ; Get destination into DE	; Get destination into DE
427)   9BE6 21 CB 00    		 ld hl, B2DBUF	;
428)   9BE9 CD F0 9B    		 call SkipWhitespace	;
429)   9BEC ED B0       		 ldir	;
430)   9BEE EB          		 ex de, hl        ; Get destination into DE	; Get destination into DE
431)   9BEF C9          		 ret	;
436)   9BF0 7E          		 ld a, (hl)	;
437)   9BF1 FE 20       		 cp ' '	;
438)   9BF3 C0          		 ret nz	;
439)   9BF4 23          		 inc hl	;
440)   9BF5 18 F9       		 jr SkipWhitespace	;
444)   9BF7 06 08       		@REVBITS: ld b, 8	;
445)   9BF9 6F          		 ld l, a	;
447)   9BFA CB 15       		 rl l	;
448)   9BFC 1F          		 rra	;
449)   9BFD 10 FB       		 djnz REVLOOP	;
450)   9BFF C9          		 RET	;
460)   9C00 E5          		 push hl	;
462)   9C01 7E          		 ld a, (hl)	;
464)   9C02 FE 00       		 cp  0	;
465)   9C04 28 0E       		 jr z, IsStrDecTrue	;
467)   9C06 FE 30       		 cp  '0'	;
468)   9C08 38 06       		 jr c, IsStrDecFalse	;
470)   9C0A FE 3A       		 cp  '9'+1	;
471)   9C0C 38 09       		 jr c, IsStrDecContinue	;
472)   9C0E FE 39       		 cp  '9'	;
475)   9C10 F6 01       		 or 1         ; Reset zero flag	; Reset zero flag
476)   9C12 E1          		 pop hl	;
477)   9C13 C9          		 ret	;
479)   9C14 BF          		 cp a         ; Set zero flag	; Set zero flag
480)   9C15 E1          		 pop hl	;
481)   9C16 C9          		 ret	;
483)   9C17 23          		 inc hl	;
484)   9C18 18 E7       		 jr IsStrDec00	;
491)   9C1A E5          		 push hl	;
493)   9C1B 7E          		 ld a, (hl)	;
495)   9C1C FE 00       		 cp  0	;
496)   9C1E 28 14       		 jr z, IsStrHexTrue	;
498)   9C20 FE 30       		 cp  '0'	;
499)   9C22 38 0C       		 jr c, IsStrHexFalse	;
501)   9C24 FE 3A       		 cp  '9'+1	;
502)   9C26 38 0F       		 jr c, IsStrHexContinue	;
504)   9C28 FE 30       		 cp  '0'	;
505)   9C2A 38 04       		 jr c, IsStrHexFalse	;
507)   9C2C FE 47       		 cp  'F'+1	;
508)   9C2E 38 07       		 jr c, IsStrHexContinue	;
511)   9C30 F6 01       		 or 1         ; Reset zero flag	; Reset zero flag
512)   9C32 E1          		 pop hl	;
513)   9C33 C9          		 ret	;
515)   9C34 BF          		 cp a         ; Set zero flag	; Set zero flag
516)   9C35 E1          		 pop hl	;
517)   9C36 C9          		 ret	;
519)   9C37 23          		 inc hl	;
520)   9C38 18 E1       		 jr IsStrHex00	;
527)   9C3A AF          		 xor a	;
528)   9C3B CD 40 9C    		 call loop	;
529)   9C3E 7A          		 ld a, d	;
530)   9C3F C9          		 ret	;
532)   9C40 57          		 ld d, a	;
533)   9C41 7E          		 ld a, (hl)	;
534)   9C42 23          		 inc hl	;
535)   9C43 D6 3A       		 sub '9' + 1	;
536)   9C45 C6 0A       		 add 10	;
537)   9C47 D0          		 ret nc	;
538)   9C48 5F          		 ld e, a	;
539)   9C49 7A          		 ld a, d	;
540)   9C4A 87          		 add a, a        ;double our accumulator	;double our accumulator
541)   9C4B 87          		 add a, a        ;double again (now x4)	;double again (now x4)
542)   9C4C 82          		 add a, d        ;add the original (now x5)	;add the original (now x5)
543)   9C4D 87          		 add a, a        ;double again (now x10)	;double again (now x10)
544)   9C4E 83          		 add a, e        ;add in the incoming digit	;add in the incoming digit
545)   9C4F 18 EF       		 jr loop	;
553)   9C51 7E          		 ld a, (hl)        ; Copy first char to A	; Copy first char to A
554)   9C52 CD 62 9C    		 call Hex12        ; Convert first char	; Convert first char
555)   9C55 87          		 add a, a        ; Multiply by 16...	; Multiply by 16...
556)   9C56 87          		 add a, a        ; ...	; ...
557)   9C57 87          		 add a, a        ; ...	; ...
558)   9C58 87          		 add a, a        ; ...done!	; ...done!
559)   9C59 57          		 ld d, a        ; Store top 4 bits in D	; Store top 4 bits in D
560)   9C5A 23          		 inc hl         ; Advance to next char	; Advance to next char
561)   9C5B 7E          		 ld a, (hl)	;
562)   9C5C CD 62 9C    		 call Hex12        ; Convert second char	; Convert second char
563)   9C5F B2          		 or d         ; Add back top bits	; Add back top bits
564)   9C60 23          		 inc hl         ; Advance for next guy	; Advance for next guy
565)   9C61 C9          		 ret	;
566)   9C62 D6 30       		Hex12: sub  '0'	;
567)   9C64 FE 0A       		 cp 10	;
568)   9C66 D8          		 ret c	;
569)   9C67 D6 07       		 sub 'A' - '0' - 10	;
570)   9C69 C9          		 ret	;
577)   9C6A CD 51 9C    		 call Read8bit	;
578)   9C6D 47          		 ld b, a	;
579)   9C6E CD 51 9C    		 call Read8bit	;
580)   9C71 4F          		 ld c, a	;
581)   9C72 C9          		 ret	;
589)   9C73 7E          		 ld a, (hl)	;
590)   9C74 23          		 inc hl	;
591)   9C75 D6 30       		 sub '0'	;
592)   9C77 CB 27       		 sla a	;
593)   9C79 CB 27       		 sla a	;
594)   9C7B CB 27       		 sla a	;
595)   9C7D CB 27       		 sla a	;
596)   9C7F 47          		 ld b, a	;
597)   9C80 7E          		 ld a, (hl)	;
598)   9C81 23          		 inc hl	;
599)   9C82 D6 30       		 sub '0'	;
600)   9C84 B0          		 or b	;
601)   9C85 C9          		 ret	;
606)   9C86 4F          		 ld c, a        ; a = number to convert	; a = number to convert
607)   9C87 CD 93 9C    		 call Num1	;
608)   9C8A 77          		 ld (hl), a	;
609)   9C8B 23          		 inc hl	;
610)   9C8C 79          		 ld a, c	;
611)   9C8D CD 97 9C    		 call Num2	;
612)   9C90 77          		 ld (hl), a	;
613)   9C91 23          		 inc hl	;
614)   9C92 C9          		 ret	;
615)   9C93 1F          		Num1: rra	;
616)   9C94 1F          		 rra	;
617)   9C95 1F          		 rra	;
618)   9C96 1F          		 rra	;
619)   9C97 F6 F0       		Num2: or $F0	;
620)   9C99 27          		 daa	;
621)   9C9A C6 A0       		 add a, $A0	;
622)   9C9C CE 40       		 adc a, $40        ; Ascii hex at this point (0 to F)	; Ascii hex at this point (0 to F)
623)   9C9E C9          		 ret	;
634)   9C9F 22 AC 00    		STR_SET: LD (LINESTR),HL	;
635)   9CA2 C9          		 RET	;
638)   9CA3 AF          		STR_CLR: XOR A	;
639)   9CA4 32 AE 00    		 LD (LINEPOS),A	;
640)   9CA7 32 AC 00    		 LD (LINESTR),A	;
641)   9CAA 32 AD 00    		 LD (LINESTR+1),A	;
642)   9CAD C9          		 RET	;
645)   9CAE 3A AC 00    		STR_VALID: LD A,(LINESTR)	;
646)   9CB1 47          		 LD B,A	;
647)   9CB2 3A AD 00    		 LD A,(LINESTR+1)	;
648)   9CB5 80          		 ADD B	;
649)   9CB6 B7          		 OR A	;
650)   9CB7 C9          		 RET	;
656)   9CB8 F5          		STR_CALCADDR: PUSH AF	;
657)   9CB9 ED 5B AC 00 		 LD DE,(LINESTR)	;
658)   9CBD EB          		 EX DE,HL	;
659)   9CBE 3A AE 00    		 LD A,(LINEPOS)	;
660)   9CC1 4F          		 LD C,A	;
661)   9CC2 06 00       		 LD B,0	;
662)   9CC4 09          		 ADD HL,BC	;
663)   9CC5 EB          		 EX DE,HL	;
664)   9CC6 F1          		 POP AF	;
665)   9CC7 C9          		 RET	;
669)   9CC8 3A AE 00    		STR_NEXTPOS: LD A,(LINEPOS)	;
670)   9CCB 3C          		 INC A	;
671)   9CCC 32 AE 00    		 LD (LINEPOS),A	;
672)   9CCF C9          		 RET	;
676)   9CD0 CD B8 9C    		STR_ADD: CALL STR_CALCADDR	;
677)   9CD3 CD C8 9C    		STRA_AGN: CALL STR_NEXTPOS	;
678)   9CD6 7E          		 LD A,(HL)	;
679)   9CD7 12          		 LD (DE),A	;
680)   9CD8 23          		 INC HL	;
681)   9CD9 13          		 INC DE	;
682)   9CDA B7          		 OR A	;
683)   9CDB C8          		 RET Z	;
684)   9CDC 18 F5       		 JR STRA_AGN	;
687)   9CDE CD B8 9C    		STR_ADDCHAR: CALL STR_CALCADDR	;
688)   9CE1 12          		 LD (DE),A	;
689)   9CE2 CD C8 9C    		 CALL STR_NEXTPOS	;
690)   9CE5 13          		 INC DE	;
691)   9CE6 AF          		 XOR A	;
692)   9CE7 12          		 LD (DE),A	;
693)   9CE8 C9          		 RET	;
701)   9CE9 26 00       		@PRINTNUM: LD H,0	;
702)   9CEB 6F          		 LD L,A	;
703)   9CEC F5          		@PRINTNUM16: PUSH AF	;
705)   9CED 11 BC 00    		 LD DE,NUMBUF	;
706)   9CF0 CD 32 9B    		 CALL Bcd2ASC  ;FOR HEX	;FOR HEX
707)   9CF3 3E 68       		 LD A,'h'	;
708)   9CF5 12          		 LD (DE),A  	;
709)   9CF6 13          		 INC DE	;
710)   9CF7 AF          		 XOR A	;
711)   9CF8 12          		 LD (DE),A  	;
713)   9CF9 21 BC 00    		 LD HL,NUMBUF	;
714)   9CFC CD 3B 8B    		 CALL RS_TXT	;
715)   9CFF CD 9B 8B    		 CALL RS_NEWLINE	;
716)   9D02 F1          		 POP AF	;
717)   9D03 C9          		 RET	;
725)   9D04 E5          		@NUM_ADDZERO: PUSH HL	;
726)   9D05 0E 00       		 LD C,0	;
727)   9D07 7E          		AZ_AGN: LD A,(HL)   	;
728)   9D08 23          		 INC HL	;
729)   9D09 0C          		 INC C	;
730)   9D0A FE 00       		 CP 0	;
731)   9D0C 20 F9       		 JR NZ,AZ_AGN	;
732)   9D0E 0D          		 DEC C ;EXCLUDE ZERO TERM	;EXCLUDE ZERO TERM
733)   9D0F E1          		 POP HL	;
734)   9D10 79          		 LD A,C	;
735)   9D11 B8          		 CP B	;
736)   9D12 C8          		 RET Z	;
738)   9D13 78          		 LD A,B	;
739)   9D14 91          		 SUB C	;
740)   9D15 D8          		 RET C ;RETURN IF CARRY MEANS WE HAVE MORE DIGITS	;RETURN IF CARRY MEANS WE HAVE MORE DIGITS
741)   9D16 47          		 LD B,A	;
742)   9D17 3E 30       		 LD A,'0'	;
743)   9D19 2B          		AZ_AGN2: DEC HL	;
744)   9D1A 77          		 LD (HL),A	;
745)   9D1B 10 FC       		 DJNZ AZ_AGN2 	;
746)   9D1D C9          		 RET	;
752)   9D1E 11 8B 00    		@COPYFNAME: LD DE,STRGBUFF	;
753)   9D21 7E          		@COPYSTRING:   LD A,(HL)	;
754)   9D22 12          		 LD (DE),A	;
755)   9D23 FE 00       		 CP 0	;
756)   9D25 C8          		 RET Z  	;
757)   9D26 13          		 INC DE	;
758)   9D27 23          		 INC HL	;
759)   9D28 18 F7       		 JR COPYSTRING	;
  1)   9D2A 00 00 00 00 		DS 0A000H-$	;
  1)   9D2E 00 00 00 00 		DS 0A000H-$	;
  1)   9D32 00 00 00 00 		DS 0A000H-$	;
  1)   9D36 00 00 00 00 		DS 0A000H-$	;
  1)   9D3A 00 00 00 00 		DS 0A000H-$	;
  1)   9D3E 00 00 00 00 		DS 0A000H-$	;
  1)   9D42 00 00 00 00 		DS 0A000H-$	;
  1)   9D46 00 00 00 00 		DS 0A000H-$	;
  1)   9D4A 00 00 00 00 		DS 0A000H-$	;
  1)   9D4E 00 00 00 00 		DS 0A000H-$	;
  1)   9D52 00 00 00 00 		DS 0A000H-$	;
  1)   9D56 00 00 00 00 		DS 0A000H-$	;
  1)   9D5A 00 00 00 00 		DS 0A000H-$	;
  1)   9D5E 00 00 00 00 		DS 0A000H-$	;
  1)   9D62 00 00 00 00 		DS 0A000H-$	;
  1)   9D66 00 00 00 00 		DS 0A000H-$	;
  1)   9D6A 00 00 00 00 		DS 0A000H-$	;
  1)   9D6E 00 00 00 00 		DS 0A000H-$	;
  1)   9D72 00 00 00 00 		DS 0A000H-$	;
  1)   9D76 00 00 00 00 		DS 0A000H-$	;
  1)   9D7A 00 00 00 00 		DS 0A000H-$	;
  1)   9D7E 00 00 00 00 		DS 0A000H-$	;
  1)   9D82 00 00 00 00 		DS 0A000H-$	;
  1)   9D86 00 00 00 00 		DS 0A000H-$	;
  1)   9D8A 00 00 00 00 		DS 0A000H-$	;
  1)   9D8E 00 00 00 00 		DS 0A000H-$	;
  1)   9D92 00 00 00 00 		DS 0A000H-$	;
  1)   9D96 00 00 00 00 		DS 0A000H-$	;
  1)   9D9A 00 00 00 00 		DS 0A000H-$	;
  1)   9D9E 00 00 00 00 		DS 0A000H-$	;
  1)   9DA2 00 00 00 00 		DS 0A000H-$	;
  1)   9DA6 00 00 00 00 		DS 0A000H-$	;
  1)   9DAA 00 00 00 00 		DS 0A000H-$	;
  1)   9DAE 00 00 00 00 		DS 0A000H-$	;
  1)   9DB2 00 00 00 00 		DS 0A000H-$	;
  1)   9DB6 00 00 00 00 		DS 0A000H-$	;
  1)   9DBA 00 00 00 00 		DS 0A000H-$	;
  1)   9DBE 00 00 00 00 		DS 0A000H-$	;
  1)   9DC2 00 00 00 00 		DS 0A000H-$	;
  1)   9DC6 00 00 00 00 		DS 0A000H-$	;
  1)   9DCA 00 00 00 00 		DS 0A000H-$	;
  1)   9DCE 00 00 00 00 		DS 0A000H-$	;
  1)   9DD2 00 00 00 00 		DS 0A000H-$	;
  1)   9DD6 00 00 00 00 		DS 0A000H-$	;
  1)   9DDA 00 00 00 00 		DS 0A000H-$	;
  1)   9DDE 00 00 00 00 		DS 0A000H-$	;
  1)   9DE2 00 00 00 00 		DS 0A000H-$	;
  1)   9DE6 00 00 00 00 		DS 0A000H-$	;
  1)   9DEA 00 00 00 00 		DS 0A000H-$	;
  1)   9DEE 00 00 00 00 		DS 0A000H-$	;
  1)   9DF2 00 00 00 00 		DS 0A000H-$	;
  1)   9DF6 00 00 00 00 		DS 0A000H-$	;
  1)   9DFA 00 00 00 00 		DS 0A000H-$	;
  1)   9DFE 00 00 00 00 		DS 0A000H-$	;
  1)   9E02 00 00 00 00 		DS 0A000H-$	;
  1)   9E06 00 00 00 00 		DS 0A000H-$	;
  1)   9E0A 00 00 00 00 		DS 0A000H-$	;
  1)   9E0E 00 00 00 00 		DS 0A000H-$	;
  1)   9E12 00 00 00 00 		DS 0A000H-$	;
  1)   9E16 00 00 00 00 		DS 0A000H-$	;
  1)   9E1A 00 00 00 00 		DS 0A000H-$	;
  1)   9E1E 00 00 00 00 		DS 0A000H-$	;
  1)   9E22 00 00 00 00 		DS 0A000H-$	;
  1)   9E26 00 00 00 00 		DS 0A000H-$	;
  1)   9E2A 00 00 00 00 		DS 0A000H-$	;
  1)   9E2E 00 00 00 00 		DS 0A000H-$	;
  1)   9E32 00 00 00 00 		DS 0A000H-$	;
  1)   9E36 00 00 00 00 		DS 0A000H-$	;
  1)   9E3A 00 00 00 00 		DS 0A000H-$	;
  1)   9E3E 00 00 00 00 		DS 0A000H-$	;
  1)   9E42 00 00 00 00 		DS 0A000H-$	;
  1)   9E46 00 00 00 00 		DS 0A000H-$	;
  1)   9E4A 00 00 00 00 		DS 0A000H-$	;
  1)   9E4E 00 00 00 00 		DS 0A000H-$	;
  1)   9E52 00 00 00 00 		DS 0A000H-$	;
  1)   9E56 00 00 00 00 		DS 0A000H-$	;
  1)   9E5A 00 00 00 00 		DS 0A000H-$	;
  1)   9E5E 00 00 00 00 		DS 0A000H-$	;
  1)   9E62 00 00 00 00 		DS 0A000H-$	;
  1)   9E66 00 00 00 00 		DS 0A000H-$	;
  1)   9E6A 00 00 00 00 		DS 0A000H-$	;
  1)   9E6E 00 00 00 00 		DS 0A000H-$	;
  1)   9E72 00 00 00 00 		DS 0A000H-$	;
  1)   9E76 00 00 00 00 		DS 0A000H-$	;
  1)   9E7A 00 00 00 00 		DS 0A000H-$	;
  1)   9E7E 00 00 00 00 		DS 0A000H-$	;
  1)   9E82 00 00 00 00 		DS 0A000H-$	;
  1)   9E86 00 00 00 00 		DS 0A000H-$	;
  1)   9E8A 00 00 00 00 		DS 0A000H-$	;
  1)   9E8E 00 00 00 00 		DS 0A000H-$	;
  1)   9E92 00 00 00 00 		DS 0A000H-$	;
  1)   9E96 00 00 00 00 		DS 0A000H-$	;
  1)   9E9A 00 00 00 00 		DS 0A000H-$	;
  1)   9E9E 00 00 00 00 		DS 0A000H-$	;
  1)   9EA2 00 00 00 00 		DS 0A000H-$	;
  1)   9EA6 00 00 00 00 		DS 0A000H-$	;
  1)   9EAA 00 00 00 00 		DS 0A000H-$	;
  1)   9EAE 00 00 00 00 		DS 0A000H-$	;
  1)   9EB2 00 00 00 00 		DS 0A000H-$	;
  1)   9EB6 00 00 00 00 		DS 0A000H-$	;
  1)   9EBA 00 00 00 00 		DS 0A000H-$	;
  1)   9EBE 00 00 00 00 		DS 0A000H-$	;
  1)   9EC2 00 00 00 00 		DS 0A000H-$	;
  1)   9EC6 00 00 00 00 		DS 0A000H-$	;
  1)   9ECA 00 00 00 00 		DS 0A000H-$	;
  1)   9ECE 00 00 00 00 		DS 0A000H-$	;
  1)   9ED2 00 00 00 00 		DS 0A000H-$	;
  1)   9ED6 00 00 00 00 		DS 0A000H-$	;
  1)   9EDA 00 00 00 00 		DS 0A000H-$	;
  1)   9EDE 00 00 00 00 		DS 0A000H-$	;
  1)   9EE2 00 00 00 00 		DS 0A000H-$	;
  1)   9EE6 00 00 00 00 		DS 0A000H-$	;
  1)   9EEA 00 00 00 00 		DS 0A000H-$	;
  1)   9EEE 00 00 00 00 		DS 0A000H-$	;
  1)   9EF2 00 00 00 00 		DS 0A000H-$	;
  1)   9EF6 00 00 00 00 		DS 0A000H-$	;
  1)   9EFA 00 00 00 00 		DS 0A000H-$	;
  1)   9EFE 00 00 00 00 		DS 0A000H-$	;
  1)   9F02 00 00 00 00 		DS 0A000H-$	;
  1)   9F06 00 00 00 00 		DS 0A000H-$	;
  1)   9F0A 00 00 00 00 		DS 0A000H-$	;
  1)   9F0E 00 00 00 00 		DS 0A000H-$	;
  1)   9F12 00 00 00 00 		DS 0A000H-$	;
  1)   9F16 00 00 00 00 		DS 0A000H-$	;
  1)   9F1A 00 00 00 00 		DS 0A000H-$	;
  1)   9F1E 00 00 00 00 		DS 0A000H-$	;
  1)   9F22 00 00 00 00 		DS 0A000H-$	;
  1)   9F26 00 00 00 00 		DS 0A000H-$	;
  1)   9F2A 00 00 00 00 		DS 0A000H-$	;
  1)   9F2E 00 00 00 00 		DS 0A000H-$	;
  1)   9F32 00 00 00 00 		DS 0A000H-$	;
  1)   9F36 00 00 00 00 		DS 0A000H-$	;
  1)   9F3A 00 00 00 00 		DS 0A000H-$	;
  1)   9F3E 00 00 00 00 		DS 0A000H-$	;
  1)   9F42 00 00 00 00 		DS 0A000H-$	;
  1)   9F46 00 00 00 00 		DS 0A000H-$	;
  1)   9F4A 00 00 00 00 		DS 0A000H-$	;
  1)   9F4E 00 00 00 00 		DS 0A000H-$	;
  1)   9F52 00 00 00 00 		DS 0A000H-$	;
  1)   9F56 00 00 00 00 		DS 0A000H-$	;
  1)   9F5A 00 00 00 00 		DS 0A000H-$	;
  1)   9F5E 00 00 00 00 		DS 0A000H-$	;
  1)   9F62 00 00 00 00 		DS 0A000H-$	;
  1)   9F66 00 00 00 00 		DS 0A000H-$	;
  1)   9F6A 00 00 00 00 		DS 0A000H-$	;
  1)   9F6E 00 00 00 00 		DS 0A000H-$	;
  1)   9F72 00 00 00 00 		DS 0A000H-$	;
  1)   9F76 00 00 00 00 		DS 0A000H-$	;
  1)   9F7A 00 00 00 00 		DS 0A000H-$	;
  1)   9F7E 00 00 00 00 		DS 0A000H-$	;
  1)   9F82 00 00 00 00 		DS 0A000H-$	;
  1)   9F86 00 00 00 00 		DS 0A000H-$	;
  1)   9F8A 00 00 00 00 		DS 0A000H-$	;
  1)   9F8E 00 00 00 00 		DS 0A000H-$	;
  1)   9F92 00 00 00 00 		DS 0A000H-$	;
  1)   9F96 00 00 00 00 		DS 0A000H-$	;
  1)   9F9A 00 00 00 00 		DS 0A000H-$	;
  1)   9F9E 00 00 00 00 		DS 0A000H-$	;
  1)   9FA2 00 00 00 00 		DS 0A000H-$	;
  1)   9FA6 00 00 00 00 		DS 0A000H-$	;
  1)   9FAA 00 00 00 00 		DS 0A000H-$	;
  1)   9FAE 00 00 00 00 		DS 0A000H-$	;
  1)   9FB2 00 00 00 00 		DS 0A000H-$	;
  1)   9FB6 00 00 00 00 		DS 0A000H-$	;
  1)   9FBA 00 00 00 00 		DS 0A000H-$	;
  1)   9FBE 00 00 00 00 		DS 0A000H-$	;
  1)   9FC2 00 00 00 00 		DS 0A000H-$	;
  1)   9FC6 00 00 00 00 		DS 0A000H-$	;
  1)   9FCA 00 00 00 00 		DS 0A000H-$	;
  1)   9FCE 00 00 00 00 		DS 0A000H-$	;
  1)   9FD2 00 00 00 00 		DS 0A000H-$	;
  1)   9FD6 00 00 00 00 		DS 0A000H-$	;
  1)   9FDA 00 00 00 00 		DS 0A000H-$	;
  1)   9FDE 00 00 00 00 		DS 0A000H-$	;
  1)   9FE2 00 00 00 00 		DS 0A000H-$	;
  1)   9FE6 00 00 00 00 		DS 0A000H-$	;
  1)   9FEA 00 00 00 00 		DS 0A000H-$	;
  1)   9FEE 00 00 00 00 		DS 0A000H-$	;
  1)   9FF2 00 00 00 00 		DS 0A000H-$	;
  1)   9FF6 00 00 00 00 		DS 0A000H-$	;
  1)   9FFA 00 00 00 00 		DS 0A000H-$	;
  1)   9FFE 00 00       		DS 0A000H-$	;
