 42)   007A 00          		 @SERERR DEFS 1       ;SERERR NOT USED BY SERIAL USED BY NBSETLCD	;SERERR NOT USED BY SERIAL USED BY NBSETLCD
 46)   007B 00          		 @LCDCX DEFS 1        ;DISPLAY X POS (0..F  FOR 1..16)	;DISPLAY X POS (0..F  FOR 1..16)
 47)   007C 00          		 @LCDCY DEFS 1        ;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)	;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)
 48)   007D 00          		 @LCD_DSPCTRL DEFS 1       ;LCD I2C 16X2	;LCD I2C 16X2
 49)   007E 00          		 @LCD_DSPMODE DEFS 1       ;LCD I2C 16X2	;LCD I2C 16X2
 50)   007F 00          		 @LCD_STSMASK DEFS 1       ;LCD I2C 16X2  	;LCD I2C 16X2
 52)   0080 00          		 @KEYCTR DEFS 1        ;IN NB SYSTEM VARS	;IN NB SYSTEM VARS
 53)   0081 00          		 @LASTKEY DEFS 1  ;LAST KEY PRESSED	;LAST KEY PRESSED
 55)   0082 00 00 00 00 		 @BANKS DEFS 8        ;8 PAGES FOR THE 8 BANKS 0..7	;8 PAGES FOR THE 8 BANKS 0..7
 55)   0086 00 00 00 00 		 @BANKS DEFS 8        ;8 PAGES FOR THE 8 BANKS 0..7	;8 PAGES FOR THE 8 BANKS 0..7
 57)   008A 00          		 @STRG_STAT DEFS 1       ;STORAGE_NEW STAUS BIT 0=0 NOT CONNECTED,1=CONNECTED,BIT 7 DEVICE EXISTS	;STORAGE_NEW STAUS BIT 0=0 NOT CONNECTED, 1=CONNECTED, BIT 7 DEVICE EXISTS
 58)   008B 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   008F 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   0093 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   0097 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   009B 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   009F 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   00A3 00 00 00 00 		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 58)   00A7 00 00       		 @USBBUF DEFS 30       ;CH376 USB BUFFER=20BYTES	;CH376 USB BUFFER=20BYTES
 59)   00A9 	            		 @STRGBUFF EQU CHANCN       ;USED FOR DIRECTORY AND FILENAME	;USED FOR DIRECTORY AND FILENAME
 61)   00A9 	            		 @BUFFER EQU B2DBUF       ; 20 BYTE BUFFER FOR I2C USAGE  	; 20 BYTE BUFFER FOR I2C USAGE
 63)   00A9 00 00       		 @PRGEX DEFS 2        ;ONLY FOR BOOTL	;ONLY FOR BOOTL
 64)   00AB 00          		 TVSTAT DEFS 1	;
 65)   00AC 00 00       		 @LINESTR DEFS 2       ;ADDRESS OF LINEBUF FOR PRINTING ON STRING	;ADDRESS OF LINEBUF FOR PRINTING ON STRING
 66)   00AE 00          		 @LINEPOS DEFS 1	;
 67)   00AF 00 00 00 00 		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 67)   00B3 00 00 00 00 		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 67)   00B7 00 00 00 00 		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 67)   00BB 00          		 @MYNUM DEFS 13        ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 68)   00BC 00 00 00 00 		 @NUMBUF DEFS 7    	;
 68)   00C0 00 00 00    		 @NUMBUF DEFS 7    	;
 69)   00C3 00 00 00 00 		 @B2DINV DEFS 8        ;BINARY NUMBER TO BE CONVERTED	;BINARY NUMBER TO BE CONVERTED
 69)   00C7 00 00 00 00 		 @B2DINV DEFS 8        ;BINARY NUMBER TO BE CONVERTED	;BINARY NUMBER TO BE CONVERTED
 70)   00CB 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 70)   00CF 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 70)   00D3 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 70)   00D7 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 70)   00DB 00 00 00 00 		 @B2DBUF DEFS 20       ;ASCCI STRING OF THE NUMBER	;ASCCI STRING OF THE NUMBER
 71)   00DF 00          		 @B2DEND DEFS 1        ;0 FOR TERMINATE THE STRING        	;0 FOR TERMINATE THE STRING
 76)   00E0 00 00       		@CHANDATA:     DEFS 2	;
 77)   00E2 00 00       		               DEFS 2	;
 78)   00E4 00 00       		               DEFS 2	;
 79)   00E6 00 00       		               DEFS 2	;
 81)   00E8 00 00       		@CHANDEL:      DEFS 2	;
 82)   00EA 00 00       		               DEFS 2	;
 83)   00EC 00 00       		               DEFS 2	;
 84)   00EE 00 00       		               DEFS 2	;
 86)   00F0 00          		@CHANCN:       DEFS 1	;
 87)   00F1 00          		               DEFS 1	;
 88)   00F2 00          		               DEFS 1	;
 89)   00F3 00          		               DEFS 1	;
 90)   00F4 00          		@CHANST:       DEFS 1    ;CHANNEL STATUS  BITS 0-3 SET MEANS DISABLED     	;CHANNEL STATUS  BITS 0-3 SET MEANS DISABLED
116)   8000 2F          		 CPL         ;ROM IS HERE	;ROM IS HERE
117)   8001 C3 D1 81    		 JP START	;
118)   8004 C3 5F 80    		 JP GETKEY        ;CALL HERE FROM NB ROM TO FIND THE GTNBKEY  $8004	;CALL HERE FROM NB ROM TO FIND THE GTNBKEY  $8004
119)   8007 C3 8F 80    		 JP RSTX        ; CALL HERE FROM NB TO FIND SERIAL TRASMIT  $8007	; CALL HERE FROM NB TO FIND SERIAL TRASMIT  $8007
120)   800A C3 93 80    		 JP RSRX        ; CALL HERE FROM NB TO FIND SERIAL RECEIVE  $800A	; CALL HERE FROM NB TO FIND SERIAL RECEIVE  $800A
121)   800D C3 A9 80    		 JP NBSTLCD        ;CALL HERE FROM NB TO FIND THE NBSETLCD $800D	;CALL HERE FROM NB TO FIND THE NBSETLCD $800D
122)   8010 C3 2D 82    		 JP MENU        ;$8010	;$8010
123)   8013 C3 4F 80    		 JP CHKKEY       ;CALL HERE FROM NB TO FIND THE CHKKEY $8013 RET NZ FOR KEY AVAIL	;CALL HERE FROM NB TO FIND THE CHKKEY $8013 RET NZ FOR KEY AVAIL
128)   8016 CD 84 8C    		@OS_PRINTCHAR: CALL RS_TX	;
129)   8019 C9          		 RET	;
133)   801A 7E          		@OS_PRINTTEXT: LD A, (HL)	;
134)   801B FE 00       		 CP 0	;
135)   801D C8          		 RET Z	;
136)   801E E5          		 PUSH HL	;
137)   801F CD 16 80    		 CALL OS_PRINTCHAR	;
138)   8022 E1          		 POP HL	;
139)   8023 23          		 INC HL	;
140)   8024 18 F4       		 JR OS_PRINTTEXT	;
143)   8026 E1          		@OS_PRINTMSG: POP HL	;
144)   8027 CD 1A 80    		 CALL OS_PRINTTEXT	;
145)   802A 23          		 INC HL	;
146)   802B E5          		 PUSH HL        ;CONTINUE AFTER THE MESG	;CONTINUE AFTER THE MESG
147)   802C C9          		 RET	;
153)   802D DF 3C       		@OS_PRCHSCR: DEFW WPTCHAR	;
154)   802F C9          		 RET	;
158)   8030 7E          		@OS_PRMESSCR:  LD A,(HL)	;
159)   8031 B7          		 OR A	;
160)   8032 C8          		 RET Z	;
161)   8033 DF 3C       		 DEFW WPTCHAR	;
162)   8035 23          		 INC HL	;
163)   8036 18 F8       		 JR OS_PRMESSCR	;
165)   8038 7E          		@OS_PRMESSCRSFE: LD A,(HL)	;
166)   8039 B7          		 OR A	;
167)   803A C8          		 RET Z	;
168)   803B FE 0A       		 CP $0A	;
169)   803D 28 04       		 JR Z,PMS_PRN	;
170)   803F FE 1F       		 CP 31 	;
171)   8041 38 04       		 JR C,PMS_SKP	;
172)   8043 DF 3C       		PMS_PRN: DEFW WPTCHAR	;
173)   8045 18 05       		 JR PMS_CNT	;
174)   8047 E5          		PMS_SKP:       PUSH HL	;
175)   8048 CD 01 81    		 CALL SOUTAS	;
176)   804B E1          		 POP HL	;
177)   804C 23          		PMS_CNT: INC HL	;
178)   804D 18 E9       		 JR OS_PRMESSCRSFE	;
182)   804F 47          		CHKKEY: LD B,A	;
183)   8050 CD EB 8C    		 CALL RS_KEYRD 	;
184)   8053 20 04       		 JR NZ, CK_EX       ;ZF SET IF NO KEY ON SERIAL	;ZF SET IF NO KEY ON SERIAL
185)   8055 DB 06       		 IN A,(6)	;
186)   8057 CB 5F       		 BIT 3,A        ;CHECK IF REAL KBD HAS AVAIL KEY, ZF SET IF NO KEY ON REAL KBD	;CHECK IF REAL KBD HAS AVAIL KEY, ZF SET IF NO KEY ON REAL KBD
187)   8059 78          		CK_EX: LD A,B	;
188)   805A 16 A0       		 LD D,$A0        ;DISPCOM 	;DISPCOM
189)   805C CB B6       		 RES 6,(HL)       ;KDATA= BIT 6 	;KDATA= BIT 6
190)   805E C9          		 RET	;
192)   805F D5          		GETKEY: PUSH DE	;
193)   8060 C5          		 PUSH BC	;
194)   8061 DD E5       		 PUSH IX	;
195)   8063 E5          		 PUSH HL	;
197)   8064 CD 6E 8A    		 CALL PS2KEYAVAIL       ;ZF=0 IF WE HAVE A KEY ELSE 1	;ZF=0 IF WE HAVE A KEY ELSE 1
198)   8067 20 05       		 JR NZ, KEYAVAIL       ;CHECK FOR SERIAL INPUT	;CHECK FOR SERIAL INPUT
199)   8069 CD 73 8A    		 CALL READKBCHAR       ;READ KEY FROM PS/2	;READ KEY FROM PS/2
200)   806C 18 10       		 JR RGT        ;NB TRANSLATION AND EXIT	;NB TRANSLATION AND EXIT
202)   806E CD BB 8C    		KEYAVAIL: CALL RS_RX       ;GET A CHAR FROM RS232 OR PS2_KEYB	;GET A CHAR FROM RS232 OR PS2_KEYB
203)   8071 FE FE       		 CP 254        ;BREAK KEY	;BREAK KEY
204)   8073 20 09       		 JR NZ,RGT	;
210)   8075 21 3C 00    		 LD HL,COPST	;
211)   8078 36 66       		 LD (HL),102  ;SIMULATE BREAK	;SIMULATE BREAK
212)   807A 3E 19       		 LD A,$19 	;
213)   807C 18 03       		 JR KAEXIT	;
214)   807E CD B8 88    		RGT: CALL GTNBKEY        ;KEY PRESSED TRANSLATE FOR NB	;KEY PRESSED TRANSLATE FOR NB
223)   8081 E1          		KAEXIT: POP HL  	;
224)   8082 DD E1       		 POP IX	;
225)   8084 C1          		 POP BC	;
226)   8085 D1          		 POP DE 	;
227)   8086 FE 00       		 CP 0         ;CHECK IF INVALID KEY	;CHECK IF INVALID KEY
228)   8088 C0          		 RET NZ	;
229)   8089 CB B6       		 RES KDATA (HL)        ; KEY INVALID RESET KDATA TEST BIT	; KEY INVALID RESET KDATA TEST BIT
230)   808B 23          		 INC HL         ;GET TO THE LAST VALID KEY	;GET TO THE LAST VALID KEY
231)   808C 7E          		 LD A, (HL)	;
232)   808D 2B          		 DEC HL   	;
233)   808E C9          		 RET	;
235)   808F CD 84 8C    		RSTX: CALL RS_TX	;
236)   8092 C9          		 RET	;
238)   8093 CD BB 8C    		RSRX: CALL RS_RX	;
239)   8096 C9          		 RET	;
242)   8097 E5          		LCD16SETCURS:  PUSH HL	;
243)   8098 C5          		 PUSH BC	;
244)   8099 CD 9E 95    		 CALL LCD16_SETCURS       ;SET LCD TO LCDCX,LCDCY	;SET LCD TO LCDCX,LCDCY
245)   809C C1          		 POP BC	;
246)   809D E1          		 POP HL	;
247)   809E C9          		 RET	;
249)   809F E5          		LCD16PRCHR: PUSH HL     ;OUTPUT CHAR TO LCD	;OUTPUT CHAR TO LCD
250)   80A0 C5          		 PUSH BC	;
251)   80A1 D5          		 PUSH DE	;
252)   80A2 CD 8D 95    		 CALL LCD16_PRCHR	;
253)   80A5 D1          		 POP DE	;
254)   80A6 C1          		 POP BC	;
255)   80A7 E1          		 POP HL	;
256)   80A8 C9          		 RET	;
262)   80A9 D5          		NBSTLCD: PUSH DE	;
263)   80AA F5          		 PUSH AF	;
264)   80AB C5          		 PUSH BC	;
265)   80AC E5          		 PUSH HL	;
266)   80AD 21 7A 00    		 LD HL,SERERR	;
267)   80B0 35          		 DEC (HL)	;
268)   80B1 7E          		 LD A,(HL)	;
269)   80B2 B7          		 OR A	;
270)   80B3 28 14       		 JR Z, NBLSEND	;
271)   80B5 E1          		NBLEXIT:       POP HL	;
272)   80B6 C1          		 POP BC	;
273)   80B7 F1          		 POP AF	;
274)   80B8 D1          		 POP DE 	;
275)   80B9 2B          		 DEC HL	;
276)   80BA 2B          		 DEC HL	;
278)   80BB 42          		 LD B,D	;
279)   80BC ED A3       		 OUTLP OUTI ;WRITE 1 BYTE EVERY 20 MUSECS	;WRITE 1 BYTE EVERY 20 MUSECS
280)   80BE DD E5       		 PUSH IX	;
281)   80C0 DD E1       		 POP IX	;
282)   80C2 00          		 NOP	;
283)   80C3 00          		 NOP	;
284)   80C4 7E          		 LD A,(HL)	;
285)   80C5 7E          		 LD A,(HL)	;
286)   80C6 20 F4       		 JR NZ OUTLP   	;
287)   80C8 C9          		 RET	;
289)   80C9 36 03       		NBLSEND: LD (HL),3         ;EVERY 5 TIMES SEND DATA TO LCD  	;EVERY 5 TIMES SEND DATA TO LCD
290)   80CB E1          		 POP HL	;
291)   80CC E5          		 PUSH HL	;
292)   80CD 42          		 LD B, D        ;TOTAL CHARS	;TOTAL CHARS
293)   80CE 05          		 DEC B	;
294)   80CF 05          		 DEC B         ;SKIP 2	;SKIP 2
295)   80D0 11 0F 00    		 LD DE, 15        ;START FROM THE END	;START FROM THE END
296)   80D3 19          		 ADD HL, DE	;
297)   80D4 AF          		 XOR A	;
298)   80D5 11 7B 00    		 LD DE, LCDCX        ;LCD POSITION	;LCD POSITION
299)   80D8 12          		 LD (DE), A	;
300)   80D9 13          		 INC DE	;
301)   80DA 12          		 LD (DE), A	;
303)   80DB D5          		 PUSH DE	;
304)   80DC 57          		 LD D, A	;
305)   80DD 5F          		 LD E, A	;
306)   80DE CD 97 80    		 CALL LCD16SETCURS       ;SET LCD TO LCDCX,LCDCY	;SET LCD TO LCDCX,LCDCY
307)   80E1 D1          		 POP DE	;
308)   80E2 1B          		 DEC DE         ;POSITION ON LCDCX	;POSITION ON LCDCX
309)   80E3 0E 00       		 LD C, 0        ;LCD POSITION COUNT	;LCD POSITION COUNT
310)   80E5 7E          		NBSETLP: LD A, (HL)	;
311)   80E6 CB 7F       		 BIT 7, A        ;CHECK IF CURSOR HERE	;CHECK IF CURSOR HERE
312)   80E8 28 06       		 JR Z, NBNXT	;
313)   80EA F5          		 PUSH AF	;
314)   80EB 79          		 LD A, C	;
315)   80EC 12          		 LD (DE), A        ;POSITION CURSOR	;POSITION CURSOR
316)   80ED F1          		 POP AF	;
317)   80EE CB BF       		 RES 7, A        ;CLEAR CHAR FROM CURSOR INFO	;CLEAR CHAR FROM CURSOR INFO
318)   80F0 CD 9F 80    		NBNXT: CALL LCD16PRCHR       ;OUTPUT CHAR TO LCD	;OUTPUT CHAR TO LCD
319)   80F3 2B          		 DEC HL	;
320)   80F4 0C          		 INC C	;
321)   80F5 10 EE       		 DJNZ NBSETLP        ;LOOP NEXT CHAR	;LOOP NEXT CHAR
322)   80F7 1A          		 LD A,(DE)	;
323)   80F8 57          		 LD D, A	;
324)   80F9 1E 00       		 LD E, 0	;
325)   80FB CD 9E 95    		 CALL LCD16_SETCURS       ;POSITION CURSOR	;POSITION CURSOR
326)   80FE C3 B5 80    		 JP NBLEXIT	;
330)   8101 F5          		SOUTAS: PUSH AF        ;SERIAL PRINT ASCII IN DECIMAL	;SERIAL PRINT ASCII IN DECIMAL
331)   8102 26 00       		 LD H, 0	;
332)   8104 6F          		 LD L, A	;
333)   8105 11 AF 00    		 LD DE, MYNUM	;
334)   8108 CD 1C 9C    		 CALL OUTASC	;
336)   810B 3E 0A       		 LD A, 10	;
337)   810D 12          		 LD (DE), A	;
338)   810E 13          		 INC DE	;
339)   810F 3E 0D       		 LD A, 13	;
340)   8111 12          		 LD (DE), A	;
341)   8112 13          		 INC DE	;
342)   8113 AF          		 XOR A	;
343)   8114 12          		 LD (DE), A	;
345)   8115 21 AF 00    		 LD HL, MYNUM	;
346)   8118 CD 93 8C    		 CALL RS_TXT	;
347)   811B F1          		 POP AF	;
348)   811C C9          		 RET	;
351)   811D E5          		TVON: PUSH HL	;
352)   811E 21 AB 00    		 LD HL, TVSTAT	;
353)   8121 CB D6       		 SET 2, (HL)	;
354)   8123 21 24 00    		 LD HL, 36	;
355)   8126 CB D6       		 SET 2, (HL)	;
356)   8128 E1          		 POP HL	;
357)   8129 18 12       		 JR RESTV	;
360)   812B E5          		TVOFF: PUSH HL	;
361)   812C 21 AB 00    		 LD HL, TVSTAT	;
362)   812F CB 96       		 RES 2, (HL)	;
363)   8131 21 24 00    		 LD HL, 36	;
364)   8134 CB 96       		 RES 2, (HL)	;
365)   8136 E1          		 POP HL	;
366)   8137 18 04       		 JR RESTV	;
369)   8139 AF          		TVOFTM: XOR A         ;TV OFF	;TV OFF
370)   813A D3 07       		 OUT (7), A	;
371)   813C C9          		 RET	;
373)   813D E5          		RESTV: PUSH HL	;
374)   813E 21 AB 00    		 LD HL, TVSTAT	;
375)   8141 7E          		 LD A, (HL)	;
376)   8142 D3 07       		 OUT (7), A	;
377)   8144 3E 05       		 LD A, 5	;
378)   8146 D3 09       		 OUT (9), A        ; SET DISPLAY ADDRESS	; SET DISPLAY ADDRESS
379)   8148 E1          		 POP HL	;
380)   8149 C9          		 RET	;
383)   814A 5C 43 48 53 		FONTNAME1 DEFM "\CHSET4.CHR"	;
383)   814E 45 54 34 2E 		FONTNAME1 DEFM "\CHSET4.CHR"	;
383)   8152 43 48 52    		FONTNAME1 DEFM "\CHSET4.CHR"	;
384)   8155 00          		 DB 0	;
385)   8156 5C 43 48 53 		FONTNAME2 DEFM "\CHSET2.CHR"	;
385)   815A 45 54 32 2E 		FONTNAME2 DEFM "\CHSET2.CHR"	;
385)   815E 43 48 52    		FONTNAME2 DEFM "\CHSET2.CHR"	;
386)   8161 00          		 DB 0	;
388)   8162 06 02       		LOADFONTS: LD B,2  ;BANK2	;BANK2
389)   8164 3E 08       		 LD A,8   ;VIDEO PAGE FOR FONTS   	;VIDEO PAGE FOR FONTS
390)   8166 CD 40 8C    		 CALL PUTPGINBANK  	;
391)   8169 21 4A 81    		 LD HL,FONTNAME1	;
392)   816C 01 B8 0B    		 LD BC,3000  ;MAX FILE SIZE	;MAX FILE SIZE
393)   816F 11 00 40    		 LD DE,$4000  ;0000 ON PAGE 8	;0000 ON PAGE 8
394)   8172 CD 1F 90    		 CALL STRG_LOADFILE	;
395)   8175 30 01       		 JR NC, LFFILOK	;
396)   8177 76          		 HALT   ;STOP EXEC	;STOP EXEC
397)   8178 21 56 81    		LFFILOK: LD HL,FONTNAME2	;
398)   817B 01 B8 0B    		 LD BC,3000  ;MAX FILE SIZE	;MAX FILE SIZE
399)   817E 11 00 50    		 LD DE,$5000  ;1000h ON PAGE 8	;1000h ON PAGE 8
400)   8181 CD 1F 90    		 CALL STRG_LOADFILE  	;
401)   8184 30 01       		 JR NC, LFFILOK2	;
402)   8186 76          		 HALT   ;STOP EXEC	;STOP EXEC
403)   8187 3E 0E       		LFFILOK2: LD A,14  ;BANK 2 ON NBRAIN RESTORE PAGE 14	;BANK 2 ON NBRAIN RESTORE PAGE 14
404)   8189 06 02       		 LD B,2	;
405)   818B CD 40 8C    		 CALL PUTPGINBANK	;
406)   818E C9          		 RET 	;
409)   818F 15 02 00 18 		SCRDATA DB        $15,$02,$00,$18,$18,$28,$40,$20	;
409)   8193 18 28 40 20 		SCRDATA DB        $15,$02,$00,$18,$18,$28,$40,$20	;
410)   8197 00 02 00 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
410)   819B 00 00 0A 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
410)   819F 00 00 FF 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
410)   81A3 AB 00 00 00 		 DB $00,$02,$00,$00,$00,$00,$0A,$00,$00,$00,$FF,$00,$AB,$00,$00,$00	;
411)   81A7 00 B1       		 DB $00,$B1	;
413)   81A9 21 8F 81    		SETSCRDATA: LD HL,SCRDATA	;
414)   81AC 11 68 02    		 LD DE,$268	;
415)   81AF 01 1A 00    		 LD BC,26	;
416)   81B2 ED B0       		 LDIR	;
417)   81B4 21 5C 00    		 LD HL,$5C	;
418)   81B7 36 68       		 LD (HL),$68  ;VIDEO START	;VIDEO START
419)   81B9 23          		 INC HL	;
420)   81BA 36 02       		 LD (HL),$02	;
421)   81BC C9          		 RET	;
424)   81BD E5          		BLPRNMES:   PUSH HL	;
425)   81BE CD 93 8C    		 CALL RS_TXT	;
426)   81C1 E1          		 POP HL	;
427)   81C2 11 F4 00    		 LD DE,CHANST	;
428)   81C5 1A          		 LD A,(DE)	;
429)   81C6 D5          		 PUSH DE	;
430)   81C7 CD EF 84    		 CALL SCPRN	;
431)   81CA CD 3D 81    		 CALL RESTV    ;ONLY NEEDED FOR EMULATOR & REAL NB	;ONLY NEEDED FOR EMULATOR & REAL NB
432)   81CD D1          		 POP DE	;
433)   81CE EB          		 EX DE,HL	;
434)   81CF 34          		 INC (HL)  	;
435)   81D0 C9          		 RET	;
439)   81D1 F3          		START: DI	;
441)   81D2 CD 2B 81    		 CALL TVOFF	;
446)   81D5 CD 62 81    		 CALL LOADFONTS       ;LOAD NEWBRAIN FONTS TO VIDEO RAM	;LOAD NEWBRAIN FONTS TO VIDEO RAM
447)   81D8 CD A9 81    		 CALL SETSCRDATA	;
448)   81DB CD AF 84    		 CALL SCCLS        ;CLEAR SCREEN BUFFER  	;CLEAR SCREEN BUFFER
449)   81DE 21 F4 00    		 LD HL,CHANST       ;LINE TO PRINT NEXT	;LINE TO PRINT NEXT
450)   81E1 36 00       		 LD (HL),0  	;
451)   81E3 21 8F 83    		 LD HL, STR02	;
452)   81E6 AF          		 XOR A	;
453)   81E7 CD EF 84    		 CALL SCPRN        ;PRINT WAITING AT SCREEN BUFFER	;PRINT WAITING AT SCREEN BUFFER
455)   81EA CD 1D 81    		 CALL TVON  	;
458)   81ED 3E 01       		 LD A, 1        ;1=115200 BPS	;1=115200 BPS
459)   81EF CD 6B 8C    		 CALL RS_INI        ;RS232 INITIALIZE	;RS232 INITIALIZE
460)   81F2 21 D8 83    		 LD HL, STR_CRIGHT1	;
461)   81F5 CD BD 81    		 CALL BLPRNMES    	;
462)   81F8 21 60 84    		 LD HL, STR_SERIAL	;
463)   81FB CD BD 81    		 CALL BLPRNMES  	;
465)   81FE CD 68 8A    		 CALL PS2KBINIT  	;
466)   8201 21 6D 84    		 LD HL, STR_KEYB	;
467)   8204 CD BD 81    		 CALL BLPRNMES  	;
469)   8207 CD C8 93    		 CALL I2C_INIT	;
470)   820A CD A9 96    		 CALL DS1307_INIT       ;	;
471)   820D 21 7A 84    		 LD HL, STR_I2C	;
472)   8210 CD BD 81    		 CALL BLPRNMES  	;
474)   8213 CD 0F 95    		 CALL LCD16_INIT       ;LCD 16x2 Initialized	;LCD 16x2 Initialized
475)   8216 21 7F 83    		 LD HL, STR0	;
476)   8219 CD 83 95    		 CALL LCD16_PRINT	;
477)   821C 21 8E 84    		 LD HL, STR_LCD16	;
478)   821F CD BD 81    		 CALL BLPRNMES  	;
488)   8222 CD 9F 8A    		 CALL PATCHCMDS       ;PATCH CD ROM TO IMPLEMENT OUR OWN COMMANDS	;PATCH CD ROM TO IMPLEMENT OUR OWN COMMANDS
489)   8225 CD 85 88    		 CALL STNEWD        ;SET NEWDRIVERS AND DEFSTORE DEVICE	;SET NEWDRIVERS AND DEFSTORE DEVICE
491)   8228 21 7A 00    		 LD HL,SERERR       ;SERERR NOT USED BY SERIAL	;SERERR NOT USED BY SERIAL
492)   822B 36 05       		 LD (HL),5       ;INIT EVERY 5 TIMES TO PRINT TO LCD	;INIT EVERY 5 TIMES TO PRINT TO LCD
495)   822D 21 07 84    		 LD HL, STRMN	;
496)   8230 CD 93 8C    		 CALL RS_TXT        ;OUTPUT MENU COMMANDS AT RS232	;OUTPUT MENU COMMANDS AT RS232
497)   8233 21 50 84    		 LD HL, STR01	;
498)   8236 CD 93 8C    		 CALL RS_TXT        ;OUTPUT WAITING AT RS232	;OUTPUT WAITING AT RS232
500)   8239 CD 7A 95    		 CALL LCD16_CLR	;
502)   823C 21 8F 83    		 LD HL, STR02	;
503)   823F CD 83 95    		 CALL LCD16_PRINT	;
505)   8242 21 60 83    		 LD HL, SMENU	;
506)   8245 3E 0A       		 LD A, 10	;
507)   8247 CD EF 84    		 CALL SCPRN	;
509)   824A CD 69 82    		 CALL GET_KBCHAR       ;TAKE A CHAR FROM RS232 OR PS2 KEYB	;TAKE A CHAR FROM RS232 OR PS2 KEYB
512)   824D FE 55       		 CP 'U'         ;UPLOAD PROGRAM	;UPLOAD PROGRAM
513)   824F CC D6 82    		 CALL Z, UPLOD	;
514)   8252 FE 58       		 CP 'X'	;
515)   8254 CA B9 82    		 JP Z, EXEC	;
516)   8257 FE 53       		 CP 'S'	;
517)   8259 CC 37 83    		 CALL Z, TXTSCR	;
518)   825C FE 4E       		 CP 'N'	;
519)   825E CA 90 82    		 JP Z, GONB        ;$E090	;$E090
520)   8261 FE 44       		 CP 'D'	;
521)   8263 CC 1C 83    		 CALL Z, DNLOD	;
523)   8266 C3 2D 82    		 JP MENU	;
526)   8269 AF          		GET_KBCHAR: XOR A	;
529)   826A CD EB 8C    		 CALL RS_KEYRD        ;CHAR IN RS232?	;CHAR IN RS232?
530)   826D 28 04       		 JR Z, GT_TST2	;
532)   826F CD BB 8C    		 CALL RS_RX        ; GET THAT CHAR	; GET THAT CHAR
533)   8272 C9          		 RET	;
535)   8273 CD 6E 8A    		GT_TST2: CALL PS2KEYAVAIL      ;ZF=0 IF WE HAVE A KEY ELSE 1	;ZF=0 IF WE HAVE A KEY ELSE 1
536)   8276 20 F1       		 JR NZ, GET_KBCHAR       ;RECHECK	;RECHECK
537)   8278 CD 73 8A    		 CALL READKBCHAR	;
538)   827B B7          		 OR A	;
539)   827C CA 69 82    		 JP Z,GET_KBCHAR	;
548)   827F C9          		 RET	;
550)   8280 16 00       		LCDLN1: LD D, 0	;
551)   8282 1E 00       		 LD E, 0	;
552)   8284 CD 9E 95    		 CALL LCD16_SETCURS  ; D HAS THE COLUMN E HAS THE ROW	; D HAS THE COLUMN E HAS THE ROW
553)   8287 C9          		 RET	;
555)   8288 16 00       		LCDLN2: LD D, 0	;
556)   828A 1E 01       		 LD E, 1	;
557)   828C CD 9E 95    		 CALL LCD16_SETCURS ; D HAS THE COLUMN E HAS THE ROW	; D HAS THE COLUMN E HAS THE ROW
558)   828F C9          		 RET	;
562)   8290 21 E0 00    		GONB: LD HL,DIRNM	;
563)   8293 3E 2F       		 LD A,'/'	;
564)   8295 77          		 LD (HL),A	;
565)   8296 23          		 INC HL	;
566)   8297 36 00       		 LD (HL),0	;
567)   8299 23          		 INC HL	;
568)   829A 36 00       		 LD (HL),0	;
569)   829C CD 88 82    		 CALL LCDLN2	;
570)   829F 21 4F 83    		 LD HL, DSPMES	;
571)   82A2 CD 83 95    		 CALL LCD16_PRINT	;
573)   82A5 CD BB 95    		 CALL LCD16_CURSON       ;CURSOR On	;CURSOR On
574)   82A8 CD D7 95    		 CALL LCD16_BLINKON       ;BLINK ON	;BLINK ON
576)   82AB 21 06 00    		 LD HL,6	;
577)   82AE 36 FE       		 LD (HL),254	;
578)   82B0 23          		 INC HL	;
579)   82B1 36 7F       		 LD (HL),127	;
580)   82B3 AF          		 XOR A	;
581)   82B4 D3 E0       		 OUT (INTENB),A       ;ENABLE INTERRUPTS ON NB	;ENABLE INTERRUPTS ON NB
582)   82B6 C3 15 A0    		 JP $A015	;
587)   82B9 CD 7A 95    		EXEC: CALL LCD16_CLR	;
588)   82BC CD 88 82    		 CALL LCDLN2	;
589)   82BF 21 B6 83    		 LD HL, SPRGX	;
590)   82C2 CD 83 95    		 CALL LCD16_PRINT	;
591)   82C5 CD 80 82    		 CALL LCDLN1	;
593)   82C8 3E 05       		 LD A, 5	;
594)   82CA CD EF 84    		 CALL SCPRN	;
596)   82CD 11 A9 00    		 LD DE, PRGEX	;
597)   82D0 1A          		 LD A, (DE)	;
598)   82D1 6F          		 LD L, A	;
599)   82D2 13          		 INC DE	;
600)   82D3 1A          		 LD A, (DE)	;
601)   82D4 67          		 LD H, A	;
602)   82D5 E9          		 JP (HL)	;
605)   82D6 21 A9 83    		UPLOD: LD HL, DATST	;
606)   82D9 CD 88 82    		 CALL LCDLN2	;
607)   82DC CD 83 95    		 CALL LCD16_PRINT	;
609)   82DF CD BB 8C    		 CALL RS_RX        ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
610)   82E2 6F          		 LD L, A	;
611)   82E3 CD BB 8C    		 CALL RS_RX	;
612)   82E6 67          		 LD H, A	;
613)   82E7 CD BB 8C    		 CALL RS_RX        ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
614)   82EA 4F          		 LD C, A	;
615)   82EB CD BB 8C    		 CALL RS_RX	;
616)   82EE 47          		 LD B, A	;
618)   82EF 11 A9 00    		 LD DE, PRGEX        ;SAVE TO PRGEX THE PROG EXEC ADDR=HL	;SAVE TO PRGEX THE PROG EXEC ADDR=HL
619)   82F2 7D          		 LD A, L	;
620)   82F3 12          		 LD (DE), A	;
621)   82F4 13          		 INC DE	;
622)   82F5 7C          		 LD A, H	;
623)   82F6 12          		 LD (DE), A	;
625)   82F7 FE 80       		 CP $80	;
626)   82F9 28 02       		 JR Z, ROMWR	;
627)   82FB 38 02       		 JR C, NORWR	;
629)   82FD D3 7C       		ROMWR: OUT (124), A       ;SET ROM WRITABLE = '0'     	;SET ROM WRITABLE = '0'
631)   82FF E5          		NORWR: PUSH HL	;
632)   8300 CD BB 8C    		NXB: CALL RS_RX	;
633)   8303 77          		 LD (HL), A	;
634)   8304 23          		 INC HL	;
635)   8305 0B          		 DEC BC	;
636)   8306 78          		 LD A, B	;
637)   8307 B1          		 OR C	;
638)   8308 20 F6       		 JR NZ, NXB        ;LOOP ALL BYTES	;LOOP ALL BYTES
640)   830A D3 7D       		 OUT (125), A        ;SET ROM NON WRITABLE ='1'	;SET ROM NON WRITABLE ='1'
642)   830C 21 9A 83    		 LD HL, DATTR	;
643)   830F CD 7A 95    		 CALL LCD16_CLR	;
644)   8312 CD 83 95    		 CALL LCD16_PRINT	;
645)   8315 3E 05       		 LD A, 5	;
646)   8317 CD EF 84    		 CALL SCPRN	;
650)   831A E1          		 POP HL	;
652)   831B C9          		 RET	;
659)   831C CD BB 8C    		DNLOD: CALL RS_RX        ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
660)   831F 6F          		 LD L, A	;
661)   8320 CD BB 8C    		 CALL RS_RX	;
662)   8323 67          		 LD H, A	;
663)   8324 CD BB 8C    		 CALL RS_RX        ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
664)   8327 4F          		 LD C, A	;
665)   8328 CD BB 8C    		 CALL RS_RX	;
666)   832B 47          		 LD B, A	;
668)   832C 7E          		NXB3: LD A, (HL)	;
669)   832D CD 84 8C    		 CALL RS_TX        ;SEND BYTE	;SEND BYTE
670)   8330 23          		 INC HL	;
671)   8331 0B          		 DEC BC	;
672)   8332 78          		 LD A, B	;
673)   8333 B1          		 OR C	;
674)   8334 20 F6       		 JR NZ, NXB3        ;LOOP ALL BYTES   	;LOOP ALL BYTES
675)   8336 C9          		 RET	;
678)   8337 21 C2 83    		TXTSCR: LD HL, TXTMES        ;SCREEN START	;SCREEN START
679)   833A 11 82 02    		 LD DE, TXTRAM	;
680)   833D 01 15 00    		 LD BC, 21	;
681)   8340 ED B0       		 LDIR	;
683)   8342 21 C2 83    		 LD HL, TXTMES	;
684)   8345 11 C2 02    		 LD DE, TXTRAM + 64       ;SCREEN START+64 40chars screen +24 excess	;SCREEN START+64 40chars screen +24 excess
685)   8348 01 15 00    		 LD BC, 21	;
686)   834B ED B0       		 LDIR	;
688)   834D AF          		 XOR A	;
689)   834E C9          		 RET	;
692)   834F 3C 43 44 45 		DSPMES: DEFM "<CDESP 2022-24> "	;
692)   8353 53 50 20 32 		DSPMES: DEFM "<CDESP 2022-24> "	;
692)   8357 30 32 32 2D 		DSPMES: DEFM "<CDESP 2022-24> "	;
692)   835B 32 34 3E 20 		DSPMES: DEFM "<CDESP 2022-24> "	;
693)   835F 00          		 DB 0  	;
695)   8360 55 3A 55 50 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   8364 2C 58 3A 52 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   8368 55 4E 2C 53 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   836C 3A 44 49 53 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   8370 50 2C 4E 3A 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   8374 4E 42 52 4F 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   8378 4D 2C 44 3A 		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
695)   837C 44 4E       		SMENU: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
696)   837E 00          		 DB 0 	;
698)   837F 4C 43 44 20 		STR0: DEFM "LCD INITIALIZED"	;
698)   8383 49 4E 49 54 		STR0: DEFM "LCD INITIALIZED"	;
698)   8387 49 41 4C 49 		STR0: DEFM "LCD INITIALIZED"	;
698)   838B 5A 45 44    		STR0: DEFM "LCD INITIALIZED"	;
699)   838E 00          		 DB 0	;
701)   838F 57 41 49 54 		STR02: DEFM "WAITING..."	;
701)   8393 49 4E 47 2E 		STR02: DEFM "WAITING..."	;
701)   8397 2E 2E       		STR02: DEFM "WAITING..."	;
702)   8399 00          		 DB 0	;
704)   839A 50 52 47 20 		DATTR: DEFM "PRG TRANSFERED"	;
704)   839E 54 52 41 4E 		DATTR: DEFM "PRG TRANSFERED"	;
704)   83A2 53 46 45 52 		DATTR: DEFM "PRG TRANSFERED"	;
704)   83A6 45 44       		DATTR: DEFM "PRG TRANSFERED"	;
705)   83A8 00          		 DB 0	;
707)   83A9 52 45 43 45 		DATST: DEFM "RECEIVING..."	;
707)   83AD 49 56 49 4E 		DATST: DEFM "RECEIVING..."	;
707)   83B1 47 2E 2E 2E 		DATST: DEFM "RECEIVING..."	;
708)   83B5 00          		 DB 0	;
710)   83B6 50 52 47 20 		SPRGX: DEFM "PRG EXECUTE"	;
710)   83BA 45 58 45 43 		SPRGX: DEFM "PRG EXECUTE"	;
710)   83BE 55 54 45    		SPRGX: DEFM "PRG EXECUTE"	;
711)   83C1 00          		 DB 0	;
713)   83C2 4E 45 57 42 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
713)   83C6 52 41 49 4E 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
713)   83CA 20 53 43 52 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
713)   83CE 45 45 4E 20 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
713)   83D2 52 45 41 44 		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
713)   83D6 59          		TXTMES: DEFM "NEWBRAIN SCREEN READY"	;
714)   83D7 00          		 DB 0	;
716)   83D8 4E 45 57 42 		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
716)   83DC 52 41 49 4E 		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
716)   83E0 20 48 41 52 		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
716)   83E4 44 57 41 52 		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
716)   83E8 45 20 45 4D 		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
716)   83EC 55 4C 41 54 		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
716)   83F0 4F 52       		STR_CRIGHT1 DEFM "NEWBRAIN HARDWARE EMULATOR"	;
717)   83F2 0A 0D 00    		 DB 10,13,0	;
719)   83F5 43 44 65 73 		STR_CRIGHT2 DEFM "CDesp 2022-2024"	;
719)   83F9 70 20 32 30 		STR_CRIGHT2 DEFM "CDesp 2022-2024"	;
719)   83FD 32 32 2D 32 		STR_CRIGHT2 DEFM "CDesp 2022-2024"	;
719)   8401 30 32 34    		STR_CRIGHT2 DEFM "CDesp 2022-2024"	;
720)   8404 0A 0D 00    		 DB 10,13,0	;
722)   8407 55 3A 55 50 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   840B 2C 58 3A 52 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   840F 55 4E 2C 53 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   8413 3A 44 49 53 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   8417 50 2C 4E 3A 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   841B 4E 42 52 4F 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   841F 4D 2C 44 3A 		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
722)   8423 44 4E       		STRMN: DEFM "U:UP,X:RUN,S:DISP,N:NBROM,D:DN"	;
723)   8425 0A 0D 00    		 DB 10,13,0	;
725)   8428 4E 45 57 42 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
725)   842C 52 41 49 4E 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
725)   8430 20 42 4F 4F 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
725)   8434 54 45 44 20 		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
725)   8438 4F 4B       		STRBT: DEFM "NEWBRAIN BOOTED OK"	;
726)   843A 0A 0D 00    		 DB 10,13,0	;
728)   843D 43 4C 45 41 		STRSCR: DEFM "CLEARING SCREEN."	;
728)   8441 52 49 4E 47 		STRSCR: DEFM "CLEARING SCREEN."	;
728)   8445 20 53 43 52 		STRSCR: DEFM "CLEARING SCREEN."	;
728)   8449 45 45 4E 2E 		STRSCR: DEFM "CLEARING SCREEN."	;
729)   844D 0A 0D 00    		 DB 10,13,0	;
732)   8450 0A 0D       		STR01: DB 10,13	;
733)   8452 57 41 49 54 		 DEFM "WAITING..."	;
733)   8456 49 4E 47 2E 		 DEFM "WAITING..."	;
733)   845A 2E 2E       		 DEFM "WAITING..."	;
734)   845C 0A 0D 00    		 DB 10,13,0	;
735)   845F 00          		 DB 0	;
737)   8460 0A 0D       		STR_SERIAL: DB 10,13	;
738)   8462 52 53 32 33 		 DEFM "RS232 OK"	;
738)   8466 32 20 4F 4B 		 DEFM "RS232 OK"	;
739)   846A 0A 0D 00    		 DB 10,13,0	;
741)   846D 4B 45 59 42 		STR_KEYB DEFM "KEYBORD OK"	;
741)   8471 4F 52 44 20 		STR_KEYB DEFM "KEYBORD OK"	;
741)   8475 4F 4B       		STR_KEYB DEFM "KEYBORD OK"	;
742)   8477 0A 0D 00    		 DB 10,13,0   	;
744)   847A 49 32 43 20 		STR_I2C DEFM "I2C OK"	;
744)   847E 4F 4B       		STR_I2C DEFM "I2C OK"	;
745)   8480 0A 0D 00    		 DB 10,13,0   	;
747)   8483 53 4F 55 4E 		STR_SND DEFM "SOUND OK"	;
747)   8487 44 20 4F 4B 		STR_SND DEFM "SOUND OK"	;
748)   848B 0A 0D 00    		 DB 10,13,0   	;
749)   848E 4C 43 44 20 		STR_LCD16 DEFM "LCD 16x2 OK"	;
749)   8492 31 36 78 32 		STR_LCD16 DEFM "LCD 16x2 OK"	;
749)   8496 20 4F 4B    		STR_LCD16 DEFM "LCD 16x2 OK"	;
750)   8499 0A 0D 00    		 DB 10,13,0   	;
 14)   849C E5          		SCCLL: PUSH HL	;
 15)   849D F5          		 PUSH AF	;
 16)   849E 21 10 85    		 LD HL, STCL4        ;40 LINE CLEAR	;40 LINE CLEAR
 17)   84A1 CD F2 84    		 CALL SCPRN1	;
 18)   84A4 F1          		 POP AF	;
 19)   84A5 E1          		 POP HL	;
 20)   84A6 C9          		 RET	;
 23)   84A7 AF          		 XOR A         ;LINE 0	;LINE 0
 24)   84A8 21 1D 86    		 LD HL, SCRDY	;
 25)   84AB CD EF 84    		 CALL SCPRN	;
 26)   84AE C9          		 RET	;
 30)   84AF 06 19       		SCCLS: LD B, 25	;
 31)   84B1 AF          		 XOR A         ;; PRINT STR0 AT LINE 1	;; PRINT STR0 AT LINE 1
 32)   84B2 C5          		TSTLP1: PUSH BC	;
 33)   84B3 CD 9C 84    		 CALL SCCLL	;
 34)   84B6 3C          		 INC A         ; NEXT LINE	; NEXT LINE
 35)   84B7 C1          		 POP BC	;
 36)   84B8 10 F8       		 DJNZ TSTLP1	;
 37)   84BA CD A7 84    		 CALL SCMSG1	;
 38)   84BD C9          		 RET	;
 43)   84BE F5          		PRNRGA: PUSH AF	;
 44)   84BF 06 08       		 LD B, 8	;
 45)   84C1 CB 07       		LPN5: RLC A         ; BIT 7 FIRST	; BIT 7 FIRST
 46)   84C3 F5          		 PUSH AF	;
 47)   84C4 3E 00       		 LD A, 0	;
 48)   84C6 30 02       		 JR NC, SKP5	;
 49)   84C8 3E 01       		 LD A, 1	;
 50)   84CA C6 30       		SKP5:  ADD A, 48	;
 51)   84CC CD D5 84    		 CALL PRNCL        ; PRINT A AT COL,LINE	; PRINT A AT COL,LINE
 52)   84CF 1C          		 INC E	;
 53)   84D0 F1          		 POP AF	;
 54)   84D1 10 EE       		 DJNZ LPN5	;
 55)   84D3 F1          		 POP AF	;
 56)   84D4 C9          		 RET	;
 59)   84D5 E5          		PRNCL: PUSH HL	;
 60)   84D6 D5          		 PUSH DE	;
 61)   84D7 F5          		 PUSH AF	;
 62)   84D8 C5          		 PUSH BC	;
 63)   84D9 21 82 02    		 LD HL, TXTRAM	;
 64)   84DC 42          		 LD B, D        ; D HAS THE LINE	; D HAS THE LINE
 65)   84DD D5          		 PUSH DE	;
 66)   84DE 11 40 00    		 LD DE, 40 + 24        ; FOR 40 COLUMN SCREEN	; FOR 40 COLUMN SCREEN
 67)   84E1 19          		LPN2: ADD HL, DE	;
 68)   84E2 10 FD       		 DJNZ LPN2	;
 69)   84E4 D1          		 POP DE	;
 70)   84E5 43          		 LD B, E        ; E HAS THE COLUMN	; E HAS THE COLUMN
 71)   84E6 23          		LPN3: INC HL	;
 72)   84E7 10 FD       		 DJNZ LPN3	;
 73)   84E9 77          		 LD (HL), A        ; A HAS THE CHAR TO PRINT	; A HAS THE CHAR TO PRINT
 74)   84EA C1          		 POP BC	;
 75)   84EB F1          		 POP AF	;
 76)   84EC D1          		 POP DE	;
 77)   84ED E1          		 POP HL	;
 78)   84EE C9          		 RET	;
 81)   84EF CD 9C 84    		SCPRN: CALL SCCLL        ; CLEAR THE LINE	; CLEAR THE LINE
 82)   84F2 E5          		SCPRN1: PUSH HL	;
 83)   84F3 21 82 02    		 LD HL, TXTRAM	;
 84)   84F6 B7          		 OR A	;
 85)   84F7 28 07       		 JR Z, SCSKIP        ;SKIP FOR LINE 0	;SKIP FOR LINE 0
 86)   84F9 47          		 LD B, A	;
 87)   84FA 11 40 00    		 LD DE, 40 + 24        ; FOR 40 COLUMN SCREEN	; FOR 40 COLUMN SCREEN
 88)   84FD 19          		LPN1: ADD HL, DE	;
 89)   84FE 10 FD       		 DJNZ LPN1	;
 90)   8500 EB          		SCSKIP: EX DE, HL	;
 91)   8501 E1          		 POP HL	;
 92)   8502 7E          		SCLP: LD A, (HL)	;
 93)   8503 B7          		 OR A	;
 94)   8504 28 09       		 JR Z, SCEXT	;
 95)   8506 FE 1F       		 CP 31	;
 96)   8508 38 02       		 JR C,SCLPSKIP	;
 97)   850A 12          		 LD (DE), A	;
 98)   850B 13          		 INC DE	;
 99)   850C 23          		SCLPSKIP: INC HL	;
100)   850D 18 F3       		 JR SCLP	;
101)   850F C9          		SCEXT: RET	;
103)   8510 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8514 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8518 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   851C 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8520 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8524 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8528 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   852C 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8530 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8534 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8538 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   853C 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8540 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8544 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8548 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   854C 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8550 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8554 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8558 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   855C 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8560 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8564 20 20 20 20 		STCL4: DEFM "                                                                                         "	;
103)   8568 20          		STCL4: DEFM "                                                                                         "	;
104)   8569 00          		 DB 0	;
106)   856A 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   856E 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   8572 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   8576 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   857A 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   857E 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   8582 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   8586 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   858A 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   858E 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   8592 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   8596 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   859A 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   859E 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85A2 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85A6 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85AA 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85AE 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85B2 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85B6 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85BA 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85BE 20 20 20 20 		STCL8: DEFM "                                                                                         "	;
106)   85C2 20          		STCL8: DEFM "                                                                                         "	;
107)   85C3 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85C7 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85CB 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85CF 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85D3 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85D7 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85DB 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85DF 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85E3 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85E7 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85EB 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85EF 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85F3 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85F7 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85FB 20 20 20 20 		 DEFM "                                                                                         "	;
107)   85FF 20 20 20 20 		 DEFM "                                                                                         "	;
107)   8603 20 20 20 20 		 DEFM "                                                                                         "	;
107)   8607 20 20 20 20 		 DEFM "                                                                                         "	;
107)   860B 20 20 20 20 		 DEFM "                                                                                         "	;
107)   860F 20 20 20 20 		 DEFM "                                                                                         "	;
107)   8613 20 20 20 20 		 DEFM "                                                                                         "	;
107)   8617 20 20 20 20 		 DEFM "                                                                                         "	;
107)   861B 20          		 DEFM "                                                                                         "	;
108)   861C 00          		 DB 0	;
110)   861D 53 43 52 45 		SCRDY: DEFM "SCREEN READY!!!"	;
110)   8621 45 4E 20 52 		SCRDY: DEFM "SCREEN READY!!!"	;
110)   8625 45 41 44 59 		SCRDY: DEFM "SCREEN READY!!!"	;
110)   8629 21 21 21    		SCRDY: DEFM "SCREEN READY!!!"	;
111)   862C 00          		 DB 0	;
 16)   862D 	            		 RBR EQU DEVSER+0       ;	;
 17)   862D 	            		 MCR EQU DEVSER+04	;
 18)   862D 	            		 LSR EQU DEVSER+05	;
 34)   862D 04          		 DEFB 4	;
 35)   862E 05          		 DEFB RS2OIN-$        ;OPEN IN	;OPEN IN
 36)   862F 04          		 DEFB RS2OOT-$        ;OPEN OUT	;OPEN OUT
 37)   8630 10          		 DEFB RS2INP-$        ;INPUT BYTE	;INPUT BYTE
 38)   8631 2A          		 DEFB RS2OTP-$        ;OUTPUT BYTE	;OUTPUT BYTE
 39)   8632 0A          		 DEFB RS2CLS-$        ;CLOSE	;CLOSE
 51)   8633 C5          		RS2OOT: PUSH BC        ;OPENOUT	;OPENOUT
 52)   8634 01 01 00    		 LD BC, 1        ;NO OF BYTES REQUIRED	;NO OF BYTES REQUIRED
 53)   8637 E7 37       		 DEFW ZMKBUFF        ;	;
 54)   8639 C1          		 POP BC         ;	;
 55)   863A D8          		 RET C         ;	;
 57)   863B 72          		 LD (HL), D        ;PORT NUMBER	;PORT NUMBER
 58)   863C AF          		RS2CLS: XOR A         ; CLOSE STREAM	; CLOSE STREAM
 59)   863D 47          		 LD B A         ;	;
 60)   863E 4F          		 LD C A         ;	;
 61)   863F C9          		 RET         ;	;
 71)   8640 F3          		RS2INP: DI         ;	;
 72)   8641 21 24 00    		 LD HL ENREGMAP        ;	;
 73)   8644 CB 86       		 RES VIDEO, (HL)       ; NO VIDEO	; NO VIDEO
 74)   8646 7E          		 LD A, (HL)	;
 75)   8647 D3 07       		 OUT (ENREG) A        ;	;
 76)   8649 3E 01       		 LD A, 1	;
 77)   864B D3 24       		 OUT (MCR), A	;
 78)   864D CD 6B 86    		 CALL MWAIT        ;	;
 79)   8650 AF          		 XOR A         ;NOT ready to receive SIGNAL DSR 0	;NOT ready to receive SIGNAL DSR 0
 80)   8651 D3 24       		 OUT (MCR), A	;
 81)   8653 DB 20       		 IN A, (RBR)        ;GET THE CHAR	;GET THE CHAR
 82)   8655 CD 48 E5    		 CALL STOPTV        ;	;
 83)   8658 FB          		 EI         ;	;
 84)   8659 B7          		 OR A         ;	;
 85)   865A C9          		 RET	;
 88)   865B 4F          		RS2OTP: LD C, A        ;	;
 94)   865C F3          		 DI         ;	;
 95)   865D CD 1C E2    		 CALL $E21C        ;NOVID ;	;NOVID ;
 96)   8660 79          		 LD A, C	;
 97)   8661 CD 07 80    		 CALL $8007        ;RSTX   ;SEND CHAR IN A	;RSTX   ;SEND CHAR IN A
 98)   8664 CD 48 E5    		 CALL STOPTV        ;	;
 99)   8667 FB          		 EI         ;	;
100)   8668 2B          		 DEC HL         ;	;
101)   8669 B7          		 OR A         ;	;
102)   866A C9          		 RET         ;	;
105)   866B 21 00 64    		MWAIT: LD HL 25600	;
107)   866E DB 25       		MWAIT2: IN A, (LSR)	;
108)   8670 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
109)   8671 D8          		 RET C	;
110)   8672 10 FA       		 DJNZ MWAIT2	;
111)   8674 DB 25       		 IN A, (LSR)	;
112)   8676 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
113)   8677 D8          		 RET C	;
114)   8678 2D          		 DEC L	;
115)   8679 DB 25       		 IN A, (LSR)	;
116)   867B 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
117)   867C D8          		 RET C	;
118)   867D C2 6E 86    		 JP NZ MWAIT2	;
119)   8680 DB 25       		 IN A, (LSR)	;
120)   8682 1F          		 RRA         ;check d0 ('DATA')	;check d0 ('DATA')
121)   8683 D8          		 RET C	;
122)   8684 25          		 DEC H	;
123)   8685 DB 25       		 IN A, (LSR)	;
124)   8687 1F          		 RRA	;
125)   8688 D8          		 RET C	;
126)   8689 C2 6E 86    		 JP NZ, MWAIT2	;
127)   868C F1          		 POP AF         ;POP LAST RETURN ADDRESS FROM STACK	;POP LAST RETURN ADDRESS FROM STACK
128)   868D 3E C8       		 LD A, 200        ;TIMEOUT ERROR	;TIMEOUT ERROR
129)   868F 37          		 SCF	;
130)   8690 C9          		 RET         ;RETURN TO BASIC WITH ERROR TIMEOUT	;RETURN TO BASIC WITH ERROR TIMEOUT
 26)   8691 04          		 DEFB 4                                                          ;COUNT OF DISPLACEMENTS-1	;COUNT OF DISPLACEMENTS-1
 27)   8692 18          		 DEFB SG2OIN-$        ;OPEN IN	;OPEN IN
 28)   8693 1B          		 DEFB SG2OOT-$        ;OPEN OUT	;OPEN OUT
 29)   8694 87          		 DEFB SG2INP-$        ;INPUT BYTE	;INPUT BYTE
 30)   8695 F3          		 DEFB SG2OTP-$        ;OUTPUT BYTE	;OUTPUT BYTE
 31)   8696 6A          		 DEFB SG2CLS-$        ;CLOSE	;CLOSE
 34)   8697 11 F0 00    		CPYFNAME:      LD DE,STRGBUFF	;
 35)   869A ED B0       		               LDIR	;
 36)   869C C9          		               RET	;
 40)   869D E5          		MKCAPS:        PUSH HL	;
 41)   869E 7E          		MC_NXT:        LD A,(HL)	;
 42)   869F B7          		               OR A	;
 43)   86A0 28 06       		               JR Z,MC_EXIT	;
 44)   86A2 E7 2F       		               DEFW ZTTCAPS	;
 45)   86A4 77          		               LD (HL),A	;
 46)   86A5 23          		               INC HL	;
 47)   86A6 18 F6       		               JR MC_NXT	;
 48)   86A8 E1          		MC_EXIT:       POP HL	;
 49)   86A9 C9          		               RET	;
 76)   86AA 3E 00       		SG2OIN: LD A,0        ;OPENIN	;OPENIN
 77)   86AC 18 02       		               JR SG2OPN	;
 80)   86AE 3E 01       		SG2OOT: LD A,1	;
 81)   86B0 E5          		SG2OPN:        PUSH HL	;
 82)   86B1 C5          		               PUSH BC        ;OPENOUT	;OPENOUT
 83)   86B2 F5          		               PUSH AF	;
 84)   86B3 01 10 02    		 LD BC, SPCNEED        ;NO OF BYTES REQUIRED	;NO OF BYTES REQUIRED
 85)   86B6 E7 37       		 DEFW ZMKBUFF        ;	;
 86)   86B8 D1          		               POP DE	;
 87)   86B9 C1          		 POP BC                                 	;
 88)   86BA 38 41       		 JR C, ERREXIT                	;
 89)   86BC E5          		               PUSH HL                                                         ;SAVE START OF STRUCT	;SAVE START OF STRUCT
 90)   86BD 7A          		               LD A,D	;
 92)   86BE 77          		 LD (HL), A        ;OPEN TYPE	;OPEN TYPE
 93)   86BF 23          		               INC HL	;
 94)   86C0 36 00       		               LD (HL),0                                                       ;FILE POS ZERO	;FILE POS ZERO
 95)   86C2 23          		               INC HL	;
 96)   86C3 36 00       		               LD (HL),0	;
 97)   86C5 23          		               INC HL	;
 98)   86C6 36 00       		               LD (HL),0                                                     ;BUF POS 0 	;BUF POS 0
 99)   86C8 23          		               INC HL	;
100)   86C9 36 00       		               LD (HL),0	;
101)   86CB 23          		               INC HL	;
102)   86CC E5          		               PUSH HL	;
103)   86CD C5          		               PUSH BC	;
104)   86CE 01 14 00    		               LD BC,BYTREAD-FNAMEIX                                           ;SKIP FILENAME	;SKIP FILENAME
105)   86D1 09          		               ADD HL,BC	;
106)   86D2 C1          		               POP BC	;
107)   86D3 36 00       		               LD (HL),0                                                       ;BYTES READ TO 0 	;BYTES READ TO 0
108)   86D5 23          		               INC HL	;
109)   86D6 36 00       		               LD (HL),0                                                     	;
110)   86D8 D1          		               POP DE                                                          ;DE AT FNAMEIX       	;DE AT FNAMEIX
111)   86D9 DD E1       		               POP IX                                                          ;IX THE START OF STRUCT                	;IX THE START OF STRUCT
112)   86DB E1          		               POP HL                                                          ;HL THE FILE NAME	;HL THE FILE NAME
113)   86DC D5          		               PUSH DE                                                         ;SAVE THE START OF FILENAME        	;SAVE THE START OF FILENAME
114)   86DD ED B0       		               LDIR                                                            ;TRANSFER THE FNAME TO OUR STRUCT        	;TRANSFER THE FNAME TO OUR STRUCT
115)   86DF AF          		               XOR A	;
116)   86E0 12          		               LD (DE),A                                                       ;NULL TERMINATED STRING	;NULL TERMINATED STRING
117)   86E1 E1          		               POP HL                                                          ;START OF FNAME                	;START OF FNAME
118)   86E2 CD 9D 86    		               CALL MKCAPS                                                     ;make hl filename caps  	;make hl filename caps
119)   86E5 DD 7E 00    		               LD A,(IX)	;
120)   86E8 FE 00       		               CP 0	;
121)   86EA 20 0F       		               JR NZ,SG2EX                                                      ;IF FILE OPEN OUT EXIT	;IF FILE OPEN OUT EXIT
123)   86EC 01 00 00    		               LD BC,0	;
124)   86EF 13          		               INC DE	;
125)   86F0 F3          		               DI	;
126)   86F1 CD C2 8D    		               CALL STRG_OPENCDIR ;OPEN UP TO CURRENT DIR  	;OPEN UP TO CURRENT DIR
127)   86F4 CD 1F 90    		               CALL STRG_LOADFILE	;
128)   86F7 FB          		               EI	;
129)   86F8 3E 96       		               LD A,ERROPF                                                     ;ERROR NO IF FILE ERROR	;ERROR NO IF FILE ERROR
130)   86FA D8          		               RET C	;
131)   86FB AF          		SG2EX:         XOR A	;
132)   86FC C9          		               RET	;
135)   86FD E1          		ERREXIT:       POP HL	;
136)   86FE 37          		               SCF	;
137)   86FF C9          		               RET	;
139)   8700 7E          		SG2CLS: LD A,(HL)	;
140)   8701 FE 01       		               CP 1                                                            ;CHECK IF OPENOUT	;CHECK IF OPENOUT
141)   8703 20 12       		               JR NZ,SCL_EX	;
148)   8705 DD E5       		               PUSH IX	;
149)   8707 E5          		               PUSH HL	;
150)   8708 DD E1       		               POP IX	;
151)   870A 01 05 00    		               LD BC,FNAMEIX	;
152)   870D 09          		               ADD HL,BC	;
153)   870E DD 4E 03    		               LD C,(IX+BUFFOFS)	;
154)   8711 DD 46 04    		               LD B,(IX+BUFFOFS+1)	;
155)   8714 CD B7 87    		               CALL SO_STFILE	;
156)   8717 AF          		SCL_EX:        XOR A         ; CLOSE STREAM	; CLOSE STREAM
157)   8718 47          		 LD B A         ;	;
158)   8719 4F          		 LD C A         ;	;
159)   871A C9          		 RET         ;	;
166)   871B DD E5       		SG2INP:        PUSH IX	;
167)   871D CD 23 87    		               CALL SG2INP2	;
168)   8720 DD E1       		               POP IX	;
169)   8722 C9          		               RET	;
171)   8723 7E          		SG2INP2:       LD A,(HL)	;
172)   8724 FE 00       		               CP 0	;
173)   8726 3E 9B       		               LD A,ERRTRA	;
174)   8728 37          		               SCF	;
175)   8729 C0          		               RET NZ                                                          ;IF NOT INPUT THEN ERROR                	;IF NOT INPUT THEN ERROR
176)   872A CD E2 87    		               CALL SGCHKEOF                                                   ;TEST EOF	;TEST EOF
177)   872D 23          		               INC HL                	;
178)   872E E5          		               PUSH HL                                                         ;SAVE OFFSET POS	;SAVE OFFSET POS
179)   872F 4E          		               LD C,(HL)	;
180)   8730 23          		               INC HL	;
181)   8731 46          		               LD B,(HL)                                                       ;BC THE FILE OFFS	;BC THE FILE OFFS
182)   8732 23          		               INC HL	;
183)   8733 5E          		               LD E,(HL)	;
184)   8734 23          		               INC HL	;
185)   8735 56          		               LD D,(HL)                                                       ;DE THE BUFFER OFFS	;DE THE BUFFER OFFS
186)   8736 23          		               INC HL                                                          ;NOW ON FILENAME OFFS	;NOW ON FILENAME OFFS
188)   8737 3E 97       		               LD A,ERREOF	;
189)   8739 DA FD 86    		               JP C,ERREXIT                                                    ;ON C EOF REACHED                	;ON C EOF REACHED
190)   873C 28 0E       		               JR Z,RDFMFILE                                                   ;ON Z=EOB READ FROM FILE	;ON Z=EOB READ FROM FILE
199)   873E 01 16 00    		RDFMBUFF:      LD BC,FBUFFIX-FNAMEIX                                           ;500 BYTES BUFFER OFFSET	;500 BYTES BUFFER OFFSET
200)   8741 09          		               ADD HL,BC                                                       ;HL ON BUFFER        	;HL ON BUFFER
201)   8742 19          		               ADD HL,DE                                                       ;HL ON NXT BYTE INSIDE BUFFER	;HL ON NXT BYTE INSIDE BUFFER
203)   8743 7E          		               LD A,(HL)                                                       ;READ BYTE TO A                	;READ BYTE TO A
204)   8744 E1          		               POP HL                                                          ;HL AT THE FILE OFFSET	;HL AT THE FILE OFFSET
205)   8745 23          		               INC HL	;
206)   8746 23          		               INC HL                                                          ;AT THE BUFFER OFFSET	;AT THE BUFFER OFFSET
207)   8747 13          		               INC DE                                                          ;POINT TO NEXT BYTE	;POINT TO NEXT BYTE
208)   8748 73          		               LD (HL),E                                                       ;SAVE 	;SAVE
209)   8749 23          		               INC HL	;
210)   874A 72          		               LD (HL),D	;
211)   874B C9          		               RET	;
212)   874C E5          		RDFMFILE:      PUSH HL                                                         ;HL FILENAME        	;HL FILENAME
213)   874D D1          		               POP DE                                                          ;DE FILENAME	;DE FILENAME
214)   874E EB          		               EX DE,HL	;
215)   874F C5          		               PUSH BC	;
216)   8750 01 16 00    		               LD BC,FBUFFIX-FNAMEIX                                           ;500 BYTES BUFFER OFFSET	;500 BYTES BUFFER OFFSET
217)   8753 09          		               ADD HL,BC	;
218)   8754 C1          		               POP BC	;
219)   8755 EB          		               EX DE,HL                                                        ;HL TO FNAME OFFSET, DE TO BUFFER OFFSET	;HL TO FNAME OFFSET, DE TO BUFFER OFFSET
222)   8756 D5          		               PUSH DE                                                         ;BC THE FILE OFFSET TO READ FROM	;BC THE FILE OFFSET TO READ FROM
225)   8757 F3          		               DI                                                                	;
226)   8758 CD C2 8D    		               CALL STRG_OPENCDIR ;OPEN UP TO CURRENT DIR                                                                                	;OPEN UP TO CURRENT DIR
227)   875B CD 9F 90    		               CALL STRG_READBUFR                                              ;READ 500 BYTES FROM FILE TO BUFFER BC= BYTES READ	;READ 500 BYTES FROM FILE TO BUFFER BC= BYTES READ
228)   875E FB          		               EI	;
229)   875F D1          		               POP DE                                                          ;THE BUFFER TO READ THE BYTE	;THE BUFFER TO READ THE BYTE
230)   8760 3E 98       		               LD A,ERRRDF                                                     ;ERROR CODE CAN'T READ FROM FILE	;ERROR CODE CAN'T READ FROM FILE
231)   8762 DA FD 86    		               JP C,ERREXIT	;
233)   8765 E1          		               POP HL                                                          ;GET FILE OFFSET POS ADDR	;GET FILE OFFSET POS ADDR
234)   8766 D5          		               PUSH DE                                                         ;SAVE START OF BUFFER	;SAVE START OF BUFFER
235)   8767 EB          		               EX DE,HL                                                        ;DE THE OFFSET ADDR	;DE THE OFFSET ADDR
236)   8768 1A          		               LD A,(DE)                                                       ;OFFSET OF FILE 	;OFFSET OF FILE
237)   8769 6F          		               LD L,A	;
238)   876A 13          		               INC DE	;
239)   876B 1A          		               LD A,(DE)	;
240)   876C 67          		               LD H,A	;
241)   876D 09          		               ADD HL,BC                                                       ;ADD NEW READ BYTES TO PREVIOUS OFFSET	;ADD NEW READ BYTES TO PREVIOUS OFFSET
242)   876E EB          		               EX DE,HL                                                        ;HL THE OFFSET ADDR, DE THE NEW OFFSET	;HL THE OFFSET ADDR, DE THE NEW OFFSET
243)   876F 72          		               LD (HL),D                                                       ;SAVE BACK	;SAVE BACK
244)   8770 2B          		               DEC HL	;
245)   8771 73          		               LD (HL),E	;
246)   8772 23          		               INC HL	;
247)   8773 23          		               INC HL                                                          ;TO THE BUF OFFSET 	;TO THE BUF OFFSET
248)   8774 3E 01       		               LD A,1	;
249)   8776 77          		               LD (HL),A                                                       ;SET THE BUF OFFS TO 1	;SET THE BUF OFFS TO 1
250)   8777 23          		               INC HL	;
251)   8778 AF          		               XOR A	;
252)   8779 77          		               LD (HL),A     	;
253)   877A 23          		               INC HL                                                  	;
256)   877B C5          		               PUSH BC	;
257)   877C 01 14 00    		               LD BC,20	;
258)   877F 09          		               ADD HL,BC                                                       ;NOW AT BYTREAD	;NOW AT BYTREAD
259)   8780 C1          		               POP BC	;
260)   8781 71          		               LD (HL),C                                                       ;SAVE BYTES READ FROM FILE	;SAVE BYTES READ FROM FILE
261)   8782 23          		               INC HL	;
262)   8783 70          		               LD (HL),B	;
263)   8784 D1          		               POP DE                                                          ;GET START OF BUFFER	;GET START OF BUFFER
264)   8785 AF          		               XOR A                                                           ;CLEAR CARRY FLAG	;CLEAR CARRY FLAG
265)   8786 1A          		               LD A,(DE)                                                       ;READ THE 1ST BYTE TO A	;READ THE 1ST BYTE TO A
266)   8787 C9          		               RET	;
275)   8788 DD E5       		SG2OTP:        PUSH IX	;
276)   878A E5          		               PUSH HL	;
277)   878B DD E1       		               POP IX	;
278)   878D 57          		               LD D,A                                                          ;SAVE BYTE TO BE WRITTEN	;SAVE BYTE TO BE WRITTEN
279)   878E 7E          		               LD A,(HL)	;
280)   878F FE 00       		               CP 0	;
281)   8791 3E 9B       		               LD A,ERRTRA	;
282)   8793 37          		               SCF	;
283)   8794 28 47       		               JR Z,SO_EX	;
284)   8796 7A          		               LD A,D                                                          ;RESTORE A BYTE TO WRITE	;RESTORE A BYTE TO WRITE
285)   8797 01 05 00    		               LD BC,FNAMEIX	;
286)   879A 09          		               ADD HL,BC                	;
287)   879B DD E5       		               PUSH IX	;
288)   879D D1          		               POP DE	;
289)   879E EB          		               EX DE,HL	;
290)   879F 01 1B 00    		               LD BC,FBUFFIX	;
291)   87A2 09          		               ADD HL,BC                	;
292)   87A3 DD 4E 03    		               LD C,(IX+BUFFOFS)	;
293)   87A6 DD 46 04    		               LD B,(IX+BUFFOFS+1)	;
294)   87A9 09          		               ADD HL,BC	;
295)   87AA EB          		               EX DE,HL                                	;
296)   87AB 12          		               LD (DE),A	;
298)   87AC 79          		               LD A,C	;
299)   87AD FE F3       		               CP $F3                                                          ;499 WE START AT 0  	;499 WE START AT 0
300)   87AF 20 25       		               JR NZ,SO_BUFFNXT	;
301)   87B1 78          		               LD A,B	;
302)   87B2 FE 01       		               CP $01	;
303)   87B4 20 20       		               JR NZ,SO_BUFFNXT	;
304)   87B6 03          		               INC BC                                                          ;500	;500
312)   87B7 EB          		 SO_STFILE:    EX DE,HL	;
313)   87B8 DD E5       		               PUSH IX	;
314)   87BA E1          		               POP HL	;
315)   87BB C5          		               PUSH BC	;
316)   87BC 01 1B 00    		               LD BC,FBUFFIX	;
317)   87BF 09          		               ADD HL,BC	;
318)   87C0 C1          		               POP BC	;
319)   87C1 EB          		               EX DE,HL	;
322)   87C2 CD C2 8D    		               CALL STRG_OPENCDIR ;OPEN UP TO CURRENT DIR	;OPEN UP TO CURRENT DIR
323)   87C5 CD F9 91    		               CALL STRG_WRITEBUFR                             ;WRITES 500 BYTES FROM BUFFER DE TO THE END OF THE FILE	;WRITES 500 BYTES FROM BUFFER DE TO THE END OF THE FILE
324)   87C8 3E 96       		               LD A,ERROPF	;
325)   87CA 38 06       		               JR C,SO_ERROUT	;
326)   87CC 3E 99       		               LD A,ERRWTF	;
327)   87CE 37          		               SCF	;
328)   87CF 20 01       		               JR NZ,SO_ERROUT	;
329)   87D1 AF          		               XOR A	;
330)   87D2 01 00 00    		SO_ERROUT:     LD BC,0                                         ;ZERO BUFFER OFFSET	;ZERO BUFFER OFFSET
331)   87D5 16          		               DB $16                                          ;SKIP INC BC LD D,NN	;SKIP INC BC LD D,NN
332)   87D6 03          		SO_BUFFNXT:    INC BC                                          	;
333)   87D7 DD 71 03    		               LD (IX+BUFFOFS),C	;
334)   87DA DD 70 04    		               LD (IX+BUFFOFS+1),B	;
335)   87DD DD E1       		SO_EX          POP IX	;
336)   87DF FE 00       		               CP 0	;
337)   87E1 C9          		               RET	;
344)   87E2 DD E5       		SGCHKEOF:      PUSH IX	;
345)   87E4 D5          		               PUSH DE	;
346)   87E5 C5          		               PUSH BC	;
348)   87E6 E5          		               PUSH HL	;
349)   87E7 DD E1       		               POP IX	;
350)   87E9 DD 5E 03    		               LD E,(IX+BUFFOFS)	;
351)   87EC DD 56 04    		               LD D,(IX+BUFFOFS+1)	;
352)   87EF DD 4E 19    		               LD C,(IX+BYTREAD)	;
353)   87F2 DD 46 1A    		               LD B,(IX+BYTREAD+1)	;
355)   87F5 78          		               LD A,B	;
356)   87F6 B1          		               OR C	;
357)   87F7 3E 03       		               LD A,3	;
358)   87F9 28 1C       		               JR Z, SGEFEXIT                                                  ;Z=EOB	;Z=EOB
359)   87FB EB          		               EX DE,HL                                                        ;SAVE HL SET HL=DE	;SAVE HL SET HL=DE
360)   87FC B7          		               OR A	;
361)   87FD ED 42       		               SBC HL,BC	;
362)   87FF 7C          		               LD A,H	;
363)   8800 B5          		               OR L	;
364)   8801 EB          		               EX DE,HL                                                        ;RESTORE HL	;RESTORE HL
365)   8802 3E 01       		               LD A,1                                                          ;NO EOF NO EOB = NZ	;NO EOF NO EOB = NZ
366)   8804 20 11       		               JR NZ,SGEFEXIT	;
368)   8806 78          		               LD A,B	;
369)   8807 D6 01       		               SUB $01	;
370)   8809 20 09       		               JR NZ, SGDOEOF	;
371)   880B 79          		               LD A,C	;
372)   880C D6 F4       		               SUB $F4	;
373)   880E 20 04       		               JR NZ, SGDOEOF	;
374)   8810 3E 02       		               LD A,2                                                          ;Z MEANS EOB END OF BUFFER                	;Z MEANS EOB END OF BUFFER
375)   8812 18 03       		               JR  SGEFEXIT	;
377)   8814 3E 97       		SGDOEOF:       LD A,ERREOF                                                           ;RETURN 0 ON EOF	;RETURN 0 ON EOF
378)   8816 37          		               SCF         	;
379)   8817 C1          		SGEFEXIT:      POP BC	;
380)   8818 D1          		               POP DE	;
381)   8819 DD E1       		               POP IX	;
382)   881B C9          		               RET	;
385)   881C E5          		PRNHL:         PUSH HL	;
386)   881D C5          		               PUSH BC	;
387)   881E D5          		               PUSH DE	;
388)   881F CD B6 9C    		 CALL B2D16	;
389)   8822 21 CB 00    		 LD HL,B2DBUF	;
390)   8825 CD 4A 9D    		 CALL SKIPSPC	;
391)   8828 CD 93 8C    		 CALL RS_TXT	;
392)   882B D1          		               POP DE	;
393)   882C C1          		               POP BC	;
394)   882D E1          		               POP HL	;
395)   882E C9          		               RET	;
397)   882F E5          		PRINTDBG:      PUSH HL	;
398)   8830 C5          		               PUSH BC	;
399)   8831 D5          		               PUSH DE	;
400)   8832 F5          		               PUSH AF	;
402)   8833 CD 1C 88    		               CALL PRNHL	;
403)   8836 D5          		               PUSH DE	;
404)   8837 C5          		               PUSH BC	;
405)   8838 CD 26 80    		 CALL OS_PRINTMSG	;
406)   883B 20 48 4C    		 DEFM " HL"	;
407)   883E 0A 0D 00    		 DB 10,13,0	;
408)   8841 C1          		               POP BC	;
409)   8842 D1          		               POP DE	;
411)   8843 D5          		               PUSH DE	;
412)   8844 E1          		               POP HL	;
413)   8845 CD 1C 88    		               CALL PRNHL	;
414)   8848 D5          		               PUSH DE	;
415)   8849 C5          		               PUSH BC	;
416)   884A CD 26 80    		 CALL OS_PRINTMSG	;
417)   884D 20 44 45    		 DEFM " DE"	;
418)   8850 0A 0D 00    		 DB 10,13,0	;
419)   8853 C1          		               POP BC	;
420)   8854 D1          		               POP DE	;
422)   8855 C5          		               PUSH BC	;
423)   8856 E1          		               POP HL	;
424)   8857 CD 1C 88    		               CALL PRNHL	;
425)   885A D5          		               PUSH DE	;
426)   885B C5          		               PUSH BC	;
427)   885C CD 26 80    		 CALL OS_PRINTMSG	;
428)   885F 20 42 43    		 DEFM " BC"	;
429)   8862 0A 0D 00    		 DB 10,13,0	;
430)   8865 C1          		               POP BC	;
431)   8866 D1          		               POP DE	;
434)   8867 F1          		               POP AF	;
435)   8868 D1          		               POP DE	;
436)   8869 C1          		               POP BC	;
437)   886A E1          		               POP HL	;
438)   886B C9          		               RET	;
442)   886C F5          		CLRBUFR:       PUSH AF	;
443)   886D E5          		               PUSH HL	;
444)   886E D5          		               PUSH DE	;
445)   886F C5          		               PUSH BC	;
446)   8870 AF          		               XOR A	;
447)   8871 12          		               LD (DE),A	;
448)   8872 D5          		               PUSH DE	;
449)   8873 E1          		               POP HL	;
450)   8874 13          		               INC DE	;
451)   8875 01 F3 01    		               LD BC,499	;
452)   8878 ED B0       		               LDIR        	;
453)   887A C1          		               POP BC	;
454)   887B D1          		               POP DE	;
455)   887C E1          		               POP HL	;
456)   887D F1          		               POP AF	;
457)   887E C9          		               RET	;
462)   887F 04          		 DEFB 4                                                          ;COUNT OF DISPLACEMENTS-1	;COUNT OF DISPLACEMENTS-1
463)   8880 2A          		 DEFB SG2OIN-$        ;OPEN IN	;OPEN IN
464)   8881 2D          		 DEFB SG2OOT-$        ;OPEN OUT	;OPEN OUT
465)   8882 99          		 DEFB SG2INP-$        ;INPUT BYTE	;INPUT BYTE
466)   8883 05          		 DEFB SG2OTP-$        ;OUTPUT BYTE	;OUTPUT BYTE
467)   8884 7C          		 DEFB SG2CLS-$        ;CLOSE	;CLOSE
 21)   8885 21 58 00    		STNEWD: LD HL, $58        ;DEVTAB	;DEVTAB
 22)   8888 11 95 88    		 LD DE, DEVTAB        ; NEW TABLE SET	; NEW TABLE SET
 23)   888B 73          		 LD (HL), E	;
 24)   888C 23          		 INC HL	;
 25)   888D 72          		 LD (HL), D	;
 26)   888E 21 13 00    		 LD HL, DEFSTOR	;
 27)   8891 3E 01       		 LD A, USESTORDEV        ;DEFAULT STORE DEVICE IS 12 NB STORAGE MODULE	;DEFAULT STORE DEVICE IS 12 NB STORAGE MODULE
 28)   8893 77          		 LD (HL), A	;
 29)   8894 C9          		 RET	;
 33)   8895 11          		DEVTAB: DEFB 17        ;number of entries ;number of entries	;number of entries ;number of entries
 34)   8896 83 E6       		 DEFW TVIO        ;	;
 35)   8898 EE ED       		 DEFW TP1IO        ;	;
 36)   889A F4 ED       		 DEFW TP2IO        ;	;
 37)   889C 50 E6       		 DEFW LIIO        ;	;
 38)   889E 75 E6       		 DEFW TLIO        ;	;
 39)   88A0 36 A1       		 DEFW NKBWIO        ;	;
 40)   88A2 1A A1       		 DEFW NKBIIO        ;	;
 41)   88A4 1F E4       		 DEFW UPIO        ;	;
 42)   88A6 3C E4       		 DEFW LPIO        ;	;
 43)   88A8 2F E4       		 DEFW JGIO        ;	;
 44)   88AA 19 E4       		 DEFW DUMMY        ;	;
 45)   88AC 96 A5       		 DEFW GRAPH        ;  	;
 46)   88AE 91 86       		               DEFW SG2IO        ;MY STORAGE DEVICE 13 BDISCIO BINARY SERIAL	;MY STORAGE DEVICE 13 BDISCIO BINARY SERIAL
 47)   88B0 91 86       		               DEFW SG2IO                                                      ;MY STORAGE DEVICE 14 TDISCIO SAME AS 13 FOR ME	;MY STORAGE DEVICE 14 TDISCIO SAME AS 13 FOR ME
 48)   88B2 91 86       		               DEFW SG2IO                                                      ;MY STORAGE DEVICE 15 RDISCIO RANDOM ACCESS	;MY STORAGE DEVICE 15 RDISCIO RANDOM ACCESS
 49)   88B4 91 86       		               DEFW SG2IO                                                      ;MY STORAGE DEVICE 16 SDISCIO DIR COMMANDS	;MY STORAGE DEVICE 16 SDISCIO DIR COMMANDS
 50)   88B6 2D 86       		               DEFW RS2IO        ;MY SERIAL DEVICE 17	;MY SERIAL DEVICE 17
  6)   88B8 FE 00       		 CP 0	;
  7)   88BA C8          		 RET Z	;
  8)   88BB CD 5F 89    		 CALL NBLOOKASC	;
  9)   88BE C9          		 RET	;
 12)   88BF 21 DD 88    		NBLOOK: LD HL, NBTAB	;
 13)   88C2 06 00       		 LD B, 0	;
 14)   88C4 4F          		 LD C, A	;
 15)   88C5 09          		 ADD HL, BC	;
 16)   88C6 7E          		 LD A, (HL)	;
 17)   88C7 FE 00       		 CP 0	;
 18)   88C9 C8          		 RET Z	;
 19)   88CA 21 80 00    		 LD HL, KEYCTR        ;BIT 6=SHIFT BIT 7=CTRL  BIT 6+7=GRPH	;BIT 6=SHIFT BIT 7=CTRL  BIT 6+7=GRPH
 20)   88CD CB 6E       		 BIT 5, (HL)	;
 21)   88CF 28 04       		 JR Z, NOGRPH	;
 22)   88D1 06 C0       		 LD B, 192        ;SET BIT 6 AND 7	;SET BIT 6 AND 7
 23)   88D3 18 06       		 JR NBLKEX	;
 24)   88D5 4F          		NOGRPH: LD C, A	;
 25)   88D6 7E          		 LD A, (HL)	;
 26)   88D7 E6 C0       		 AND 11000000	;
 27)   88D9 47          		 LD B, A	;
 28)   88DA 79          		 LD A, C	;
 29)   88DB B0          		NBLKEX: OR B	;
 30)   88DC C9          		 RET	;
 32)   88DD 00 00 00 00 		NBTAB: DB 0,0,0,0,0,0,0,0,0,0       ;  0-  9	;  0-  9
 32)   88E1 00 00 00 00 		NBTAB: DB 0,0,0,0,0,0,0,0,0,0       ;  0-  9	;  0-  9
 32)   88E5 00 00       		NBTAB: DB 0,0,0,0,0,0,0,0,0,0       ;  0-  9	;  0-  9
 33)   88E7 00 00 00 A4 		 DB 0,0,0,36+128,0,0,0,0,0,0      ; 10- 19 0,0,0,TAB	; 10- 19 0,0,0,TAB
 33)   88EB 00 00 00 00 		 DB 0,0,0,36+128,0,0,0,0,0,0      ; 10- 19 0,0,0,TAB	; 10- 19 0,0,0,TAB
 33)   88EF 00 00       		 DB 0,0,0,36+128,0,0,0,0,0,0      ; 10- 19 0,0,0,TAB	; 10- 19 0,0,0,TAB
 34)   88F1 00 0E 09 00 		 DB 0,14,9,0,0,0,60,45,46,13      ; 20- 29	; 20- 29
 34)   88F5 00 00 3C 2D 		 DB 0,14,9,0,0,0,60,45,46,13      ; 20- 29	; 20- 29
 34)   88F9 2E 0D       		 DB 0,14,9,0,0,0,60,45,46,13      ; 20- 29	; 20- 29
 35)   88FB 08 00 00 3A 		 DB 8,0,0,58,59,44,12,6,7,0      ; 30- 39	; 30- 39
 35)   88FF 3B 2C 0C 06 		 DB 8,0,0,58,59,44,12,6,7,0      ; 30- 39	; 30- 39
 35)   8903 07 00       		 DB 8,0,0,58,59,44,12,6,7,0      ; 30- 39	; 30- 39
 36)   8905 00 0F 39 2B 		 DB 0,15,57,43,10,11,5,0,0,52      ; 40- 49	; 40- 49
 36)   8909 0A 0B 05 00 		 DB 0,15,57,43,10,11,5,0,0,52      ; 40- 49	; 40- 49
 36)   890D 00 34       		 DB 0,15,57,43,10,11,5,0,0,52      ; 40- 49	; 40- 49
 37)   890F 38 29 2A 25 		 DB 56,41,42,37,4,0,0,0,53,51      ; 50- 59	; 50- 59
 37)   8913 04 00 00 00 		 DB 56,41,42,37,4,0,0,0,53,51      ; 50- 59	; 50- 59
 37)   8917 35 33       		 DB 56,41,42,37,4,0,0,0,53,51      ; 50- 59	; 50- 59
 38)   8919 23 03 13 00 		 DB 35,3,19,0,0,54,62,36,38,21      ; 60- 69	; 60- 69
 38)   891D 00 36 3E 24 		 DB 35,3,19,0,0,54,62,36,38,21      ; 60- 69	; 60- 69
 38)   8921 26 15       		 DB 35,3,19,0,0,54,62,36,38,21      ; 60- 69	; 60- 69
 39)   8923 14 00 00 37 		 DB 20,0,0,55,47,39,40,26,28,0      ; 70- 79	; 70- 79
 39)   8927 2F 27 28 1A 		 DB 20,0,0,55,47,39,40,26,28,0      ; 70- 79	; 70- 79
 39)   892B 1C 00       		 DB 20,0,0,55,47,39,40,26,28,0      ; 70- 79	; 70- 79
 40)   892D 00 00 43 00 		 DB 0,0,67,0,86,27,0,0,0,0      ; 80- 89	; 80- 89
 40)   8931 56 1B 00 00 		 DB 0,0,67,0,86,27,0,0,0,0      ; 80- 89	; 80- 89
 40)   8935 00 00       		 DB 0,0,67,0,86,27,0,0,0,0      ; 80- 89	; 80- 89
 41)   8937 1E 00 00 00 		 DB 30,0,0,0,0,0,0,0,0,0      ; 90- 99	; 90- 99
 41)   893B 00 00 00 00 		 DB 30,0,0,0,0,0,0,0,0,0      ; 90- 99	; 90- 99
 41)   893F 00 00       		 DB 30,0,0,0,0,0,0,0,0,0      ; 90- 99	; 90- 99
 42)   8941 00 00 40 00 		 DB 0,0,64,0,0,26+128,0,2,63,0      ;100-109  0,0,64,0,0,END	;100-109  0,0,64,0,0,END
 42)   8945 00 9A 00 02 		 DB 0,0,64,0,0,26+128,0,2,63,0      ;100-109  0,0,64,0,0,END	;100-109  0,0,64,0,0,END
 42)   8949 3F 00       		 DB 0,0,64,0,0,26+128,0,2,63,0      ;100-109  0,0,64,0,0,END	;100-109  0,0,64,0,0,END
 43)   894B 00 00 3D A5 		 DB 0,0,61,37+128,34,0,18,50,31,25     ;110-119  0,0,INS,DEL	;110-119  0,0,INS,DEL
 43)   894F 22 00 12 32 		 DB 0,0,61,37+128,34,0,18,50,31,25     ;110-119  0,0,INS,DEL	;110-119  0,0,INS,DEL
 43)   8953 1F 19       		 DB 0,0,61,37+128,34,0,18,50,31,25     ;110-119  0,0,INS,DEL	;110-119  0,0,INS,DEL
 44)   8955 00 1D 07 1C 		 DB 0,29,7,28,24,20,0,0,0,0      ;120-129	;120-129
 44)   8959 18 14 00 00 		 DB 0,29,7,28,24,20,0,0,0,0      ;120-129	;120-129
 44)   895D 00 00       		 DB 0,29,7,28,24,20,0,0,0,0      ;120-129	;120-129
 47)   895F 21 68 89    		NBLOOKASC:     LD HL, NBRSTAB	;
 48)   8962 06 00       		 LD B, 0	;
 49)   8964 4F          		 LD C, A	;
 50)   8965 09          		 ADD HL, BC	;
 51)   8966 7E          		 LD A, (HL)	;
 52)   8967 C9          		 RET	;
 55)   8968 00 3D 52 12 		NBRSTAB:      DB 0,61,18+64,18,2,0,64,0,64,27+128    ;  0-  9	;  0-  9
 55)   896C 02 00 40 00 		NBRSTAB:      DB 0,61,18+64,18,2,0,64,0,64,27+128    ;  0-  9	;  0-  9
 55)   8970 40 9B       		NBRSTAB:      DB 0,61,18+64,18,2,0,64,0,64,27+128    ;  0-  9	;  0-  9
 56)   8972 22 32 00 1E 		 DB 34,50,0,30,0,0,0,0,0,0     ; 10- 19 	; 10- 19
 56)   8976 00 00 00 00 		 DB 34,50,0,30,0,0,0,0,0,0     ; 10- 19 	; 10- 19
 56)   897A 00 00       		 DB 34,50,0,30,0,0,0,0,0,0     ; 10- 19 	; 10- 19
 57)   897C 00 00 00 00 		 DB 0,0,0,0,0,0,0,31,28+128,29+128    ; 20- 29	; 20- 29
 57)   8980 00 00 00 1F 		 DB 0,0,0,0,0,0,0,31,28+128,29+128    ; 20- 29	; 20- 29
 57)   8984 9C 9D       		 DB 0,0,0,0,0,0,0,31,28+128,29+128    ; 20- 29	; 20- 29
 58)   8986 00 00 0F 49 		 DB 0,0,15,9+64,8+64,7+64,6+64,5+64,0,3+64          ; 30- 39  	; 30- 39
 58)   898A 48 47 46 45 		 DB 0,0,15,9+64,8+64,7+64,6+64,5+64,0,3+64          ; 30- 39  	; 30- 39
 58)   898E 00 43       		 DB 0,0,15,9+64,8+64,7+64,6+64,5+64,0,3+64          ; 30- 39  	; 30- 39
 59)   8990 16 17 18 1D 		 DB 22,23,24,29,54,28,55,47,21,9     ; 40- 49	; 40- 49
 59)   8994 36 1C 37 2F 		 DB 22,23,24,29,54,28,55,47,21,9     ; 40- 49	; 40- 49
 59)   8998 15 09       		 DB 22,23,24,29,54,28,55,47,21,9     ; 40- 49	; 40- 49
 60)   899A 08 07 06 05 		 DB 8,7,6,5,4,3,19,20,40+64,40             ; 50- 59	; 50- 59
 60)   899E 04 03 13 14 		 DB 8,7,6,5,4,3,19,20,40+64,40             ; 50- 59	; 50- 59
 60)   89A2 68 28       		 DB 8,7,6,5,4,3,19,20,40+64,40             ; 50- 59	; 50- 59
 61)   89A4 76 1B 77 6F 		 DB 54+64,27,55+64,47+64,0,46+64,56+64,58+64,44+64,12+64  ; 60- 69	; 60- 69
 61)   89A8 00 6E 78 7A 		 DB 54+64,27,55+64,47+64,0,46+64,56+64,58+64,44+64,12+64  ; 60- 69	; 60- 69
 61)   89AC 6C 4C       		 DB 54+64,27,55+64,47+64,0,46+64,56+64,58+64,44+64,12+64  ; 60- 69	; 60- 69
 62)   89AE 6B 6A 69 64 		 DB 43+64,42+64,41+64,36+64,51+64,62+64,39+64,53+64,52+64,38+64 ; 70- 79	; 70- 79
 62)   89B2 73 7E 67 75 		 DB 43+64,42+64,41+64,36+64,51+64,62+64,39+64,53+64,52+64,38+64 ; 70- 79	; 70- 79
 62)   89B6 74 66       		 DB 43+64,42+64,41+64,36+64,51+64,62+64,39+64,53+64,52+64,38+64 ; 70- 79	; 70- 79
 63)   89B8 5A 4E 4B 6D 		 DB 26+64,14+64,11+64,45+64,10+64,35+64,57+64,13+64,59+64,37+64 ; 80- 89	; 80- 89
 63)   89BC 4A 63 79 4D 		 DB 26+64,14+64,11+64,45+64,10+64,35+64,57+64,13+64,59+64,37+64 ; 80- 89	; 80- 89
 63)   89C0 7B 65       		 DB 26+64,14+64,11+64,45+64,10+64,35+64,57+64,13+64,59+64,37+64 ; 80- 89	; 80- 89
 64)   89C2 7C 56 5C 57 		 DB 60+64,22+64,92,23+64,29+64,0,0,46,56,58   ; 90- 99	; 90- 99
 64)   89C6 5D 00 00 2E 		 DB 60+64,22+64,92,23+64,29+64,0,0,46,56,58   ; 90- 99	; 90- 99
 64)   89CA 38 3A       		 DB 60+64,22+64,92,23+64,29+64,0,0,46,56,58   ; 90- 99	; 90- 99
 65)   89CC 2C 0C 2B 2A 		 DB 44,12,43,42,41,36,51,62,39,53    ;100-109  	;100-109
 65)   89D0 29 24 33 3E 		 DB 44,12,43,42,41,36,51,62,39,53    ;100-109  	;100-109
 65)   89D4 27 35       		 DB 44,12,43,42,41,36,51,62,39,53    ;100-109  	;100-109
 66)   89D6 34 26 1A 0E 		 DB 52,38,26,14,11,45,10,35,57,13           ;110-119  	;110-119
 66)   89DA 0B 2D 0A 23 		 DB 52,38,26,14,11,45,10,35,57,13           ;110-119  	;110-119
 66)   89DE 39 0D       		 DB 52,38,26,14,11,45,10,35,57,13           ;110-119  	;110-119
 67)   89E0 3B 25 3C 00 		 DB 59,37,60,0,0,0,0,0,0,0       ;120-129	;120-129
 67)   89E4 00 00 00 00 		 DB 59,37,60,0,0,0,0,0,0,0       ;120-129	;120-129
 67)   89E8 00 00       		 DB 59,37,60,0,0,0,0,0,0,0       ;120-129	;120-129
 68)   89EA 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;130-  9	;130-  9
 68)   89EE 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;130-  9	;130-  9
 68)   89F2 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;130-  9	;130-  9
 69)   89F4 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;140-  9	;140-  9
 69)   89F8 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;140-  9	;140-  9
 69)   89FC 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;140-  9	;140-  9
 70)   89FE 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;150-  9	;150-  9
 70)   8A02 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;150-  9	;150-  9
 70)   8A06 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;150-  9	;150-  9
 71)   8A08 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;160-  9	;160-  9
 71)   8A0C 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;160-  9	;160-  9
 71)   8A10 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;160-  9	;160-  9
 72)   8A12 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;170-  9	;170-  9
 72)   8A16 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;170-  9	;170-  9
 72)   8A1A 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;170-  9	;170-  9
 73)   8A1C 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;180-  9	;180-  9
 73)   8A20 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;180-  9	;180-  9
 73)   8A24 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;180-  9	;180-  9
 74)   8A26 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;190-  9	;190-  9
 74)   8A2A 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;190-  9	;190-  9
 74)   8A2E 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;190-  9	;190-  9
 75)   8A30 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;200-  9	;200-  9
 75)   8A34 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;200-  9	;200-  9
 75)   8A38 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;200-  9	;200-  9
 76)   8A3A 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;210-  9	;210-  9
 76)   8A3E 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;210-  9	;210-  9
 76)   8A42 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;210-  9	;210-  9
 77)   8A44 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;220-  9	;220-  9
 77)   8A48 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;220-  9	;220-  9
 77)   8A4C 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;220-  9	;220-  9
 78)   8A4E 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;230-  9	;230-  9
 78)   8A52 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;230-  9	;230-  9
 78)   8A56 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;230-  9	;230-  9
 79)   8A58 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;240-  9	;240-  9
 79)   8A5C 00 00 00 00 		               DB 0,0,0,0,0,0,0,0,0,0       ;240-  9	;240-  9
 79)   8A60 00 00       		               DB 0,0,0,0,0,0,0,0,0,0       ;240-  9	;240-  9
 80)   8A62 00 00 00 00 		               DB 0,0,0,0,0,0           ;250-  5	;250-  5
 80)   8A66 00 00       		               DB 0,0,0,0,0,0           ;250-  5	;250-  5
  7)   8A68 21 80 00    		@PS2KBINIT: LD HL,KEYCTR	;
  8)   8A6B 36 00       		 LD (HL),0	;
  9)   8A6D C9          		 RET	;
 12)   8A6E DB 06       		@PS2KEYAVAIL: IN A,(6)	;
 13)   8A70 FE 38       		 CP 56  ;38H =0011 1000  0011 IS 3 MEANS KBD INPUT 1000 MEANS REAL KEYBOARD	;38H =0011 1000  0011 IS 3 MEANS KBD INPUT 1000 MEANS REAL KEYBOARD
 14)   8A72 C9          		 RET	;
 16)   8A73 CD 7F 8A    		@READKBCHAR: CALL GETKBKEY ;GET HARDWARE KEY WITH CHECKS ON SHIFT...	;GET HARDWARE KEY WITH CHECKS ON SHIFT...
 17)   8A76 B7          		 OR A ;	;
 18)   8A77 C8          		 RET Z	;
 19)   8A78 32 81 00    		 LD (LASTKEY),A	;
 20)   8A7B CD 2A 9A    		 CALL PS2LOK  ;RETURN ASCII CHAR	;RETURN ASCII CHAR
 21)   8A7E C9          		 RET	;
 24)   8A7F CD 88 8A    		GETKBKEY: CALL GETPS2HWKEY ;GET SCANCODE FROM PS/2 KEYB	;GET SCANCODE FROM PS/2 KEYB
 25)   8A82 B7          		 OR A 	;
 26)   8A83 C8          		 RET Z   ;IF KEYBRD KEY IS ZERO	;IF KEYBRD KEY IS ZERO
 27)   8A84 CD 69 99    		 CALL CHECKEXT  ;CHECKEXT SHIFTS CTRL ALT CAPS	;CHECKEXT SHIFTS CTRL ALT CAPS
 28)   8A87 C9          		 RET	;
 32)   8A88 F3          		GETPS2HWKEY: DI	;
 33)   8A89 DB 48       		 IN A,(DEVKBI)  	;
 34)   8A8B 4F          		 LD C,A	;
 35)   8A8C CD 97 8A    		 CALL KBENABLE	;
 36)   8A8F 79          		 LD A,C	;
 37)   8A90 FB          		 EI	;
 38)   8A91 C9          		 RET	;
 40)   8A92 3E 02       		@KBDISABLE: LD A, 2	;
 41)   8A94 D3 48       		 OUT (DEVKBI), A	;
 42)   8A96 C9          		 RET	;
 44)   8A97 AF          		@KBENABLE: XOR A	;
 45)   8A98 D3 48       		 OUT (DEVKBI), A	;
 46)   8A9A D3 48       		 OUT (DEVKBI), A	;
 47)   8A9C D3 48       		 OUT (DEVKBI), A	;
 48)   8A9E C9          		 RET	;
 40)   8A9F 3E 03       		PATCHCMDS: LD A,11b ;DISABLE INTS & DISABLE NB=RAM WRITABLE	;DISABLE INTS & DISABLE NB=RAM WRITABLE
 41)   8AA1 D3 E0       		 OUT (INTENB),A	;
 44)   8AA3 21 F9 A2    		 LD HL,$A2F9	;
 45)   8AA6 36 CD       		 LD (HL),$CD ;CALL	;CALL
 46)   8AA8 11 00 8B    		 LD DE,CHKNEWCMD	;
 47)   8AAB 23          		 INC HL	;
 48)   8AAC 73          		 LD (HL),E	;
 49)   8AAD 23          		 INC HL	;
 50)   8AAE 72          		 LD (HL),D	;
 51)   8AAF 21 85 A4    		 LD HL,$A485  ;PXCL3	;PXCL3
 52)   8AB2 36 C3       		 LD (HL),$C3 ;JP	;JP
 53)   8AB4 11 E4 8A    		 LD DE,OSXCL3	;
 54)   8AB7 23          		 INC HL	;
 55)   8AB8 73          		 LD (HL),E	;
 56)   8AB9 23          		 INC HL	;
 57)   8ABA 72          		 LD (HL),D	;
 67)   8ABB 21 F1 E9    		 LD HL,$E9F1 ;PRINT EDITOR	;PRINT EDITOR
 68)   8ABE 36 CD       		 LD (HL),$CD ;CALL	;CALL
 69)   8AC0 11 16 8C    		 LD DE, MDLINT_PRNEDT	;
 70)   8AC3 23          		 INC HL	;
 71)   8AC4 73          		 LD (HL),E	;
 72)   8AC5 23          		 INC HL	;
 73)   8AC6 72          		 LD (HL),D	;
 75)   8AC7 21 D7 EC    		 LD HL,$ECD7 ;PRINT EDITOR	;PRINT EDITOR
 76)   8ACA 36 CD       		 LD (HL),$CD ;CALL	;CALL
 77)   8ACC 11 1C 8C    		 LD DE, MDLINT_PUT31	;
 78)   8ACF 23          		 INC HL	;
 79)   8AD0 73          		 LD (HL),E	;
 80)   8AD1 23          		 INC HL	;
 81)   8AD2 72          		 LD (HL),D	;
 83)   8AD3 21 DF EC    		 LD HL,$ECDF ;PRINT BLANK	;PRINT BLANK
 84)   8AD6 36 CD       		 LD (HL),$CD ;CALL	;CALL
 85)   8AD8 11 22 8C    		 LD DE, MDLINT_BLANK	;
 86)   8ADB 23          		 INC HL	;
 87)   8ADC 73          		 LD (HL),E	;
 88)   8ADD 23          		 INC HL	;
 89)   8ADE 72          		 LD (HL),D	;
107)   8ADF 3E 01       		OT2: LD A,01b  ;DISABLE INTS & ENABLE NB=RAM NON WRITABLE	;DISABLE INTS & ENABLE NB=RAM NON WRITABLE
108)   8AE1 D3 E0       		 OUT (INTENB),A  	;
109)   8AE3 C9          		 RET	;
112)   8AE4 01 14 DD    		OSXCL3: LD BC,XTABLE	;
113)   8AE7 FA 35 C3    		 JP M,ENTER	;
114)   8AEA 01 00 DE    		 LD BC,XTABL2	;
115)   8AED FE 56       		 CP LPCODE	;
116)   8AEF DA 35 C3    		 JP C,ENTER       ;IF <$56 GOTO TAB2 	;IF <$56 GOTO TAB2
117)   8AF2 01 43 A4    		 LD BC,XTABL3	;
118)   8AF5 FE 62       		 CP OSCODE	;
119)   8AF7 DA 35 C3    		 JP C,ENTER ;IF <$62 GOTO TAB3	;IF <$62 GOTO TAB3
120)   8AFA 01 E9 8A    		 LD BC,XTABL4 ;ELSE  OUR TAB4	;ELSE  OUR TAB4
121)   8AFD C3 35 C3    		 JP ENTER	;
124)   8B00 F5          		 PUSH AF	;
125)   8B01 DD E5       		 PUSH IX	;
126)   8B03 FD E5       		 PUSH IY	;
127)   8B05 D5          		 PUSH DE	;
128)   8B06 21 6C 8B    		 LD HL,TOS	;
129)   8B09 CD D4 A2    		 CALL PSCAN	;
130)   8B0C D4 19 8B    		 CALL NC, COSCMD	;
131)   8B0F D1          		 POP DE	;
132)   8B10 FD E1       		 POP IY	;
133)   8B12 DD E1       		 POP IX	;
134)   8B14 F1          		 POP AF	;
135)   8B15 21 5A A3    		OT: LD HL,TPLOT	;
136)   8B18 C9          		 RET	;
138)   8B19 	            		 PARAMS EQU MYNUM  	;
142)   8B19 21 6F 8B    		COSCMD: LD HL,OSLST	;
143)   8B1C CD D4 A2    		 CALL PSCAN ;check for any of the OS COMMAND-list	;check for any of the OS COMMAND-list
144)   8B1F D8          		 RET C	;
145)   8B20 61          		 LD H,C  ;THE OS LIST COMMAND ID ON C	;THE OS LIST COMMAND ID ON C
146)   8B21 2E B1       		 LD L,YOSCMD ;THE OS COMMAND	;THE OS COMMAND
147)   8B23 D7 01       		 DEFW ZCM2HL	;
148)   8B25 05          		 DEC B  ;CHECK FOR ARGS	;CHECK FOR ARGS
149)   8B26 28 06       		 JR Z,NOARGS ;NO ARGS	;NO ARGS
150)   8B28 0D          		 DEC C  ; CCD	; CCD
151)   8B29 20 09       		 JR NZ, NXTCMD0	;
155)   8B2B DF 18       		 DEFW WEXPN ;GET PARAM for cd string	;GET PARAM for cd string
156)   8B2D C9          		 RET	;
157)   8B2E D8          		NOARGS: RET C	;
158)   8B2F 3E B2       		 LD A,YOSEND	;
159)   8B31 C3 85 CA    		 JP CSTOP1	;
160)   8B34 0D          		NXTCMD0: DEC C ;COLOR COMMAND HAS 2 PARAMS	;COLOR COMMAND HAS 2 PARAMS
161)   8B35 C0          		 RET NZ   ;NZ MEANS OVER CMD 3 SO ERROR	;NZ MEANS OVER CMD 3 SO ERROR
163)   8B36 C5          		NXTPARAM: PUSH BC ;NUMEXP smashes BC,DE	;NUMEXP smashes BC,DE
164)   8B37 DF 16       		 DEFW WNUMEXP ;	;
165)   8B39 C1          		 POP BC	;
166)   8B3A D8          		 RET C	;
167)   8B3B 3E B4       		    LD A,YCOLPAR ;PARAM HERE	;PARAM HERE
168)   8B3D D7 57       		        DEFW ZCMONE ;	;
169)   8B3F 05          		 DEC B	;
170)   8B40 28 04       		 JR Z, NPEX ;Last argument?	;Last argument?
171)   8B42 DF 40       		 DEFW WCHKCOM ;CHECK FOR COMMA	;CHECK FOR COMMA
172)   8B44 18 F0       		 JR NXTPARAM  	;
173)   8B46 3E B2       		NPEX: LD A,YOSEND ;NO MORE PARAMS OS COMMAND ENDED	;NO MORE PARAMS OS COMMAND ENDED
174)   8B48 C3 85 CA    		 JP CSTOP1	;
196)   8B4B 53 8B       		       DEFW XOSCMD	;
199)   8B4D 5F 8B       		       DEFW XOSEND	;
202)   8B4F 66 8B       		       DEFW XCOL	;
205)   8B51 69 8B       		 DEFW XCOLPAR	;
208)   8B53 7E          		XOSCMD: LD A,(HL) ;GET SUB COMMAND 0=DIR 1=CD 2=COL	;GET SUB COMMAND 0=DIR 1=CD 2=COL
209)   8B54 B7          		 OR A	;
210)   8B55 28 27       		 JR Z,CMD_DIR	;
211)   8B57 3D          		 DEC A	;
212)   8B58 28 3C       		 JR Z,CMD_CD	;
213)   8B5A 3D          		 DEC A	;
214)   8B5B CA E4 8B    		 JP Z,CMD_COL	;
216)   8B5E C9          		 RET	;
218)   8B5F CD A0 D1    		XOSEND: CALL GFORP	;
219)   8B62 CD 8C C5    		 CALL LDUSTP	;
220)   8B65 C9          		 RET	;
222)   8B66 C3 E4 8B    		XCOL:  JP CMD_COL	;
224)   8B69 C3 EC 8B    		XCOLPAR: JP CMD_COLPAR	;
228)   8B6C 01          		TOS: DEFB 1	;
229)   8B6D 4F          		 DEFM 'O'	;
230)   8B6E D3          		 DEFB 'S'+80H	;
232)   8B6F 03          		OSLST: DEFB 3 ;no of sub-commands	;no of sub-commands
234)   8B70 44 49       		 DEFM 'DI' 	;
235)   8B72 D2 00 01    		 DEFB 'R'+80H,CDIR,0+1 ;+1 OF ARGS	;+1 OF ARGS
237)   8B75 43          		 DEFM 'C' 	;
238)   8B76 C4 01 02    		 DEFB 'D'+80H,CCD,1+1	;
240)   8B79 43 4F       		 DEFM 'CO' 	;
241)   8B7B CC 02 03    		 DEFB 'L'+80H,CCOL,2+1	;
246)   8B7E D7 39       		CMD_DIR: DEFW ZPTMSG ;	;
247)   8B80 11          		 DEFB 17	;
248)   8B81 0D          		 DEFB $0D	;
249)   8B82 2D 2D 2D 5B 		 DEFM "---[DIR INFO]--"	;
249)   8B86 44 49 52 20 		 DEFM "---[DIR INFO]--"	;
249)   8B8A 49 4E 46 4F 		 DEFM "---[DIR INFO]--"	;
249)   8B8E 5D 2D 2D    		 DEFM "---[DIR INFO]--"	;
250)   8B91 0D          		 DEFB $0D	;
251)   8B92 CD 90 8D    		 CALL STRG_DIRLIST  ;PRINT DIR	;PRINT DIR
252)   8B95 C9          		 RET	;
254)   8B96 CD 36 DC    		CMD_CD: CALL GUSTP   ;SETS HL FROM IX+11,12 USRTOP	;SETS HL FROM IX+11,12 USRTOP
265)   8B99 CD 3F 8E    		 CALL STRG_DIRCHG	;
266)   8B9C 38 09       		 JR C, CD_ERR	;
267)   8B9E 3E 96       		 LD A,150   ;ERROR MISSING FILE	;ERROR MISSING FILE
268)   8BA0 28 05       		 JR Z,CD_ERR	;
275)   8BA2 CD E1 8D    		 CALL STRG_DIRNMCHG	;
276)   8BA5 18 0F       		 JR CD_CONT	;
278)   8BA7 E5          		 PUSH HL	;
279)   8BA8 F5          		 PUSH AF  	;
280)   8BA9 D7 39       		 DEFW ZPTMSG ;	;
281)   8BAB 05          		 DEFB 5	;
282)   8BAC 45 52 52 5F 		 DEFM "ERR_R"	;
282)   8BB0 52          		 DEFM "ERR_R"	;
283)   8BB1 F1          		 POP AF  	;
284)   8BB2 CD 01 81    		 CALL SOUTAS  	;
285)   8BB5 E1          		 POP HL  	;
286)   8BB6 F5          		CD_CONT: PUSH AF   ;SAVE FLAGS  	;SAVE FLAGS
288)   8BB7 54          		 LD D,H	;
289)   8BB8 5D          		 LD E,L	;
290)   8BB9 1A          		CD_AGN: LD A,(DE)	;
291)   8BBA FE 00       		 CP 0	;
292)   8BBC 3E 00       		 LD A,0	;
293)   8BBE 12          		 LD (DE),A    ;ZERO THIS	;ZERO THIS
294)   8BBF 13          		 INC DE	;
295)   8BC0 20 F7       		 JR NZ,CD_AGN	;
296)   8BC2 06 04       		 LD B,4	;
297)   8BC4 12          		CD_AGN2: LD (DE),A	;
298)   8BC5 13          		 INC DE	;
299)   8BC6 10 FC       		 DJNZ CD_AGN2	;
301)   8BC8 E5          		 PUSH HL	;
302)   8BC9 D5          		 PUSH DE	;
303)   8BCA 21 E0 00    		 LD HL,DIRNM	;
304)   8BCD 7E          		NXTCHR: LD A,(HL)	;
305)   8BCE B7          		 OR A 	;
306)   8BCF 28 05       		 JR Z,NXTPATH	;
307)   8BD1 DF 3C       		 DEFW WPTCHAR	;
308)   8BD3 23          		 INC HL	;
309)   8BD4 18 F7       		 JR NXTCHR	;
310)   8BD6 23          		NXTPATH: INC HL	;
311)   8BD7 7E          		 LD A,(HL)	;
312)   8BD8 B7          		 OR A	;
313)   8BD9 20 F2       		 JR NZ,NXTCHR	;
314)   8BDB D1          		 POP DE	;
315)   8BDC E1          		 POP HL	;
316)   8BDD EB          		 EX DE,HL	;
317)   8BDE CD 8C C5    		 CALL LDUSTP	;
321)   8BE1 F1          		 POP AF  ;REST FLAGS  	;REST FLAGS
322)   8BE2 AF          		 XOR A	;
323)   8BE3 C9          		 RET	;
330)   8BE4 E5          		CMD_COL: PUSH HL	;
331)   8BE5 11 AF 00    		 LD DE,PARAMS	;
332)   8BE8 12          		 LD (DE),A  ;ZERO	;ZERO
333)   8BE9 C3 F2 C1    		 JP XRUN1D	;
336)   8BEC E5          		CMD_COLPAR: PUSH HL	;
337)   8BED CD 36 DC    		 CALL GUSTP   ;HL POINTS TO 1st PARAM	;HL POINTS TO 1st PARAM
338)   8BF0 23          		 INC HL  ;POSITION TO PARAM  	;POSITION TO PARAM
339)   8BF1 EB          		 EX DE,HL ;DE IN PARAM POS	;DE IN PARAM POS
340)   8BF2 21 AF 00    		 LD HL,PARAMS	;
341)   8BF5 34          		 INC (HL)	;
342)   8BF6 7E          		 LD A,(HL)  	;
343)   8BF7 23          		 INC HL	;
344)   8BF8 FE 01       		 CP 1	;
345)   8BFA 28 09       		 JR Z, SVPAR	;
347)   8BFC 7E          		 LD A,(HL)  ;1ST PARAM TO A FROM SV POS	;1ST PARAM TO A FROM SV POS
348)   8BFD EB          		 EX DE,HL	;
349)   8BFE 46          		 LD B,(HL) ;2ND PARAM FROM USER STACK	;2ND PARAM FROM USER STACK
350)   8BFF CD 0A 8C    		 CALL DOSETCOL	;
351)   8C02 C3 F2 C1    		COLPAREX: JP XRUN1D	;
353)   8C05 EB          		SVPAR: EX DE,HL ;HL IN PARAM POS, DE ON PARAMS 1 OR 2	;HL IN PARAM POS, DE ON PARAMS 1 OR 2
354)   8C06 7E          		 LD A,(HL)	;
355)   8C07 12          		 LD (DE),A   	;
356)   8C08 18 F8       		 JR COLPAREX	;
359)   8C0A CB 27       		DOSETCOL: SLA A ;HI NIBBLE IS FORE COLOR	;HI NIBBLE IS FORE COLOR
360)   8C0C CB 27       		 SLA A 	;
361)   8C0E CB 27       		 SLA A 	;
362)   8C10 CB 27       		 SLA A   	;
364)   8C12 B0          		 OR B  ;MERGE HIGH NIBBLE	;MERGE HIGH NIBBLE
365)   8C13 D3 40       		 OUT (DEVCLR),A ;SEND IT TO THE COLOR SCREEN	;SEND IT TO THE COLOR SCREEN
366)   8C15 C9          		 RET	;
 22)   8C16 DD 7E 0E    		MDLINT_PRNEDT: LD A,(IX+CHAR)         ;e9f1	;e9f1
 23)   8C19 18 0E       		               JR MDL_SETCOLOR	;
 24)   8C1B C9          		 RET	;
 26)   8C1C DD 7E 06    		MDLINT_PUT31: LD A,(IX+EL)           ;ECD7	;ECD7
 27)   8C1F 18 08       		               JR MDL_SETCOLOR	;
 28)   8C21 C9          		 RET	;
 30)   8C22 36 20       		MDLINT_BLANK: LD (HL),BLANK          ;ECDF	;ECDF
 31)   8C24 CD 29 8C    		               CALL MDL_SETCOLOR                         	;
 32)   8C27 23          		               INC HL                	;
 33)   8C28 C9          		 RET	;
 46)   8C29 F5          		MDL_SETCOLOR:  PUSH AF	;
 49)   8C2A C5          		               PUSH BC	;
 50)   8C2B 44          		               LD B,H	;
 51)   8C2C 7D          		               LD A,L	;
 52)   8C2D 0E 41       		               LD C,DEVCLR+1	;
 53)   8C2F ED 79       		               OUT (C),A	;
 54)   8C31 C1          		               POP BC	;
 57)   8C32 F1          		               POP AF	;
 58)   8C33 C9          		               RET	;
 10)   8C34 21 82 00    		INITMMU:       LD HL,BANKS	;
 11)   8C37 06 08       		               LD B,8	;
 12)   8C39 AF          		               XOR A	;
 13)   8C3A 77          		INM_AGN:       LD (HL),A	;
 14)   8C3B 3C          		               INC A	;
 15)   8C3C 23          		 INC HL	;
 16)   8C3D 10 FB       		               DJNZ INM_AGN	;
 17)   8C3F C9          		               RET                	;
 23)   8C40 4F          		PUTPGINBANK: LD C, A       ;SAVE PAGE	;SAVE PAGE
 24)   8C41 78          		 LD A, B                                                         ;BANK IN A	;BANK IN A
 25)   8C42 FE 02       		 CP 2	;
 26)   8C44 D8          		 RET C         ;BANK 0,1 WILL NEVER CHANGE	;BANK 0,1 WILL NEVER CHANGE
 27)   8C45 FE 07       		 CP 7	;
 28)   8C47 C8          		 RET Z         ;BANK 7 WILL NEVER CHANGE	;BANK 7 WILL NEVER CHANGE
 29)   8C48 21 82 00    		 LD HL, BANKS	;
 30)   8C4B 16 00       		 LD D, 0	;
 31)   8C4D 5F          		 LD E, A	;
 32)   8C4E 19          		 ADD HL, DE	;
 33)   8C4F 79          		 LD A, C        ;RESTORE PAGE	;RESTORE PAGE
 34)   8C50 77          		 LD (HL), A        ;SAVE PG IN BANK B MEMORY	;SAVE PG IN BANK B MEMORY
 35)   8C51 0E 00       		 LD C, DEVMMU	;
 36)   8C53 58          		 LD E,B	;
 37)   8C54 CB 20       		 SLA B         ;SHIFT BANK TO A15..A13 FROM A2..A0 WE USE THESE PINS ON THE CPLD FOR BANK INPUT	;SHIFT BANK TO A15..A13 FROM A2..A0 WE USE THESE PINS ON THE CPLD FOR BANK INPUT
 38)   8C56 CB 20       		 SLA B	;
 39)   8C58 CB 20       		 SLA B	;
 40)   8C5A CB 20       		 SLA B	;
 41)   8C5C CB 20       		 SLA B         ;SET TO A15,A14,A13	;SET TO A15,A14,A13
 42)   8C5E ED 79       		 OUT (C), A	;
 43)   8C60 43          		 LD B,E	;
 44)   8C61 C9          		 RET	;
 49)   8C62 21 82 00    		GETPGINBANK:   LD HL,BANKS	;
 50)   8C65 16 00       		               LD D,0	;
 51)   8C67 58          		               LD E,B	;
 52)   8C68 19          		               ADD HL,DE	;
 53)   8C69 7E          		               LD A,(HL)	;
 54)   8C6A C9          		               RET	;
 17)   8C6B 	            		 RBR EQU DEVSER+0      ;RECEIVER BUFFER REGISTER (READ ONLY) (DLAB = 0)	;RECEIVER BUFFER REGISTER (READ ONLY) (DLAB = 0)
 18)   8C6B 	            		 THR EQU DEVSER+0      ;TRANSMITER HOLDING REGISTER (WRITE ONLY) (DLAB = 0)	;TRANSMITER HOLDING REGISTER (WRITE ONLY) (DLAB = 0)
 19)   8C6B 	            		 IER EQU DEVSER+1      ;INTERRUPT ENABLE REGISTER (DLAB = 0)	;INTERRUPT ENABLE REGISTER (DLAB = 0)
 24)   8C6B 	            		 IIR EQU DEVSER+2      ;INTERRUPT IDENT. REGISTER (READ ONLY)	;INTERRUPT IDENT. REGISTER (READ ONLY)
 29)   8C6B 	            		 FCR EQU DEVSER+2      ;FIFO CONTROL REGISTER (WRITE ONLY)	;FIFO CONTROL REGISTER (WRITE ONLY)
 37)   8C6B 	            		 LCR EQU DEVSER+3      ;LINE CONTROL REGISTER	;LINE CONTROL REGISTER
 45)   8C6B 	            		 MCR EQU DEVSER+4      ;MODEM CONTROL REGISTER	;MODEM CONTROL REGISTER
 46)   8C6B 	            		 LSR EQU DEVSER+5      ;LINE STATUS REGISTER	;LINE STATUS REGISTER
 55)   8C6B 	            		 MSR EQU DEVSER+6      ;MODEM STATUS REGISTER	;MODEM STATUS REGISTER
 56)   8C6B 	            		 SCR EQU DEVSER+7      ;SCRATCH REGISTER	;SCRATCH REGISTER
 57)   8C6B 	            		 DLL EQU DEVSER+0      ;DIVISOR LATCH (LEAST SIGNIFICANT BYTE) (DLAB = 1)	;DIVISOR LATCH (LEAST SIGNIFICANT BYTE) (DLAB = 1)
 58)   8C6B 	            		 DLM EQU DEVSER+1      ;DIVISOR LATCH (MOST SIGNIFICANT BYTE) (DLAB = 1)	;DIVISOR LATCH (MOST SIGNIFICANT BYTE) (DLAB = 1)
 64)   8C6B F5          		RS_INI: PUSH AF	;
 65)   8C6C 3E 80       		 LD A, $80        ; Mask to set DLAB on	; Mask to set DLAB on
 66)   8C6E D3 23       		 OUT (LCR), A        ; Send to LINe Control Register	; Send to LINe Control Register
 75)   8C70 F1          		 POP AF	;
 76)   8C71 D3 20       		 OUT (DLL), A        ; Set LSB of divisor	; Set LSB of divisor
 77)   8C73 3E 00       		 LD A, 00        ; This will be the MSB of the divisior	; This will be the MSB of the divisior
 78)   8C75 D3 21       		 OUT (DLM), A        ; Send to the MSB register	; Send to the MSB register
 79)   8C77 3E 03       		 LD A, $03        ; 8 bits, 1 stop, no parity (and clear DLAB)	; 8 bits, 1 stop, no parity (and clear DLAB)
 80)   8C79 D3 23       		 OUT (LCR), A        ; Write new value to LCR	; Write new value to LCR
 82)   8C7B 3E 00       		 LD A, 0	;
 83)   8C7D D3 22       		 OUT (FCR), A        ;//was commented	;//was commented
 84)   8C7F 3E 00       		 LD A, $00        ; 5 A=0 Disable all INterrupts	; 5 A=0 Disable all INterrupts
 85)   8C81 D3 21       		 OUT (IER), A        ; Send to INterrupt Enable Register	; Send to INterrupt Enable Register
 86)   8C83 C9          		 RET	;
 89)   8C84 CD 8A 8C    		RS_TX: CALL RSTXRD	;
 90)   8C87 D3 20       		 OUT (THR), A	;
 92)   8C89 C9          		 RET	;
 95)   8C8A F5          		RSTXRD: PUSH AF	;
 96)   8C8B DB 25       		RSTXLP: IN A, (LSR)        ; fetch the control register	; fetch the control register
 97)   8C8D CB 6F       		 BIT 5, A        ; bit will be set if UART is ready	; bit will be set if UART is ready
 98)   8C8F 28 FA       		 JR Z, RSTXLP	;
 99)   8C91 F1          		 POP AF	;
100)   8C92 C9          		 RET	;
104)   8C93 7E          		RS_TXT: LD A, (HL)	;
105)   8C94 23          		 INC HL	;
106)   8C95 FE 00       		 CP 0	;
107)   8C97 C8          		 RET Z	;
108)   8C98 CD 84 8C    		 CALL RS_TX	;
109)   8C9B 18 F6       		 JR RS_TXT	;
113)   8C9D E5          		RS_MESG: PUSH HL	;
114)   8C9E C5          		 PUSH BC	;
115)   8C9F D5          		 PUSH DE	;
116)   8CA0 F5          		 PUSH AF	;
117)   8CA1 21 09 00    		 LD HL,9 ;POINTS TO RET ADDRESS +10 FROM SP = OUR STRING	;POINTS TO RET ADDRESS +10 FROM SP = OUR STRING
118)   8CA4 39          		 ADD HL,SP	;
119)   8CA5 46          		 LD B,(HL)    	;
120)   8CA6 2B          		 DEC HL	;
121)   8CA7 4E          		 LD C,(HL)	;
122)   8CA8 60          		 LD H,B	;
123)   8CA9 69          		 LD L,C	;
124)   8CAA CD 93 8C    		 CALL RS_TXT	;
125)   8CAD F1          		 POP AF	;
126)   8CAE D1          		 POP DE	;
127)   8CAF 44          		 LD B,H  ;NEW RET ADDRESS	;NEW RET ADDRESS
128)   8CB0 4D          		 LD C,L	;
129)   8CB1 21 05 00    		 LD HL,5 ;POINTS TO RET ADDRESS +6 FROM SP	;POINTS TO RET ADDRESS +6 FROM SP
130)   8CB4 39          		 ADD HL,SP  	;
131)   8CB5 70          		 LD (HL),B	;
132)   8CB6 2B          		 DEC HL	;
133)   8CB7 71          		 LD (HL),C  	;
134)   8CB8 C1          		 POP BC	;
135)   8CB9 E1          		 POP HL	;
136)   8CBA C9          		 RET 	;
143)   8CBB ED 57       		RS_RX: LD A,I        ;SETS PV IF INTS ARE ENABLED	;SETS PV IF INTS ARE ENABLED
144)   8CBD F5          		 PUSH AF	;
145)   8CBE D1          		 POP DE	;
146)   8CBF F3          		 DI	;
147)   8CC0 3E 01       		 LD A, 1        ;ready to receive SIGNAL DSR 1	;ready to receive SIGNAL DSR 1
148)   8CC2 D3 24       		 OUT (MCR), A	;
149)   8CC4 CD E2 8C    		 CALL RSRXRD	;
150)   8CC7 AF          		RS_GTCH: XOR A        ;NOT ready to receive SIGNAL DSR 0	;NOT ready to receive SIGNAL DSR 0
151)   8CC8 D3 24       		 OUT (MCR), A	;
153)   8CCA DB 20       		 IN A, (RBR)  	;
154)   8CCC D5          		 PUSH DE	;
155)   8CCD 57          		 LD D,A	;
156)   8CCE F1          		 POP AF	;
157)   8CCF 7A          		 LD A,D	;
158)   8CD0 E0          		 RET PO  	;
159)   8CD1 FB          		 EI	;
160)   8CD2 C9          		 RET	;
162)   8CD3 3E 01       		RS_RXNW: LD A, 1       ;ready to receive SIGNAL DSR 1	;ready to receive SIGNAL DSR 1
163)   8CD5 D3 24       		 OUT (MCR), A	;
164)   8CD7 DB 25       		 IN A, (LSR)        ; fetch the conrtol register	; fetch the conrtol register
165)   8CD9 CB 47       		 BIT 0, A	;
166)   8CDB 28 03       		 JR Z, RS_NOCHAR	;
167)   8CDD F3          		 DI	;
168)   8CDE 18 E7       		 JR RS_GTCH	;
169)   8CE0 AF          		RS_NOCHAR: XOR A        ;RETURN ZERO	;RETURN ZERO
170)   8CE1 C9          		 RET	;
178)   8CE2 F5          		 PUSH AF	;
184)   8CE3 DB 25       		 IN A, (LSR)        ; fetch the control register	; fetch the control register
185)   8CE5 CB 47       		 BIT 0, A        ; bit will be set if UART has data	; bit will be set if UART has data
186)   8CE7 28 FA       		 JR Z, RSRXLP	;
188)   8CE9 F1          		 POP AF	;
190)   8CEA C9          		 RET	;
194)   8CEB DB 25       		RS_KEYRD: IN A, (LSR)       ; fetch the conrtol register	; fetch the conrtol register
195)   8CED CB 47       		 BIT 0, A        ; bit will be set if UART has data	; bit will be set if UART has data
196)   8CEF C9          		 RET	;
198)   8CF0 F5          		SHLCD: PUSH AF	;
200)   8CF1 F1          		 POP AF	;
202)   8CF2 C9          		 RET	;
204)   8CF3 F5          		RS_NEWLINE: PUSH AF	;
205)   8CF4 3E 0D       		 LD A,13	;
206)   8CF6 CD 84 8C    		 CALL RS_TX	;
207)   8CF9 3E 0A       		 LD A,10	;
208)   8CFB CD 84 8C    		 CALL RS_TX	;
209)   8CFE F1          		 POP AF	;
210)   8CFF C9          		 RET  	;
213)   8D00 F5          		CHKERR: PUSH AF	;
214)   8D01 E5          		 PUSH HL	;
215)   8D02 C5          		 PUSH BC	;
216)   8D03 DB 25       		 IN A, (LSR)        ;FETCH LINE STATUS REGISTER	;FETCH LINE STATUS REGISTER
217)   8D05 CB 67       		 BIT 4, A	;
218)   8D07 28 04       		 JR Z, LBLPE	;
219)   8D09 3E 42       		 LD A, 'B'       ;$20  ;BREAK	;$20  ;BREAK
220)   8D0B 18 1A       		 JR EXIT	;
221)   8D0D CB 57       		LBLPE: BIT 2, A	;
222)   8D0F 28 04       		 JR Z, LBLFE	;
223)   8D11 3E 50       		 LD A, 'P'       ;$40  ;PARITY	;$40  ;PARITY
224)   8D13 18 12       		 JR EXIT	;
225)   8D15 CB 5F       		LBLFE: BIT 3, A	;
226)   8D17 28 04       		 JR Z, LBLOE	;
227)   8D19 3E 46       		 LD A, 'F'       ;$60  ;FRAME	;$60  ;FRAME
228)   8D1B 18 0A       		 JR EXIT	;
229)   8D1D CB 4F       		LBLOE: BIT 1, A	;
230)   8D1F 28 04       		 JR Z, LBLNE	;
231)   8D21 3E 4F       		 LD A, 'O'        ;$80  ;OVERRUN	;$80  ;OVERRUN
232)   8D23 18 02       		 JR EXIT	;
233)   8D25 3E 4E       		LBLNE: LD A, 'N'        ;NO ERROR	;NO ERROR
234)   8D27 21 7A 00    		EXIT: LD HL, SERERR	;
235)   8D2A 77          		 LD (HL), A	;
237)   8D2B C1          		 POP BC	;
238)   8D2C E1          		 POP HL	;
239)   8D2D F1          		 POP AF	;
240)   8D2E C9          		 RET	;
 32)   8D2F 	            		@CH376_ERROR EQU RS_MESG	;
 42)   8D2F 57          		STRG_INIT: LD D,A	;
 43)   8D30 AF          		 XOR A  	;
 44)   8D31 32 8A 00    		 LD (STRG_STAT),A  ;NOT CONNECTED, NOT EXISTS	;NOT CONNECTED, NOT EXISTS
 45)   8D34 CD 0C 93    		 CALL CH376_INIT	;
 46)   8D37 20 06       		 JR NZ,INIERR	;
 47)   8D39 7A          		 LD A,D   ;SELECT USB DEVICE 3 FOR SDCARD, 6 FOR FLASH	;SELECT USB DEVICE 3 FOR SDCARD, 6 FOR FLASH
 48)   8D3A CD 21 93    		 CALL CH376_SETUSB	;
 49)   8D3D 28 03       		 JR Z,INIOK	;
 50)   8D3F 3E 00       		INIERR: LD A,0  	;
 51)   8D41 C9          		 RET	;
 52)   8D42 CD 01 93    		INIOK: CALL CH376_VERSION	;
 53)   8D45 BF          		 CP A  ;SET ZF	;SET ZF
 54)   8D46 3E 80       		 LD A, $80  ;BIT 7 MEANS EXISTS	;BIT 7 MEANS EXISTS
 55)   8D48 32 8A 00    		 LD (STRG_STAT),A  ;	;
 56)   8D4B C9          		 RET	;
 59)   8D4C 3A 8A 00    		STRG_EXISTS: LD A,(STRG_STAT)	;
 60)   8D4F CB 7F       		 BIT 7,A	;
 61)   8D51 C9          		 RET	;
 67)   8D52 CD 4C 8D    		STRG_CHECK: CALL STRG_EXISTS	;
 68)   8D55 37          		 SCF	;
 69)   8D56 C8          		 RET Z    ;Z MEANS NOT EXISTS	;Z MEANS NOT EXISTS
 70)   8D57 06 05       		 LD B,5	;
 71)   8D59 CD 51 93    		SC_AGN1: CALL CH376_CONNECT 	;
 72)   8D5C 28 06       		 JR Z,DOCON	;
 73)   8D5E 30 1C       		 JR NC,DODISC	;
 74)   8D60 10 F7       		 DJNZ SC_AGN1    	;
 78)   8D62 AF          		 XOR A   	;
 79)   8D63 C9          		 RET   ;TIMEOUT	;TIMEOUT
 81)   8D64 AF          		DOCON: XOR A    ;CLCF	;CLCF
 82)   8D65 3A 8A 00    		 LD A,(STRG_STAT)	;
 83)   8D68 CB 47       		 BIT 0,A	;
 84)   8D6A C0          		 RET NZ    ;ALREADY MOUNTED THE DRIVE	;ALREADY MOUNTED THE DRIVE
 88)   8D6B CD 5C 93    		 CALL CH376_MOUNT   ;MOUNT THE DRIVE	;MOUNT THE DRIVE
 89)   8D6E 20 0C       		 JR NZ, DONOMNT	;
 93)   8D70 3A 8A 00    		 LD A,(STRG_STAT)	;
 94)   8D73 CB C7       		 SET 0,A	;
 95)   8D75 32 8A 00    		 LD (STRG_STAT),A	;
 96)   8D78 AF          		 XOR A    ;CLEAR CARRY FLAG MEANS WE ARE OK	;CLEAR CARRY FLAG MEANS WE ARE OK
 97)   8D79 3E 01       		 LD A,1    ;A=1 IS JUST CONNECTED	;A=1 IS JUST CONNECTED
 98)   8D7B C9          		 RET	;
106)   8D7C AF          		 XOR A 	;
107)   8D7D 3A 8A 00    		 LD A,(STRG_STAT)  	;
108)   8D80 CB 47       		 BIT 0,A	;
109)   8D82 C8          		 RET Z    ;ALREADY DISCONNECTED	;ALREADY DISCONNECTED
110)   8D83 CB 87       		 RES 0,A    ;SET BIT 0 TO 0=DISCONNECTED	;SET BIT 0 TO 0=DISCONNECTED
111)   8D85 32 8A 00    		 LD (STRG_STAT),A  	;
112)   8D88 3E 02       		 LD A,2    ;A=2 IS JUST DISCONNECTED	;A=2 IS JUST DISCONNECTED
113)   8D8A C9          		 RET	;
119)   8D8B C3 65 93    		STRG_OPENCRD:  JP CH376_MOUNTDEV  	;
122)   8D8E 2A 00       		SDIRTP  DEFB '*',0	;
124)   8D90 CD C2 8D    		STRG_DIRLIST: CALL STRG_OPENCDIR ;OPEN CURRENT DIR	;OPEN CURRENT DIR
125)   8D93 21 8E 8D    		 LD HL,SDIRTP	;
126)   8D96 CD 3F 8E    		 CALL STRG_OPENFD	;
127)   8D99 C8          		DL_NXTFILE: RET Z   ;NO  MORE FILES	;NO  MORE FILES
128)   8D9A 3E 27       		 LD A,CMD_RDUSB_DATA0	;
129)   8D9C CD EB 92    		 CALL CH376_COMMD	;
130)   8D9F CD 2A 92    		 CALL CH376_GETDATA ;DATA ON USBBUF A=BYTES TO READ	;DATA ON USBBUF A=BYTES TO READ
131)   8DA2 3E 00       		 LD A,0	;
132)   8DA4 12          		 LD (DE),A   ;ZT STRING	;ZT STRING
134)   8DA5 21 8B 00    		 LD HL,USBBUF	;
135)   8DA8 CD 38 80    		 CALL OS_PRMESSCRSFE	;
136)   8DAB 3E 0D       		 LD A,$0D	;
137)   8DAD CD 2D 80    		 CALL OS_PRCHSCR	;
139)   8DB0 3E 33       		 LD A, CMD_FILEENUM_GO	;
140)   8DB2 CD EB 92    		 CALL CH376_COMMD	;
141)   8DB5 CD 7C 92    		 CALL CH376_WTCMDEND	;
142)   8DB8 FE 42       		 CP ERR_MISS_FILE	;
143)   8DBA 18 DD       		 JR DL_NXTFILE	;
147)   8DBC 7E          		NEXTDIR: LD A,(HL)	;
148)   8DBD 23          		 INC HL	;
149)   8DBE B7          		 OR A	;
150)   8DBF C8          		 RET Z	;
151)   8DC0 18 FA       		 JR NEXTDIR	;
157)   8DC2 E5          		STRG_OPENCDIR: PUSH HL	;
158)   8DC3 D5          		 PUSH DE	;
159)   8DC4 C5          		 PUSH BC  	;
160)   8DC5 21 E0 00    		 LD HL,DIRNM	;
161)   8DC8 CD CF 8D    		 CALL STRG_OPENCDIR2	;
162)   8DCB C1          		        POP BC	;
163)   8DCC D1          		 POP DE	;
164)   8DCD E1          		 POP HL	;
165)   8DCE C9          		 RET	;
167)   8DCF 7E          		STRG_OPENCDIR2: LD A,(HL)	;
168)   8DD0 B7          		 OR A	;
169)   8DD1 C8          		 RET Z  ;WHEN ZERO MEANS NO MORE DIR TO OPEN	;WHEN ZERO MEANS NO MORE DIR TO OPEN
173)   8DD2 E5          		 PUSH HL	;
174)   8DD3 CD 3F 8E    		 CALL STRG_OPENFD	;
175)   8DD6 E1          		 POP HL	;
176)   8DD7 D8          		 RET C  ;ERROR	;ERROR
177)   8DD8 37          		 SCF	;
178)   8DD9 3E 96       		 LD A,150 ;MISSING FILENAME	;MISSING FILENAME
179)   8DDB C8          		 RET Z  ;FILE MISSING	;FILE MISSING
181)   8DDC CD BC 8D    		 CALL NEXTDIR	;
182)   8DDF 18 EE       		 JR STRG_OPENCDIR2	;
186)   8DE1 E5          		STRG_DIRNMCHG: PUSH HL 	;
187)   8DE2 7E          		 LD A,(HL)	;
188)   8DE3 FE 5C       		 CP '\'        ;changed from '/' on 18/2/2024	;changed from '/' on 18/2/2024
189)   8DE5 28 0E       		 JR Z,DNC_RESET	;
190)   8DE7 FE 2F       		 CP '/'        ; 25/2/2024	; 25/2/2024
191)   8DE9 28 0A       		 JR Z,DNC_RESET  	;
192)   8DEB FE 2E       		 CP '.'	;
193)   8DED 20 2D       		 JR NZ, DNC_ADD	;
194)   8DEF FE 2E       		 CP '.'	;
195)   8DF1 28 0F       		 JR Z,DNC_RMV	;
196)   8DF3 E1          		 POP HL	;
197)   8DF4 C9          		 RET ;DO NOTHING IF . OR .\ OR .<x>	;DO NOTHING IF . OR .\ OR .<x>
198)   8DF5 21 E0 00    		DNC_RESET: LD HL,DIRNM	;
199)   8DF8 36 5C       		 LD (HL),'\'	;
200)   8DFA 23          		 INC HL	;
201)   8DFB 36 00       		 LD (HL),0	;
202)   8DFD 23          		 INC HL	;
203)   8DFE 36 00       		 LD (HL),0	;
204)   8E00 E1          		 POP HL	;
205)   8E01 C9          		 RET	;
207)   8E02 21 E0 00    		DNC_RMV: LD HL,DIRNM	;
208)   8E05 CD BC 8D    		 CALL NEXTDIR	;
209)   8E08 7E          		 LD A,(HL)	;
210)   8E09 B7          		 OR A	;
211)   8E0A EB          		 EX DE,HL ;DE THE NEXT DIR	;DE THE NEXT DIR
212)   8E0B E1          		 POP HL	;
213)   8E0C C8          		 RET Z ;RET IF WE ARE ON 1ST DIRECTORY  	;RET IF WE ARE ON 1ST DIRECTORY
214)   8E0D E5          		 PUSH HL	;
215)   8E0E EB          		 EX DE,HL ;HL THE NEXT DIR	;HL THE NEXT DIR
216)   8E0F 44          		RMV_NXT: LD B,H	;
217)   8E10 4D          		 LD C,L	;
218)   8E11 CD BC 8D    		 CALL NEXTDIR	;
219)   8E14 7E          		 LD A,(HL)	;
220)   8E15 B7          		 OR A	;
221)   8E16 20 F7       		 JR NZ,RMV_NXT ;GO TO NEXT DIR 	;GO TO NEXT DIR
224)   8E18 AF          		 XOR A	;
225)   8E19 02          		 LD (BC),A	;
226)   8E1A E1          		 POP HL	;
227)   8E1B C9          		 RET	;
228)   8E1C EB          		DNC_ADD: EX DE,HL ;DE THE NEW FILE	;DE THE NEW FILE
229)   8E1D 21 E0 00    		 LD HL,DIRNM	;
230)   8E20 CD BC 8D    		ADDNXT: CALL NEXTDIR	;
231)   8E23 7E          		 LD A,(HL)	;
232)   8E24 B7          		 OR A	;
233)   8E25 20 F9       		 JR NZ,ADDNXT	;
235)   8E27 EB          		 EX DE,HL	;
237)   8E28 7E          		ADDNXT2: LD A,(HL)	;
238)   8E29 12          		 LD (DE),A	;
239)   8E2A 23          		 INC HL	;
240)   8E2B 13          		 INC DE	;
241)   8E2C B7          		 OR A	;
242)   8E2D 20 F9       		 JR NZ,ADDNXT2	;
244)   8E2F EB          		 EX DE,HL	;
245)   8E30 36 00       		 LD (HL),0 ;SIGNAL END OF DIRECTORIES WITH A SECOND ZERO	;SIGNAL END OF DIRECTORIES WITH A SECOND ZERO
246)   8E32 E1          		 POP HL	;
247)   8E33 C9          		 RET	;
251)   8E34 F5          		TEMPPRMSG: PUSH AF	;
252)   8E35 CD 30 80    		 CALL OS_PRMESSCR	;
253)   8E38 3E 0A       		 LD A,$0A	;
254)   8E3A CD 2D 80    		 CALL OS_PRCHSCR	;
255)   8E3D F1          		 POP AF	;
256)   8E3E C9          		 RET	;
265)   8E3F E5          		STRG_DIRCHG: PUSH HL	;
269)   8E40 3E 2F       		 LD A, CMD_SETFILENAME	;
270)   8E42 CD EB 92    		     CALL CH376_COMMD  	;
271)   8E45 CD A0 93    		     CALL CH376_WRSTRING	;
272)   8E48 20 0E       		 JR NZ,DC_WSERR  	;
273)   8E4A 3E 32       		 LD A, CMD_FILE_OPEN	;
274)   8E4C CD EB 92    		 CALL CH376_COMMD	;
275)   8E4F CD 7C 92    		 CALL CH376_WTCMDEND   	;
276)   8E52 E1          		 POP HL	;
277)   8E53 FE 42       		 CP ERR_MISS_FILE	;
278)   8E55 C8          		 RET Z	;
279)   8E56 B7          		 OR A  ;CLEAR CARRY	;CLEAR CARRY
280)   8E57 C9          		 RET	;
282)   8E58 E1          		DC_WSERR: POP HL	;
283)   8E59 37          		 SCF	;
284)   8E5A C9          		 RET  	;
286)   8E5B C9          		STRG_TPFILE: RET	;
287)   8E5C C9          		STRG_GETPOS: RET	;
291)   8E5D D5          		STRG_SETPOS16: PUSH DE	;
292)   8E5E 11 00 00    		 LD DE,0	;
293)   8E61 CD 66 8E    		 CALL STRG_SETPOS 	;
294)   8E64 D1          		 POP DE	;
295)   8E65 C9          		 RET	;
297)   8E66 3E 39       		STRG_SETPOS: LD A,CMD_BYTE_LOCATE	;
298)   8E68 CD EB 92    		 CALL CH376_COMMD	;
299)   8E6B 79          		 LD A,C                             ; 4 BYTES TO SET THE OFFSET LOW IN FRONT	; 4 BYTES TO SET THE OFFSET LOW IN FRONT
300)   8E6C CD EF 92    		     CALL CH376_DATAWR	;
301)   8E6F 78          		 LD A,B	;
302)   8E70 CD EF 92    		 CALL CH376_DATAWR	;
303)   8E73 7B          		 LD A,E	;
304)   8E74 CD EF 92    		 CALL CH376_DATAWR            ;LAST 2 BYTES 0 MAX 65535 SKIP	;LAST 2 BYTES 0 MAX 65535 SKIP
305)   8E77 7A          		 LD A,D	;
306)   8E78 CD EF 92    		 CALL CH376_DATAWR	;
307)   8E7B CD 7C 92    		     CALL CH376_WTCMDEND	;
308)   8E7E C9          		 RET	;
311)   8E7F C9          		STRG_GETSIZE: RET	;
312)   8E80 C9          		STRG_GETEOF: RET	;
319)   8E81 3E 27       		STRG_PRDRVINFO: LD A,CMD_RDUSB_DATA0	;
320)   8E83 CD EB 92    		 CALL CH376_COMMD	;
321)   8E86 CD 2A 92    		 CALL CH376_GETDATA	;
322)   8E89 F5          		 PUSH AF	;
323)   8E8A D6 08       		 SUB 8  	;
324)   8E8C 47          		 LD B,A	;
325)   8E8D F1          		 POP AF   	;
326)   8E8E 21 93 00    		 LD HL,USBBUF+8  ;SKIP 8 BYTES	;SKIP 8 BYTES
327)   8E91 7E          		PDI_NXT: LD A,(HL)	;
328)   8E92 E5          		 PUSH HL	;
329)   8E93 C5          		 PUSH BC	;
330)   8E94 CD 16 80    		 CALL OS_PRINTCHAR	;
331)   8E97 C1          		 POP BC	;
332)   8E98 E1          		 POP HL	;
333)   8E99 23          		 INC HL	;
334)   8E9A 10 F5       		 DJNZ PDI_NXT  	;
335)   8E9C CD F3 8C    		 CALL RS_NEWLINE	;
337)   8E9F 3E 3F       		 LD A,CMD_DISK_QUERY   	;
338)   8EA1 CD EB 92    		 CALL CH376_COMMD	;
339)   8EA4 CD 7C 92    		 CALL CH376_WTCMDEND	;
340)   8EA7 C0          		 RET NZ	;
341)   8EA8 3E 27       		 LD A,CMD_RDUSB_DATA0	;
342)   8EAA CD EB 92    		 CALL CH376_COMMD  	;
343)   8EAD CD 2A 92    		 CALL CH376_GETDATA	;
345)   8EB0 DD 21 8B 00 		 LD IX,USBBUF 	;
346)   8EB4 DD E5       		 PUSH IX   	;
347)   8EB6 DD 56 03    		 LD D,(IX+3)	;
348)   8EB9 DD 5E 02    		 LD E,(IX+2)	;
349)   8EBC DD 66 01    		 LD H,(IX+1)	;
350)   8EBF DD 6E 00    		 LD L,(IX+0)	;
351)   8EC2 CD BA 9C    		 CALL B2D32    ;DE:HL RES ON B2DBUF	;DE:HL RES ON B2DBUF
352)   8EC5 21 CB 00    		 LD HL,B2DBUF	;
353)   8EC8 CD 4A 9D    		 CALL SKIPSPC	;
354)   8ECB CD 1A 80    		 CALL OS_PRINTTEXT	;
355)   8ECE CD 26 80    		 CALL OS_PRINTMSG	;
356)   8ED1 20 53 45 43 		 DEFM " SECTORS"	;
356)   8ED5 54 4F 52 53 		 DEFM " SECTORS"	;
357)   8ED9 0A 0D 00    		 DB 10,13 0	;
358)   8EDC DD E1       		 POP IX	;
360)   8EDE DD E5       		 PUSH IX     	;
361)   8EE0 DD 56 07    		 LD D,(IX+7)	;
362)   8EE3 DD 5E 06    		 LD E,(IX+6)	;
363)   8EE6 DD 66 05    		 LD H,(IX+5)	;
364)   8EE9 DD 6E 04    		 LD L,(IX+4)  	;
365)   8EEC CD BA 9C    		 CALL B2D32  ;DE:HL RES ON B2DBUF	;DE:HL RES ON B2DBUF
366)   8EEF 21 CB 00    		 LD HL,B2DBUF	;
367)   8EF2 CD 4A 9D    		 CALL SKIPSPC	;
368)   8EF5 CD 1A 80    		 CALL OS_PRINTTEXT	;
369)   8EF8 CD 26 80    		 CALL OS_PRINTMSG	;
370)   8EFB 20 53 45 43 		 DEFM " SECTORS FREE   "	;
370)   8EFF 54 4F 52 53 		 DEFM " SECTORS FREE   "	;
370)   8F03 20 46 52 45 		 DEFM " SECTORS FREE   "	;
370)   8F07 45 20 20 20 		 DEFM " SECTORS FREE   "	;
371)   8F0B 0A 0D 00    		 DB 10,13,0   	;
372)   8F0E DD E1       		 POP IX	;
374)   8F10 DD 7E 08    		FILESYSTEM: LD A,(IX+8) ;1-FAT12,2-FAT16,3-FAT32	;1-FAT12,2-FAT16,3-FAT32
375)   8F13 3D          		 DEC A	;
376)   8F14 28 08       		 JR Z,PDI_NXT0	;
377)   8F16 3D          		 DEC A	;
378)   8F17 28 18       		 JR Z,PDI_NXT1	;
379)   8F19 3D          		 DEC A	;
380)   8F1A 28 28       		 JR Z,PDI_NXT2	;
381)   8F1C 18 39       		 JR PDI_NXT3	;
383)   8F1E CD 26 80    		PDI_NXT0: CALL OS_PRINTMSG	;
384)   8F21 46 53 20 49 		 DEFM "FS IS FAT-12"	;
384)   8F25 53 20 46 41 		 DEFM "FS IS FAT-12"	;
384)   8F29 54 2D 31 32 		 DEFM "FS IS FAT-12"	;
385)   8F2D 0A 0D 00    		 DB 10,13,0	;
386)   8F30 C9          		 RET	;
387)   8F31 CD 26 80    		PDI_NXT1: CALL OS_PRINTMSG	;
388)   8F34 46 53 20 49 		 DEFM "FS IS FAT-16"	;
388)   8F38 53 20 46 41 		 DEFM "FS IS FAT-16"	;
388)   8F3C 54 2D 31 36 		 DEFM "FS IS FAT-16"	;
389)   8F40 0A 0D 00    		 DB 10,13,0	;
390)   8F43 C9          		 RET	;
391)   8F44 CD 26 80    		PDI_NXT2: CALL OS_PRINTMSG	;
392)   8F47 46 53 20 49 		 DEFM "FS IS FAT-32"	;
392)   8F4B 53 20 46 41 		 DEFM "FS IS FAT-32"	;
392)   8F4F 54 2D 33 32 		 DEFM "FS IS FAT-32"	;
393)   8F53 0A 0D 00    		 DB 10,13,0	;
394)   8F56 C9          		 RET	;
395)   8F57 CD 26 80    		PDI_NXT3: CALL OS_PRINTMSG	;
396)   8F5A 55 4E 4B 4E 		 DEFM "UNKNOWN FS"	;
396)   8F5E 4F 57 4E 20 		 DEFM "UNKNOWN FS"	;
396)   8F62 46 53       		 DEFM "UNKNOWN FS"	;
397)   8F64 0A 0D 00    		 DB 10,13,0	;
398)   8F67 DD 7E 08    		 LD A,(IX+8)  ;TO BE PRINTED MAYBE	;TO BE PRINTED MAYBE
399)   8F6A C9          		 RET	;
404)   8F6B F5          		STRG_OPNFILE: PUSH AF	;
405)   8F6C 3E 2F       		 LD A, CMD_SETFILENAME	;
406)   8F6E CD EB 92    		     CALL CH376_COMMD	;
407)   8F71 21 F0 00    		 LD HL, STRGBUFF	;
408)   8F74 CD A0 93    		     CALL CH376_WRSTRING	;
409)   8F77 28 1E       		 JR Z,OF_WSOK	;
410)   8F79 F1          		 POP AF	;
411)   8F7A CD 26 80    		 CALL OS_PRINTMSG	;
412)   8F7D 45 52 52 4F 		 DEFM "ERROR SETTING FILENAME"	;
412)   8F81 52 20 53 45 		 DEFM "ERROR SETTING FILENAME"	;
412)   8F85 54 54 49 4E 		 DEFM "ERROR SETTING FILENAME"	;
412)   8F89 47 20 46 49 		 DEFM "ERROR SETTING FILENAME"	;
412)   8F8D 4C 45 4E 41 		 DEFM "ERROR SETTING FILENAME"	;
412)   8F91 4D 45       		 DEFM "ERROR SETTING FILENAME"	;
413)   8F93 0A 0D 00    		 DB 10,13,0  	;
414)   8F96 C9          		 RET	;
415)   8F97 F1          		OF_WSOK: POP AF	;
419)   8F98 B7          		 OR A  ;0 READ	;0 READ
420)   8F99 28 0C       		 JR Z,OF_OPEN	;
421)   8F9B D6 01       		 SUB 1  ;1 WRITE	;1 WRITE
422)   8F9D 28 08       		 JR Z,OF_OPEN	;
423)   8F9F D6 01       		 SUB 1  ;2 READ/WRITE	;2 READ/WRITE
424)   8FA1 28 04       		 JR Z,OF_OPEN	;
434)   8FA3 3E 34       		 LD A, CMD_FILE_CREATE  	;
435)   8FA5 18 02       		 JR OF_EXEC	;
440)   8FA7 3E 32       		 LD A, CMD_FILE_OPEN	;
444)   8FA9 CD EB 92    		 CALL CH376_COMMD	;
445)   8FAC CD 7C 92    		 CALL CH376_WTCMDEND	;
446)   8FAF C9          		 RET	;
448)   8FB0 3E 36       		STRG_CLSFILE: LD A, CMD_FILE_CLOSE	;
449)   8FB2 CD EB 92    		     CALL CH376_COMMD	;
450)   8FB5 3E 01       		     LD A, 1                             ; 1 = update file size if necessary	; 1 = update file size if necessary
451)   8FB7 CD EF 92    		     CALL CH376_DATAWR	;
452)   8FBA CD 7C 92    		     CALL CH376_WTCMDEND	;
453)   8FBD C9          		     RET	;
459)   8FBE D5          		STRG_BLKREAD: PUSH DE	;
460)   8FBF 3E 3A       		 LD A, CMD_BYTE_READ	;
461)   8FC1 CD EB 92    		     CALL CH376_COMMD	;
462)   8FC4 79          		     LD A, C                           ; BYTES REQUEST ON BC	; BYTES REQUEST ON BC
463)   8FC5 CD EF 92    		     CALL CH376_DATAWR	;
464)   8FC8 78          		     LD A, B	;
465)   8FC9 CD EF 92    		     CALL CH376_DATAWR	;
466)   8FCC 2F          		 CPL	;
467)   8FCD 2F          		 CPL    	;
471)   8FCE D1          		 POP DE	;
472)   8FCF 21 00 00    		 LD HL,0      ;BYTE RECEIVE COUNTER	;BYTE RECEIVE COUNTER
473)   8FD2 E5          		STBR_DOREST: PUSH HL	;
474)   8FD3 D5          		 PUSH DE	;
475)   8FD4 CD 7C 92    		 CALL CH376_WTCMDEND	;
476)   8FD7 D1          		 POP DE	;
477)   8FD8 E1          		 POP HL	;
478)   8FD9 28 1C       		 JR Z, FR_DONE   ;Z=NO MORE OR CANNOT READ	;Z=NO MORE OR CANNOT READ
479)   8FDB FE 1D       		 CP USB_INT_DISK_READ                    	;
480)   8FDD 20 1C       		     JR NZ, FR_ERROR	;
482)   8FDF 3E 27       		 LD A,CMD_RDUSB_DATA0	;
483)   8FE1 CD EB 92    		 CALL CH376_COMMD 	;
484)   8FE4 CD FE 92    		 CALL CH376_DATARD  ;A= BYTES TO READ TO BUFFER	;A= BYTES TO READ TO BUFFER
485)   8FE7 47          		 LD B,A	;
498)   8FE8 CD FE 92    		STBR_NXT1: CALL CH376_DATARD ;READ THE BYTES TO BUFFER	;READ THE BYTES TO BUFFER
499)   8FEB 12          		 LD (DE),A	;
500)   8FEC 13          		 INC DE	;
501)   8FED 23          		 INC HL    ;TOTAL BYTES READ COUNTER	;TOTAL BYTES READ COUNTER
502)   8FEE 10 F8       		 DJNZ STBR_NXT1  	;
503)   8FF0 3E 3B       		 LD A, CMD_BYTE_RD_GO 	;
504)   8FF2 CD EB 92    		 CALL CH376_COMMD 	;
505)   8FF5 18 DB       		 JR STBR_DOREST	;
511)   8FF7 44          		 LD B,H	;
512)   8FF8 4D          		 LD C,L	;
513)   8FF9 AF          		 XOR A	;
514)   8FFA C9          		 RET	;
515)   8FFB F5          		FR_ERROR: PUSH AF	;
516)   8FFC CD 43 9E    		 CALL PRINTNUM	;
517)   8FFF CD 26 80    		 CALL OS_PRINTMSG	;
518)   9002 45 52 52 4F 		 DEFM "ERROR READING BLOCK!!! "	;
518)   9006 52 20 52 45 		 DEFM "ERROR READING BLOCK!!! "	;
518)   900A 41 44 49 4E 		 DEFM "ERROR READING BLOCK!!! "	;
518)   900E 47 20 42 4C 		 DEFM "ERROR READING BLOCK!!! "	;
518)   9012 4F 43 4B 21 		 DEFM "ERROR READING BLOCK!!! "	;
518)   9016 21 21 20    		 DEFM "ERROR READING BLOCK!!! "	;
519)   9019 00          		 DB 0 	;
520)   901A F1          		 POP AF	;
521)   901B 06 02       		 LD B,2	;
522)   901D 05          		 DEC B	;
523)   901E C9          		 RET  	;
530)   901F D5          		STRG_LOADFILE: PUSH DE	;
531)   9020 C5          		 PUSH BC	;
537)   9021 CD 78 9E    		 CALL COPYFNAME	;
538)   9024 AF          		 XOR A   ;READ ONLY 	;READ ONLY
539)   9025 CD 6B 8F    		 CALL STRG_OPNFILE  	;
540)   9028 20 4B       		 JR NZ, FOPENERR	;
545)   902A C1          		 POP BC  ;BYTECOUNT	;BYTECOUNT
546)   902B D1          		 POP DE  ;DEST BUFFER	;DEST BUFFER
547)   902C CD BE 8F    		 CALL STRG_BLKREAD	;
548)   902F 28 20       		 JR Z, FREADOK	;
549)   9031 CD 43 9E    		 CALL PRINTNUM	;
550)   9034 CD 26 80    		 CALL OS_PRINTMSG	;
551)   9037 20 45 52 52 		 DEFM " ERROR READING FILE"	;
551)   903B 4F 52 20 52 		 DEFM " ERROR READING FILE"	;
551)   903F 45 41 44 49 		 DEFM " ERROR READING FILE"	;
551)   9043 4E 47 20 46 		 DEFM " ERROR READING FILE"	;
551)   9047 49 4C 45    		 DEFM " ERROR READING FILE"	;
552)   904A 0A 0D 00    		 DB 10,13,0	;
553)   904D D5          		 PUSH DE	;
554)   904E C5          		 PUSH BC	;
555)   904F 18 24       		 JR FOPENERR	;
556)   9051 C5          		FREADOK: PUSH BC	;
557)   9052 CD B6 9C    		 CALL B2D16	;
558)   9055 21 CB 00    		 LD HL,B2DBUF	;
559)   9058 CD 4A 9D    		 CALL SKIPSPC	;
560)   905B CD 93 8C    		 CALL RS_TXT	;
561)   905E CD 26 80    		 CALL OS_PRINTMSG	;
562)   9061 20 42 59 54 		 DEFM " BYTES READ"	;
562)   9065 45 53 20 52 		 DEFM " BYTES READ"	;
562)   9069 45 41 44    		 DEFM " BYTES READ"	;
563)   906C 0A 0D 00    		 DB 10,13,0	;
564)   906F CD B0 8F    		 CALL STRG_CLSFILE	;
565)   9072 C1          		 POP BC   ;BYTES LOADED TO BUFFER	;BYTES LOADED TO BUFFER
566)   9073 AF          		 XOR A	;
567)   9074 C9          		 RET	;
568)   9075 C1          		FOPENERR: POP BC	;
569)   9076 D1          		 POP DE	;
570)   9077 CD 43 9E    		 CALL PRINTNUM	;
571)   907A CD 26 80    		 CALL OS_PRINTMSG	;
572)   907D 2D 2D 3E 45 		 DEFM "-->ERROR AT LOADFILE"	;
572)   9081 52 52 4F 52 		 DEFM "-->ERROR AT LOADFILE"	;
572)   9085 20 41 54 20 		 DEFM "-->ERROR AT LOADFILE"	;
572)   9089 4C 4F 41 44 		 DEFM "-->ERROR AT LOADFILE"	;
572)   908D 46 49 4C 45 		 DEFM "-->ERROR AT LOADFILE"	;
573)   9091 0A 0D 00    		 DB 10,13,0	;
574)   9094 21 F0 00    		 LD HL,STRGBUFF	;
575)   9097 CD 93 8C    		 CALL RS_TXT	;
576)   909A CD F3 8C    		 CALL RS_NEWLINE	;
577)   909D 37          		 SCF	;
578)   909E C9          		 RET	;
586)   909F D5          		STRG_READBUFR: PUSH DE	;
587)   90A0 C5          		 PUSH BC	;
593)   90A1 CD 78 9E    		 CALL COPYFNAME	;
594)   90A4 AF          		 XOR A   ;READ ONLY 	;READ ONLY
595)   90A5 CD 6B 8F    		 CALL STRG_OPNFILE  	;
596)   90A8 20 32       		 JR NZ, RB_FOPENERR	;
601)   90AA C1          		 POP BC  ;BYTE OFFSET	;BYTE OFFSET
602)   90AB CD 5D 8E    		 CALL STRG_SETPOS16	;
603)   90AE 01 F4 01    		 LD BC, 500 ;READ 500 BYTES  	;READ 500 BYTES
604)   90B1 D1          		 POP DE  ;DEST BUFFER	;DEST BUFFER
605)   90B2 CD BE 8F    		 CALL STRG_BLKREAD	;
606)   90B5 28 1E       		 JR Z, RB_FREADOK	;
607)   90B7 CD 43 9E    		 CALL PRINTNUM	;
608)   90BA CD 26 80    		 CALL OS_PRINTMSG	;
609)   90BD 20 45 52 52 		 DEFM " ERROR READING FILE"	;
609)   90C1 4F 52 20 52 		 DEFM " ERROR READING FILE"	;
609)   90C5 45 41 44 49 		 DEFM " ERROR READING FILE"	;
609)   90C9 4E 47 20 46 		 DEFM " ERROR READING FILE"	;
609)   90CD 49 4C 45    		 DEFM " ERROR READING FILE"	;
610)   90D0 0A 0D 00    		 DB 10,13,0	;
611)   90D3 18 09       		 JR RB_FOPENERR2	;
612)   90D5 C5          		RB_FREADOK: PUSH BC	;
620)   90D6 CD B0 8F    		 CALL STRG_CLSFILE	;
621)   90D9 C1          		 POP BC   ;BYTES LOADED TO BUFFER	;BYTES LOADED TO BUFFER
622)   90DA AF          		 XOR A	;
623)   90DB C9          		 RET	;
624)   90DC C1          		RB_FOPENERR: POP BC	;
625)   90DD D1          		 POP DE	;
626)   90DE CD 43 9E    		RB_FOPENERR2: CALL PRINTNUM	;
627)   90E1 CD 26 80    		 CALL OS_PRINTMSG	;
628)   90E4 2D 2D 3E 45 		 DEFM "-->ERROR OPENING FILE"	;
628)   90E8 52 52 4F 52 		 DEFM "-->ERROR OPENING FILE"	;
628)   90EC 20 4F 50 45 		 DEFM "-->ERROR OPENING FILE"	;
628)   90F0 4E 49 4E 47 		 DEFM "-->ERROR OPENING FILE"	;
628)   90F4 20 46 49 4C 		 DEFM "-->ERROR OPENING FILE"	;
628)   90F8 45          		 DEFM "-->ERROR OPENING FILE"	;
629)   90F9 0A 0D 00    		 DB 10,13,0	;
630)   90FC 21 F0 00    		 LD HL,STRGBUFF	;
631)   90FF CD 93 8C    		 CALL RS_TXT	;
632)   9102 CD F3 8C    		 CALL RS_NEWLINE	;
633)   9105 37          		 SCF	;
634)   9106 C9          		 RET	;
639)   9107 D5          		STRG_BLKWRITE: PUSH DE	;
640)   9108 3E 3C       		 LD A, CMD_BYTE_WRITE	;
641)   910A CD EB 92    		     CALL CH376_COMMD	;
642)   910D 79          		     LD A, C                           ; BYTES REQUEST ON BC	; BYTES REQUEST ON BC
643)   910E CD EF 92    		     CALL CH376_DATAWR	;
644)   9111 78          		     LD A, B	;
645)   9112 CD EF 92    		     CALL CH376_DATAWR    	;
649)   9115 E1          		 POP HL	;
650)   9116 CD 7C 92    		STBW_DOREST: CALL CH376_WTCMDEND 	;
651)   9119 28 1B       		 JR Z, WFR_DONE   ;Z=NO MORE OR CANNOT READ	;Z=NO MORE OR CANNOT READ
652)   911B FE 1E       		 CP USB_INT_DISK_WRITE                    	;
653)   911D 20 19       		     JR NZ, WFR_ERROR	;
654)   911F 3E 2D       		 LD A,CMD_WR_REQ_DATA	;
655)   9121 CD EB 92    		 CALL CH376_COMMD 	;
657)   9124 CD FE 92    		 CALL CH376_DATARD ;READ BYTE COUNT UP TO 255 BYTES	;READ BYTE COUNT UP TO 255 BYTES
658)   9127 47          		 LD B,A   	;
660)   9128 7E          		STBW_NXT1: LD A,(HL)	;
661)   9129 CD EF 92    		 CALL CH376_DATAWR	;
662)   912C 23          		 INC HL	;
663)   912D 10 F9       		 DJNZ STBW_NXT1	;
664)   912F 3E 3D       		 LD A, CMD_BYTE_WR_GO 	;
665)   9131 CD EB 92    		 CALL CH376_COMMD 	;
666)   9134 18 E0       		 JR STBW_DOREST	;
672)   9136 B7          		 OR A	;
673)   9137 C9          		 RET	;
674)   9138 F5          		WFR_ERROR: PUSH AF	;
675)   9139 CD 43 9E    		 CALL PRINTNUM	;
676)   913C CD 26 80    		 CALL OS_PRINTMSG	;
677)   913F 45 52 52 4F 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   9143 52 20 57 52 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   9147 49 54 49 4E 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   914B 47 20 42 4C 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   914F 4F 43 4B 21 		 DEFM "ERROR WRITING BLOCK!!! "	;
677)   9153 21 21 20    		 DEFM "ERROR WRITING BLOCK!!! "	;
678)   9156 0D 0A 00    		 DB 13,10,0 	;
679)   9159 F1          		 POP AF	;
680)   915A 06 02       		 LD B,2	;
681)   915C 05          		 DEC B	;
682)   915D C9          		 RET  	;
690)   915E D5          		STRG_SAVEFILE: PUSH DE	;
691)   915F C5          		 PUSH BC	;
692)   9160 E5          		 PUSH HL  	;
693)   9161 CD 26 80    		 CALL OS_PRINTMSG	;
694)   9164 0A 0D       		 DB 10,13	;
695)   9166 53 41 56 45 		 DEFM "SAVE FILE"	;
695)   916A 20 46 49 4C 		 DEFM "SAVE FILE"	;
695)   916E 45          		 DEFM "SAVE FILE"	;
696)   916F 0A 0D 0A 0D 		 DB 10,13,10,13,0	;
696)   9173 00          		 DB 10,13,10,13,0	;
697)   9174 E1          		 POP HL	;
698)   9175 CD 78 9E    		 CALL COPYFNAME	;
699)   9178 3E 04       		 LD A,4   ;CREATE THE FILE	;CREATE THE FILE
700)   917A CD 6B 8F    		 CALL STRG_OPNFILE  	;
701)   917D 20 4E       		 JR NZ, FSAVEERR	;
702)   917F CD 26 80    		 CALL OS_PRINTMSG	;
703)   9182 0A 0D       		 DB 10,13	;
704)   9184 46 49 4C 45 		 DEFM "FILE CREATED OK"	;
704)   9188 20 43 52 45 		 DEFM "FILE CREATED OK"	;
704)   918C 41 54 45 44 		 DEFM "FILE CREATED OK"	;
704)   9190 20 4F 4B    		 DEFM "FILE CREATED OK"	;
705)   9193 0A 0D 00    		 DB 10,13,0	;
706)   9196 C1          		 POP BC  ;BYTECOUNT	;BYTECOUNT
707)   9197 D1          		 POP DE  ;SOURCE BUFFER	;SOURCE BUFFER
708)   9198 CD 07 91    		 CALL STRG_BLKWRITE	;
709)   919B 28 19       		 JR Z, FWRITEOK	;
711)   919D CD 26 80    		 CALL OS_PRINTMSG	;
712)   91A0 20 45 52 52 		 DEFM " ERROR WRITING FILE"	;
712)   91A4 4F 52 20 57 		 DEFM " ERROR WRITING FILE"	;
712)   91A8 52 49 54 49 		 DEFM " ERROR WRITING FILE"	;
712)   91AC 4E 47 20 46 		 DEFM " ERROR WRITING FILE"	;
712)   91B0 49 4C 45    		 DEFM " ERROR WRITING FILE"	;
713)   91B3 0A 0D 00    		 DB 10,13,0	;
714)   91B6 CD 26 80    		FWRITEOK: CALL OS_PRINTMSG	;
715)   91B9 42 59 54 45 		 DEFM "BYTE WRITTEN"	;
715)   91BD 20 57 52 49 		 DEFM "BYTE WRITTEN"	;
715)   91C1 54 54 45 4E 		 DEFM "BYTE WRITTEN"	;
716)   91C5 0A 0D 00    		 DB 10,13,0	;
717)   91C8 CD B0 8F    		 CALL STRG_CLSFILE	;
718)   91CB AF          		 XOR A	;
719)   91CC C9          		 RET	;
720)   91CD C1          		FSAVEERR: POP BC	;
721)   91CE D1          		 POP DE	;
722)   91CF CD 43 9E    		 CALL PRINTNUM	;
723)   91D2 CD 26 80    		 CALL OS_PRINTMSG	;
724)   91D5 2D 2D 3E 45 		 DEFM "-->ERROR CREATING FILE"	;
724)   91D9 52 52 4F 52 		 DEFM "-->ERROR CREATING FILE"	;
724)   91DD 20 43 52 45 		 DEFM "-->ERROR CREATING FILE"	;
724)   91E1 41 54 49 4E 		 DEFM "-->ERROR CREATING FILE"	;
724)   91E5 47 20 46 49 		 DEFM "-->ERROR CREATING FILE"	;
724)   91E9 4C 45       		 DEFM "-->ERROR CREATING FILE"	;
725)   91EB 0A 0D 00    		 DB 10,13,0	;
726)   91EE 21 F0 00    		 LD HL,STRGBUFF	;
727)   91F1 CD 93 8C    		 CALL RS_TXT	;
728)   91F4 CD F3 8C    		 CALL RS_NEWLINE	;
729)   91F7 37          		 SCF	;
730)   91F8 C9          		 RET	;
740)   91F9 C5          		STRG_WRITEBUFR: PUSH BC	;
741)   91FA D5          		 PUSH DE	;
742)   91FB CD 78 9E    		 CALL COPYFNAME   ;HL NOT NEEDED AFTER THIS	;HL NOT NEEDED AFTER THIS
743)   91FE 3E 01       		 LD A,1    ;OPEN THE FILE FOR W	;OPEN THE FILE FOR W
744)   9200 CD 6B 8F    		 CALL STRG_OPNFILE  	;
745)   9203 20 0B       		 JR NZ,SWB_CREATE  ;ON ERROR TRY TO CREATE THE FILE	;ON ERROR TRY TO CREATE THE FILE
747)   9205 01 FF FF    		 LD BC,$FFFF	;
748)   9208 11 FF FF    		 LD DE,$FFFF 	;
749)   920B CD 66 8E    		 CALL STRG_SETPOS  ;GOTO EOF	;GOTO EOF
750)   920E 18 09       		 JR SWB_WRITEBUF	;
752)   9210 3E 04       		 LD A,4	;
753)   9212 CD 6B 8F    		 CALL STRG_OPNFILE  	;
754)   9215 3E 97       		 LD A,151   ;ERROR NUMBER	;ERROR NUMBER
755)   9217 20 0D       		 JR NZ, SWB_ERR	;
756)   9219 D1          		SWB_WRITEBUF: POP DE	;
757)   921A C1          		 POP BC    ;THE BYTE COUNT  	;THE BYTE COUNT
758)   921B CD 07 91    		 CALL STRG_BLKWRITE  	;
759)   921E F5          		 PUSH AF	;
760)   921F CD B0 8F    		 CALL STRG_CLSFILE  ;ALWAYS CLOSE FILE	;ALWAYS CLOSE FILE
761)   9222 F1          		 POP AF	;
762)   9223 C0          		 RET NZ    ;NZ IF ERROR	;NZ IF ERROR
763)   9224 AF          		 XOR A	;
764)   9225 C9          		 RET	;
765)   9226 D1          		SWB_ERR: POP DE	;
766)   9227 C1          		 POP BC  	;
767)   9228 37          		 SCF	;
768)   9229 C9          		 RET  	;
  3)   922A 	            		INT376CMD EQU DEV376+1	;
  4)   922A 	            		INT376DAT EQU DEV376	;
 90)   922A CD FE 92    		CH376_GETDATA: CALL CH376_DATARD	;
 91)   922D FE 00       		 CP 0	;
 92)   922F C8          		 RET Z   ;NO DATA AVAILABLE	;NO DATA AVAILABLE
 99)   9230 F5          		               PUSH AF	;
100)   9231 11 8B 00    		 LD DE,USBBUF	;
101)   9234 47          		 LD B,A	;
102)   9235 CD FE 92    		UDC_NXT1: CALL CH376_DATARD	;
104)   9238 12          		 LD (DE),A	;
105)   9239 13          		 INC DE	;
109)   923A 10 F9       		 DJNZ UDC_NXT1 	;
110)   923C F1          		               POP AF	;
111)   923D C9          		 RET	;
114)   923E F5          		DISKERROR: PUSH AF	;
115)   923F CD 9D 8C    		 CALL RS_MESG	;
116)   9242 46 41 54 41 		 DEFM "FATAL ERROR:" 	;
116)   9246 4C 20 45 52 		 DEFM "FATAL ERROR:" 	;
116)   924A 52 4F 52 3A 		 DEFM "FATAL ERROR:" 	;
117)   924E 00          		 DB 0  	;
118)   924F F1          		 POP AF	;
119)   9250 CD 43 9E    		 CALL PRINTNUM	;
120)   9253 21 5F 92    		 LD HL,ERR_PART	;
121)   9256 FE 92       		 CP ERR_TYPE_ERROR	;
122)   9258 28 01       		 JR Z,PRNMES	;
123)   925A C9          		 RET	;
124)   925B CD 93 8C    		PRNMES: CALL RS_TXT 	;
125)   925E C9          		 RET	;
127)   925F 50 41 52 54 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   9263 49 54 49 4F 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   9267 4E 2E 4E 4F 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   926B 54 2E 53 55 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   926F 50 50 4F 52 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   9273 54 45 44 21 		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
127)   9277 21 21       		ERR_PART DEFM "PARTITION NOT SUPPORTED!!!"	;
128)   9279 0A 0D 00    		 DB 10,13,0	;
138)   927C E5          		CH376_WTCMDEND: PUSH HL	;
139)   927D CD 8A 92    		 CALL CH376_WAITINT	;
140)   9280 E1          		 POP HL	;
141)   9281 C0          		               RET NZ	;
142)   9282 D8          		 RET C	;
143)   9283 AF          		 XOR A	;
144)   9284 CD A9 92    		 CALL CH376_GETSTAT	;
145)   9287 FE 14       		 CP USB_INT_SUCCESS  	;
146)   9289 C9          		 RET  ;NZ FLAG MEANS ERROR USUALLY	;NZ FLAG MEANS ERROR USUALLY
152)   928A AF          		CH376_WAITINT: XOR A	;
153)   928B 01 32 00    		 LD BC,50	;
154)   928E CD FB 92    		C3AGN2: CALL CH376_INSTAT	;
155)   9291 CB 7F       		 BIT 7,A	;
156)   9293 C8          		 RET Z	;
157)   9294 F5          		 PUSH AF	;
158)   9295 C5          		 PUSH BC	;
159)   9296 06 04       		 LD B,20/5	;
160)   9298 CD E6 9B    		 CALL DELAY5MICS	;
161)   929B C1          		 POP BC	;
162)   929C F1          		 POP AF	;
163)   929D 0B          		 DEC BC	;
164)   929E 5F          		 LD E,A	;
165)   929F 78          		 LD A,B	;
166)   92A0 B1          		 OR C	;
167)   92A1 7B          		 LD A,E	;
168)   92A2 20 EA       		 JR NZ, C3AGN2  	;
173)   92A4 37          		 SCF ;TIMEOUT       	;TIMEOUT
174)   92A5 06 02       		 LD B,2	;
175)   92A7 05          		 DEC B  ;NZ FLAG	;NZ FLAG
176)   92A8 C9          		 RET	;
178)   92A9 3E 22       		CH376_GETSTAT: LD A,CMD_GET_STATUS	;
179)   92AB CD EB 92    		 CALL CH376_COMMD	;
180)   92AE CD FE 92    		 CALL CH376_DATARD	;
181)   92B1 C9          		 RET	;
189)   92B2 01 C4 09    		CH376_CHOK: LD BC,2500	;
190)   92B5 CD FB 92    		C3AGN: CALL CH376_INSTAT	;
191)   92B8 CB 67       		 BIT 4,A   ;CHECK BUSY	;CHECK BUSY
192)   92BA C8          		 RET Z   	;
193)   92BB C5          		 PUSH BC	;
194)   92BC F5          		 PUSH AF	;
195)   92BD 06 0A       		 LD B,50/5	;
196)   92BF CD E6 9B    		 CALL DELAY5MICS	;
197)   92C2 F1          		 POP AF	;
198)   92C3 C1          		 POP BC	;
199)   92C4 0B          		 DEC BC	;
200)   92C5 5F          		 LD E,A	;
201)   92C6 78          		 LD A,B	;
202)   92C7 B1          		 OR C	;
203)   92C8 7B          		 LD A,E	;
204)   92C9 20 EA       		 JR NZ,C3AGN	;
205)   92CB F5          		 PUSH AF  	;
206)   92CC CD 43 9E    		 CALL PRINTNUM  	;
207)   92CF F1          		 POP AF	;
208)   92D0 CD 9D 8C    		 CALL RS_MESG	;
209)   92D3 2A 2A 2A 43 		 DEFM "***CMD TIMEOUT***"	;
209)   92D7 4D 44 20 54 		 DEFM "***CMD TIMEOUT***"	;
209)   92DB 49 4D 45 4F 		 DEFM "***CMD TIMEOUT***"	;
209)   92DF 55 54 2A 2A 		 DEFM "***CMD TIMEOUT***"	;
209)   92E3 2A          		 DEFM "***CMD TIMEOUT***"	;
210)   92E4 0A 0D 00    		 DB 10,13,0       	;
211)   92E7 06 02       		 LD B,2	;
212)   92E9 05          		 DEC B  ;NZ FLAG	;NZ FLAG
213)   92EA C9          		 RET	;
219)   92EB D3 31       		CH376_COMMD: OUT (INT376CMD),A	;
220)   92ED 18 02       		 JR C3D_CONT	;
223)   92EF D3 30       		CH376_DATAWR: OUT (INT376DAT),A 	;
224)   92F1 C5          		C3D_CONT: PUSH BC	;
225)   92F2 D5          		 PUSH DE	;
226)   92F3 E5          		 PUSH HL	;
227)   92F4 CD B2 92    		 CALL CH376_CHOK  ;CHECK NOT BUSY	;CHECK NOT BUSY
228)   92F7 E1          		 POP HL	;
229)   92F8 D1          		 POP DE	;
230)   92F9 C1          		 POP BC	;
231)   92FA C9          		 RET	;
233)   92FB DB 31       		CH376_INSTAT: IN A,(INT376CMD)	;
235)   92FD C9          		 RET	;
238)   92FE DB 30       		CH376_DATARD: IN A,(INT376DAT)	;
243)   9300 C9          		 RET	;
246)   9301 3E 01       		CH376_VERSION: LD A,CMD_GET_IC_VER 	;
247)   9303 CD EB 92    		 CALL CH376_COMMD	;
248)   9306 CD FE 92    		 CALL CH376_DATARD	;
249)   9309 E6 0F       		 AND 00001111B	;
250)   930B C9          		               RET	;
252)   930C 3E 05       		CH376_INIT:    LD A,CMD_RESET_ALL	;
253)   930E CD EB 92    		 CALL CH376_COMMD  	;
254)   9311 3E 06       		 LD A,CMD_CHECK_EXIST 	;
255)   9313 CD EB 92    		 CALL CH376_COMMD	;
256)   9316 3E 57       		 LD A,87	;
257)   9318 CD EF 92    		 CALL CH376_DATAWR	;
258)   931B CD FE 92    		 CALL CH376_DATARD	;
259)   931E FE A8       		 CP 255 - 87 	;
260)   9320 C9          		               RET               	;
264)   9321 F5          		CH376_SETUSB: PUSH AF	;
265)   9322 3E 15       		               LD A,CMD_SETUSB_MODE	;
266)   9324 CD EB 92    		 CALL CH376_COMMD	;
267)   9327 F1          		               POP AF	;
268)   9328 CD EF 92    		 CALL CH376_DATAWR	;
270)   932B 06 04       		 LD B,20/5	;
271)   932D CD E6 9B    		 CALL DELAY5MICS     ;WAIT A BIT	;WAIT A BIT
276)   9330 CD A9 92    		 CALL CH376_GETSTAT	;
277)   9333 FE 15       		 CP USB_INT_CONNECT	;
278)   9335 C8          		 RET Z	;
280)   9336 F5          		 PUSH AF	;
281)   9337 CD 9D 8C    		 CALL CH376_ERROR	;
282)   933A 45 52 52 3A 		 DEFM "ERR: SETUSBMODE"	;
282)   933E 20 53 45 54 		 DEFM "ERR: SETUSBMODE"	;
282)   9342 55 53 42 4D 		 DEFM "ERR: SETUSBMODE"	;
282)   9346 4F 44 45    		 DEFM "ERR: SETUSBMODE"	;
283)   9349 0A 0D 00    		 DB 10,13,0	;
284)   934C F1          		 POP AF	;
285)   934D CD 43 9E    		 CALL PRINTNUM	;
286)   9350 C9          		               RET	;
291)   9351 3E 30       		CH376_CONNECT: LD A, CMD_DISK_CONNECT	;
292)   9353 CD EB 92    		     CALL CH376_COMMD	;
293)   9356 CD 7C 92    		 CALL CH376_WTCMDEND	;
295)   9359 D8          		 RET C ;TIMEOUT	;TIMEOUT
296)   935A C8          		 RET Z ;CONNECT OK	;CONNECT OK
301)   935B C9          		 RET ;NZ HERE	;NZ HERE
311)   935C 3E 31       		CH376_MOUNT:   LD A,CMD_DISK_MOUNT  	;
312)   935E CD EB 92    		 CALL CH376_COMMD	;
313)   9361 CD 7C 92    		 CALL CH376_WTCMDEND  	;
314)   9364 C9          		 RET	;
319)   9365 06 0A       		CH376_MOUNTDEV:   LD B,10  ;TRY TO MOUNT 10 TIMES	;TRY TO MOUNT 10 TIMES
320)   9367 C5          		CM_AGN1: PUSH BC	;
321)   9368 CD 21 93    		 CALL CH376_SETUSB	;
322)   936B 20 10       		 JR NZ,CM_ERROR	;
323)   936D CD 51 93    		 CALL CH376_CONNECT	;
324)   9370 20 0B       		 JR NZ,CM_ERROR	;
325)   9372 3E 31       		        LD A,CMD_DISK_MOUNT  	;
326)   9374 CD EB 92    		 CALL CH376_COMMD	;
327)   9377 CD 7C 92    		 CALL CH376_WTCMDEND	;
328)   937A C1          		 POP BC	;
329)   937B C8          		 RET Z	;
330)   937C C5          		 PUSH BC	;
331)   937D 06 64       		CM_ERROR: LD B,100	;
332)   937F CD F9 9B    		 CALL DELAYMILI     ;WAIT A BIT	;WAIT A BIT
333)   9382 C1          		 POP BC	;
334)   9383 10 E2       		 DJNZ CM_AGN1  	;
335)   9385 06 02       		 LD B,2	;
336)   9387 05          		 DEC B  ;NZ  	;NZ
337)   9388 F5          		 PUSH AF	;
338)   9389 CD 9D 8C    		 CALL CH376_ERROR	;
339)   938C 45 52 52 3A 		 DEFM "ERR: MOUNT DISK"	;
339)   9390 20 4D 4F 55 		 DEFM "ERR: MOUNT DISK"	;
339)   9394 4E 54 20 44 		 DEFM "ERR: MOUNT DISK"	;
339)   9398 49 53 4B    		 DEFM "ERR: MOUNT DISK"	;
340)   939B 0A 0D 00    		 DB 10,13,0	;
341)   939E F1          		     POP AF	;
342)   939F C9          		               RET	;
345)   93A0 7E          		CH376_WRSTRING: LD A,(HL)	;
351)   93A1 CD EF 92    		 CALL CH376_DATAWR	;
352)   93A4 C0          		 RET NZ	;
353)   93A5 7E          		 LD A,(HL)	;
354)   93A6 B7          		 OR A	;
355)   93A7 C8          		 RET Z	;
356)   93A8 23          		 INC HL	;
357)   93A9 18 F5       		 JR CH376_WRSTRING	;
  7)   93AB 	            		 DI2C_STA EQU DEVI2C+0      ;00 A0=LOW A1=LOW READONLY  DEF $F8	;00 A0=LOW A1=LOW READONLY  DEF $F8
  8)   93AB 	            		 DI2C_INDPTR EQU DEVI2C+0     ;00 A0=LOW A1=LOW WRITEONLY DEF $00	;00 A0=LOW A1=LOW WRITEONLY DEF $00
  9)   93AB 	            		 DI2C_DAT EQU DEVI2C+1      ;01 A0=HIGH A1=LOW R/W   DEF $00	;01 A0=HIGH A1=LOW R/W   DEF $00
 10)   93AB 	            		 DI2C_CON EQU DEVI2C+3      ;11 A0=HIGH A1=HIGH R/W  DEF $00	;11 A0=HIGH A1=HIGH R/W  DEF $00
 11)   93AB 	            		 DI2C_INDIR EQU DEVI2C+2     ;10 A0=LOW A1=HIGH R/W  DEF $00	;10 A0=LOW A1=HIGH R/W  DEF $00
 56)   93AB C5          		I2C_RDSTAT_WT: PUSH BC	;
 57)   93AC 01 00 20    		 LD BC, $2000	;
 58)   93AF DB 73       		I2CRWT_AGN: IN A, (DI2C_CON)      ;READ CONTROL REGISTER BIT 3 IS SI	;READ CONTROL REGISTER BIT 3 IS SI
 59)   93B1 CB 5F       		 BIT 3, A        ;CHECK BIT 3 SI	;CHECK BIT 3 SI
 60)   93B3 20 05       		 JR NZ, I2CRWT_OK       ;BIT 3 SHOULD BE SET IF VALID STATUS	;BIT 3 SHOULD BE SET IF VALID STATUS
 61)   93B5 0B          		 DEC BC	;
 62)   93B6 78          		 LD A, B	;
 63)   93B7 B1          		 OR C	;
 64)   93B8 20 F5       		 JR NZ, I2CRWT_AGN	;
 65)   93BA C1          		I2CRWT_OK: POP BC	;
 66)   93BB DB 70       		 IN A, (DI2C_STA)       ;VALID HERE	;VALID HERE
 67)   93BD C9          		 RET	;
 69)   93BE DB 73       		I2C_RDSTAT_NW: IN A, (DI2C_CON)      ;READ CONTROL REGISTER BIT 3 IS SI	;READ CONTROL REGISTER BIT 3 IS SI
 70)   93C0 CB 5F       		 BIT 3, A        ;CHECK BIT 3 SI	;CHECK BIT 3 SI
 71)   93C2 3E FF       		 LD A, $FF        ;$FF=INVALID STATUS	;$FF=INVALID STATUS
 72)   93C4 C8          		 RET Z         ;BIT 3 SHOULD BE SET IF VALID STATUS	;BIT 3 SHOULD BE SET IF VALID STATUS
 73)   93C5 DB 70       		 IN A, (DI2C_STA)       ;VALID HERE	;VALID HERE
 74)   93C7 C9          		 RET	;
 77)   93C8 3E 01       		I2C_INIT: LD A, I2CADR	;
 78)   93CA D3 70       		 OUT (DI2C_INDPTR), A	;
 79)   93CC 3E E0       		 LD A, $E0	;
 80)   93CE D3 72       		 OUT (DI2C_INDIR), A       ;SET MY SLAVE ADDR	;SET MY SLAVE ADDR
 82)   93D0 3E 40       		 LD A, $40        ;INIT	;INIT
 83)   93D2 D3 73       		 OUT (DI2C_CON), A      ;	;
 84)   93D4 06 64       		 LD B, 500/5	;
 85)   93D6 CD E6 9B    		 CALL DELAY5MICS	;
 92)   93D9 3E 06       		 LD A, I2CMODE	;
 93)   93DB D3 70       		 OUT (DI2C_INDPTR), A      ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
 94)   93DD 3E 00       		 LD A, 0        ;SELECT MODE 0	;SELECT MODE 0
 95)   93DF D3 72       		 OUT (DI2C_INDIR), A	;
 96)   93E1 3E 02       		 LD A, I2CSCLL	;
 97)   93E3 D3 70       		 OUT (DI2C_INDPTR), A      ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
 98)   93E5 3E 9D       		 LD A, $9D        ;SELECT CLK L	;SELECT CLK L
 99)   93E7 D3 72       		 OUT (DI2C_INDIR), A	;
100)   93E9 3E 03       		 LD A, I2CSCLH	;
101)   93EB D3 70       		 OUT (DI2C_INDPTR), A      ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
102)   93ED 3E 86       		 LD A, $86        ;SELECT CLK H	;SELECT CLK H
103)   93EF D3 72       		 OUT (DI2C_INDIR), A	;
105)   93F1 C9          		 RET	;
112)   93F2 3E 60       		I2C_WR_BYTE: LD A, $60       ;START	;START
113)   93F4 D3 73       		 OUT (DI2C_CON), A	;
114)   93F6 CD AB 93    		WRB_LP1: CALL I2C_RDSTAT_WT      ;WAIT FOR INTERRUPT SI=1	;WAIT FOR INTERRUPT SI=1
115)   93F9 5F          		 LD E, A        ;SAVE STATUS	;SAVE STATUS
116)   93FA FE 08       		 CP MASTER_START_TXed      ;A HAS THE STATUS	;A HAS THE STATUS
117)   93FC 28 21       		 JR Z, WRB_S1	;
118)   93FE FE 10       		 CP MASTER_RESTART_TXed	;
119)   9400 28 1D       		 JR Z, WRB_S1	;
120)   9402 FE 28       		 CP MASTER_DATA_W_ACK	;
121)   9404 28 26       		 JR Z, WRB_S2	;
122)   9406 FE 18       		 CP MASTER_SLA_W_ACK	;
123)   9408 28 23       		 JR Z, WRB_S3	;
124)   940A FE 20       		 CP MASTER_SLA_W_NAK	;
125)   940C 28 2D       		 JR Z, WRB_EXIT	;
126)   940E FE 30       		 CP MASTER_DATA_W_NAK	;
127)   9410 28 29       		 JR Z, WRB_EXIT	;
128)   9412 FE 38       		 CP MASTER_ARB_LOST	;
129)   9414 C8          		 RET Z	;
130)   9415 FE B0       		 CP SLAVE_AL_ADDRESSED_R	;
131)   9417 C8          		 RET Z	;
132)   9418 FE 68       		 CP SLAVE_AL_ADDRESSED_W	;
133)   941A C8          		 RET Z	;
134)   941B FE D8       		 CP SLAVE_GENERALCALL_AL	;
135)   941D C8          		 RET Z	;
136)   941E C9          		 RET	;
138)   941F 7A          		WRB_S1: LD A, D        ;DEVICE ADDR	;DEVICE ADDR
139)   9420 CB 27       		 SLA A	;
140)   9422 E6 FE       		 AND $FE        ;ADDR+WRITE ON D0=0	;ADDR+WRITE ON D0=0
141)   9424 D3 71       		 OUT (DI2C_DAT), A	;
142)   9426 3E 40       		 LD A, $40	;
143)   9428 D3 73       		 OUT (DI2C_CON), A	;
144)   942A 18 CA       		 JR WRB_LP1	;
145)   942C 0B          		WRB_S2: DEC BC	;
146)   942D 78          		WRB_S3: LD A, B	;
147)   942E B1          		 OR C	;
148)   942F 28 0A       		 JR Z, WRB_EXIT	;
149)   9431 7E          		 LD A, (HL)	;
150)   9432 23          		 INC HL	;
151)   9433 D3 71       		 OUT (DI2C_DAT), A	;
152)   9435 3E 40       		 LD A, $40	;
153)   9437 D3 73       		 OUT (DI2C_CON), A	;
154)   9439 18 BB       		 JR WRB_LP1	;
156)   943B 3E 50       		WRB_EXIT: LD A, $50       ;STOP	;STOP
157)   943D D3 73       		 OUT (DI2C_CON), A	;
158)   943F 78          		 LD A, B	;
159)   9440 B1          		 OR C	;
160)   9441 C9          		 RET         ;IF A NOT ZERO THEN ERROR	;IF A NOT ZERO THEN ERROR
166)   9442 78          		I2C_RD_BYTE: LD A, B	;
167)   9443 B1          		 OR C	;
168)   9444 C8          		 RET Z        ;RETURN IF ZERO BYTE COUNT	;RETURN IF ZERO BYTE COUNT
169)   9445 3E 60       		 LD A, $60	;
170)   9447 D3 73       		 OUT (DI2C_CON), A	;
171)   9449 CD AB 93    		RDB_LP1: CALL I2C_RDSTAT_WT      ;WAIT FOR INTERRUPT SI=1	;WAIT FOR INTERRUPT SI=1
172)   944C 1E 00       		 LD E, 0	;
173)   944E FE 08       		 CP MASTER_START_TXed	;
174)   9450 28 1F       		 JR Z, RDB_S1	;
176)   9452 28 1D       		 JR Z, RDB_S1	;
177)   9454 FE 58       		 CP MASTER_DATA_R_NAK	;
178)   9456 28 26       		 JR Z, RDB_S2	;
179)   9458 FE 50       		 CP MASTER_DATA_R_ACK	;
180)   945A 28 24       		 JR Z, RDB_S3	;
181)   945C FE 40       		 CP MASTER_SLA_R_ACK	;
182)   945E 28 25       		 JR Z, RDB_S4	;
183)   9460 FE 48       		 CP MASTER_SLA_R_NAK	;
184)   9462 28 38       		 JR Z, RDB_EXIT	;
185)   9464 FE 38       		 CP MASTER_ARB_LOST	;
186)   9466 C8          		 RET Z	;
187)   9467 FE B0       		 CP SLAVE_AL_ADDRESSED_R	;
188)   9469 C8          		 RET Z	;
189)   946A FE 68       		 CP SLAVE_AL_ADDRESSED_W	;
190)   946C C8          		 RET Z	;
191)   946D FE D8       		 CP SLAVE_GENERALCALL_AL	;
192)   946F C8          		 RET Z	;
193)   9470 C9          		 RET	;
196)   9471 7A          		RDB_S1: LD A, D        ;DEVICE ADDR	;DEVICE ADDR
197)   9472 CB 27       		 SLA A	;
198)   9474 F6 01       		 OR $01         ;ADDR + READ COMMAND	;ADDR + READ COMMAND
199)   9476 D3 71       		 OUT (DI2C_DAT), A	;
200)   9478 3E 40       		 LD A, $40	;
201)   947A D3 73       		 OUT (DI2C_CON), A	;
202)   947C 18 CB       		 JR RDB_LP1	;
203)   947E 1E 01       		RDB_S2: LD E, 1        ;MEANS WE EXIT	;MEANS WE EXIT
204)   9480 DB 71       		RDB_S3: IN A, (DI2C_DAT)       ;READ DATA	;READ DATA
205)   9482 77          		 LD (HL), A	;
206)   9483 23          		 INC HL	;
207)   9484 0B          		 DEC BC	;
208)   9485 78          		RDB_S4: LD A, B        ; IS LENGTH 0	; IS LENGTH 0
209)   9486 B1          		 OR C	;
210)   9487 28 13       		 JR Z, RDB_EXIT	;
211)   9489 7B          		 LD A, E	;
212)   948A FE 01       		 CP 1	;
213)   948C 28 0E       		 JR Z, RDB_EXIT	;
214)   948E 78          		 LD A, B	;
215)   948F 81          		 ADD C	;
216)   9490 FE 01       		 CP 1	;
217)   9492 3E 40       		 LD A, $40	;
218)   9494 28 02       		 JR Z, RDB_NXT1	;
219)   9496 3E C0       		 LD A, $C0	;
220)   9498 D3 73       		RDB_NXT1: OUT (DI2C_CON), A      ;WRITE $40 IF BYTE COUNT BC=1 ELSE WRITE $C0	;WRITE $40 IF BYTE COUNT BC=1 ELSE WRITE $C0
221)   949A 18 AD       		 JR RDB_LP1	;
223)   949C 3E 50       		RDB_EXIT: LD A, $50	;
224)   949E D3 73       		 OUT (DI2C_CON), A	;
225)   94A0 78          		 LD A, B	;
226)   94A1 B1          		 OR C	;
227)   94A2 C9          		 RET         ;IF A NOT ZERO THEN ERROR	;IF A NOT ZERO THEN ERROR
113)   94A3 16 00       		LCD16_WR4BITS: LD D, 0       ;PIN MAP VALUES FRO 8574 BIT 0-7	;PIN MAP VALUES FRO 8574 BIT 0-7
115)   94A5 0F          		 RRCA         ;D4 = D0,D5=D1,D6=D2,D7=D3	;D4 = D0,D5=D1,D6=D2,D7=D3
116)   94A6 30 02       		 JR NC, LWNXT1        ;BIT 0 NOT SET JR	;BIT 0 NOT SET JR
117)   94A8 CB E2       		 SET D4, D	;
118)   94AA 0F          		LWNXT1: RRCA	;
119)   94AB 30 02       		 JR NC, LWNXT2        ;BIT 1 NOT SET JR	;BIT 1 NOT SET JR
120)   94AD CB EA       		 SET D5, D	;
121)   94AF 0F          		LWNXT2: RRCA	;
122)   94B0 30 02       		 JR NC, LWNXT3        ;BIT 2 NOT SET JR	;BIT 2 NOT SET JR
123)   94B2 CB F2       		 SET D6, D	;
124)   94B4 0F          		LWNXT3: RRCA	;
125)   94B5 30 02       		 JR NC, LWNXT4        ;BIT 3 NOT SET JR	;BIT 3 NOT SET JR
126)   94B7 CB FA       		 SET D7, D	;
127)   94B9 7B          		LWNXT4: LD A, E	;
128)   94BA 0F          		 RRCA	;
129)   94BB 30 02       		 JR NC, LWNXT5	;
130)   94BD CB C2       		 SET RS, D	;
132)   94BF 3A 7F 00    		 LD A,(LCD_STSMASK)       ;ADD THE BACKLIGHT MASKS  	;ADD THE BACKLIGHT MASKS
133)   94C2 B2          		 OR D	;
134)   94C3 57          		 LD D,A	;
136)   94C4 CB D2       		 SET EN, D        ;EN=HIGH	;EN=HIGH
137)   94C6 7A          		 LD A, D	;
138)   94C7 CD D1 94    		 CALL LCD16_I2CSEND	;
139)   94CA CB 92       		 RES EN, D        ;EN=LOW	;EN=LOW
140)   94CC 7A          		 LD A, D	;
141)   94CD CD D1 94    		 CALL LCD16_I2CSEND	;
142)   94D0 C9          		 RET	;
146)   94D1 D5          		LCD16_I2CSEND: PUSH DE	;
147)   94D2 E5          		 PUSH HL	;
148)   94D3 21 CB 00    		 LD HL, BUFFER	;
149)   94D6 77          		 LD (HL), A	;
150)   94D7 16 27       		 LD D, LCDADDR	;
151)   94D9 01 01 00    		 LD BC, 1	;
152)   94DC CD F2 93    		 CALL I2C_WRITE	;
153)   94DF E1          		 POP HL	;
154)   94E0 D1          		 POP DE	;
155)   94E1 C9          		 RET	;
158)   94E2 1E 00       		LCD16_COMMD: LD E, COMMAND	;
159)   94E4 18 02       		 JR LCD16_SEND	;
162)   94E6 1E 01       		LCD16_DATA: LD E, LCD_DATA 	;
165)   94E8 57          		LCD16_SEND: LD D, A       ;SAVE A FOR LATER USE	;SAVE A FOR LATER USE
166)   94E9 7B          		 LD A, E	;
167)   94EA 0F          		 RRCA	;
168)   94EB 38 07       		 JR C, ISCMDDATA	;
169)   94ED 0F          		 RRCA	;
170)   94EE 30 04       		 JR NC, ISCMDDATA	;
172)   94F0 1E 00       		 LD E, COMMAND        ;SEND 4 BITS AS COMMAND E=0	;SEND 4 BITS AS COMMAND E=0
173)   94F2 18 0E       		 JR LCSD_4BIT	;
174)   94F4 7A          		ISCMDDATA: LD A, D	;
175)   94F5 CB 3F       		 SRL A	;
176)   94F7 CB 3F       		 SRL A	;
177)   94F9 CB 3F       		 SRL A	;
178)   94FB CB 3F       		 SRL A	;
179)   94FD D5          		 PUSH DE	;
180)   94FE CD A3 94    		 CALL LCD16_WR4BITS      ;HIGH 4 BITS FIRST	;HIGH 4 BITS FIRST
181)   9501 D1          		 POP DE	;
182)   9502 7A          		LCSD_4BIT: LD A, D	;
183)   9503 E6 0F       		 AND $0F	;
184)   9505 CD A3 94    		 CALL LCD16_WR4BITS      ;LOW 4 BITS NEXT	;LOW 4 BITS NEXT
185)   9508 C9          		 RET	;
187)   9509 06 04       		PAUSE: LD B,4	;
188)   950B CD F9 9B    		 CALL DELAYMILI	;
189)   950E C9          		 RET	;
191)   950F 3E 03       		@LCD16_INIT: LD A, 3       ;SET LCD TO 4BIT MODE	;SET LCD TO 4BIT MODE
192)   9511 1E 02       		 LD E, FOUR_BITS	;
193)   9513 CD E8 94    		 CALL LCD16_SEND	;
194)   9516 CD 09 95    		 CALL PAUSE        ;DELAY 4,5ms	;DELAY 4,5ms
195)   9519 3E 03       		 LD A, 3	;
196)   951B 1E 02       		 LD E, FOUR_BITS	;
197)   951D CD E8 94    		 CALL LCD16_SEND	;
198)   9520 CD 09 95    		 CALL PAUSE        ;DELAY 4,5ms	;DELAY 4,5ms
199)   9523 3E 03       		 LD A, 3	;
200)   9525 1E 02       		 LD E, FOUR_BITS	;
201)   9527 CD E8 94    		 CALL LCD16_SEND	;
202)   952A CD 09 95    		 CALL PAUSE        ;DELAY 4,5ms	;DELAY 4,5ms
203)   952D 3E 02       		 LD A, 2        ;PUT 4 BIT MODE	;PUT 4 BIT MODE
204)   952F 1E 02       		 LD E, FOUR_BITS	;
205)   9531 CD E8 94    		 CALL LCD16_SEND	;
206)   9534 CD 09 95    		 CALL PAUSE        ;DELAY 4,5ms	;DELAY 4,5ms
208)   9537 3E 28       		 LD A, LCD_FUNCTIONSET OR LCD_2LINE	;
209)   9539 CD E2 94    		 CALL LCD16_COMMD	;
210)   953C 3E 02       		 LD A, LCD_DISPLAYON OR LCD_CURSOROFF OR LCD_BLINKOFF	;
211)   953E 32 7D 00    		 LD (LCD_DSPCTRL), A	;
212)   9541 CD 66 95    		 CALL LCD16_DISP	;
213)   9544 CD 7A 95    		 CALL LCD16_CLR	;
214)   9547 3E 02       		 LD A, LCD_ENTRYLEFT OR LCD_ENTRYSHIFTDECREMENT	;
215)   9549 32 7E 00    		 LD (LCD_DSPMODE), A	;
216)   954C F6 04       		 OR LCD_ENTRYMODESET	;
217)   954E CD E2 94    		 CALL LCD16_COMMD	;
218)   9551 CD 09 95    		 CALL PAUSE        ;DELAY 4,5ms	;DELAY 4,5ms
219)   9554 CD FD 95    		 CALL LCD16_BKLTON      ;BACKLIGHT ON BY DEFAULT	;BACKLIGHT ON BY DEFAULT
220)   9557 C9          		 RET	;
222)   9558 3A 7D 00    		@LCD16_NODISP: LD A, (LCD_DSPCTRL)	;
223)   955B CB 97       		 RES LCD_DISPLAYON, A	;
224)   955D 32 7D 00    		 LD (LCD_DSPCTRL), A	;
225)   9560 F6 08       		 OR LCD_DISPLAYCONTROL	;
226)   9562 CD E2 94    		 CALL LCD16_COMMD	;
227)   9565 C9          		 RET	;
228)   9566 3A 7D 00    		@LCD16_DISP: LD A, (LCD_DSPCTRL)	;
229)   9569 CB D7       		 SET LCD_DISPLAYON, A	;
230)   956B 32 7D 00    		 LD (LCD_DSPCTRL), A	;
231)   956E F6 08       		 OR LCD_DISPLAYCONTROL	;
232)   9570 CD E2 94    		 CALL LCD16_COMMD	;
233)   9573 C9          		 RET	;
235)   9574 06 02       		LCDDELAY: LD B, HOME_CLEAR_EXEC	;
236)   9576 CD F9 9B    		LCLR_AGN1: CALL DELAYMILI 	;
237)   9579 C9          		 RET	;
239)   957A 3E 01       		@LCD16_CLR: LD A, LCD_CLEARDISPLAY      ;clear display, set cursor position to zero	;clear display, set cursor position to zero
240)   957C CD E2 94    		 CALL LCD16_COMMD	;
241)   957F CD 74 95    		 CALL LCDDELAY	;
242)   9582 C9          		 RET	;
245)   9583 7E          		@LCD16_PRINT: LD A, (HL)	;
246)   9584 FE 00       		 CP 0	;
247)   9586 C8          		 RET Z	;
248)   9587 CD E6 94    		 CALL LCD16_DATA	;
249)   958A 23          		 INC HL	;
250)   958B 18 F6       		 JR LCD16_PRINT	;
253)   958D CD E6 94    		@LCD16_PRCHR: CALL LCD16_DATA	;
254)   9590 C9          		 RET	;
256)   9591 3E 02       		@LCD16_HOME: LD A, LCD_RETURNHOME	;
257)   9593 CD E2 94    		 CALL LCD16_COMMD	;
258)   9596 CD 74 95    		 CALL LCDDELAY	;
259)   9599 C9          		 RET	;
262)   959A 00 40 14 54 		ROWOFFSET: DB $00,$40,$14,$54	;
263)   959E 06 00       		@LCD16_SETCURS: LD B, 0	;
264)   95A0 4B          		 LD C, E	;
265)   95A1 21 9A 95    		 LD HL, ROWOFFSET	;
266)   95A4 09          		 ADD HL, BC	;
267)   95A5 7E          		 LD A, (HL)	;
268)   95A6 82          		 ADD D	;
269)   95A7 F6 80       		 OR LCD_SETDDRAMADDR	;
270)   95A9 CD E2 94    		 CALL LCD16_COMMD	;
271)   95AC C9          		 RET	;
273)   95AD 3A 7D 00    		@LCD16_CURSOFF: LD A, (LCD_DSPCTRL)	;
274)   95B0 CB 8F       		 RES LCD_CURSORON, A	;
275)   95B2 32 7D 00    		 LD (LCD_DSPCTRL), A	;
276)   95B5 F6 08       		 OR LCD_DISPLAYCONTROL	;
277)   95B7 CD E2 94    		 CALL LCD16_COMMD	;
278)   95BA C9          		 RET	;
281)   95BB 3A 7D 00    		@LCD16_CURSON: LD A, (LCD_DSPCTRL)	;
282)   95BE CB CF       		 SET LCD_CURSORON, A	;
283)   95C0 32 7D 00    		 LD (LCD_DSPCTRL), A	;
284)   95C3 F6 08       		 OR LCD_DISPLAYCONTROL	;
285)   95C5 CD E2 94    		 CALL LCD16_COMMD	;
286)   95C8 C9          		 RET	;
288)   95C9 3A 7D 00    		@LCD16_BLINKOFF: LD A, (LCD_DSPCTRL)	;
289)   95CC CB 87       		 RES LCD_BLINKON, A	;
290)   95CE 32 7D 00    		 LD (LCD_DSPCTRL), A	;
291)   95D1 F6 08       		 OR LCD_DISPLAYCONTROL	;
292)   95D3 CD E2 94    		 CALL LCD16_COMMD	;
293)   95D6 C9          		 RET	;
296)   95D7 3A 7D 00    		@LCD16_BLINKON: LD A, (LCD_DSPCTRL)	;
297)   95DA CB C7       		 SET LCD_BLINKON, A	;
298)   95DC 32 7D 00    		 LD (LCD_DSPCTRL), A	;
299)   95DF F6 08       		 OR LCD_DISPLAYCONTROL	;
300)   95E1 CD E2 94    		 CALL LCD16_COMMD	;
301)   95E4 C9          		 RET	;
303)   95E5 3E 18       		@LCD16_SCRLEFT: LD A, LCD_CURSORSHIFT OR LCD_DISPLAYMOVE OR LCD_MOVELEFT	;
304)   95E7 CD E2 94    		 CALL LCD16_COMMD	;
305)   95EA C9          		 RET	;
307)   95EB 3E 1C       		@LCD16_SCRRIGHT: LD A, LCD_CURSORSHIFT OR LCD_DISPLAYMOVE OR LCD_MOVERIGHT	;
308)   95ED CD E2 94    		 CALL LCD16_COMMD	;
309)   95F0 C9          		 RET	;
311)   95F1 3E 10       		@LCD16_MOVLEFT: LD A, LCD_CURSORSHIFT OR LCD_CURSORMOVE OR LCD_MOVELEFT	;
312)   95F3 CD E2 94    		 CALL LCD16_COMMD	;
313)   95F6 C9          		 RET	;
315)   95F7 3E 14       		@LCD16_MOVRIGHT: LD A, LCD_CURSORSHIFT OR LCD_CURSORMOVE OR LCD_MOVERIGHT	;
316)   95F9 CD E2 94    		 CALL LCD16_COMMD	;
317)   95FC C9          		 RET	;
320)   95FD 3E 08       		@LCD16_BKLTON: LD A, BACKLIGHTPINMASK AND LCD_BACKLIGHT	;
321)   95FF 32 7F 00    		 LD (LCD_STSMASK),A	;
322)   9602 CD D1 94    		 CALL LCD16_I2CSEND	;
323)   9605 C9          		 RET	;
325)   9606 3E 00       		@LCD16_BKLTOFF: LD A, BACKLIGHTPINMASK AND LCD_NOBACKLIGHT	;
326)   9608 32 7F 00    		 LD (LCD_STSMASK),A	;
327)   960B CD D1 94    		 CALL LCD16_I2CSEND	;
328)   960E C9          		 RET	;
 29)   960F 53 75 6E 64 		 SUN DEFM  "Sunday"	;
 29)   9613 61 79       		 SUN DEFM  "Sunday"	;
 30)   9615 00          		 DB 0	;
 31)   9616 4D 6F 6E 64 		 MON DEFM  "Monday"	;
 31)   961A 61 79       		 MON DEFM  "Monday"	;
 32)   961C 00          		 DB 0	;
 33)   961D 54 75 65 73 		 TUE DEFM  "Tuesday"	;
 33)   9621 64 61 79    		 TUE DEFM  "Tuesday"	;
 34)   9624 00          		 DB 0	;
 35)   9625 57 65 64 6E 		 WED DEFM  "Wednesday"	;
 35)   9629 65 73 64 61 		 WED DEFM  "Wednesday"	;
 35)   962D 79          		 WED DEFM  "Wednesday"	;
 36)   962E 00          		 DB 0	;
 37)   962F 54 68 75 72 		 THU DEFM  "Thursday"	;
 37)   9633 73 64 61 79 		 THU DEFM  "Thursday"	;
 38)   9637 00          		 DB 0	;
 39)   9638 46 72 69 64 		 FRI DEFM  "Friday"	;
 39)   963C 61 79       		 FRI DEFM  "Friday"	;
 40)   963E 00          		 DB 0	;
 41)   963F 53 61 74 75 		 SAT DEFM  "Saturday"	;
 41)   9643 72 64 61 79 		 SAT DEFM  "Saturday"	;
 42)   9647 00          		 DB 0	;
 44)   9648 0F 96       		 DAYS DEFW SUN	;
 45)   964A 16 96       		 DEFW MON	;
 46)   964C 1D 96       		 DEFW TUE	;
 47)   964E 25 96       		 DEFW WED	;
 48)   9650 2F 96       		 DEFW THU	;
 49)   9652 38 96       		 DEFW FRI	;
 50)   9654 3F 96       		 DEFW SAT	;
 52)   9656 52 54 43 20 		 MESERR DEFM "RTC ER RV"	;
 52)   965A 45 52 20 52 		 MESERR DEFM "RTC ER RV"	;
 52)   965E 56          		 MESERR DEFM "RTC ER RV"	;
 53)   965F 0A 0D 00    		 DEFB 10,13,0	;
 55)   9662 52 54 43 20 		 MESERR0 DEFM "RTC ER SD"	;
 55)   9666 45 52 20 53 		 MESERR0 DEFM "RTC ER SD"	;
 55)   966A 44          		 MESERR0 DEFM "RTC ER SD"	;
 56)   966B 0A 0D 00    		 DEFB 10,13,0	;
 58)   966E 7B          		SHERR0: LD A, E	;
 59)   966F C5          		 PUSH BC	;
 60)   9670 CD 01 81    		 CALL SOUTAS	;
 61)   9673 C1          		 POP BC	;
 62)   9674 79          		 LD A, C	;
 63)   9675 CD 01 81    		 CALL SOUTAS	;
 65)   9678 21 62 96    		 LD HL, MESERR0	;
 66)   967B CD 93 8C    		 CALL RS_TXT	;
 67)   967E C9          		 RET	;
 70)   967F 79          		SHERR: LD A, C	;
 71)   9680 CD 01 81    		 CALL SOUTAS	;
 72)   9683 21 56 96    		 LD HL, MESERR	;
 73)   9686 CD 93 8C    		 CALL RS_TXT	;
 74)   9689 37          		 SCF	;
 75)   968A C9          		 RET	;
 78)   968B AF          		RST_BUF: XOR A	;
 79)   968C 06 14       		 LD B, 20	;
 80)   968E 21 CB 00    		 LD HL, BUFFER	;
 81)   9691 77          		LP1: LD (HL), A	;
 82)   9692 23          		 INC HL	;
 83)   9693 10 FC       		 DJNZ LP1	;
 84)   9695 C9          		 RET	;
 86)   9696 64 64 2F 6D 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   969A 6D 2F 79 79 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   969E 20 77 20 68 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   96A2 68 3A 6D 6D 		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 86)   96A6 3A 73 73    		DATEMASK: DEFM "dd/mm/yy w hh:mm:ss"	;
 89)   96A9 21 96 96    		DS1307_INIT: LD HL,DATEMASK	;
 90)   96AC 11 CB 00    		 LD DE,TIMMSG	;
 91)   96AF 01 13 00    		 LD BC,19	;
 92)   96B2 ED B0       		 LDIR        	;
 93)   96B4 C9          		 RET	;
 95)   96B5 21 CB 00    		DS1307_GETNOW: LD HL, BUFFER	;
 96)   96B8 AF          		 XOR A         ;SEND COMMAND 0	;SEND COMMAND 0
 97)   96B9 77          		 LD (HL), A	;
 98)   96BA 16 68       		 LD D, DS1307_ADDRESS	;
 99)   96BC 01 01 00    		 LD BC, 1	;
100)   96BF CD F2 93    		 CALL I2C_WRITE	;
101)   96C2 C2 6E 96    		 JP NZ, SHERR0	;
103)   96C5 21 CB 00    		 LD HL, BUFFER	;
104)   96C8 16 68       		 LD D, DS1307_ADDRESS	;
105)   96CA 01 07 00    		 LD BC, 7	;
106)   96CD CD 42 94    		 CALL I2C_READ	;
107)   96D0 C2 7F 96    		 JP NZ, SHERR	;
108)   96D3 AF          		 XOR A	;
109)   96D4 C9          		 RET	;
113)   96D5 11 CB 00    		DS1307_SETTIME: LD DE, BUFFER	;
114)   96D8 AF          		 XOR A	;
115)   96D9 12          		 LD (DE), A	;
116)   96DA 13          		 INC DE	;
117)   96DB 21 DC 00    		 LD HL,TIMMSG+17  ;SS	;SS
118)   96DE CD 0C 97    		 CALL SETTMPARAM	;
119)   96E1 21 D9 00    		 LD HL,TIMMSG+14  ;MN	;MN
120)   96E4 CD 0C 97    		 CALL SETTMPARAM	;
121)   96E7 21 D6 00    		 LD HL,TIMMSG+11  ;HH	;HH
122)   96EA CD 0C 97    		 CALL SETTMPARAM	;
123)   96ED 21 D4 00    		 LD HL,TIMMSG+9  ;D OF WEEK 1-7	;D OF WEEK 1-7
124)   96F0 CD 0C 97    		 CALL SETTMPARAM	;
125)   96F3 21 CB 00    		 LD HL,TIMMSG  ;DD	;DD
126)   96F6 CD 0C 97    		 CALL SETTMPARAM	;
127)   96F9 21 CE 00    		 LD HL,TIMMSG+3  ;MM	;MM
128)   96FC CD 0C 97    		 CALL SETTMPARAM	;
129)   96FF 21 D1 00    		 LD HL,TIMMSG+6  ;YY	;YY
130)   9702 CD 0C 97    		 CALL SETTMPARAM	;
131)   9705 3E 00       		 LD A,0	;
132)   9707 12          		 LD (DE), A	;
133)   9708 CD 54 97    		 CALL DS1307_ADJUST	;
134)   970B C9          		 RET	;
136)   970C D5          		SETTMPARAM: PUSH DE	;
137)   970D CD 94 9D    		 CALL strtob	;
138)   9710 D1          		 POP DE	;
139)   9711 CD 36 9C    		 CALL BN2BCD	;
140)   9714 7D          		 LD A,L	;
141)   9715 12          		 LD (DE),A	;
142)   9716 13          		 INC DE  	;
143)   9717 C9          		 RET	;
148)   9718 11 CB 00    		 LD DE, BUFFER	;
149)   971B AF          		 XOR A	;
150)   971C 12          		 LD (DE), A	;
151)   971D 13          		 INC DE	;
152)   971E 3E 0A       		 LD A, 10        ; 10 SECS	; 10 SECS
153)   9720 CD 36 9C    		 CALL BN2BCD	;
154)   9723 7D          		 LD A, L	;
155)   9724 12          		 LD (DE), A	;
156)   9725 13          		 INC DE	;
157)   9726 3E 22       		 LD A, 34        ; 28 MINS	; 28 MINS
158)   9728 CD 36 9C    		 CALL BN2BCD	;
159)   972B 7D          		 LD A, L	;
160)   972C 12          		 LD (DE), A	;
161)   972D 13          		 INC DE	;
162)   972E 3E 12       		 LD A, 18        ; 19 HOURS	; 19 HOURS
163)   9730 CD 36 9C    		 CALL BN2BCD	;
164)   9733 7D          		 LD A, L	;
165)   9734 12          		 LD (DE), A	;
166)   9735 13          		 INC DE	;
167)   9736 3E 05       		 LD A, 5        ; DAY OF WEEK	; DAY OF WEEK
168)   9738 12          		 LD (DE), A	;
169)   9739 13          		 INC DE	;
170)   973A 3E 12       		 LD A, 18        ; 8 DAY	; 8 DAY
171)   973C CD 36 9C    		 CALL BN2BCD	;
172)   973F 7D          		 LD A, L	;
173)   9740 12          		 LD (DE), A	;
174)   9741 13          		 INC DE	;
175)   9742 3E 02       		 LD A, 02        ; 10 MONTH	; 10 MONTH
176)   9744 CD 36 9C    		 CALL BN2BCD	;
177)   9747 7D          		 LD A, L	;
178)   9748 12          		 LD (DE), A	;
179)   9749 13          		 INC DE	;
180)   974A 3E 15       		 LD A, 21        ; 21 YEAR (2020)	; 21 YEAR (2020)
181)   974C CD 36 9C    		 CALL BN2BCD	;
182)   974F 7D          		 LD A, L	;
183)   9750 12          		 LD (DE), A	;
184)   9751 13          		 INC DE	;
185)   9752 AF          		 XOR A	;
186)   9753 12          		 LD (DE), A	;
199)   9754 21 CB 00    		DS1307_ADJUST: LD HL, BUFFER	;
200)   9757 16 68       		 LD D, DS1307_ADDRESS	;
201)   9759 01 09 00    		 LD BC, 9	;
202)   975C CD F2 93    		 CALL I2C_WRITE	;
203)   975F C2 6E 96    		 JP NZ, SHERR0	;
204)   9762 06 01       		 LD B,1	;
205)   9764 CD 03 9C    		 CALL DELAYSEC	;
206)   9767 C9          		 RET	;
210)   9768 21 CB 00    		DS1307_SETSQ: LD HL, BUFFER	;
211)   976B E5          		 PUSH HL	;
212)   976C 3E 07       		 LD A, DS1307_CONTROL_REGISTER	;
213)   976E 77          		 LD (HL), A	;
214)   976F 23          		 INC HL	;
215)   9770 7A          		 LD A, D	;
216)   9771 77          		 LD (HL), A	;
217)   9772 E1          		 POP HL	;
218)   9773 16 68       		 LD D, DS1307_ADDRESS	;
219)   9775 01 02 00    		 LD BC, 2	;
220)   9778 CD F2 93    		 CALL I2C_WRITE	;
221)   977B C2 6E 96    		 JP NZ, SHERR0	;
222)   977E C9          		 RET	;
226)   977F CD 9D 9C    		CONVHL: CALL Bcd2ASC	;
227)   9782 26 00       		 LD H, 0	;
228)   9784 C9          		 RET	;
231)   9785 06 07       		CHKERROR: LD B, 7	;
232)   9787 21 CB 00    		 LD HL, BUFFER	;
233)   978A 7E          		CEAGN: LD A, (HL)	;
234)   978B FE FF       		 CP $FF	;
235)   978D 28 05       		 JR Z, STER	;
236)   978F 23          		 INC HL	;
237)   9790 10 F8       		 DJNZ CEAGN	;
238)   9792 AF          		 XOR A	;
239)   9793 C9          		 RET	;
242)   9794 37          		 SCF	;
243)   9795 C9          		 RET	;
248)   9796 CD 8B 96    		DS1307_GETTIME: CALL RST_BUF	;
249)   9799 CD B5 96    		 CALL DS1307_GETNOW	;
250)   979C D8          		 RET C         ;ERROR RETURN	;ERROR RETURN
251)   979D CD 85 97    		 CALL CHKERROR	;
252)   97A0 D8          		 RET C         ;ERRREAD  ;IF ERROR DONT PRINT	;ERRREAD  ;IF ERROR DONT PRINT
253)   97A1 DD 21 CB 00 		 LD IX, BUFFER	;
254)   97A5 11 CB 00    		 LD DE, TIMMSG	;
255)   97A8 26 00       		 LD H, 0	;
256)   97AA DD 6E 04    		 LD L, (IX + 4)        ;DAY	;DAY
257)   97AD CD 7F 97    		 CALL CONVHL	;
258)   97B0 3E 2F       		 LD A, ' / '	;
259)   97B2 12          		 LD (DE), A	;
260)   97B3 13          		 INC DE	;
261)   97B4 DD 6E 05    		 LD L, (IX + 5)        ;MONTH	;MONTH
262)   97B7 CD 7F 97    		 CALL CONVHL	;
263)   97BA 3E 2F       		 LD A, ' / '	;
264)   97BC 12          		 LD (DE), A	;
265)   97BD 13          		 INC DE	;
266)   97BE DD 6E 06    		 LD L, (IX + 6)        ;YEAR	;YEAR
267)   97C1 CD 7F 97    		 CALL CONVHL	;
268)   97C4 3E 20       		 LD A, ' '	;
269)   97C6 12          		 LD (DE), A	;
270)   97C7 13          		 INC DE	;
271)   97C8 DD 6E 02    		 LD L, (IX + 2)        ;HOUR	;HOUR
272)   97CB CD 7F 97    		 CALL CONVHL	;
273)   97CE 3E 3A       		 LD A, ':'	;
274)   97D0 12          		 LD (DE), A	;
275)   97D1 13          		 INC DE	;
276)   97D2 DD 6E 01    		 LD L, (IX + 1)        ;MIN	;MIN
277)   97D5 CD 7F 97    		 CALL CONVHL	;
278)   97D8 3E 3A       		 LD A, ':'	;
279)   97DA 12          		 LD (DE), A	;
280)   97DB 13          		 INC DE	;
281)   97DC DD 6E 00    		 LD L, (IX)        ;SECS	;SECS
282)   97DF CD 7F 97    		 CALL CONVHL	;
283)   97E2 13          		 INC DE	;
284)   97E3 AF          		 XOR A	;
285)   97E4 12          		 LD (DE), A	;
286)   97E5 C9          		 RET	;
108)   97E6 ED 44       		DELAYABIT: NEG  ;8 CLOCK CYCLES	;8 CLOCK CYCLES
109)   97E8 ED 44       		 NEG	;
110)   97EA ED 44       		 NEG	;
111)   97EC ED 44       		 NEG	;
112)   97EE ED 44       		 NEG	;
113)   97F0 ED 44       		 NEG	;
114)   97F2 ED 44       		 NEG	;
115)   97F4 ED 44       		 NEG	;
116)   97F6 C9          		 RET	;
123)   97F7 D3 38       		SND_OUT: OUT (DEVSND),A ;SEND TO SOUND	;SEND TO SOUND
139)   97F9 CD E6 97    		 CALL DELAYABIT	;
140)   97FC C9          		 RET	;
142)   97FD 3E 9F       		SND_MUTEALL:   LD A,$9F  ;MUTE CHANNEL 0	;MUTE CHANNEL 0
143)   97FF CD F7 97    		 CALL SND_OUT	;
144)   9802 3E BF       		 LD A,$BF  ;MUTE CHANNEL 1	;MUTE CHANNEL 1
145)   9804 CD F7 97    		 CALL SND_OUT	;
146)   9807 3E DF       		 LD A,$DF  ;MUTE CHANNEL 2	;MUTE CHANNEL 2
147)   9809 CD F7 97    		 CALL SND_OUT	;
148)   980C 3E FF       		 LD A,$FF  ;MUTE CHANNEL NOISE	;MUTE CHANNEL NOISE
149)   980E CD F7 97    		 CALL SND_OUT                	;
150)   9811 C9          		               RET	;
152)   9812 CD FD 97    		SND_INIT: CALL SND_MUTEALL	;
153)   9815 AF          		               XOR A	;
154)   9816 32 F4 00    		               LD (CHANST),A	;
155)   9819 AF          		SND_CLRDAT:    XOR A	;
156)   981A 21 E0 00    		               LD HL,CHANDATA	;
157)   981D 77          		               LD (HL),A	;
158)   981E 54          		               LD D,H	;
159)   981F 5D          		               LD E,L	;
160)   9820 13          		               INC DE	;
161)   9821 01 0B 00    		               LD BC,11  	;
162)   9824 ED B0       		               LDIR	;
163)   9826 C9          		 RET	;
168)   9827 F5          		SND_NOTE:      PUSH AF	;
169)   9828 E6 03       		               AND $03                  ;KEEP 2 BITS	;KEEP 2 BITS
170)   982A 07          		               RLCA	;
171)   982B 07          		               RLCA	;
172)   982C 07          		               RLCA	;
173)   982D 07          		               RLCA	;
174)   982E 07          		               RLCA                    ;TRANSFER TO BITS 6&5	;TRANSFER TO BITS 6&5
175)   982F B4          		               OR H                    ;A HAS THE HI BYTE TO SEND TO THE SOUND CHIP WITH CORRECT CHANNEL	;A HAS THE HI BYTE TO SEND TO THE SOUND CHIP WITH CORRECT CHANNEL
176)   9830 CD F7 97    		               CALL SND_OUT	;
177)   9833 7D          		SN_LOW:        LD A,L                	;
178)   9834 CD F7 97    		               CALL SND_OUT	;
179)   9837 F1          		               POP AF	;
180)   9838 C9          		               RET	;
186)   9839 F5          		SND_DOBEEP:    PUSH AF	;
187)   983A 3E 02       		               LD A,DEFCHN	;
188)   983C 0E 00       		               LD C,SNDVOLHI	;
189)   983E CD 62 98    		               CALL SND_SETVOLUME                	;
190)   9841 3E 02       		               LD A,DEFCHN	;
191)   9843 CD 27 98    		               CALL SND_NOTE	;
192)   9846 06 A0       		               LD B,160	;
193)   9848 CD F9 9B    		               CALL DELAYMILI	;
194)   984B 3E 02       		               LD A,DEFCHN	;
195)   984D 0E 04       		               LD C,SNDMUTE	;
196)   984F CD 62 98    		               CALL SND_SETVOLUME	;
197)   9852 F1          		               POP AF	;
198)   9853 C9          		               RET	;
200)   9854 21 07 83    		SND_BEEP:      LD HL,nG4             ;NOTE G4 ON CHANNEL2	;NOTE G4 ON CHANNEL2
201)   9857 CD 39 98    		               CALL SND_DOBEEP	;
202)   985A C9          		               RET	;
204)   985B 21 02 81    		SND_BEEP2:     LD HL,nD6             ;NOTE D6 ON CHANNEL2	;NOTE D6 ON CHANNEL2
205)   985E CD 39 98    		               CALL SND_DOBEEP	;
206)   9861 C9          		               RET	;
213)   9862 07          		SND_SETVOLUME: RLCA                            ;DOUBLE CHANNEL 0-3 --> 0,2,4,6               	;DOUBLE CHANNEL 0-3 --> 0,2,4,6
214)   9863 3C          		               INC A                           ;E=A+1	;E=A+1
215)   9864 5F          		               LD E,A                          ;SAVE CHANNEL INFO	;SAVE CHANNEL INFO
216)   9865 79          		               LD A,C	;
217)   9866 FE 04       		               CP SNDMUTE	;
218)   9868 3E 0F       		               LD A,$F	;
219)   986A 28 09       		               JR Z, SV_DOIT                   ;SNDMUTE=4 MEANS NO VOLUME = MUTE	;SNDMUTE=4 MEANS NO VOLUME = MUTE
220)   986C 3E 01       		               LD A,1                          ;VOLUME 0-3 --> 1,2,4,8 SET THE CORRESPONDING BIT 0-3	;VOLUME 0-3 --> 1,2,4,8 SET THE CORRESPONDING BIT 0-3
221)   986E 0C          		               INC C	;
222)   986F 0D          		SV_AGN:        DEC C	;
223)   9870 28 03       		               JR Z, SV_DOIT	;
224)   9872 07          		               RLCA	;
225)   9873 18 FA       		               JR SV_AGN	;
226)   9875 57          		SV_DOIT:       LD D,A                          ;D THE VOLUME , E THE CHANNEL  1&CCC&VVVV	;D THE VOLUME , E THE CHANNEL  1&CCC&VVVV
227)   9876 3E 80       		               LD A,$80	;
228)   9878 CB 03       		               RLC E	;
229)   987A CB 03       		               RLC E	;
230)   987C CB 03       		               RLC E	;
231)   987E CB 03       		               RLC E	;
232)   9880 B2          		               OR D	;
233)   9881 B3          		               OR E	;
234)   9882 CD F7 97    		               CALL SND_OUT                    ;SET THE VOLUME        	;SET THE VOLUME
235)   9885 C9          		               RET	;
238)   9886 F5          		SND_DISABLE:   PUSH AF	;
239)   9887 CD AF 98    		               CALL SND_GETCHMASK	;
240)   988A 47          		               LD B,A	;
241)   988B 3A F4 00    		               LD A,(CHANST)	;
242)   988E B0          		               OR B	;
243)   988F 32 F4 00    		               LD (CHANST),A	;
244)   9892 F1          		               POP AF	;
245)   9893 0E 04       		               LD C, SNDMUTE	;
246)   9895 CD 62 98    		               CALL SND_SETVOLUME	;
247)   9898 C9          		               RET	;
250)   9899 F5          		SND_ENABLE:    PUSH AF	;
251)   989A CD AF 98    		               CALL SND_GETCHMASK	;
252)   989D ED 44       		               NEG	;
253)   989F 3D          		               DEC A	;
254)   98A0 47          		               LD B,A	;
255)   98A1 3A F4 00    		               LD A,(CHANST)	;
256)   98A4 A0          		               AND B	;
257)   98A5 32 F4 00    		               LD (CHANST),A	;
258)   98A8 F1          		               POP AF	;
259)   98A9 0E 00       		               LD C, SNDVOLHI                  ;TODO: KEEP RECORD OF THE VOLUME IN EACH CHANNEL	;TODO: KEEP RECORD OF THE VOLUME IN EACH CHANNEL
260)   98AB CD 62 98    		               CALL SND_SETVOLUME	;
261)   98AE C9          		               RET	;
266)   98AF 3C          		SND_GETCHMASK: INC A	;
267)   98B0 4F          		               LD C,A	;
268)   98B1 AF          		               XOR A	;
269)   98B2 3C          		               INC A                	;
270)   98B3 0D          		GMCAGN:        DEC C	;
271)   98B4 C8          		               RET Z	;
272)   98B5 07          		               RLCA	;
273)   98B6 18 FB       		               JR GMCAGN             	;
280)   98B8 F5          		SND_PLAYCH:    PUSH AF	;
281)   98B9 21 E0 00    		               LD HL,CHANDATA	;
282)   98BC 07          		               RLCA                            ;DOUBLE A	;DOUBLE A
283)   98BD 06 00       		               LD B,0	;
284)   98BF 4F          		               LD C,A	;
285)   98C0 09          		               ADD HL,BC                       ;HL ON CHANNELS DATA ADDRESS VAR	;HL ON CHANNELS DATA ADDRESS VAR
286)   98C1 5E          		               LD E,(HL)	;
287)   98C2 23          		               INC HL	;
288)   98C3 56          		               LD D,(HL)                       ;DE THE CHANNEL DATA ADDRESS	;DE THE CHANNEL DATA ADDRESS
289)   98C4 7A          		               LD A,D	;
290)   98C5 83          		               ADD E	;
291)   98C6 B7          		               OR A	;
292)   98C7 28 4B       		               JR Z, PC_NOMORE                 ;IF CHANDATA ADDRESS IS ZERO RETURN	;IF CHANDATA ADDRESS IS ZERO RETURN
294)   98C9 F1          		               POP AF                          ;GET CHANNEL	;GET CHANNEL
295)   98CA F5          		               PUSH AF	;
296)   98CB CD AF 98    		               CALL SND_GETCHMASK	;
297)   98CE 4F          		               LD C, A	;
298)   98CF 3A F4 00    		               LD A,(CHANST)	;
299)   98D2 A1          		               AND C	;
300)   98D3 C1          		               POP BC	;
301)   98D4 20 50       		               JR NZ,SNDOK                     ;SIGNAL OK BUT DON'T PLAY ANYTHING	;SIGNAL OK BUT DON'T PLAY ANYTHING
302)   98D6 C5          		               PUSH BC	;
303)   98D7 48          		               LD C,B                          ;CHAN NO ON C	;CHAN NO ON C
304)   98D8 06 00       		               LD B,0	;
305)   98DA 21 F0 00    		               LD HL,CHANCN	;
306)   98DD 09          		               ADD HL,BC                       ;HL ON CHANNELS NOTE IDX	;HL ON CHANNELS NOTE IDX
307)   98DE 7E          		               LD A,(HL)                       ;A THE NOTE IDX 0-255 	;A THE NOTE IDX 0-255
308)   98DF 3C          		               INC A	;
309)   98E0 28 32       		               JR Z, PC_NOMORE                 ;IF 255 NO MORE NOTES TO PLAY	;IF 255 NO MORE NOTES TO PLAY
310)   98E2 3D          		               DEC A          	;
311)   98E3 34          		               INC (HL)                        ;NEXT NOTE	;NEXT NOTE
312)   98E4 6F          		               LD L,A                          ;HL THE NOTE IDX	;HL THE NOTE IDX
313)   98E5 26 00       		               LD H,0                          ;	;
314)   98E7 29          		               ADD HL,HL                       ;DOUBLE THE IDX CAUSE 2 BYTES PER NOTE	;DOUBLE THE IDX CAUSE 2 BYTES PER NOTE
315)   98E8 29          		               ADD HL,HL                       ;DOUBLE AGAIN THE IDX CAUSE 2 BYTES IS THE DURATION OF THE NOTE	;DOUBLE AGAIN THE IDX CAUSE 2 BYTES IS THE DURATION OF THE NOTE
316)   98E9 19          		               ADD HL,DE                       ;THE NOTE ADDRESS ON HL	;THE NOTE ADDRESS ON HL
317)   98EA 5E          		               LD E,(HL)                       ;E 2ND BYTE OF THE NOTE TO PLAY	;E 2ND BYTE OF THE NOTE TO PLAY
318)   98EB 23          		               INC HL	;
319)   98EC 56          		               LD D,(HL)                       ;D 1ST BYTE OF THE NOTE TO PLAY	;D 1ST BYTE OF THE NOTE TO PLAY
320)   98ED 23          		               INC HL	;
321)   98EE 4E          		               LD C,(HL)                      ;THE DURATION OF THE NOTE ON BC	;THE DURATION OF THE NOTE ON BC
322)   98EF 23          		               INC HL	;
323)   98F0 46          		               LD B,(HL)	;
324)   98F1 ED 43 A9 00 		               LD (PRGEX),BC                   ;SAVE BC                	;SAVE BC
325)   98F5 C1          		               POP BC                          ;CHANNEL ON B	;CHANNEL ON B
326)   98F6 C5          		               PUSH BC                         	;
327)   98F7 21 E8 00    		               LD HL,CHANDEL                   ;SAVING DURATION ON CHANDEL + CHAN IDX         	;SAVING DURATION ON CHANDEL + CHAN IDX
328)   98FA CB 00       		               RLC B                           ;DOUBLE IDX	;DOUBLE IDX
329)   98FC 48          		               LD C,B	;
330)   98FD 06 00       		               LD B,0	;
331)   98FF 09          		               ADD HL,BC	;
332)   9900 ED 4B A9 00 		               LD BC,(PRGEX)                      ;RESTORE BC	;RESTORE BC
333)   9904 71          		               LD (HL),C                       ;SAVE NOTE DELAY ON CHANNEL DELAY	;SAVE NOTE DELAY ON CHANNEL DELAY
334)   9905 23          		               INC HL	;
335)   9906 70          		               LD (HL),B	;
336)   9907 7A          		               LD A,D	;
337)   9908 C1          		               POP BC                          ;GET THE CHANNEL ON B	;GET THE CHANNEL ON B
338)   9909 FE 0A       		               CP 10                           ;CHECK IF 1ST BYTE IS UNDER 10  MAYBE DO SPECIAL OPS	;CHECK IF 1ST BYTE IS UNDER 10  MAYBE DO SPECIAL OPS
339)   990B 38 0A       		               JR C,SND_SPOPS	;
340)   990D EB          		               EX DE,HL                        ;HL THE NOTE	;HL THE NOTE
341)   990E 78          		               LD A,B                          ;CHANNEL ON A	;CHANNEL ON A
342)   990F CD 27 98    		               CALL SND_NOTE	;
343)   9912 18 12       		               JR SNDOK                        ;NOTE PLAYED OK	;NOTE PLAYED OK
344)   9914 C1          		PC_NOMORE:     POP BC	;
345)   9915 18 11       		               JR SNDEND                       ;SIGNAL  SONG END	;SIGNAL  SONG END
349)   9917 FE 03       		SND_SPOPS:     CP 3	;
350)   9919 30 07       		               JR NC,SNDOTOPS	;
351)   991B 4F          		               LD C,A                          ;VOLUME	;VOLUME
352)   991C 78          		               LD A,B                          ;CHANNEL	;CHANNEL
353)   991D CD 62 98    		               CALL SND_SETVOLUME	;
354)   9920 18 04       		               JR SNDOK                        ;VOLUME SET OK	;VOLUME SET OK
356)   9922 FE 09       		SNDOTOPS:      CP 9                            ;9 MEANS SONG ENDED	;9 MEANS SONG ENDED
357)   9924 28 02       		               JR Z, SNDEND	;
359)   9926 AF          		SNDOK:         XOR A                           ;END OK                	;END OK
360)   9927 C9          		               RET	;
361)   9928 3E 01       		SNDEND:        LD A,1                          ;SONG END	;SONG END
362)   992A C9          		               RET	;
368)   992B 21 E8 00    		SND_DOCHAN:    LD HL,CHANDEL	;
369)   992E 4F          		               LD C,A	;
370)   992F 06 00       		               LD B,0	;
371)   9931 09          		               ADD HL,BC	;
372)   9932 09          		               ADD HL,BC       ;DOUBLE CAUSE 2 BYTES PER DELAY VALUE	;DOUBLE CAUSE 2 BYTES PER DELAY VALUE
373)   9933 4E          		               LD C,(HL)	;
374)   9934 23          		               INC HL	;
375)   9935 46          		               LD B,(HL)	;
376)   9936 57          		               LD D,A          ;SAVE A	;SAVE A
377)   9937 78          		               LD A,B	;
378)   9938 B1          		               OR C	;
379)   9939 7A          		               LD A,D          ;RESTORE CHANNEL ON A	;RESTORE CHANNEL ON A
380)   993A CA B8 98    		               JP Z,SND_PLAYCH ;PLAY CHANNEL NOTES	;PLAY CHANNEL NOTES
381)   993D AF          		               XOR A           ;DATA ON CHANNEL CAUSE WE DELAY 	;DATA ON CHANNEL CAUSE WE DELAY
383)   993E C9          		               RET	;
389)   993F 21 E8 00    		SND_INTDELAY:  LD HL,CHANDEL	;
390)   9942 06 04       		               LD B,4                  	;
391)   9944 5E          		ID_NXTCH:      LD E,(HL)	;
392)   9945 23          		               INC HL	;
393)   9946 56          		               LD D,(HL)	;
394)   9947 7A          		               LD A, D	;
395)   9948 B3          		               OR E	;
396)   9949 28 05       		               JR Z, ID_SKP	;
397)   994B 1B          		               DEC DE          ;MINUS NOTE DELAY VALUE	;MINUS NOTE DELAY VALUE
398)   994C 72          		               LD (HL),D	;
399)   994D 2B          		               DEC HL	;
400)   994E 73          		               LD (HL),E	;
401)   994F 23          		               INC HL	;
402)   9950 23          		ID_SKP:        INC HL	;
403)   9951 10 F1       		               DJNZ ID_NXTCH	;
404)   9953 C9          		               RET	;
408)   9954 06 04       		SND_PLAYMUSIC: LD B,4	;
409)   9956 0E 00       		               LD C,0	;
410)   9958 05          		PM_NXT:        DEC B                           ;PLAY 3,2,1,0	;PLAY 3,2,1,0
411)   9959 78          		               LD A,B	;
412)   995A C5          		               PUSH BC                	;
413)   995B CD 2B 99    		               CALL SND_DOCHAN	;
414)   995E C1          		               POP BC                	;
415)   995F 81          		               ADD A,C                         ;A=0 IF NOTE PLAYED A=1 IF CHANNEL NOT ENABLED OR NO MORE NOTES	;A=0 IF NOTE PLAYED A=1 IF CHANNEL NOT ENABLED OR NO MORE NOTES
416)   9960 4F          		               LD C,A	;
417)   9961 78          		               LD A,B	;
418)   9962 B7          		               OR A	;
419)   9963 20 F3       		               JR NZ, PM_NXT	;
420)   9965 79          		               LD A,C	;
421)   9966 FE 04       		               CP 4                            ;MEANS ALL 4 CHANNELS ARE NOT ENABLED	;MEANS ALL 4 CHANNELS ARE NOT ENABLED
422)   9968 C9          		               RET	;
  8)   9969 FE E1       		@CHECKEXT:     CP $E1         ;BREAK KEY	;BREAK KEY
  9)   996B C8          		 RET Z        ;JUST SAVE IT  	;JUST SAVE IT
 10)   996C FE F0       		 CP $F0         ;240 KEY RELEASED	;240 KEY RELEASED
 11)   996E C8          		 RET Z        ;JUST SAVE IT  	;JUST SAVE IT
 12)   996F FE E0       		 CP $E0         ;224 EXTENDED KEYS	;224 EXTENDED KEYS
 13)   9971 C8          		 RET Z        ;JUST SAVE IT	;JUST SAVE IT
 14)   9972 FE AA       		 CP $AA        ;POST TEST KB OK	;POST TEST KB OK
 15)   9974 C8          		 RET Z	;
 17)   9975 4F          		 LD C,A        ;SAVE KEY	;SAVE KEY
 18)   9976 3A 81 00    		 LD A,(LASTKEY)	;
 19)   9979 FE E1       		 CP $E1	;
 20)   997B 28 23       		 JR Z, GTBRK	;
 21)   997D FE F0       		 CP $F0	;
 22)   997F 28 59       		 JR Z, GTREL	;
 23)   9981 FE E0       		 CP $E0	;
 24)   9983 28 21       		 JR Z, GTEXT	;
 25)   9985 79          		 LD A,C	;
 27)   9986 FE 12       		 CP 18         ;LEFT SHIFT	;LEFT SHIFT
 28)   9988 CC 06 9A    		 CALL Z, SHFTOG	;
 29)   998B FE 59       		 CP 89         ;RIGHT SHIFT	;RIGHT SHIFT
 30)   998D CC 06 9A    		 CALL Z, SHFTOG	;
 31)   9990 FE 14       		 CP 20         ;RIGHT CONTROL	;RIGHT CONTROL
 32)   9992 CC 0F 9A    		 CALL Z, CTRTOG	;
 33)   9995 FE 11       		 CP 17         ;LEFT ALT	;LEFT ALT
 34)   9997 CC 18 9A    		 CALL Z, ALTTOG	;
 35)   999A FE 58       		 CP $58         ;CAPS LOCK	;CAPS LOCK
 36)   999C CC 21 9A    		 CALL Z, CAPSTOG	;
 37)   999F C9          		               RET	;
 39)   99A0 79          		GTBRK: LD A,C       ;$14 OR $F0	;$14 OR $F0
 40)   99A1 FE F0       		 CP $F0	;
 41)   99A3 C8          		 RET Z  	;
 42)   99A4 AF          		 XOR A        	;
 43)   99A5 C9          		 RET	;
 45)   99A6 79          		GTEXT: LD A,C       ; THIS IS THE EXTENDED KEY	; THIS IS THE EXTENDED KEY
 46)   99A7 FE 6B       		 CP $6B         ;LEFT	;LEFT
 47)   99A9 C8          		 RET Z	;
 48)   99AA FE 72       		 CP $72        ;DOWN	;DOWN
 49)   99AC C8          		 RET Z	;
 50)   99AD FE 74       		 CP $74        ;RIGHT	;RIGHT
 51)   99AF C8          		 RET Z	;
 52)   99B0 FE 75       		 CP $75        ;UP	;UP
 53)   99B2 C8          		 RET Z	;
 54)   99B3 FE 70       		 CP $70        ;INSERT	;INSERT
 55)   99B5 C8          		 RET Z	;
 56)   99B6 FE 6C       		 CP $6C        ;HOME	;HOME
 57)   99B8 C8          		 RET Z	;
 58)   99B9 FE 7D       		 CP $7D        ;PG UP	;PG UP
 59)   99BB C8          		 RET Z	;
 60)   99BC FE 7A       		 CP $7A        ;PG DN	;PG DN
 61)   99BE C8          		 RET Z	;
 62)   99BF FE 69       		 CP $69        ;END	;END
 63)   99C1 C8          		 RET Z	;
 64)   99C2 FE 71       		 CP $71        ;DEL	;DEL
 65)   99C4 C8          		 RET Z	;
 66)   99C5 FE 66       		 CP $66         ;BACKSPACE	;BACKSPACE
 67)   99C7 C8          		 RET Z	;
 68)   99C8 FE 5A       		 CP $5A        ;ENTER NUM	;ENTER NUM
 69)   99CA C8          		 RET Z	;
 70)   99CB FE 11       		 CP $11        ;RIGHT ALT	;RIGHT ALT
 71)   99CD C8          		 RET Z	;
 72)   99CE FE 14       		 CP $14        ;LEFT ALT	;LEFT ALT
 73)   99D0 C8          		 RET Z	;
 74)   99D1 FE 4A       		 CP $4A         ;NUMLOCK /	;NUMLOCK /
 75)   99D3 C8          		 RET Z	;
 76)   99D4 FE F0       		 CP $F0	;
 77)   99D6 20 00       		 JR NZ, EXGTEX       ;GTREL ;EXTENDED KEY RELEASED $E0 $F0 $KEY  	;GTREL ;EXTENDED KEY RELEASED $E0 $F0 $KEY
 79)   99D8 AF          		EXGTEX: XOR A        ;NOT VALID EXTENDED KEY	;NOT VALID EXTENDED KEY
 80)   99D9 C9          		 RET	;
 83)   99DA 79          		GTREL: LD A,C       ; THIS IS THE RELEASED KEY	; THIS IS THE RELEASED KEY
 84)   99DB FE 12       		 CP 18         ; LSHIFT RELEASED	; LSHIFT RELEASED
 85)   99DD CC F4 99    		 CALL Z, SHFRES       ; RESET SHIFT	; RESET SHIFT
 86)   99E0 FE 14       		 CP 20         ; LCTRL RELEASED	; LCTRL RELEASED
 87)   99E2 CC FA 99    		 CALL Z, CTRRES       ; RESET CONTROL	; RESET CONTROL
 88)   99E5 FE 11       		 CP 17         ; LALT RELEASED	; LALT RELEASED
 89)   99E7 CC 00 9A    		 CALL Z, ALTRES       ; RESET ALT	; RESET ALT
 90)   99EA FE 59       		 CP 89         ; RSHIFT RELEASED	; RSHIFT RELEASED
 91)   99EC CC F4 99    		 CALL Z, SHFRES       ; RESET SHIFT  	; RESET SHIFT
 92)   99EF 32 81 00    		 LD (LASTKEY),A         ; SET LAST KEY	; SET LAST KEY
 93)   99F2 AF          		 XOR A         ; NO KEY  	; NO KEY
 94)   99F3 C9          		 RET	;
 96)   99F4 21 80 00    		SHFRES: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
 97)   99F7 CB B6       		 RES 6, (HL)        ; BIT 6 IS SHIFT $40=64	; BIT 6 IS SHIFT $40=64
 98)   99F9 C9          		 RET	;
100)   99FA 21 80 00    		CTRRES: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
101)   99FD CB BE       		 RES 7, (HL)       ; BIT 7 IS CTRL $80=128	; BIT 7 IS CTRL $80=128
102)   99FF C9          		 RET	;
104)   9A00 21 80 00    		ALTRES: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
105)   9A03 CB AE       		 RES 5, (HL)       ; BIT 5 IS SHIFT $20=32	; BIT 5 IS SHIFT $20=32
106)   9A05 C9          		 RET	;
108)   9A06 21 80 00    		SHFTOG: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
109)   9A09 3E 40       		 LD A, $40       ; MASK	; MASK
110)   9A0B AE          		 XOR (HL)        ; BIT 6 IS SHIFT $40=64	; BIT 6 IS SHIFT $40=64
111)   9A0C 77          		 LD (HL), A       ; SAVE	; SAVE
112)   9A0D AF          		 XOR A         ; NO KEY	; NO KEY
113)   9A0E C9          		 RET	;
115)   9A0F 21 80 00    		CTRTOG: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
116)   9A12 3E 80       		 LD A, $80       ; MASK	; MASK
117)   9A14 AE          		 XOR (HL)       ; BIT 7 IS CTRL $80=128	; BIT 7 IS CTRL $80=128
118)   9A15 77          		 LD (HL), A       ; SAVE	; SAVE
119)   9A16 AF          		 XOR A         ; NO KEY	; NO KEY
120)   9A17 C9          		 RET	;
122)   9A18 21 80 00    		ALTTOG: LD HL, KEYCTR       ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
123)   9A1B 3E 20       		 LD A, $20	;
124)   9A1D AE          		 XOR (HL)       ; BIT 5 IS ALT $20=32	; BIT 5 IS ALT $20=32
125)   9A1E 77          		 LD (HL), A       ; SAVE	; SAVE
126)   9A1F AF          		 XOR A         ; NO KEY	; NO KEY
127)   9A20 C9          		 RET	;
129)   9A21 21 80 00    		CAPSTOG: LD HL, KEYCTR      ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH,CAPS	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH,CAPS
130)   9A24 3E 10       		 LD A, $10	;
131)   9A26 AE          		 XOR (HL)       ; BIT 4 IS CAPS $10=16	; BIT 4 IS CAPS $10=16
132)   9A27 77          		 LD (HL), A       ; SAVE	; SAVE
133)   9A28 AF          		 XOR A         ; NO KEY	; NO KEY
134)   9A29 C9          		 RET	;
138)   9A2A FE AA       		@PS2LOK: CP $AA	;
139)   9A2C 38 02       		 JR C,DOTRANS       ;ONLY 0-170	;ONLY 0-170
141)   9A2E AF          		 XOR A	;
142)   9A2F C9          		 RET	;
143)   9A30 21 66 9A    		DOTRANS: LD HL, PS2TAB1      ;UNSHIFTED	;UNSHIFTED
144)   9A33 57          		 LD D,A        ;SAVE KEY CODE	;SAVE KEY CODE
145)   9A34 CD 60 9A    		 CALL PLK1       ;GET CHAR NO SHIFT NO CAPS	;GET CHAR NO SHIFT NO CAPS
146)   9A37 47          		 LD B,A        ;SAVE CHAR	;SAVE CHAR
147)   9A38 FE 61       		 CP 'a'	;
148)   9A3A 38 04       		 JR C,PS2CHKCAPS	;
149)   9A3C FE 7B       		PS2SGT: CP 'z'+1  	;
150)   9A3E 38 09       		 JR C, PS2CPSF;ITS A LETTER CAPS AND SHIFT MATTERS	;ITS A LETTER CAPS AND SHIFT MATTERS
152)   9A40 3A 80 00    		PS2CHKCAPS: LD A, (KEYCTR)      ; GET KEYBFLAGS ON A SHIFT  	; GET KEYBFLAGS ON A SHIFT
153)   9A43 CB 77       		 BIT 6, A	;
154)   9A45 78          		 LD A,B	;
155)   9A46 C8          		 RET Z        ;IF NO SHIFT RETURN TAB1 CHAR	;IF NO SHIFT RETURN TAB1 CHAR
157)   9A47 18 0F       		 JR PS2SHIFT	;
159)   9A49 3A 80 00    		PS2CPSF: LD A, (KEYCTR)      ; GET KEYBFLAGS ON A SHIFT	; GET KEYBFLAGS ON A SHIFT
160)   9A4C 4F          		 LD C, A        ;CAPS ON C	;CAPS ON C
161)   9A4D CB 1F       		 RR A	;
162)   9A4F CB 1F       		 RR A         ;2 ROTATIONS RIGHT SHIFT BECOMES BIT 4 FROM 6	;2 ROTATIONS RIGHT SHIFT BECOMES BIT 4 FROM 6
163)   9A51 A9          		 XOR C         ;XOR SHIFT WITH CAPS	;XOR SHIFT WITH CAPS
164)   9A52 CB 67       		 BIT 4, A        ;CHECK IF BIT 4 IS 0 = UNSHIFTED      	;CHECK IF BIT 4 IS 0 = UNSHIFTED
165)   9A54 20 02       		 JR NZ,PS2SHIFT	;
169)   9A56 78          		 LD A,B    	;
170)   9A57 C9          		 RET	;
171)   9A58 7A          		PS2SHIFT: LD A, D       ;RESTORE A KEYCODE	;RESTORE A KEYCODE
172)   9A59 21 10 9B    		 LD HL, PS2TAB2       ;SHIFTED	;SHIFTED
173)   9A5C CD 60 9A    		 CALL PLK1       ;GET CHAR	;GET CHAR
174)   9A5F C9          		 RET	;
175)   9A60 06 00       		PLK1: LD B, 0	;
176)   9A62 4F          		 LD C, A	;
177)   9A63 09          		 ADD HL, BC	;
178)   9A64 7E          		 LD A, (HL)       ;GET THE CHAR	;GET THE CHAR
179)   9A65 C9          		 RET	;
183)   9A66 00 00 00 A5 		PS2TAB1: DB 0,0,0,165,0,0,0,0,0,0	;
183)   9A6A 00 00 00 00 		PS2TAB1: DB 0,0,0,165,0,0,0,0,0,0	;
183)   9A6E 00 00       		PS2TAB1: DB 0,0,0,165,0,0,0,0,0,0	;
184)   9A70 A8 A6 00 00 		 DB 168,166,0,0,'`',0,0,0,0,0	;
184)   9A74 60 00 00 00 		 DB 168,166,0,0,'`',0,0,0,0,0	;
184)   9A78 00 00       		 DB 168,166,0,0,'`',0,0,0,0,0	;
185)   9A7A 00 71 31 00 		 DB 0,'q','1',0,0,0,'z','s','a','w'	;
185)   9A7E 00 00 7A 73 		 DB 0,'q','1',0,0,0,'z','s','a','w'	;
185)   9A82 61 77       		 DB 0,'q','1',0,0,0,'z','s','a','w'	;
186)   9A84 32 00 00 63 		 DB '2',0,0,'c','x','d','e','4','3',0	;
186)   9A88 78 64 65 34 		 DB '2',0,0,'c','x','d','e','4','3',0	;
186)   9A8C 33 00       		 DB '2',0,0,'c','x','d','e','4','3',0	;
187)   9A8E 00 20 76 66 		 DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
187)   9A92 74 72 35 00 		 DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
187)   9A96 00 6E       		 DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
188)   9A98 62 68 67 79 		 DB 'b','h','g','y','6',0,0,44,'m','j'     ;50-59	;50-59
188)   9A9C 36 00 00 2C 		 DB 'b','h','g','y','6',0,0,44,'m','j'     ;50-59	;50-59
188)   9AA0 6D 6A       		 DB 'b','h','g','y','6',0,0,44,'m','j'     ;50-59	;50-59
189)   9AA2 75 37 38 00 		 DB 'u','7','8',0,0,',','k','i','o','0'     ;60-69	;60-69
189)   9AA6 00 2C 6B 69 		 DB 'u','7','8',0,0,',','k','i','o','0'     ;60-69	;60-69
189)   9AAA 6F 30       		 DB 'u','7','8',0,0,',','k','i','o','0'     ;60-69	;60-69
190)   9AAC 39 00 00 2E 		 DB '9',0,0,'.','/','l',59,'p','-',0         ;70-79	;70-79
190)   9AB0 2F 6C 3B 70 		 DB '9',0,0,'.','/','l',59,'p','-',0         ;70-79	;70-79
190)   9AB4 2D 00       		 DB '9',0,0,'.','/','l',59,'p','-',0         ;70-79	;70-79
191)   9AB6 00 00 27 00 		 DB 0,0,39,0,'[','=',0,0,0,0                 ;80-89	;80-89
191)   9ABA 5B 3D 00 00 		 DB 0,0,39,0,'[','=',0,0,0,0                 ;80-89	;80-89
191)   9ABE 00 00       		 DB 0,0,39,0,'[','=',0,0,0,0                 ;80-89	;80-89
192)   9AC0 0D 5D 00 5C 		 DB 13,']',0,'\',0,0,0,0,0,0                 ;90-99	;90-99
192)   9AC4 00 00 00 00 		 DB 13,']',0,'\',0,0,0,0,0,0                 ;90-99	;90-99
192)   9AC8 00 00       		 DB 13,']',0,'\',0,0,0,0,0,0                 ;90-99	;90-99
193)   9ACA 00 00 06 00 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
193)   9ACE 00 08 00 04 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
193)   9AD2 09 00       		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
194)   9AD4 00 00 01 07 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
194)   9AD8 0A 00 03 0B 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
194)   9ADC 1B 00       		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
195)   9ADE 00 00 2B 2D 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
195)   9AE2 2A 39 00 00 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
195)   9AE6 00 00       		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
196)   9AE8 00 A7 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
196)   9AEC 00 00 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
196)   9AF0 00 00       		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
197)   9AF2 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
197)   9AF6 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
197)   9AFA 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
198)   9AFC 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
198)   9B00 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
198)   9B04 00 00       		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
199)   9B06 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
199)   9B0A 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
199)   9B0E 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
202)   9B10 00 00 00 A5 		PS2TAB2: DB 0,0,0,165,0,0,0,0,0,0	;
202)   9B14 00 00 00 00 		PS2TAB2: DB 0,0,0,165,0,0,0,0,0,0	;
202)   9B18 00 00       		PS2TAB2: DB 0,0,0,165,0,0,0,0,0,0	;
203)   9B1A A8 A6 00 00 		 DB 168,166,0,0,'~',0,0,0,0,0	;
203)   9B1E 7E 00 00 00 		 DB 168,166,0,0,'~',0,0,0,0,0	;
203)   9B22 00 00       		 DB 168,166,0,0,'~',0,0,0,0,0	;
204)   9B24 00 51 21 00 		 DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
204)   9B28 00 00 5A 53 		 DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
204)   9B2C 41 57       		 DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
205)   9B2E 40 00 00 43 		 DB '@',0,0,'C','X','D','E','$','#',0	;
205)   9B32 58 44 45 24 		 DB '@',0,0,'C','X','D','E','$','#',0	;
205)   9B36 23 00       		 DB '@',0,0,'C','X','D','E','$','#',0	;
206)   9B38 00 20 56 46 		 DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
206)   9B3C 54 52 25 00 		 DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
206)   9B40 00 4E       		 DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
207)   9B42 42 48 47 59 		 DB 'B','H','G','Y','^',0,0,34,'M','J'     ;50-59 34=""	;50-59 34=""
207)   9B46 5E 00 00 22 		 DB 'B','H','G','Y','^',0,0,34,'M','J'     ;50-59 34=""	;50-59 34=""
207)   9B4A 4D 4A       		 DB 'B','H','G','Y','^',0,0,34,'M','J'     ;50-59 34=""	;50-59 34=""
208)   9B4C 55 26 2A 00 		 DB 'U','&','*',0,0,'<','K','I','O',')'     ;60-69	;60-69
208)   9B50 00 3C 4B 49 		 DB 'U','&','*',0,0,'<','K','I','O',')'     ;60-69	;60-69
208)   9B54 4F 29       		 DB 'U','&','*',0,0,'<','K','I','O',')'     ;60-69	;60-69
209)   9B56 28 00 00 3E 		 DB '(',0,0,'>','?','L',':','P','_',0        ;70-79	;70-79
209)   9B5A 3F 4C 3A 50 		 DB '(',0,0,'>','?','L',':','P','_',0        ;70-79	;70-79
209)   9B5E 5F 00       		 DB '(',0,0,'>','?','L',':','P','_',0        ;70-79	;70-79
210)   9B60 00 00 22 00 		 DB 0,0,34,0,'{','+',0,0,0,0                 ;80-89	;80-89
210)   9B64 7B 2B 00 00 		 DB 0,0,34,0,'{','+',0,0,0,0                 ;80-89	;80-89
210)   9B68 00 00       		 DB 0,0,34,0,'{','+',0,0,0,0                 ;80-89	;80-89
211)   9B6A 0D 7D 00 7C 		 DB 13,'}',0,'|',0,0,0,0,0,0                 ;90-99	;90-99
211)   9B6E 00 00 00 00 		 DB 13,'}',0,'|',0,0,0,0,0,0                 ;90-99	;90-99
211)   9B72 00 00       		 DB 13,'}',0,'|',0,0,0,0,0,0                 ;90-99	;90-99
212)   9B74 00 00 06 00 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
212)   9B78 00 08 00 04 		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
212)   9B7C 09 00       		 DB 0,0,6,0,0,8,0,4,9,0                      ;100-109	;100-109
213)   9B7E 00 00 01 07 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
213)   9B82 0A 00 03 0B 		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
213)   9B86 1B 00       		 DB 0,0,1,7,10,0,3,11,ESC,0                  ;110-119	;110-119
214)   9B88 00 00 2B 2D 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
214)   9B8C 2A 39 00 00 		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
214)   9B90 00 00       		 DB 0,0,'+','-','*','9',0,0,0,0              ;120-129	;120-129
215)   9B92 00 A7 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
215)   9B96 00 00 00 00 		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
215)   9B9A 00 00       		 DB 0,167,0,0,0,0,0,0,0,0      ;130-139	;130-139
216)   9B9C 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
216)   9BA0 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
216)   9BA4 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;140-149	;140-149
217)   9BA6 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
217)   9BAA 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
217)   9BAE 00 00       		 DB 0,0,0,0,0,0,0,0,0,0       ;150-159	;150-159
218)   9BB0 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
218)   9BB4 00 00 00 00 		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
218)   9BB8 00 00       		 DB 0,0,0,0,0,0,0,0,0,0                      ;160-169	;160-169
 43)   9BBA 00          		m18: nop         ; 4 cycles	; 4 cycles
 44)   9BBB 00          		 nop         ; 4 cycles	; 4 cycles
 45)   9BBC 00          		m16:    nop         ; 4 cycles	; 4 cycles
 46)   9BBD 00          		      nop         ; 4 cycles	; 4 cycles
 47)   9BBE 00          		      nop         ; 4 cycles	; 4 cycles
 48)   9BBF 00          		m14:    nop         ; 4 cycles	; 4 cycles
 49)   9BC0 00          		 nop         ; 4 cycles	; 4 cycles
 50)   9BC1 00          		m12:    nop         ; 4 cycles	; 4 cycles
 51)   9BC2 00          		      nop         ; 4 cycles	; 4 cycles
 52)   9BC3 00          		      nop         ; 4 cycles	; 4 cycles
 53)   9BC4 00          		m10:    nop         ; 4 cycles	; 4 cycles
 54)   9BC5 00          		      nop         ; 4 cycles	; 4 cycles
 55)   9BC6 00          		m8:    nop         ; 4 cycles	; 4 cycles
 56)   9BC7 00          		      nop         ; 4 cycles	; 4 cycles
 57)   9BC8 00          		    nop         ; 4 cycles	; 4 cycles
 58)   9BC9 00          		m6:     nop         ; 4 cycles	; 4 cycles
 59)   9BCA 00          		    nop         ; 4 cycles	; 4 cycles
 60)   9BCB 00          		m4: nop         ; 4 cycles	; 4 cycles
 61)   9BCC 00          		     nop         ; 4 cycles	; 4 cycles
 62)   9BCD 00          		      nop         ; 4 cycles	; 4 cycles
 63)   9BCE C3 F6 9B    		 JP DM3CONT	;
 69)   9BD1 00 14 13 12 		DMHELPIDX: DB 0,20,19,18,18,17,16,16,13,13,11,11,11,08,06,06,03,03,01,00,00 ;FIXED FOR DELAYS 	;FIXED FOR DELAYS
 69)   9BD5 12 11 10 10 		DMHELPIDX: DB 0,20,19,18,18,17,16,16,13,13,11,11,11,08,06,06,03,03,01,00,00 ;FIXED FOR DELAYS 	;FIXED FOR DELAYS
 69)   9BD9 0D 0D 0B 0B 		DMHELPIDX: DB 0,20,19,18,18,17,16,16,13,13,11,11,11,08,06,06,03,03,01,00,00 ;FIXED FOR DELAYS 	;FIXED FOR DELAYS
 69)   9BDD 0B 08 06 06 		DMHELPIDX: DB 0,20,19,18,18,17,16,16,13,13,11,11,11,08,06,06,03,03,01,00,00 ;FIXED FOR DELAYS 	;FIXED FOR DELAYS
 69)   9BE1 03 03 01 00 		DMHELPIDX: DB 0,20,19,18,18,17,16,16,13,13,11,11,11,08,06,06,03,03,01,00,00 ;FIXED FOR DELAYS 	;FIXED FOR DELAYS
 69)   9BE5 00          		DMHELPIDX: DB 0,20,19,18,18,17,16,16,13,13,11,11,11,08,06,06,03,03,01,00,00 ;FIXED FOR DELAYS 	;FIXED FOR DELAYS
 73)   9BE6 DB 80       		DELAY5MICS: IN A, (128)         ; THE CPU SPEED IN MHZ e.g. 12	; THE CPU SPEED IN MHZ e.g. 12
 74)   9BE8 21 D1 9B    		 LD HL,DMHELPIDX	;
 75)   9BEB 5F          		 LD E,A	;
 76)   9BEC 16 00       		 LD D,0	;
 77)   9BEE 19          		 ADD HL,DE	;
 78)   9BEF 7E          		 LD A,(HL)	;
 79)   9BF0 5F          		 LD E,A	;
 80)   9BF1 21 BA 9B    		 LD HL,DELAYRTN	;
 81)   9BF4 19          		 ADD HL,DE	;
 82)   9BF5 E9          		DM3AGN: JP (HL)	;
 83)   9BF6 10 FD       		DM3CONT: DJNZ DM3AGN	;
 84)   9BF8 C9          		 RET	;
 93)   9BF9 C5          		NXTMS: PUSH BC	;
 95)   9BFA 06 BE       		 LD B,950/5  ;FIX SHOULD BE 1000	;FIX SHOULD BE 1000
 96)   9BFC CD E6 9B    		 CALL DELAY5MICS	;
 97)   9BFF C1          		 POP BC	;
 98)   9C00 10 F7       		 DJNZ NXTMS	;
102)   9C02 C9          		 RET	;
107)   9C03 C5          		DELAYSEC: PUSH BC	;
108)   9C04 06 FA       		 LD B,250	;
109)   9C06 CD F9 9B    		 CALL DELAYMILI	;
110)   9C09 06 FA       		 LD B,250	;
111)   9C0B CD F9 9B    		 CALL DELAYMILI	;
112)   9C0E 06 FA       		 LD B,250	;
113)   9C10 CD F9 9B    		 CALL DELAYMILI	;
114)   9C13 06 FA       		 LD B,250	;
115)   9C15 CD F9 9B    		 CALL DELAYMILI	;
116)   9C18 C1          		 POP BC	;
117)   9C19 10 E8       		 DJNZ DELAYSEC	;
118)   9C1B C9          		 RET	;
124)   9C1C F5          		OUTASC: PUSH AF	;
125)   9C1D D5          		 PUSH DE	;
126)   9C1E CD 51 9C    		 CALL B2Bcd	;
127)   9C21 D1          		 POP DE	;
128)   9C22 CD 77 9C    		 CALL BCD2HA	;
129)   9C25 F1          		 POP AF	;
130)   9C26 C9          		 RET	;
144)   9C27 B7          		BCD2BN: OR A	;
145)   9C28 47          		 LD B, A	;
146)   9C29 E6 F0       		 AND $F0	;
147)   9C2B 0F          		 RRCA	;
148)   9C2C 4F          		 LD C, A	;
149)   9C2D 0F          		 RRCA	;
150)   9C2E 0F          		 RRCA	;
151)   9C2F 81          		 ADD A, C	;
152)   9C30 4F          		 LD C, A	;
153)   9C31 78          		 LD A, B	;
154)   9C32 E6 0F       		 AND $0F	;
155)   9C34 81          		 ADD A, C	;
156)   9C35 C9          		 RET	;
171)   9C36 26 FF       		BN2BCD: LD H, $FF	;
172)   9C38 24          		D100LP: INC H	;
173)   9C39 D6 64       		 SUB 100	;
174)   9C3B 30 FB       		 JR NC, D100LP	;
175)   9C3D C6 64       		 ADD A, 100	;
176)   9C3F 2E FF       		 LD L, $FF	;
177)   9C41 2C          		D10LP: INC L	;
178)   9C42 D6 0A       		 SUB 10	;
179)   9C44 30 FB       		 JR NC, D10LP	;
180)   9C46 C6 0A       		 ADD A, 10	;
181)   9C48 4F          		 LD C, A	;
182)   9C49 7D          		 LD A, L	;
183)   9C4A 07          		 RLCA	;
184)   9C4B 07          		 RLCA	;
185)   9C4C 07          		 RLCA	;
186)   9C4D 07          		 RLCA	;
187)   9C4E B1          		 OR C	;
188)   9C4F 6F          		 LD L, A	;
189)   9C50 C9          		 RET	;
203)   9C51 01 00 10    		 LD BC, 16 * 256 + 0       ; handle 16 bits, one bit per iteration	; handle 16 bits, one bit per iteration
204)   9C54 11 00 00    		 LD DE, 0	;
206)   9C57 29          		 ADD HL, HL	;
207)   9C58 7B          		 LD A, E	;
208)   9C59 8F          		 ADC A, A	;
209)   9C5A 27          		 DAA	;
210)   9C5B 5F          		 LD E, A	;
211)   9C5C 7A          		 LD A, D	;
212)   9C5D 8F          		 ADC A, A	;
213)   9C5E 27          		 DAA	;
214)   9C5F 57          		 LD D, A	;
215)   9C60 79          		 LD A, C	;
216)   9C61 8F          		 ADC A, A	;
217)   9C62 27          		 DAA	;
218)   9C63 4F          		 LD C, A	;
219)   9C64 10 F1       		 DJNZ cvtLp	;
220)   9C66 EB          		 EX DE, HL	;
221)   9C67 C9          		 RET	;
235)   9C68 B7          		BCD2BN: OR A	;
236)   9C69 47          		 LD B, A	;
237)   9C6A E6 F0       		 AND $F0	;
238)   9C6C 0F          		 RRCA	;
239)   9C6D 4F          		 LD C, A	;
240)   9C6E 0F          		 RRCA	;
241)   9C6F 0F          		 RRCA	;
242)   9C70 81          		 ADD A, C	;
243)   9C71 4F          		 LD C, A	;
244)   9C72 78          		 LD A, B	;
245)   9C73 E6 0F       		 AND $0F	;
246)   9C75 81          		 ADD A, C	;
247)   9C76 C9          		 RET	;
259)   9C77 79          		 LD A, C	;
260)   9C78 CD A4 9C    		 CALL cvtUN	;
261)   9C7B 79          		 LD A, C	;
262)   9C7C CD A8 9C    		 CALL cvtLN	;
263)   9C7F 7C          		 LD A, H	;
264)   9C80 CD A4 9C    		 CALL cvtUN	;
265)   9C83 7C          		 LD A, H	;
266)   9C84 CD A8 9C    		 CALL cvtLN	;
267)   9C87 7D          		 LD A, L	;
268)   9C88 CD A4 9C    		 CALL cvtUN	;
269)   9C8B 7D          		 LD A, L	;
270)   9C8C 18 1A       		 JR cvtLN	;
272)   9C8E 1F          		 RRA         ; move upper nibble into lower nibble	; move upper nibble into lower nibble
273)   9C8F 1F          		 RRA	;
274)   9C90 1F          		 RRA	;
275)   9C91 1F          		 RRA	;
277)   9C92 E6 0F       		 AND 0Fh        ; isolate lower nibble	; isolate lower nibble
278)   9C94 C6 90       		 ADD A, 90h        ; old trick	; old trick
279)   9C96 27          		 DAA         ; for converting	; for converting
280)   9C97 CE 40       		 ADC A, 40h        ; one nibble	; one nibble
281)   9C99 27          		 DAA         ; to hex ASCII	; to hex ASCII
282)   9C9A 12          		 LD (DE), A	;
283)   9C9B 13          		 INC DE	;
284)   9C9C C9          		 RET	;
296)   9C9D 7D          		 LD A, L	;
297)   9C9E CD 8E 9C    		 CALL cvtUN	;
298)   9CA1 7D          		 LD A, L	;
299)   9CA2 18 EE       		 JR cvtLN	;
301)   9CA4 1F          		 RRA         ; move upper nibble into lower nibble	; move upper nibble into lower nibble
302)   9CA5 1F          		 RRA	;
303)   9CA6 1F          		 RRA	;
304)   9CA7 1F          		 RRA	;
306)   9CA8 E6 0F       		 AND 0Fh        ; isolate lower nibble	; isolate lower nibble
307)   9CAA C6 90       		 ADD A, 90h        ; old trick	; old trick
308)   9CAC 27          		 DAA         ; for converting	; for converting
309)   9CAD CE 40       		 ADC A, 40h        ; one nibble	; one nibble
310)   9CAF 27          		 DAA         ; to hex ASCII	; to hex ASCII
311)   9CB0 12          		 LD (DE), A	;
312)   9CB1 13          		 INC DE	;
313)   9CB2 C9          		 RET	;
344)   9CB3 26 00       		@B2D8: LD H, 0	;
345)   9CB5 6F          		 LD L, A	;
346)   9CB6 1E 00       		@B2D16: LD E, 0	;
347)   9CB8 16 00       		@B2D24: LD D, 0	;
348)   9CBA 01 00 00    		@B2D32: LD BC, 0	;
349)   9CBD DD 21 00 00 		@B2D48: LD IX, 0        ; zero all non-used bits	; zero all non-used bits
350)   9CC1 22 C3 00    		@B2D64: LD (B2DINV), HL	;
351)   9CC4 ED 53 C5 00 		 LD (B2DINV + 2), DE	;
352)   9CC8 ED 43 C7 00 		 LD (B2DINV + 4), BC	;
353)   9CCC DD 22 C9 00 		 LD (B2DINV + 6), IX       ; place full 64-bit input value in buffer	; place full 64-bit input value in buffer
354)   9CD0 21 CB 00    		 LD HL, B2DBUF	;
355)   9CD3 11 CC 00    		 LD DE, B2DBUF + 1	;
356)   9CD6 36 20       		 LD (HL), ' '	;
358)   9CD8 01 12 00    		 LD BC, 18	;
359)   9CDB ED B0       		 LDIR         ; fill 1st 19 bytes of buffer with spaces	; fill 1st 19 bytes of buffer with spaces
360)   9CDD ED 43 DE 00 		 LD (B2DEND - 1), BC       ;set BCD value to "0" & place terminating 0	;set BCD value to "0" & place terminating 0
361)   9CE1 1E 01       		 LD E, 1        ; no. of bytes in BCD value	; no. of bytes in BCD value
362)   9CE3 21 CB 00    		 LD HL, B2DINV + 8       ; (address MSB input)+1	; (address MSB input)+1
363)   9CE6 01 09 09    		 LD BC, 0x0909	;
364)   9CE9 AF          		 XOR A	;
365)   9CEA 05          		B2DSKP0: DEC B	;
366)   9CEB 28 29       		 JR Z, B2DSIZ        ; all 0: continue with postprocessing	; all 0: continue with postprocessing
367)   9CED 2B          		 DEC HL	;
368)   9CEE B6          		 OR (HL)        ; find first byte <>0	; find first byte <>0
369)   9CEF 28 F9       		 JR Z, B2DSKP0	;
370)   9CF1 0D          		B2DFND1: DEC C	;
371)   9CF2 17          		 RLA	;
372)   9CF3 30 FC       		 JR NC, B2DFND1        ; determine no. of most significant 1-bit	; determine no. of most significant 1-bit
373)   9CF5 1F          		 RRA	;
374)   9CF6 57          		 LD D, A        ; byte from binary input value	; byte from binary input value
375)   9CF7 E5          		B2DLUS2: PUSH HL	;
376)   9CF8 C5          		 PUSH BC	;
377)   9CF9 21 DE 00    		B2DLUS1: LD HL, B2DEND - 1      ; address LSB of BCD value	; address LSB of BCD value
378)   9CFC 43          		 LD B, E        ; current length of BCD value in bytes	; current length of BCD value in bytes
379)   9CFD CB 12       		 RL D         ; highest bit from input value -> carry	; highest bit from input value -> carry
380)   9CFF 7E          		B2DLUS0: LD A, (HL)	;
381)   9D00 8F          		 ADC A, A	;
382)   9D01 27          		 DAA	;
383)   9D02 77          		 LD (HL), A        ; double 1 BCD byte from intermediate result	; double 1 BCD byte from intermediate result
384)   9D03 2B          		 DEC HL	;
385)   9D04 10 F9       		 DJNZ B2DLUS0        ; and go on to double entire BCD value (+carry!)	; and go on to double entire BCD value (+carry!)
386)   9D06 30 03       		 JR NC, B2DNXT	;
387)   9D08 1C          		 INC E         ; carry at MSB -> BCD value grew 1 byte larger	; carry at MSB -> BCD value grew 1 byte larger
388)   9D09 36 01       		 LD (HL), 1        ; initialize new MSB of BCD value	; initialize new MSB of BCD value
389)   9D0B 0D          		B2DNXT: DEC C	;
390)   9D0C 20 EB       		 JR NZ, B2DLUS1        ; repeat for remaining bits from 1 input byte	; repeat for remaining bits from 1 input byte
391)   9D0E C1          		 POP BC         ; no. of remaining bytes in input value	; no. of remaining bytes in input value
392)   9D0F 0E 08       		 LD C, 8        ; reset bit-counter	; reset bit-counter
393)   9D11 E1          		 POP HL         ; pointer to byte from input value	; pointer to byte from input value
394)   9D12 2B          		 DEC HL	;
395)   9D13 56          		 LD D, (HL)        ; get next group of 8 bits	; get next group of 8 bits
396)   9D14 10 E1       		 DJNZ B2DLUS2        ; and repeat until last byte from input value	; and repeat until last byte from input value
397)   9D16 21 DF 00    		B2DSIZ: LD HL, B2DEND        ; address of terminating 0	; address of terminating 0
398)   9D19 4B          		 LD C, E        ; size of BCD value in bytes	; size of BCD value in bytes
399)   9D1A B7          		 OR A	;
400)   9D1B ED 42       		 SBC HL, BC        ; calculate address of MSB BCD	; calculate address of MSB BCD
401)   9D1D 54          		 LD D, H	;
402)   9D1E 5D          		 LD E, L	;
403)   9D1F ED 42       		 SBC HL, BC	;
404)   9D21 EB          		 EX DE, HL        ; HL=address BCD value, DE=start of decimal value	; HL=address BCD value, DE=start of decimal value
405)   9D22 41          		 LD B, C        ; no. of bytes BCD	; no. of bytes BCD
406)   9D23 CB 21       		 SLA C         ; no. of bytes decimal (possibly 1 too high)	; no. of bytes decimal (possibly 1 too high)
407)   9D25 3E 30       		 LD A, '0'	;
408)   9D27 ED 6F       		 RLD         ; shift bits 4-7 of (HL) into bit 0-3 of A	; shift bits 4-7 of (HL) into bit 0-3 of A
409)   9D29 FE 30       		 CP '0'         ; (HL) was > 9h?	; (HL) was > 9h?
410)   9D2B 20 06       		 JR NZ, B2DEXPH        ; if yes, start with recording high digit	; if yes, start with recording high digit
411)   9D2D 0D          		 DEC C         ; correct number of decimals	; correct number of decimals
412)   9D2E 13          		 INC DE         ; correct start address	; correct start address
413)   9D2F 18 04       		 JR B2DEXPL        ; continue with converting low digit	; continue with converting low digit
414)   9D31 ED 6F       		B2DEXP: RLD         ; shift high digit (HL) into low digit of A	; shift high digit (HL) into low digit of A
415)   9D33 12          		B2DEXPH: LD (DE), A       ; record resulting ASCII-code	; record resulting ASCII-code
416)   9D34 13          		 INC DE	;
417)   9D35 ED 6F       		B2DEXPL: RLD	;
418)   9D37 12          		 LD (DE), A	;
419)   9D38 13          		 INC DE	;
420)   9D39 23          		 INC HL         ; next BCD-byte	; next BCD-byte
421)   9D3A 10 F5       		 DJNZ B2DEXP        ; and go on to convert each BCD-byte into 2 ASCII	; and go on to convert each BCD-byte into 2 ASCII
422)   9D3C ED 42       		 SBC HL, BC        ; return with HL pointing to 1st decimal	; return with HL pointing to 1st decimal
423)   9D3E C9          		 RET	;
427)   9D3F EB          		 ex de, hl        ; Get destination into DE	; Get destination into DE
428)   9D40 21 CB 00    		 ld hl, B2DBUF	;
429)   9D43 CD 4A 9D    		 call SkipWhitespace	;
430)   9D46 ED B0       		 ldir	;
431)   9D48 EB          		 ex de, hl        ; Get destination into DE	; Get destination into DE
432)   9D49 C9          		 ret	;
437)   9D4A 7E          		 ld a, (hl)	;
438)   9D4B FE 20       		 cp ' '	;
439)   9D4D C0          		 ret nz	;
440)   9D4E 23          		 inc hl	;
441)   9D4F 18 F9       		 jr SkipWhitespace	;
445)   9D51 06 08       		@REVBITS: ld b, 8	;
446)   9D53 6F          		 ld l, a	;
448)   9D54 CB 15       		 rl l	;
449)   9D56 1F          		 rra	;
450)   9D57 10 FB       		 djnz REVLOOP	;
451)   9D59 C9          		 RET	;
461)   9D5A E5          		 push hl	;
463)   9D5B 7E          		 ld a, (hl)	;
465)   9D5C FE 00       		 cp  0	;
466)   9D5E 28 0E       		 jr z, IsStrDecTrue	;
468)   9D60 FE 30       		 cp  '0'	;
469)   9D62 38 06       		 jr c, IsStrDecFalse	;
471)   9D64 FE 3A       		 cp  '9'+1	;
472)   9D66 38 09       		 jr c, IsStrDecContinue	;
473)   9D68 FE 39       		 cp  '9'	;
476)   9D6A F6 01       		 or 1         ; Reset zero flag	; Reset zero flag
477)   9D6C E1          		 pop hl	;
478)   9D6D C9          		 ret	;
480)   9D6E BF          		 cp a         ; Set zero flag	; Set zero flag
481)   9D6F E1          		 pop hl	;
482)   9D70 C9          		 ret	;
484)   9D71 23          		 inc hl	;
485)   9D72 18 E7       		 jr IsStrDec00	;
492)   9D74 E5          		 push hl	;
494)   9D75 7E          		 ld a, (hl)	;
496)   9D76 FE 00       		 cp  0	;
497)   9D78 28 14       		 jr z, IsStrHexTrue	;
499)   9D7A FE 30       		 cp  '0'	;
500)   9D7C 38 0C       		 jr c, IsStrHexFalse	;
502)   9D7E FE 3A       		 cp  '9'+1	;
503)   9D80 38 0F       		 jr c, IsStrHexContinue	;
505)   9D82 FE 30       		 cp  '0'	;
506)   9D84 38 04       		 jr c, IsStrHexFalse	;
508)   9D86 FE 47       		 cp  'F'+1	;
509)   9D88 38 07       		 jr c, IsStrHexContinue	;
512)   9D8A F6 01       		 or 1         ; Reset zero flag	; Reset zero flag
513)   9D8C E1          		 pop hl	;
514)   9D8D C9          		 ret	;
516)   9D8E BF          		 cp a         ; Set zero flag	; Set zero flag
517)   9D8F E1          		 pop hl	;
518)   9D90 C9          		 ret	;
520)   9D91 23          		 inc hl	;
521)   9D92 18 E1       		 jr IsStrHex00	;
528)   9D94 AF          		 xor a	;
529)   9D95 CD 9A 9D    		 call loop	;
530)   9D98 7A          		 ld a, d	;
531)   9D99 C9          		 ret	;
533)   9D9A 57          		 ld d, a	;
534)   9D9B 7E          		 ld a, (hl)	;
535)   9D9C 23          		 inc hl	;
536)   9D9D D6 3A       		 sub '9' + 1	;
537)   9D9F C6 0A       		 add 10	;
538)   9DA1 D0          		 ret nc	;
539)   9DA2 5F          		 ld e, a	;
540)   9DA3 7A          		 ld a, d	;
541)   9DA4 87          		 add a, a        ;double our accumulator	;double our accumulator
542)   9DA5 87          		 add a, a        ;double again (now x4)	;double again (now x4)
543)   9DA6 82          		 add a, d        ;add the original (now x5)	;add the original (now x5)
544)   9DA7 87          		 add a, a        ;double again (now x10)	;double again (now x10)
545)   9DA8 83          		 add a, e        ;add in the incoming digit	;add in the incoming digit
546)   9DA9 18 EF       		 jr loop	;
554)   9DAB 7E          		 ld a, (hl)        ; Copy first char to A	; Copy first char to A
555)   9DAC CD BC 9D    		 call Hex12        ; Convert first char	; Convert first char
556)   9DAF 87          		 add a, a        ; Multiply by 16...	; Multiply by 16...
557)   9DB0 87          		 add a, a        ; ...	; ...
558)   9DB1 87          		 add a, a        ; ...	; ...
559)   9DB2 87          		 add a, a        ; ...done!	; ...done!
560)   9DB3 57          		 ld d, a        ; Store top 4 bits in D	; Store top 4 bits in D
561)   9DB4 23          		 inc hl         ; Advance to next char	; Advance to next char
562)   9DB5 7E          		 ld a, (hl)	;
563)   9DB6 CD BC 9D    		 call Hex12        ; Convert second char	; Convert second char
564)   9DB9 B2          		 or d         ; Add back top bits	; Add back top bits
565)   9DBA 23          		 inc hl         ; Advance for next guy	; Advance for next guy
566)   9DBB C9          		 ret	;
567)   9DBC D6 30       		Hex12: sub  '0'	;
568)   9DBE FE 0A       		 cp 10	;
569)   9DC0 D8          		 ret c	;
570)   9DC1 D6 07       		 sub 'A' - '0' - 10	;
571)   9DC3 C9          		 ret	;
578)   9DC4 CD AB 9D    		 call Read8bit	;
579)   9DC7 47          		 ld b, a	;
580)   9DC8 CD AB 9D    		 call Read8bit	;
581)   9DCB 4F          		 ld c, a	;
582)   9DCC C9          		 ret	;
590)   9DCD 7E          		 ld a, (hl)	;
591)   9DCE 23          		 inc hl	;
592)   9DCF D6 30       		 sub '0'	;
593)   9DD1 CB 27       		 sla a	;
594)   9DD3 CB 27       		 sla a	;
595)   9DD5 CB 27       		 sla a	;
596)   9DD7 CB 27       		 sla a	;
597)   9DD9 47          		 ld b, a	;
598)   9DDA 7E          		 ld a, (hl)	;
599)   9DDB 23          		 inc hl	;
600)   9DDC D6 30       		 sub '0'	;
601)   9DDE B0          		 or b	;
602)   9DDF C9          		 ret	;
607)   9DE0 4F          		 ld c, a        ; a = number to convert	; a = number to convert
608)   9DE1 CD ED 9D    		 call Num1	;
609)   9DE4 77          		 ld (hl), a	;
610)   9DE5 23          		 inc hl	;
611)   9DE6 79          		 ld a, c	;
612)   9DE7 CD F1 9D    		 call Num2	;
613)   9DEA 77          		 ld (hl), a	;
614)   9DEB 23          		 inc hl	;
615)   9DEC C9          		 ret	;
616)   9DED 1F          		Num1: rra	;
617)   9DEE 1F          		 rra	;
618)   9DEF 1F          		 rra	;
619)   9DF0 1F          		 rra	;
620)   9DF1 F6 F0       		Num2: or $F0	;
621)   9DF3 27          		 daa	;
622)   9DF4 C6 A0       		 add a, $A0	;
623)   9DF6 CE 40       		 adc a, $40        ; Ascii hex at this point (0 to F)	; Ascii hex at this point (0 to F)
624)   9DF8 C9          		 ret	;
635)   9DF9 22 AC 00    		STR_SET: LD (LINESTR),HL	;
636)   9DFC C9          		 RET	;
639)   9DFD AF          		STR_CLR: XOR A	;
640)   9DFE 32 AE 00    		 LD (LINEPOS),A	;
641)   9E01 32 AC 00    		 LD (LINESTR),A	;
642)   9E04 32 AD 00    		 LD (LINESTR+1),A	;
643)   9E07 C9          		 RET	;
646)   9E08 3A AC 00    		STR_VALID: LD A,(LINESTR)	;
647)   9E0B 47          		 LD B,A	;
648)   9E0C 3A AD 00    		 LD A,(LINESTR+1)	;
649)   9E0F 80          		 ADD B	;
650)   9E10 B7          		 OR A	;
651)   9E11 C9          		 RET	;
657)   9E12 F5          		STR_CALCADDR: PUSH AF	;
658)   9E13 ED 5B AC 00 		 LD DE,(LINESTR)	;
659)   9E17 EB          		 EX DE,HL	;
660)   9E18 3A AE 00    		 LD A,(LINEPOS)	;
661)   9E1B 4F          		 LD C,A	;
662)   9E1C 06 00       		 LD B,0	;
663)   9E1E 09          		 ADD HL,BC	;
664)   9E1F EB          		 EX DE,HL	;
665)   9E20 F1          		 POP AF	;
666)   9E21 C9          		 RET	;
670)   9E22 3A AE 00    		STR_NEXTPOS: LD A,(LINEPOS)	;
671)   9E25 3C          		 INC A	;
672)   9E26 32 AE 00    		 LD (LINEPOS),A	;
673)   9E29 C9          		 RET	;
677)   9E2A CD 12 9E    		STR_ADD: CALL STR_CALCADDR	;
678)   9E2D CD 22 9E    		STRA_AGN: CALL STR_NEXTPOS	;
679)   9E30 7E          		 LD A,(HL)	;
680)   9E31 12          		 LD (DE),A	;
681)   9E32 23          		 INC HL	;
682)   9E33 13          		 INC DE	;
683)   9E34 B7          		 OR A	;
684)   9E35 C8          		 RET Z	;
685)   9E36 18 F5       		 JR STRA_AGN	;
688)   9E38 CD 12 9E    		STR_ADDCHAR: CALL STR_CALCADDR	;
689)   9E3B 12          		 LD (DE),A	;
690)   9E3C CD 22 9E    		 CALL STR_NEXTPOS	;
691)   9E3F 13          		 INC DE	;
692)   9E40 AF          		 XOR A	;
693)   9E41 12          		 LD (DE),A	;
694)   9E42 C9          		 RET	;
702)   9E43 26 00       		@PRINTNUM: LD H,0	;
703)   9E45 6F          		 LD L,A	;
704)   9E46 F5          		@PRINTNUM16: PUSH AF	;
706)   9E47 11 BC 00    		 LD DE,NUMBUF	;
707)   9E4A CD 9D 9C    		 CALL Bcd2ASC  ;FOR HEX	;FOR HEX
708)   9E4D 3E 68       		 LD A,'h'	;
709)   9E4F 12          		 LD (DE),A  	;
710)   9E50 13          		 INC DE	;
711)   9E51 AF          		 XOR A	;
712)   9E52 12          		 LD (DE),A  	;
714)   9E53 21 BC 00    		 LD HL,NUMBUF	;
715)   9E56 CD 93 8C    		 CALL RS_TXT	;
716)   9E59 CD F3 8C    		 CALL RS_NEWLINE	;
717)   9E5C F1          		 POP AF	;
718)   9E5D C9          		 RET	;
726)   9E5E E5          		@NUM_ADDZERO: PUSH HL	;
727)   9E5F 0E 00       		 LD C,0	;
728)   9E61 7E          		AZ_AGN: LD A,(HL)   	;
729)   9E62 23          		 INC HL	;
730)   9E63 0C          		 INC C	;
731)   9E64 FE 00       		 CP 0	;
732)   9E66 20 F9       		 JR NZ,AZ_AGN	;
733)   9E68 0D          		 DEC C ;EXCLUDE ZERO TERM	;EXCLUDE ZERO TERM
734)   9E69 E1          		 POP HL	;
735)   9E6A 79          		 LD A,C	;
736)   9E6B B8          		 CP B	;
737)   9E6C C8          		 RET Z	;
739)   9E6D 78          		 LD A,B	;
740)   9E6E 91          		 SUB C	;
741)   9E6F D8          		 RET C ;RETURN IF CARRY MEANS WE HAVE MORE DIGITS	;RETURN IF CARRY MEANS WE HAVE MORE DIGITS
742)   9E70 47          		 LD B,A	;
743)   9E71 3E 30       		 LD A,'0'	;
744)   9E73 2B          		AZ_AGN2: DEC HL	;
745)   9E74 77          		 LD (HL),A	;
746)   9E75 10 FC       		 DJNZ AZ_AGN2 	;
747)   9E77 C9          		 RET	;
753)   9E78 11 F0 00    		@COPYFNAME: LD DE,STRGBUFF	;
754)   9E7B 7E          		@COPYSTRING:   LD A,(HL)	;
755)   9E7C 12          		 LD (DE),A	;
756)   9E7D FE 00       		 CP 0	;
757)   9E7F C8          		 RET Z  	;
758)   9E80 13          		 INC DE	;
759)   9E81 23          		 INC HL	;
760)   9E82 18 F7       		 JR COPYSTRING	;
764)   9E84 16 00       		@Mul8b: ld d,0                         ; clearing D and L	; clearing D and L
765)   9E86 6A          		   ld l,d	;
766)   9E87 06 08       		   ld b,8                         ; we have 8 bits	; we have 8 bits
767)   9E89 29          		Mul8bLoop:  add hl,hl                      ; advancing a bit	; advancing a bit
768)   9E8A D2 8E 9E    		   jp nc,Mul8bSkip                ; if zero, we skip the addition (jp is used for speed)	; if zero, we skip the addition (jp is used for speed)
769)   9E8D 19          		   add hl,de                      ; adding to the product if necessary	; adding to the product if necessary
770)   9E8E 10 F9       		Mul8bSkip: djnz Mul8bLoop	;
771)   9E90 C9          		   ret	;
774)   9E91 21 00 00    		MUL: LD HL, 0             ; Clear HL	; Clear HL
775)   9E94 57          		     LD D, A              ; D = A (number of microseconds)	; D = A (number of microseconds)
776)   9E95 59          		     LD E, C              ; E = C (CPU speed)	; E = C (CPU speed)
777)   9E96 19          		MUL_LOOP: ADD HL, DE          ; HL = HL + DE	; HL = HL + DE
778)   9E97 15          		     DEC D                ; Decrement D	; Decrement D
779)   9E98 20 FC       		     JR NZ, MUL_LOOP      ; Repeat until D is zero	; Repeat until D is zero
780)   9E9A C9          		     RET	;
783)   9E9B AF          		DIV:    XOR A                ; Clear A (quotient)	; Clear A (quotient)
784)   9E9C 06 10       		     LD B, 16             ; Set bit counter (16 bits)	; Set bit counter (16 bits)
785)   9E9E 29          		DIV_LOOP:      ADD HL, HL           ; Shift HL left	; Shift HL left
786)   9E9F CB 17       		     RL A                 ; Shift A left through carry	; Shift A left through carry
787)   9EA1 BB          		     CP E                 ; Compare A with E	; Compare A with E
788)   9EA2 38 02       		     JR C, NO_SUB         ; If A < E, skip subtraction	; If A < E, skip subtraction
789)   9EA4 93          		     SUB E                ; A = A - E	; A = A - E
790)   9EA5 2C          		     INC L                ; Increment L (part of quotient)	; Increment L (part of quotient)
791)   9EA6 10 F6       		NO_SUB: DJNZ DIV_LOOP        ; Loop 16 times	; Loop 16 times
792)   9EA8 C9          		     RET                  ; Return with quotient in A	; Return with quotient in A
  1)   9EA9 00 00 00 00 		DS 0A000H-$	;
  1)   9EAD 00 00 00 00 		DS 0A000H-$	;
  1)   9EB1 00 00 00 00 		DS 0A000H-$	;
  1)   9EB5 00 00 00 00 		DS 0A000H-$	;
  1)   9EB9 00 00 00 00 		DS 0A000H-$	;
  1)   9EBD 00 00 00 00 		DS 0A000H-$	;
  1)   9EC1 00 00 00 00 		DS 0A000H-$	;
  1)   9EC5 00 00 00 00 		DS 0A000H-$	;
  1)   9EC9 00 00 00 00 		DS 0A000H-$	;
  1)   9ECD 00 00 00 00 		DS 0A000H-$	;
  1)   9ED1 00 00 00 00 		DS 0A000H-$	;
  1)   9ED5 00 00 00 00 		DS 0A000H-$	;
  1)   9ED9 00 00 00 00 		DS 0A000H-$	;
  1)   9EDD 00 00 00 00 		DS 0A000H-$	;
  1)   9EE1 00 00 00 00 		DS 0A000H-$	;
  1)   9EE5 00 00 00 00 		DS 0A000H-$	;
  1)   9EE9 00 00 00 00 		DS 0A000H-$	;
  1)   9EED 00 00 00 00 		DS 0A000H-$	;
  1)   9EF1 00 00 00 00 		DS 0A000H-$	;
  1)   9EF5 00 00 00 00 		DS 0A000H-$	;
  1)   9EF9 00 00 00 00 		DS 0A000H-$	;
  1)   9EFD 00 00 00 00 		DS 0A000H-$	;
  1)   9F01 00 00 00 00 		DS 0A000H-$	;
  1)   9F05 00 00 00 00 		DS 0A000H-$	;
  1)   9F09 00 00 00 00 		DS 0A000H-$	;
  1)   9F0D 00 00 00 00 		DS 0A000H-$	;
  1)   9F11 00 00 00 00 		DS 0A000H-$	;
  1)   9F15 00 00 00 00 		DS 0A000H-$	;
  1)   9F19 00 00 00 00 		DS 0A000H-$	;
  1)   9F1D 00 00 00 00 		DS 0A000H-$	;
  1)   9F21 00 00 00 00 		DS 0A000H-$	;
  1)   9F25 00 00 00 00 		DS 0A000H-$	;
  1)   9F29 00 00 00 00 		DS 0A000H-$	;
  1)   9F2D 00 00 00 00 		DS 0A000H-$	;
  1)   9F31 00 00 00 00 		DS 0A000H-$	;
  1)   9F35 00 00 00 00 		DS 0A000H-$	;
  1)   9F39 00 00 00 00 		DS 0A000H-$	;
  1)   9F3D 00 00 00 00 		DS 0A000H-$	;
  1)   9F41 00 00 00 00 		DS 0A000H-$	;
  1)   9F45 00 00 00 00 		DS 0A000H-$	;
  1)   9F49 00 00 00 00 		DS 0A000H-$	;
  1)   9F4D 00 00 00 00 		DS 0A000H-$	;
  1)   9F51 00 00 00 00 		DS 0A000H-$	;
  1)   9F55 00 00 00 00 		DS 0A000H-$	;
  1)   9F59 00 00 00 00 		DS 0A000H-$	;
  1)   9F5D 00 00 00 00 		DS 0A000H-$	;
  1)   9F61 00 00 00 00 		DS 0A000H-$	;
  1)   9F65 00 00 00 00 		DS 0A000H-$	;
  1)   9F69 00 00 00 00 		DS 0A000H-$	;
  1)   9F6D 00 00 00 00 		DS 0A000H-$	;
  1)   9F71 00 00 00 00 		DS 0A000H-$	;
  1)   9F75 00 00 00 00 		DS 0A000H-$	;
  1)   9F79 00 00 00 00 		DS 0A000H-$	;
  1)   9F7D 00 00 00 00 		DS 0A000H-$	;
  1)   9F81 00 00 00 00 		DS 0A000H-$	;
  1)   9F85 00 00 00 00 		DS 0A000H-$	;
  1)   9F89 00 00 00 00 		DS 0A000H-$	;
  1)   9F8D 00 00 00 00 		DS 0A000H-$	;
  1)   9F91 00 00 00 00 		DS 0A000H-$	;
  1)   9F95 00 00 00 00 		DS 0A000H-$	;
  1)   9F99 00 00 00 00 		DS 0A000H-$	;
  1)   9F9D 00 00 00 00 		DS 0A000H-$	;
  1)   9FA1 00 00 00 00 		DS 0A000H-$	;
  1)   9FA5 00 00 00 00 		DS 0A000H-$	;
  1)   9FA9 00 00 00 00 		DS 0A000H-$	;
  1)   9FAD 00 00 00 00 		DS 0A000H-$	;
  1)   9FB1 00 00 00 00 		DS 0A000H-$	;
  1)   9FB5 00 00 00 00 		DS 0A000H-$	;
  1)   9FB9 00 00 00 00 		DS 0A000H-$	;
  1)   9FBD 00 00 00 00 		DS 0A000H-$	;
  1)   9FC1 00 00 00 00 		DS 0A000H-$	;
  1)   9FC5 00 00 00 00 		DS 0A000H-$	;
  1)   9FC9 00 00 00 00 		DS 0A000H-$	;
  1)   9FCD 00 00 00 00 		DS 0A000H-$	;
  1)   9FD1 00 00 00 00 		DS 0A000H-$	;
  1)   9FD5 00 00 00 00 		DS 0A000H-$	;
  1)   9FD9 00 00 00 00 		DS 0A000H-$	;
  1)   9FDD 00 00 00 00 		DS 0A000H-$	;
  1)   9FE1 00 00 00 00 		DS 0A000H-$	;
  1)   9FE5 00 00 00 00 		DS 0A000H-$	;
  1)   9FE9 00 00 00 00 		DS 0A000H-$	;
  1)   9FED 00 00 00 00 		DS 0A000H-$	;
  1)   9FF1 00 00 00 00 		DS 0A000H-$	;
  1)   9FF5 00 00 00 00 		DS 0A000H-$	;
  1)   9FF9 00 00 00 00 		DS 0A000H-$	;
  1)   9FFD 00 00 00    		DS 0A000H-$	;
